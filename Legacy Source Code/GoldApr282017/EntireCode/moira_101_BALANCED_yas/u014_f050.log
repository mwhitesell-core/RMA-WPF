/alpha/rmabill/rmabill101/dvlp/moira
Thu Aug 23 17:14:41 EDT 2012
 + + + Sourced in /alpha/rmabill/rmabill101/dvlp/moira + + +
;Compiling program [/alpha/rmabill/rmabill101/dvlp/moira/u014_f050.qts]
Q T P   (7.33.E)
Copyright 1996 COGNOS INCORPORATED
Licensed PH-RUNTIME for customer: 5139390001 C.O.T.A UNIX

> ;#> PROGRAM-ID.     u014_f050.qts
> ;
> ;       ((C)) Dyad Technologies
> ;
> ;    PURPOSE: transfer the current status of the f050 revenue files
> ;	      to the appropriate history files to keep a snapshot of the
> ;	      revenue at the end of the month.
> ;
> ;    MODIFICATION HISTORY
> ;     DATE     WHO      DESCRIPTION
> ; 2000/jan/10  B.E.	- original
> ; 2000/jan/18  B.E.	- constants master PED has yyyymmdd but each dd
> ;			  is different for each clinic and we want all
> ;			  clinic data to be easily accessible for the
> ;			  same period. Therefore the 'dd' portion of the
> ;			  clinic's PED is ignored and '01' is used. For
> ;			  the 13th month the 'update' action on the output
> ;			  statement is will 12th monthend values.
> ; 2000/apr/27 B.E.      - changed output on f050-history to have separate
> ;                         output statements for add and update
> ; 2000/jun/18 B.E.	- for clinic 61-65 the passed parameter is 60 so
> ;			  the match for clinic-nbr must be only on 1st digitS
> ; 2000/jul/08 B.E.	- corrected bug on item statement for output to file 'f050-hist-update'
> ;			  where the items statement for incorrectly set for file 'f050-hist-add'
> ;
> ; 2003/jun/15 M.C.	- corrected bug on MTD item statement for output to file 'f050-hist-update'
> ; 2007/apr/10 M.C.	- for clinic 71-75 the passed parameter is 70 so
> ;			  the match for clinic-nbr must be only on 1st digit
> ; 2009/sep/29 M.C.      - correct the criteria for clinic 60 and clinic 70 when updating to
> ;                         f050 history file via u014_f050 subfile
> ; 2010/feb/10 MC1	- include clinic 66
> ; 2011/feb/28 MC2	- comment out set stacksize 10000, change from set lock file update
> ;			  to set lock record update, remove alias f050-hist-update on output update statement
> ;			  hopefully this clear out  the data conversion error for selected clinics even though
> ;			  the records were created properly.
> ; 2012/jul/09 MC3       - use PED of payroll system to select f050 records
> ;                         rather than PED of clinic
> ;                       - modify to use yearend PED as yyyy0630 if ep-nbr = yyyy13
> ; 2012/aug/23 MC4       - undo MC3 - cannot use ep-nbr of the payroll system since this program will only execute
> ;			  after the payroll run which will increase ep-nbr by 1 at the end of the run
> ;			- assuming yearend ped should be the last day of June ie yyyy0630 and 12 monthend ped
> ;			  should not = yyyymm30 (usually third week of the month)
> 
> cancel clear
> ; 2011/02/28 - MC2
> ;set stacksize 10000
> ; 2011/02/28 -  end
> run u014_f050
> 
> set default
WORKSPACE and STACKSIZE can't be reset within a QTP run.
> ; 2011/02/28 - MC2
> ;set lock file update
> set lock record update
> ; 2011/02/28 - end
> 
> set process nolimit
> 
> ; define globals for this run
> use $use/get_const_rec_7_values_globals.qts
> ; File: globals_get_const_rec_7_values.qts
> 
> ;-------------------------------------------------------------------------------
> ; obtain current costing "constants" and pass to subsequent requests
> ;
> global temp w-current-fiscal-start-yymmdd   date
> global temp w-current-fiscal-end-yymmdd     date
> global temp w-current-costing-cutoff-yymmdd date
> global temp w-current-costing-ped	    date
> global temp w-current-costing-ped-yymm	    zoned*6
> 
> global temp w-previous-fiscal-start-yymmdd  date
> global temp w-previous-fiscal-end-yymmdd    date
> 
> global temp w-ep-yr num*2
> 
> 
> global temp x-selected-clinic       num*2 	parm			&
> 	prompt "Enter CLINIC(2 digits) to be transferred to history: "
> global temp x-selected-clinic-alpha char*2
> 
> ;-------------------------------------------------------------------------------
> ; obtain current costing "constants" and pass to subsequent requests
> ;
> use $use/get_const_rec_7_values.qts
> ; File: get_const_rec_7_values.qts
> 
> ;-------------------------------------------------------------------------------
> ; obtain current costing "constants" and pass to subsequent requests
> ;
> 
> request costing1_get_rec_7              &
>                 on edit        errors report    &
>                 on calculation errors report
> access constants-mstr-rec-7
> choose const-rec-nbr 7
*W* Item (CONST-REC-NBR) is stored by the file system as a character type.
Choose viaindex CONSTANTS-MSTR-REC-7.
> 
> item w-current-fiscal-start-yymmdd   = current-fiscal-start-yymmdd
> item w-current-fiscal-end-yymmdd     = current-fiscal-end-yymmdd
> item w-current-costing-cutoff-yymmdd = current-costing-cutoff-yymmdd
> item w-current-costing-ped	     = current-costing-ped
> item w-current-costing-ped-yymm      = current-costing-ped / 100
> 
> item w-previous-fiscal-start-yymmdd  = previous-fiscal-start-yymmdd
> item w-previous-fiscal-end-yymmdd    = previous-fiscal-end-yymmdd
> item w-ep-yr			     = ep-yr
> 
> ;-------------------------------------------------------------------------------
> ;
> 
> item x-selected-clinic-alpha        = ascii(x-selected-clinic,2)
> 
> request u014_transfer_f050_to_f050_hist         &
>                 on edit        errors report    &
>                 on calculation errors report
> 
> access f050-doc-revenue-mstr			&
>    link x-selected-clinic			&
>     to iconst-clinic-nbr-1-2  of iconst-mstr-rec
> 
> 
> ; (for clinic 61-66 passed parameter is 60 so match only on 1st digit)
> ; (for clinic 71-70 passed parameter is 70 so match only on 1st digit)
> def x-selected-clinic-1 char*1 = ascii(x-selected-clinic,2)[1:1]
> def x-docrev-clinic-1   char*1 =       docrev-clinic-1-2   [1:1]
> select if docrev-clinic-1-2 					&
>         =    x-selected-clinic-alpha                            &
>          or (    x-selected-clinic-alpha = "60"                 &
> ; 2009/09/29 - MC - match the specific clinic range instead of ONLY the first digit
> ;             and x-selected-clinic-1     = x-docrev-clinic-1    &
> ; 2010/02/10 - MC1 - include clinic 66
> ;             and (docrev-clinic-1-2 >= '61' and docrev-clinic-1-2 <= '65')   &
>               and (docrev-clinic-1-2 >= '61' and docrev-clinic-1-2 <= '66')   &
> ; 2010/02/10 - end
> ; 2009/09/29 - end
>             )							&
>          or (    x-selected-clinic-alpha = "70"                 &
> ; 2009/09/29 - MC - match the specific clinic range instead of ONLY the first digit
> ;             and x-selected-clinic-1     = x-docrev-clinic-1    &
>               and (docrev-clinic-1-2 >= '71' and docrev-clinic-1-2 <= '75')   &
> ; 2009/09/29 - end
>             )
> 
> ; 2012/08/23 - MC4
> def ped-dd zoned*2 unsigned = mod(iconst-date-period-end of iconst-mstr-rec,100)
> ; 2012/08/23 - end
> 
> ;  (PED from constants master has yyyymmdd however each clinic's dd is
> ;   different for the same month.
> ;   Therefore use hard coded '01' for dd so that each clinics data is
> ;   in effect stored at the yyyymm level and thus monthly values can
> ;   be easily obtained across clinic)
> def x-iconst-date-period-end date = 					&
>      nconvert(								&
> 	         ascii (						&
> 		        ( iconst-date-period-end of iconst-mstr-rec	&
> 		         /100   					&
> 		        )						&
> 		       ,6)						&
>     	       + '01'							&
> 	     )								&
> ; 2012/08/23 - MC4 - add if condition - to check if monthend or yearend
>         if ped-dd <> 30                                                 &
>     else   iconst-date-period-end  of iconst-mstr-rec
> 
> ; 2012/08/23 - end
> 
> subfile u014_f050 keep include		 &
>      x-iconst-date-period-end		,&
>      f050-doc-revenue-mstr
> 
> 
> request u014_transfer_f050_to_f050_hist         &
>                 on edit        errors report    &
>                 on calculation errors report
> 
> ; 2011/02/28 - MC2 - redundant
> ;set process nolimit
> ; 2011/02/28 - end
> 
> access *u014_f050 				&
>   link w-ep-yr,					&
>        x-iconst-date-period-end, 		&
>        docrev-key 				&
>     to ep-yr,					&
>        iconst-date-period-end,			&
>        docrev-key of f050-doc-revenue-mstr-history   opt
> 
> 
> ;(the 13th monthend processing will use the 'update' action on the output
> ; statement to update the 12th monthend values)
> 
> output f050-doc-revenue-mstr-history alias f050-hist-add   add 		&
>   if not record f050-doc-revenue-mstr-history exists
> 
>   item ep-yr 			initial w-ep-yr
>   item iconst-date-period-end	initial x-iconst-date-period-end
> 
> ; 2011/02/28 - MC2
> ;output f050-doc-revenue-mstr-history alias f050-hist-update update 	&
> output f050-doc-revenue-mstr-history update 	&
> ; 2011/02/28 - end
>   if     record f050-doc-revenue-mstr-history exists
> 
> ; 2003/06/13 - MC
> ;(the 13th monthend processing will use the 'update' action on the output
> ; statement to update the 12th monthend values for YTD , but subtotal for
> ; MTD
> 
> ;Item DOCREV-MTD-IN-REC  OF F050-HIST-update final DOCREV-MTD-IN-REC  OF U014_F050
> ;Item DOCREV-MTD-IN-SVC  OF F050-HIST-update final DOCREV-MTD-IN-SVC  OF U014_F050
> ;Item DOCREV-MTD-OUT-REC OF F050-HIST-update final DOCREV-MTD-OUT-REC OF U014_F050
> ;Item DOCREV-MTD-OUT-SVC OF F050-HIST-update final DOCREV-MTD-OUT-SVC OF U014_F050
> 
> ; 2011/02/28 - MC2
> ;Item DOCREV-MTD-IN-REC  OF F050-HIST-update subtotal DOCREV-MTD-IN-REC  OF U014_F050
> ;Item DOCREV-MTD-IN-SVC  OF F050-HIST-update subtotal DOCREV-MTD-IN-SVC  OF U014_F050
> ;Item DOCREV-MTD-OUT-REC OF F050-HIST-update subtotal DOCREV-MTD-OUT-REC OF U014_F050
> ;Item DOCREV-MTD-OUT-SVC OF F050-HIST-update subtotal DOCREV-MTD-OUT-SVC OF U014_F050
> ;Item DOCREV-YTD-IN-REC  OF F050-HIST-update final DOCREV-YTD-IN-REC  OF U014_F050
> ;Item DOCREV-YTD-IN-SVC  OF F050-HIST-update final DOCREV-YTD-IN-SVC  OF U014_F050
> ;Item DOCREV-YTD-OUT-REC OF F050-HIST-update final DOCREV-YTD-OUT-REC OF U014_F050
> ;Item DOCREV-YTD-OUT-SVC OF F050-HIST-update final DOCREV-YTD-OUT-SVC OF U014_F050
> Item DOCREV-MTD-IN-REC  OF f050-doc-revenue-mstr-history subtotal DOCREV-MTD-IN-REC  OF U014_F050
> Item DOCREV-MTD-IN-SVC  OF f050-doc-revenue-mstr-history subtotal DOCREV-MTD-IN-SVC  OF U014_F050
> Item DOCREV-MTD-OUT-REC OF f050-doc-revenue-mstr-history subtotal DOCREV-MTD-OUT-REC OF U014_F050
> Item DOCREV-MTD-OUT-SVC OF f050-doc-revenue-mstr-history subtotal DOCREV-MTD-OUT-SVC OF U014_F050
> Item DOCREV-YTD-IN-REC  OF f050-doc-revenue-mstr-history final DOCREV-YTD-IN-REC  OF U014_F050
> Item DOCREV-YTD-IN-SVC  OF f050-doc-revenue-mstr-history final DOCREV-YTD-IN-SVC  OF U014_F050
> Item DOCREV-YTD-OUT-REC OF f050-doc-revenue-mstr-history final DOCREV-YTD-OUT-REC OF U014_F050
> Item DOCREV-YTD-OUT-SVC OF f050-doc-revenue-mstr-history final DOCREV-YTD-OUT-SVC OF U014_F050
> ; 2011/02/28 - end
> 
> ; 2003/06/13 - end
> 
> 
> 
> 
> build $obj/u014_f050
0 ERRORS  1 WARNINGS.
Item DOCREV-CLINIC-1-2 OF F050-HIST-ADD initial DOCREV-CLINIC-1-2 OF U014_F050.
Item DOCREV-DEPT OF F050-HIST-ADD initial DOCREV-DEPT OF U014_F050.
Item DOCREV-DOC-NBR OF F050-HIST-ADD initial DOCREV-DOC-NBR OF U014_F050.
Item DOCREV-LOCATION OF F050-HIST-ADD initial DOCREV-LOCATION OF U014_F050.
Item DOCREV-OMA-CODE OF F050-HIST-ADD initial DOCREV-OMA-CODE OF U014_F050.
Item DOCREV-ADJ-CD-SUB-TYPE OF F050-HIST-ADD initial DOCREV-ADJ-CD-SUB-TYPE OF 
U014_F050.
Item DOCREV-MTD-IN-REC OF F050-HIST-ADD initial DOCREV-MTD-IN-REC OF U014_F050.
Item DOCREV-MTD-IN-SVC OF F050-HIST-ADD initial DOCREV-MTD-IN-SVC OF U014_F050.
Item DOCREV-MTD-OUT-REC OF F050-HIST-ADD initial DOCREV-MTD-OUT-REC OF 
U014_F050.
Item DOCREV-MTD-OUT-SVC OF F050-HIST-ADD initial DOCREV-MTD-OUT-SVC OF 
U014_F050.
Item DOCREV-YTD-IN-REC OF F050-HIST-ADD initial DOCREV-YTD-IN-REC OF U014_F050.
Item DOCREV-YTD-IN-SVC OF F050-HIST-ADD initial DOCREV-YTD-IN-SVC OF U014_F050.
Item DOCREV-YTD-OUT-REC OF F050-HIST-ADD initial DOCREV-YTD-OUT-REC OF 
U014_F050.
Item DOCREV-YTD-OUT-SVC OF F050-HIST-ADD initial DOCREV-YTD-OUT-SVC OF 
U014_F050.
Thu Aug 23 17:14:46 EDT 2012
