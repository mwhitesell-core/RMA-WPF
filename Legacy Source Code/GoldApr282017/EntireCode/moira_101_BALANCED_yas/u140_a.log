/alpha/rmabill/rmabill101/dvlp/moira
Tue Apr  3 15:35:23 EDT 2012
 + + + Sourced in /alpha/rmabill/rmabill101/dvlp/moira + + +
;Compiling program [/alpha/rmabill/rmabill101/dvlp/moira/u140_a.qts]
Q T P   (7.33.E)
Copyright 1996 COGNOS INCORPORATED
Licensed PH-RUNTIME for customer: 5139390001 C.O.T.A UNIX

> ; Program: u140_a
> ; Purpose: Before the RA is run this program must to be to put all doctors
> ;	   into the f075 file with an indication of the number of doctors
> ;	   that share the same MOH OHIP Number
> ;	   This f075 file is then updated with the RA payments and based upon
> ;	   the split between a doctors RMA doctors of their RA Payments the
> ;	   same ratio is used to divy up the single AFP payment identified
> ;	   only with the doctor's OHIP number
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> ;
> ;  NOTE:  BEWARE -  what you see in field doc-afp-paym-group in subfiles and /or files
> ;		    is not from f020-doctor-mstr, but it is translated from the clinic nbr
> ;		    that is assigned to the doctor
> ;
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> ; 2005/apr/08 b.e. - set lock update statement
> ; 2005/apr/13 M.C. - count number of doctors within the group with MOH ohip number
> ; 2005/may/10 b.e. - removed all select statements on doctors so that both
> ;	  	     active and terminated doctors are selected
> ; 2007/jul/19 M.C. - create a new request 'u140_extract_doc_afp_group' in the beginning
> ;                    and a new request'u140_update_doc_count' at the end of the program
> ; 2008/sep/09 M.C. - create a new request to extract doctor records  for the incoming group from A2S file
> ;		     into f075-afp-doc-mstr  with an indication of the number of doctors
> ; 2008/oct/16 M.C. - include doc-nbr in the sort statement in request u140_doc_afp_group
> ;		     and include doc-nbr in the access in the request u140_create_f075_records
> ; 2008/nov/04 M.C. - Brad said that we should explode the group records only if doc-afp-paym-group
> ;		     of f020-doctor-mstr is non-blank
> ; 2008/dec/02 MC1  - undo on 2008/nov/04  - because dr 888 - Tarnolopsky 187427 has blank afp group defined in f020
> ;		     and did not show on r140_b.txt report, he has 2 records from Dec governance which have
> ;		     non-zero amt under H522 & H523
> ; 2009/jul/08 MC2  - include f074-afp-group-sequence-mstr in the access of request u140_extract_reporting_grp
> ;		   - check on nonrbp-flag or solo-flag instead of hard coded group number
> ; 2011/nov/09 MC3  - change the sort in request u140_doc_afp_group so that the active doctor will be selected
> ;		     for the same group number
> ; 2012/Apr/03 MC4  - Brad suggested to filter out (ignore) doctor with blank doc-afp-paym-group of f020-doctor-mstr
> ;		     before creating records in f075 file in u140_create_f075_records request.
> ;		     This is for the example 266049 with 3 different doctor records
> ;		     and has applied to the wrong doctor K79 and it should be 780.
> ;		     K79 Active with dept 31 and blank group
> ;		     780 Active with dept 14 and H111  group
> ;		     L69 Terminate with dept 14 and H111 group
> 
> cancel clear
> 
> run u140_a
> set process nolimit
> set lock record update
> 
> ; 2007/07/19 - MC - add the new request to extract doctor afp group
> request u140_extract_doc_afp_group			&
> 	    on calculation errors report		&
> 	    on edit errors report
> 
> access f020-doctor-mstr 			&
> 	link doc-clinic-nbr    to iconst-clinic-nbr-1-2 of iconst-mstr-rec alias clinic1 opt &
>         link  doc-clinic-nbr-2 to iconst-clinic-nbr-1-2 of iconst-mstr-rec alias clinic2 opt &
>         link  doc-clinic-nbr-3 to iconst-clinic-nbr-1-2 of iconst-mstr-rec alias clinic3 opt &
>         link  doc-clinic-nbr-4 to iconst-clinic-nbr-1-2 of iconst-mstr-rec alias clinic4 opt &
>         link  doc-clinic-nbr-5 to iconst-clinic-nbr-1-2 of iconst-mstr-rec alias clinic5 opt &
>         link  doc-clinic-nbr-6 to iconst-clinic-nbr-1-2 of iconst-mstr-rec alias clinic6 opt
> 
> choose doc-ohip-nbr 1 to 999999
*W* Item (DOC-OHIP-NBR) is stored by the file system as a character type.
Choose viaindex DOC-OHIP-NBR.
> 
> ; 2008/11/04 - MC
> ; 2008/12/02 - MC1 - comment out
> ;select if doc-afp-paym-group <> ' '
> ; 2008/12/02 - end
> ; 2008/11/04 - end
> 
> def x-term-date date = 20991231 if doc-date-fac-term = 0 &
> 	else doc-date-fac-term
> 
> subfile u140_afp_group keep 			&
> 	if iconst-clinic-card-colour of clinic1 = 'Y' include &
> doc-ohip-nbr of f020-doctor-mstr,		&
> doc-nbr of f020-doctor-mstr,			&
> ; 2008/09/09 - MC - comment out clinic nbr - not needed
> ;doc-clinic-nbr of f020-doctor-mstr,		&
> ; 2008/09/09 - end
> x-term-date         ,		&
> iconst-clinic-nbr of clinic1
> 
> subfile u140_afp_group alias afpclinic2 append 	&
> 	if iconst-clinic-card-colour of clinic2 = 'Y' include &
> doc-ohip-nbr of f020-doctor-mstr,		&
> doc-nbr of f020-doctor-mstr,			&
> ; 2008/09/09 - MC - comment out clinic nbr - not needed
> ;doc-clinic-nbr-2 of f020-doctor-mstr,		&
> ; 2008/09/09 - end
> x-term-date         ,		&
> iconst-clinic-nbr of clinic2
> 
> subfile u140_afp_group alias afpclinic3 append 	&
> 	if iconst-clinic-card-colour of clinic3 = 'Y' include &
> doc-ohip-nbr of f020-doctor-mstr,		&
> doc-nbr of f020-doctor-mstr,			&
> ; 2008/09/09 - MC - comment out clinic nbr - not needed
> ;doc-clinic-nbr-3 of f020-doctor-mstr,		&
> ; 2008/09/09 - end
> x-term-date         ,		&
> iconst-clinic-nbr of clinic3
> 
> subfile u140_afp_group alias afpclinic4 append 	&
> 	if iconst-clinic-card-colour of clinic4 = 'Y' include &
> doc-ohip-nbr of f020-doctor-mstr,		&
> doc-nbr of f020-doctor-mstr,			&
> ; 2008/09/09 - MC - comment out clinic nbr - not needed
> ;doc-clinic-nbr-4 of f020-doctor-mstr,		&
> ; 2008/09/09 - end
> x-term-date         ,		&
> iconst-clinic-nbr of clinic4
> 
> subfile u140_afp_group alias afpclinic5 append 	&
> 	if iconst-clinic-card-colour of clinic5 = 'Y' include &
> doc-ohip-nbr of f020-doctor-mstr,		&
> doc-nbr of f020-doctor-mstr,			&
> ; 2008/09/09 - MC - comment out clinic nbr - not needed
> ;doc-clinic-nbr-5 of f020-doctor-mstr,		&
> ; 2008/09/09 - end
> x-term-date         ,		&
> iconst-clinic-nbr of clinic5
> 
> subfile u140_afp_group alias afpclinic6 append 	&
> 	if iconst-clinic-card-colour of clinic6 = 'Y' include &
> doc-ohip-nbr of f020-doctor-mstr,		&
> doc-nbr of f020-doctor-mstr,			&
> ; 2008/09/09 - MC - comment out clinic nbr - not needed
> ;doc-clinic-nbr-6 of f020-doctor-mstr,		&
> ; 2008/09/09 - end
> x-term-date         ,		&
> iconst-clinic-nbr of clinic6
> ; 2007/07/19 - end
> 
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> ; 2008/09/09 - MC
> 
> ; Purpose: Extract doctor records  for the incoming group from A2S file into f075-afp-doc-mstr
> ;	   for 'R'eporting Only groups (nonrbp)
> ;
> 
> request u140_extract_reporting_grp			&
> 	    on calculation errors report		&
> 	    on edit errors report
> 
> access afp-a2s-file                                             &
>         link (nconvert(doc-afp-paym-solo))                      &
>         to   doc-ohip-nbr       of f020-doctor-mstr 		&
> ; 2009/07/08 - MC2
>         link doc-afp-paym-group  of afp-a2s-file                &
>         to   doc-afp-paym-group  of f074-afp-group-sequence-mstr opt
> ; 2009/07/08 - end
> 
> 
> def  x-payroll char*1 = parm prompt 'Enter payroll (A/C) : '
> 
> 
> def x-term-date date = 20991231 if doc-date-fac-term = 0 &
> 	else doc-date-fac-term
> 
> 
> def x-nonrbp-group char*1 = 'Y'						           &
> 
> ; 2009/07/08 - MC2
> ;	           if      (      doc-afp-paym-group of afp-a2s-file = 'H262' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H513' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H514' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H515' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H516' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H517' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H518' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H519' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H526' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H528' &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H529' &
> ;			   )
> 		if nonrbp-flag = 'Y' and solo-flag = 'N'
> ; 2009/07/08 - end
> 
> def x-solo-nonrbp-group char*1 = 'Y'						        &
> ; 2009/07/08 - MC2
> ;           if      (      doc-afp-paym-group of afp-a2s-file = 'H262'      &
> ;	                    or (      doc-afp-paym-group of afp-a2s-file >= 'H513' &
> ;	                        and   doc-afp-paym-group of afp-a2s-file <= 'H524' &
> ;			       )							&
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H526'      &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H528'      &
> ;	                    or    doc-afp-paym-group of afp-a2s-file = 'H529'      &
> ;			   )
> 	    if       nonrbp-flag = 'Y'				&
> 		and (solo-flag = 'Y' or solo-flag = 'N')
> ; 2009/07/08 - end
> 
> 
> ;select  if (      doc-afp-paym-group  of f020-doctor-mstr= 'H132'		&
> ;	      and x-payroll = 'C'			&
> ;	   ) 						&
> ;	or (      doc-dept of f020-doctor-mstr = 4 				&
> ;	      and x-payroll = 'A'			&
> ;	   )						&
> ;        or (      doc-afp-paym-group of f020-doctor-mstr = 'H111'		&
> ;	      and x-payroll = 'A'			&
> ;	      and (doc-dept = 14 or doc-dept = 15)	&
> ;           )
> 
> select  if ( x-solo-nonrbp-group = 'Y' and x-payroll = 'C'      &
> 	   ) 			                 		&
> 	or ( x-nonrbp-group = 'Y' and x-payroll = 'A'		&
> 	   )
> 
> 
> subfile u140_afp_group alias afpa2s append include	&
> doc-ohip-nbr of f020-doctor-mstr,		&
> doc-nbr of f020-doctor-mstr,			&
> x-term-date,                            &
> doc-afp-paym-group of  afp-a2s-file
> ; 2009/09/09 - end
> 
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> ; 2008/09/22 - MC - add new request
> 
> request u140_get_unique_doc_group            	&
>                 on edit        errors report 	&
>                 on calculation errors report
> 
> access *u140_afp_group
> 
> define doc-afp-paym-group char*4 = iconst-clinic-nbr
> 
> sort 	on doc-ohip-nbr 	&
> 	on doc-nbr		&
> 	on doc-afp-paym-group
> 
> subfile u140_afp_group_sort keep at doc-afp-paym-group include &
> doc-ohip-nbr,				 &
> doc-nbr,				 &
> x-term-date,     			 &
> doc-afp-paym-group
> 
> ; 2008/09/22 - end
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> 
> request u140_doc_afp_group		       	&
>                 on edit        errors report 	&
>                 on calculation errors report
> 
> access *u140_afp_group_sort
> 
> ; 2011/11/09 - MC3 - move doc-nbr to the end so that the active doctor will get selected for the same group
> 
> ;sort 	on doc-ohip-nbr 	&
> ; 2008/10/16 - MC - include doc-nbr in the sort
> ;	on doc-nbr		&
> ; 2008/10/16 - end
> ;       on doc-afp-paym-group   &
> ;	on x-term-date
> 
> sort   	on doc-ohip-nbr 	&
>         on doc-afp-paym-group   &
> 	on x-term-date          &
>         on doc-nbr
> ; 2011/11/09 - end
> 
> temp x-doc-count
> item x-doc-count = x-doc-count + 1 	&
> 	        reset at doc-afp-paym-group
> 
> subfile u140_a keep include		&
>  doc-ohip-nbr,				&
>  doc-nbr,				&
>  doc-afp-paym-group,			&
>  x-term-date,      	 		&
>  x-doc-count
> 
> ;output tmp-doctor-alpha add at sort-key  on errors report
> ; 2012/02/22 - MC3
> ;output tmp-doctor-alpha add at doc-afp-paym-group  on errors report
> output tmp-doctor-alpha add at doc-nbr   on errors report ;
> ; 2012/02/22 - end
>   item doc-ohip-nbr final   doc-ohip-nbr of u140_afp_group_sort
>   item doc-nbr  final   doc-nbr of u140_afp_group_sort
>   item tmp-alpha-field-1 final doc-afp-paym-group of u140_afp_group_sort
>   item tmp-alpha-field-2 final ascii(x-term-date of u140_afp_group_sort)
>   item tmp-counter-1 final x-doc-count
> 
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> 
> request u140_create_f075_records             	&
>                on edit        errors report 	&
>                on calculation errors report
> 
> access *u140_a              	&
> 	link doc-ohip-nbr,       	&
> ; 2008/10/16 - MC
> 	     doc-nbr,			&
> ; 2012/02/22 - MC3 - include doc-afp-paym-group
> 	     doc-afp-paym-group		&
> ;	 to  doc-ohip-nbr of tmp-doctor-alpha
> ;;	 to  doc-ohip-nbr, doc-nbr of tmp-doctor-alpha
> 
> ; 2012/04/03 - MC4 - link to f020 to get doc-afp-paym-group
> ;	 to  doc-ohip-nbr, doc-nbr, tmp-alpha-field-1   of tmp-doctor-alpha
> 	 to  doc-ohip-nbr, doc-nbr, tmp-alpha-field-1   of tmp-doctor-alpha  &
> 	link doc-nbr             	&
> 	 to  doc-nbr	of f020-doctor-mstr
> ; 2012/04/03 - end
> 
> ; 2012/02/22 - end
> ; 2008/10/16 - end
> 
> ; 2012/02/22 - MC3 - comment out
> ;select if doc-afp-paym-group of u140_a = tmp-alpha-field-1 of tmp-doctor-alpha  &
> ;   and    x-doc-count = tmp-counter-1 of tmp-doctor-alpha
> ; 2012/02/22 - end
> 
> 
> ; 2012/04/03 - MC4
> sort on doc-ohip-nbr		&
>      on doc-afp-paym-group of f020-doctor-mstr d
> 
> temp x-count
> item x-count = x-count + 1 reset at doc-ohip-nbr
> ; 2012/04/03 - end
> 
> subfile braddebug keep include 	&
> doc-ohip-nbr of u140_a , doc-nbr of u140_a, &
> doc-ohip-nbr of tmp-doctor-alpha, doc-nbr of tmp-doctor-alpha, &
>  doc-afp-paym-group of u140_a , &
>  tmp-alpha-field-1 of tmp-doctor-alpha,  &
> x-doc-count ,tmp-counter-1 of tmp-doctor-alpha
*W* Duplicate item name in subfile description : DOC-OHIP-NBR
*W* Duplicate item name in subfile description : DOC-NBR
> 
> ; 2012/04/03 - MC4 - add condition
> ;output f075-afp-doc-mstr add	on errors report
> output f075-afp-doc-mstr add		&
> 	if  doc-afp-paym-group of f020-doctor-mstr <> ' '		&
> 	or (doc-afp-paym-group of f020-doctor-mstr = ' ' and x-count = 1)  &
>  	on errors report
> ; 2012/04/03 - end
>   item doc-ohip-nbr		final doc-ohip-nbr of u140_a
>   item doc-nbr			final doc-nbr      of u140_a
>   item doc-afp-paym-group	final doc-afp-paym-group of u140_a
> 
> 
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> ; 2008/09/22 - MC - add 2 new requests
> request u140_count_f075_nbr_of_doctor 		&
>                 on edit        errors report 	&
>                 on calculation errors report
> 
> 
> access f075-afp-doc-mstr
> 
> sort on doc-ohip-nbr 	        &
>      on doc-afp-paym-group	&
>      on doc-nbr
> 
> temp x-doc-count
> item x-doc-count = x-doc-count + 1 	&
> 	reset at doc-afp-paym-group
> 
> subfile u140_a_doc_count keep at doc-afp-paym-group  &
> include doc-ohip-nbr, doc-afp-paym-group, x-doc-count
> 
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> 
> request u140_update_f075_nbr_of_doctor 		&
>                 on edit        errors report 	&
>                 on calculation errors report
> 
> 
> access *u140_a_doc_count     &
> 	link doc-ohip-nbr    &
> 	 to  doc-ohip-nbr of f075-afp-doc-mstr
> 
> select if doc-afp-paym-group of u140_a_doc_count = doc-afp-paym-group of f075-afp-doc-mstr
> 
> output f075-afp-doc-mstr update on error report
>   item afp-duplicate-doc-count  final x-doc-count
> 
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> 
> build $obj/u140_a
0 ERRORS  3 WARNINGS.
The file /alpha/rmabill/rmabill101/obj/u140_a.qtc already exists. Ok to delete?
Tue Apr  3 15:35:25 EDT 2012
