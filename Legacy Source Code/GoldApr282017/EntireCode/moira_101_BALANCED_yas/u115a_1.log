/alpha/rmabill/rmabill101/dvlp/moira
Thu Feb 11 18:07:25 EST 2016
 + + + Sourced in /alpha/rmabill/rmabill101/dvlp/moira + + +
;Compiling program [/alpha/rmabill/rmabill101/dvlp/moira/u115a_1.qts]
Q T P   (7.33.E)
Copyright 1996 COGNOS INCORPORATED
Licensed PH-RUNTIME for customer: 5139390001 C.O.T.A UNIX

> ;#> program-id.     u115a_1.qts
> ;
> ;       ((C)) Dyad Technologies
> ;
> ;    purpose: sub-process within "earnings generation" process.
> ;             calculate required 'tot'al / 'ytd' transactions as of current EP
> ;
> ;    MODIFICATION HISTORY
> ;        DATE    SAF #  WHO      DESCRIPTION
> ;     92/jan/01  ____   B.E.     - original
> ;     92/may/01  ____   B.E.     - Added YTDGUC logic
> ;     92/may/11  ____   B.E.     - YTDGUC logic changed from 1C to 1B (YTDGUC)
> ;     92/aug/11  ____   b.e.     - moved ytd logic into 2nd request
> ;     92/sep/14  ----   b.e.     - comment out output of YTDGUx transaction
> ;                                  since GTYPEx is now calculated as ytd not
> ;                                  current ep.  If GTYPEx changed re-activatE
> ;                                  the TYDGUx code.
> ;     92/oct/26  ----   B.E.     - Updated F020 with YTDINC value
> ;     92/nov/10         B.E.     - updated F020 within this run with OUTPUT stmt
> ;                                  rather than using U115 SUBFILE.
> ;     93/apr/10         B.E.     - YTDCEA/CEX use values in DOCTOR-MSTR rather
> ;                                  than calculated ones.
> ;     93/may/06         B.E.     - Added SUBFILE F119
> ;     93/may/11         B.E.     - Added ACCESS of F119-DOCTOR-YTD to preset
> ;     93/may/18         B.E.     - INTEGER*4 for zoned*8, F119/F119 SUBFILE changes
> ;                                  YTD values
> ;     93/may/27         B.E.     - *F119 exclude records added to F119
> ;                                - add/subtract F110 "M"anual type recs to
> ;				   F020's YTDEAR (ytd earnings)
> ;                                - changed YTDxxx to use = not < current-ep-nbr
> ;                       ?????? WITH ABOVE = VS < CHANGE IS THIS CODE NOW NOT REQUIRED ????????????????
> ;     93/JUN/01         B.E.     - removed ADD of recs to F119-DOCTOR-YTD, all records
> ;                                 now added to *F119 and then U122 adds them to F119-YTD
> ;     93/JUN/22         B.E.     - added Part timer Expense logic
> ;     93/AUG/09         B.E.     - GST/AMT EXPENSE now calculated by
> ;                                  separating these two amounts from the
> ;                                  the amount of the difference between
> ;                                  GROSS and NET amounts.
> ;     93/SEP/14         B.E.     - added RMA+GST and DEPT MISC/REG Expense Logic
> ;                                  and rounding of result
> ;     93/SEP/20         B.E.     - added separate expenses for RMA MISC/REG.
> ;                                  now using RMAEXR(RMA  Regular expense),
> ;                                            RMAEXM(RMA  Misc.   expense),
> ;                                            DEPEXR(DEPT Regular expense),
> ;                                            DEPEXM(DEPT Misc.   expense)
> ;                                  OUTPUT RMA and DEPT expense only if > 0
> ;     93/SEP/24         B.E.     - added DOCTOR'S CEIEXP to TOTEXP amount
> ;     93/SEP/28         B.E.     - changed update of *F119 from GROSS to NET values
> ;     93/OCT/02         B.E.     - OUTPUT TOTxxx records to *F119 only if > 0
> ;     93/OCT/05         B.E.     - RMA-EXPENSE calc. as diff between GROSS and NET
> ;                                  minus DEPT-EXPENSE even if doctor's RMA
> ;                                  EXPENSE PERCENTAGES are zero.
> ;     93/OCT/26         B.E.     - changed IF > 0  to IF <> 0 on all OUTPUT stmnts
> ;     93/OCT/30         B.E.     - AMT-INCOME-MINUS-EXPENSES-G now allowed  to go
> ;                                  negative (otherwise negative income
> ;                                  wasn't reported correctly)
> ;     93/NOV/26         B.E.     - Reversed GROSS/NET fields on CEIEXP output to *F119
> ;     93/DEC/03         B.E.     - for CEIEXP used AMT-NET not 0 in calc.
> ;     93/DEC/24         B.E.     - put YTDEAR into *F119 for update into F119-DOCTOR-YTD
> ;
> ;     94/MAR/07         M.C.     - ADD THE CONDITIONAL COMPILE FOR 'INCEXP'
> ;                                  LOGIC
> ;     94/MAR/16         M.C.     - INCLUDE COMP-TYPE 'P' IN THE SUBFILE,
> ;                                - CHANGE THE FORMULA FOR CALCULATING
> ;                                  DEPT AND RMA EXPENSE
> ;     95/MAY/02		M.C.	 - ADD THE BACKHOLD AS PART OF THE
> ;				   EXPENSE
> ;     95/MAY/08         M.C.     - COMMENT OUT THE SUBFILE DEBUGU115A,
> ;				   MESSAGE 'VIRTUAL MEMORY HAS EXCEEDED'
> ;				   OCCURRED WHEN EXECUTING PROGRAM EVEN
> ;				   THE STACKSIZE HAS INCREASED FROM 1500
> ;				   TO 10000. NOTE:  KEEP IN MIND THAT
> ;				   SIMILIAR PROBLEM MAY OCCUR IF THERE
> ;				   ARE MORE ITEMS, SUBFILES OR RECORDS
> ;				   TO BE ADDED IN THE REQUESTS
> ;     95/MAY/09		M.C.	 - CALCULATE THE RMA EXPENSE BY THE
> ;				   DOCTOR RMA EXPENSE PERCENTAGE RATHER
> ;				   THAN THE REMAINING VALUE BETWEEN
> ;				   GROSS - NET - DEPT
> ;     95/JUL/05         M.C.     - IF HOLDBACK < 10 CENTS, ADD TO RMA
> ;				   EXPENSE IF RMA-EXPENSE IS NON-ZERO;
> ;				   OTHERWISE, ADD TO DEPT EXPENSE
> ;     95/JUL/14 	M.C.	 - DUE TO VIRTUAL MEMORY HAS EXCEEDED
> ;				   SPLIT THE LAST REQUEST INTO A NEW
> ;				   PROGRAM(U115B.QTS).  IF CHANGES ARE
> ;				   REQUIRED IN THE LAST REQUEST, ALSO
> ;				   MAKE THE SAME CHANGE IN U115B.QTS
> ;     95/SEP/15		M.C.	 - INCLUDE 'E'XPENSE RECORDS AS PART OF
> ;				   FINAL-ALL-EXPENSES
> ;     95/NOV/07		M.C.	 - PDR 634 - INCLUDE NEW CONDITION FOR
> ;				   TOT-REVHBK DEFINITION
> ;     95/NOV/22  	M.C.	 - OPTIMIZE THE PROGRAM BY DELETING ALL
> ;				   THE UNUSED TEMP & DEFINE ITEMS
> ;     96/APR/19		M.C.	 - INCLUDE 'REVCLA' IN TOT-REVHBK
> ;   1999/Feb/18         S.B.     - Checked for Y2K.
> ;   1999/Jun/07		S.B.	 - Altered the call to gst.use to call
> ;				   from $use instead of src.
> ; 00/nov/23.B.E.	- HOLDBK calculation has some rounding problems whereby
> ;			  hold backs in the amount of a few cents occur. The
> ;			  original logic ignored values less than 10 cents.
> ;			  Changed to ignore anything less than $1.00
> ; 00/mar/01 B.E.	- added debug subfiles and cosmetic alignment
> ;			  of calculations
> ; 03/jan/21 B.E.	- added doc-nbr to debug file debugu115a_at_doc_nbr
> ; 03/dec/16 A.A.	- alpha doctor nbr
> ; 04/jan/28 b.e.	- calculation of RMAEXR/RMAEXM which are based upon
> ;			tot-rma-expense-only-reg/misc created only if calc is
> ;			positive (doesn't fix all of problem but at least if
> ;			total amount for month is negative we don't create
> ;			negative charge)
> ; 04/mar/01 b.e.	- added 'O'ther 'I'ncome processing in addition to
> ;			  current logic that handles 'R'egular and 'M'isc
> ;			  types of Income.
> ; 04/mac/25 b .e.	- changed sequence of factor divide by 100000 to try
> ;			  to avoid rounding errors (approx 5cents on 10,500)
> ; 04/apr/01 b.e. 	- undid the jan 28 change as the GST and TOTEXP calcs
> ;			  were still output and negative so unbalanced with
> ; 06/mar/20 b.e.	- generate of HOLDBK transaction eliminated in
> ;			  u115_common.qts used by this program
> ; 2006/may/10 b.e.      - $1M payroll changes to size of calculated fields
> ; 2008/may/10 brad2     - "AFPADJ" transactions no longer shown on r124a stmnts
> ;			   nor the '94' screen - moved to "C" type transactions
> ;			   in f119 to 'hide' them (shown on new 96 screen)
> ; 2008/jun/05 M.C.      - change access to link to f116-dtl file
> ;			- change criteria when calculating amounts for TOTINC
> ;			- modify criteria in $src/u115_common.qts
> ;			- create records in new subfile f119_tithe
> ; 2008/aug/19 M.C.      - prompt for global parameter for payroll-flag
> ; 2008/sep/29 M.C.      - access to use f119 instead of f110 since titheable records have rec-type = 'D' in f119
> ;			  which were generated from u130.qts
> ; 2008/oct/21 M.C.	- clone from u115a_0.qts but this time to use f110 instead of f119 and take out the select statement
> ; 2008/oct/22 brad1	- try various locking statements to see if performance altered
> ; 2008/nov/17 M.C.	- delete all commented codes to avoid confusion
> ;			- we must either add/update f119 for all the titheable comp code extract from f110 in order to see
> ;			  properly on the 97 screen
> ; 2008/nov/19 MC1	- change the definition for x-amt-net to consider 'MICG'
> ; 2008/nov/20 MC2	- undo MC1, use gross amt instead
> ;			- change the definition for x-amt-gross to consider 'MICG'
> ;			- since tithe calculation is calculated based on the amt-gross, we must also change to show
> ;			  the titheable comp code with amt-gross as the mtd instead of amt-net
> ; 2015/Jun/25 MC3       - add second linkage to f116-dtl for the actual doc-nbr for determine tithe
> 
> cancel clear
> set stacksize 10000
> run u115
> 
> set default
WORKSPACE and STACKSIZE can't be reset within a QTP run.
> set process 50000
> ;brad1
> set lock record update
> ;set lock file update
> 
> global temp ytdear-group   char*1
> global temp ytdear-seq-rpt zoned*2 unsigned
> 
> global temp rmaexr-group   char*1
> global temp rmaexr-seq-rpt zoned*2 unsigned
> 
> global temp rmaexm-group   char*1
> global temp rmaexm-seq-rpt zoned*2 unsigned
> 
> global temp incexp-group   char*1
> global temp incexp-seq-rpt zoned*2 unsigned
> 
> global temp totinc-group   char*1
> global temp totinc-seq-rpt zoned*2 unsigned
> 
> global temp totexp-group   char*1
> global temp totexp-seq-rpt zoned*2 unsigned
> 
> global temp depexr-group   char*1
> global temp depexr-seq-rpt zoned*2 unsigned
> 
> global temp depexm-group   char*1
> global temp depexm-seq-rpt zoned*2 unsigned
> 
> global temp gst-group   char*1
> global temp gst-seq-rpt zoned*2 unsigned
> 
> global temp holdback-group   char*1
> global temp holdback-seq-rpt zoned*2 unsigned
> 
> ; 2008/08/19 - MC
> global temp payroll-flag char*1  parm  prompt 'Enter payroll (A/C) : '
> global temp totite-group   char*1
> global temp totite-seq-rpt zoned*2 unsigned
> 
> global temp totitd-group   char*1
> global temp totitd-seq-rpt zoned*2 unsigned
> 
> ;  2008/08/19 - end
> 
> ;-------------------------------------------------------------------------------
> 
> ;
> ; DETERMINE THE 'REPORTING-SEQ' AND 'COMP CODE GROUP'
> ; FOR THE TRANSACTIONS BEING CREATED IN THIS RUN
> 
> request u115_a_get_ytdear                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "YTDEAR"
Choose viaindex COMP-CODE.
> item ytdear-group   = comp-code-group
> item ytdear-seq-rpt = reporting-seq
> 
> request u115_a_get_rmaexr                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "RMAEXR"
Choose viaindex COMP-CODE.
> item rmaexr-group   = comp-code-group
> item rmaexr-seq-rpt = reporting-seq
> 
> request u115_a_get_rmaexm                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "RMAEXM"
Choose viaindex COMP-CODE.
> item rmaexm-group   = comp-code-group
> item rmaexm-seq-rpt = reporting-seq
> 
> request u115_a_get_incexp                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "INCEXP"
Choose viaindex COMP-CODE.
> item incexp-seq-rpt  = reporting-seq
> item incexp-group    = comp-code-group
> 
> request u115_a_get_totinc                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "TOTINC"
Choose viaindex COMP-CODE.
> item totinc-seq-rpt  = reporting-seq
> item totinc-group    = comp-code-group
> 
> request u115_a_get_totexp                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "TOTEXP"
Choose viaindex COMP-CODE.
> item totexp-seq-rpt  = reporting-seq
> item totexp-group    = comp-code-group
> 
> request u115_a_get_depexr                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "DEPEXR"
Choose viaindex COMP-CODE.
> item depexr-group   = comp-code-group
> item depexr-seq-rpt = reporting-seq
> 
> request u115_a_get_depexm                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "DEPEXM"
Choose viaindex COMP-CODE.
> item depexm-group   = comp-code-group
> item depexm-seq-rpt = reporting-seq
> 
> request u115_a_get_gst                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "GST"
Choose viaindex COMP-CODE.
> item gst-group   = comp-code-group
> item gst-seq-rpt = reporting-seq
> 
> request u115_a_get_holdback                    &
>                 on edit        errors report &
>                 on calculation errors report
> access f190-comp-codes
> choose comp-code "HOLDBK"
Choose viaindex COMP-CODE.
> item holdback-group   = comp-code-group
> item holdback-seq-rpt = reporting-seq
> 
> ;-------------------------------------------------------------------------------
> 
> request u115_run_0                              &
>                 on edit        errors report    &
>                 on calculation errors report
> 
> ;main
> ; 2008/09/29 - use f119 instead of 110
> ; 2008/10/21 - MC - use f110 instead of f119
> access constants-mstr-rec-6                                     &
> 	link current-ep-nbr viaindex compensation-key2          &
>           to   ep-nbr  of f110-compensation                     &
> 	link doc-nbr of f110-compensation                       &
>         to   doc-nbr of f020-doctor-mstr                      &
>        link ("FLAT+3_TITHE_LEVELS"), 				&
> 	    doc-dept, 						&
> 	    doc-afp-paym-group, 				&
> 	    '000', 						&
> 	    comp-code  						&
> 	 to dept-expense-calc-code, 				&
> 	    dept-nbr, 						&
> 	    doc-afp-paym-group, 				&
> 	    doc-nbr, 						&
> 	    comp-code 						&
> 	  of  f116-dept-expense-rules-dtl alias f116-group  opt	&
> ; MC3
>        link ("FLAT+3_TITHE_LEVELS"), 				&
> 	    doc-dept, 						&
> 	    doc-afp-paym-group of f020-doctor-mstr,		&
> 	    doc-nbr of f110-compensation,		 	&
> 	    comp-code of f110-compensation 			&
> 	 to dept-expense-calc-code, 				&
> 	    dept-nbr, 						&
> 	    doc-afp-paym-group, 				&
> 	    doc-nbr, 						&
> 	    comp-code 						&
> 	  of  f116-dept-expense-rules-dtl alias f116-doc    opt	&
> ; MC3 - end
> 	link comp-code of f110-compensation                     &
>         to   comp-code of f190-comp-codes
> 
> choose const-rec-nbr 6
*W* Item (CONST-REC-NBR) is stored by the file system as a character type.
Choose viaindex CONSTANTS-MSTR-REC-6.
> sorted on doc-nbr   of f110-compensation                        &
>        on ep-nbr    of f110-compensation                        &
>        on comp-code of f110-compensation  ; CHANGED TO SORTED WHEN CHOOSE ADDED !!!!
> 
> 
> use $use/gst.use
> ;   this source is called by:
> ;	u115a.qts, u115b.qts
> ;
> ;define gst-percent int*8 unsigned size 4 = 7
> ; 2010/07/08 - MC - change from 5% to 13% for HST
> ;define gst-percent int*8 unsigned        = 5
> define gst-percent int*8 unsigned        = 13
> ; MC1
> ;use $src/u115_common.qts
> use $src/u115_common_f110.qts
> ;     DATE    WHO  WHY
> ; 2004/mar/25 b.e. made common to u115a/b.qts
> ; 2006/mar/20 b.e. while testing a comp code with a factor of 0 (shows amount
> ;		   in gross but pays nothing by turning net to zero) it was
> ;		   discovered that the old 'hold back' feature used in mid-90's
> ;		   was kicking in and generating a HOLDBK comp code for the
> ;		   gross amount. The calculation of this hold back amount
> ;		   changed to always be zero so that it won't intefere with
> ;		   using a factor of 0.00
> ;		   - set to zero by adding a condition 1 = 2 to logic
> ; 2006/jun/09 b.e. - UNDID THE ABOVE CHANGE SO THAT HOLDBK AGAIN CALCULATED
> ; 2006/jun/22 b.e. after change in size of field there occcured rounding
> ; problem giving .01 difference .. changed from > to = in calc of x-amt-gst-only
> ; 2008/jun/05 M.C. - modify criteria for tot-income-gross-reg, tot-income-gross-misc &
> ;			tot-income-gross-other, create tot-tithe-gross-reg,
> ;			tot-tithe-gross-misc & tot-tithe-gross-other
> ;		   - apply the same to tot-income-net-reg/misc/other, and
> ;		     tot-tithe-net-reg/misc/other
> ; 2008/jul/02 brad1 - add  code to catch TITHE expenese - above not working
> ; 2008/jul/02 brad2 - added check that comp-type is I'ncome type when incuding
> ;		      in calculation of:
> ;			  tot-income-gross-reg/misc/other
> ;		      and tot-income-net-reg/misc/other
> ;		      and tot-tithe-gross-reg/misc/other
> ;		      and tot-tithe-net-reg/misc/other
> ; 2008/nov/19 MC1   - add  new defined item  x-amt-net-adjust
> ;	              change the definition for  tot-tithe-net-misc include 'MICG'
> ; 2008/nov/20 MC2   - undo MC1 above
> ;		    -  add  new defined item  x-amt-gross-adjust
> ;	              change the definition for  tot-tithe-gross-misc include 'MICG'
> ; 2015/Jun/25 MC3   - include file qualifier f116-group for uniqueness
> ;                     for items flag-display-hide and tithe-in-ex-clude-flag
> ;                   - add more if condition for tithe related items
> ;
> ; ----------- CALCULATIONS PERFORMED AT COMP-CODE LEVEL ------------
> 
> ; (Determine Expenses charged (difference between GROSS and NET) using
> ;  FACTOR or non-zero Expense Percentages as indicators as to type of charges
> ;  applied)
> 
> 
> ;def x-income-gross-minus-net       int*8 signed size 4           &
> ;def x-income-gross-minus-net       int*10 signed                 &
> def x-income-gross-minus-net       int*8 signed                 &
>    =  amt-gross  of f110-compensation                            &
>     - amt-net    of f110-compensation
> 
> ;def x-amt-dept-expense-pot-g   int*8 signed size 4                    &
> ;      = round ( (  amt-gross of f110-compensation                     &
> ;                 * doc-dept-expense-percent-reg   ) / 1000000,0,near) &
> ;           if    comp-type     of f190-comp-codes = "I"               &
> ;             and comp-sub-type of f190-comp-codes = "R"               &
> ;   else round ( (  amt-gross of f110-compensation                     &
> ;                 * doc-dept-expense-percent-misc  ) / 1000000,0,near) &
> ;           if    comp-type     of f190-comp-codes = "I"               &
> ;             and comp-sub-type of f190-comp-codes = "M"               &
> ;   else 0
> 
> ;brad1
> def tot-dept-expense-other   int*10 signed                            &
>       = round (  (  amt-gross of f110-compensation                    &
> ;;;;;;;;                  / 1000000				      &
>   	         ) 					      	      &
> ;;;;;;;;               * factor                   ,0,near	      &
> 	      )							      &
>            if    comp-type     of f190-comp-codes = "E"               &
>              and comp-sub-type of f190-comp-codes = "O"
> 
> ;def x-amt-dept-expense-pot-g   int*8 signed size 4                    &
> def x-amt-dept-expense-pot-g   int*10 signed                          &
>       = round (  (  amt-gross of f110-compensation                    &
>                   / 1000000					      &
>   	         ) 					      	      &
>                * doc-dept-expense-percent-reg  ,0,near)		      &
>            if    comp-type     of f190-comp-codes = "I"               &
>              and comp-sub-type of f190-comp-codes = "R"               &
> ; 		2008/06/05 - MC - add criteria				&
> 	     and (  not record f116-group  exists 			&
> 		  or (     record f116-group exists			&
> ; MC3
> ;		      and tithe-in-ex-clude-flag = "E"  		&
> 		      and tithe-in-ex-clude-flag of f116-group = "E"  	&
> 		     )							&
>                   or (     record f116-group exists                     &
> ;                     and tithe-in-ex-clude-flag = "I"                  &
> ;                     and flag-display-hide      = "N"                  &
>                       and tithe-in-ex-clude-flag of f116-group = "I"    &
>                       and flag-display-hide      of f116-group = "N"    &
> ; MC3 - end
>                      )                                                  &
> 	         )							&
>    else round (  (  amt-gross of f110-compensation                    &
>                   / 1000000					      &
>   	         ) 					      	      &
>                * doc-dept-expense-percent-misc ,0,near)		      &
>            if    comp-type     of f190-comp-codes = "I"               &
>              and comp-sub-type of f190-comp-codes = "M"               &
> ; 		2008/06/05 - MC - add criteria				&
> 	     and (  not record f116-group  exists 			&
> 		  or (     record f116-group exists			&
> ; MC3
> ;		      and tithe-in-ex-clude-flag = 'E'  		&
> 		      and tithe-in-ex-clude-flag of f116-group = 'E'    &
> 		     )							&
>                   or (     record f116-group exists                     &
> ;                     and tithe-in-ex-clude-flag = "I"                  &
> ;                     and flag-display-hide      = "N"                  &
>                       and tithe-in-ex-clude-flag of f116-group = "I"    &
>                       and flag-display-hide      of f116-group = "N"    &
> ; MC3 - end
>                      )                                                  &
> 		 )							&
>    else 0
> 
> ; (check for inconsistent data where calc'd expense greater than
> ;  difference between gross and net)
> ;def x-amt-dept-expense-g   int*8 signed size 4                         &
> ;def x-amt-dept-expense-g   int*10 signed                               &
> def x-amt-dept-expense-g   int*8 signed                               &
>      = x-amt-dept-expense-pot-g                                        &
>      if       (x-amt-dept-expense-pot-g <  x-income-gross-minus-net    &
>            and amt-gross of f110-compensation > 0)                     &
>         or    (x-amt-dept-expense-pot-g >  x-income-gross-minus-net    &
>            and amt-gross of f110-compensation < 0)                     &
>   else x-income-gross-minus-net
> 
> ;def x-amt-rma-expense-pot-g   int*8 signed size 4                     &
> def x-amt-rma-expense-pot-g   int*10 signed                           &
>       = round (  (  amt-gross of f110-compensation                    &
>                   / 1000000					      &
>   	         ) 					      	      &
>                * doc-rma-expense-percent-reg  ,0,near)		      &
>            if    comp-type     of f190-comp-codes = "I"               &
>              and comp-sub-type of f190-comp-codes = "R"               &
> ; 		2008/06/05 - MC - add criteria				&
> 	     and (  not record f116-group  exists 			&
> 		  or (     record f116-group exists			&
> ; MC3
> ;		      and tithe-in-ex-clude-flag = 'E'  		&
> 		      and tithe-in-ex-clude-flag of f116-group = 'E'    &
> 		     )							&
>                   or (     record f116-group exists                     &
> ;                     and tithe-in-ex-clude-flag = "I"                  &
> ;                     and flag-display-hide      = "N"                  &
>                       and tithe-in-ex-clude-flag of f116-group = "I"    &
>                       and flag-display-hide      of f116-group = "N"    &
> ; MC3 - end
>                      )                                                  &
> 		 )							&
>    else round (  (  amt-gross of f110-compensation                    &
>                   / 1000000					      &
>   	         ) 					      	      &
>                * doc-rma-expense-percent-misc ,0,near)		      &
>            if    comp-type     of f190-comp-codes = "I"               &
>              and comp-sub-type of f190-comp-codes = "M"               &
> ; 		2008/06/05 - MC - add criteria				&
> 	     and (  not record f116-group  exists 			&
> 		  or (     record f116-group exists			&
> ; MC3
> ;		      and tithe-in-ex-clude-flag = 'E'  		&
> 		      and tithe-in-ex-clude-flag of f116-group = 'E'    &
> 		     )							&
>                   or (     record f116-group exists                     &
> ;                     and tithe-in-ex-clude-flag = "I"                  &
> ;                     and flag-display-hide      = "N"                  &
>                       and tithe-in-ex-clude-flag of f116-group = "I"    &
>                       and flag-display-hide      of f116-group = "N"    &
> ; MC3 - end
>                      )                                                  &
> 		 )							&
>    else 0
> 
> ;def x-amt-rma-expense-only       int*8 signed size 4 			 &
> ;def x-amt-rma-expense-only       int*10 signed          		&
> def x-amt-rma-expense-only       int*8 signed          		&
>     =  x-amt-rma-expense-pot-g                          		&
>       if    (    x-income-gross-minus-net > (  x-amt-dept-expense-g	&
>                        	                     + x-amt-rma-expense-pot-g) &
>              and amt-gross of f110-compensation > 0			&
> 	    )    							&
>          or (    x-income-gross-minus-net < (  x-amt-dept-expense-g 	&
>                                              + x-amt-rma-expense-pot-g) &
>              and  amt-gross of f110-compensation < 0			&
> 	    )      							&
>  else   x-income-gross-minus-net					&
>       - x-amt-dept-expense-g
> 
> ;def x-amt-gst-pot-g     int*8 signed size 4      &
> ;def x-amt-gst-pot-g     int*10 signed           &
> def x-amt-gst-pot-g     int*8 signed           &
>      =  round (    (   x-amt-rma-expense-only   &
>                      * gst-percent 		&
> 		   )				&
> 		 / 100				&
> 	       ,0,near				&
> 	      )                         	&
>            if doc-ind-pays-gst = "Y"            &
>   else  0
> 
> ; 2006/jun/22 b.e. after change in size of field there occcured rounding
> ; problem giving .01 difference .. changed from > to =
> 
> def x-amt-round-off int*8 =   absolute(x-income-gross-minus-net) &
> 		  	    - absolute(x-amt-dept-expense-g)  	&
> 			    - absolute(x-amt-rma-expense-only) 	&
> 			    - absolute(x-amt-gst-pot-g)
> 
> ;def x-amt-gst-only      int*8 signed size 4       		 &
> ;def x-amt-gst-only      int*10 signed              		&
> def x-amt-gst-only      int*8 signed              		&
>      =  x-amt-gst-pot-g                           		&
> 	    if     (     (     (   x-income-gross-minus-net 	&
> 		                >  (  x-amt-dept-expense-g  	&
> 	                            + x-amt-rma-expense-only 	&
> 			            + x-amt-gst-pot-g		&
> 			           )      			&
> 			       )				&
> 	       	           and amt-gross of f110-compensation > 0 &
> 		         ) 					&
> 	              or (      (   x-income-gross-minus-net 	&
> 			          <  (  x-amt-dept-expense-g  	&
> 				      + x-amt-rma-expense-only 	&
> 				      +  x-amt-gst-pot-g	&
> 				     )      			&
> 			        )				&
> 	         	and amt-gross of f110-compensation < 0) &
> 	  	    )					        &
> ;		   (account for rounding where diff may be +- .05 cents)
> 	        and (  x-amt-round-off > 5			&
> 		    )						&
>    else (  x-income-gross-minus-net                             &
>          - x-amt-dept-expense-g                                 &
>          - x-amt-rma-expense-only                               &
>         )
> 
> ;def x-amt-rma-expense-plus-gst-g    int*8 signed size 4          &
> def x-amt-rma-expense-plus-gst-g    int*10 signed                &
>          =  x-amt-rma-expense-only                              &
>           + x-amt-gst-only
> 
> ; (RMA 'Holdback ' calculated as difference between 'GROSS and NET'
> ;  minus 'DEPT Expense + RMA Expense + GST')
> ;def x-amt-holdback-g             int*8 signed size 4    &
> ;    =  x-income-gross-minus-net                         &
> ;     - x-amt-dept-expense-g                             &
> ;     - x-amt-rma-expense-plus-gst-g                     &
> ;   if         (x-income-gross-minus-net > (x-amt-dept-expense-g &
> ;		+  x-amt-rma-expense-plus-gst-g)	&
> ;          and  amt-gross of f110-compensation > 0)      &
> ;      or      (x-income-gross-minus-net < (x-amt-dept-expense-g &
> ;		+  x-amt-rma-expense-plus-gst-g)	&
> ;          and  amt-gross of f110-compensation < 0)      &
> ; else 0
> 
> ;def x-amt-holdback-g             int*8 signed size 4    &
> def x-amt-holdback-g             int*10 signed          &
>     = round(  x-income-gross-minus-net                  &
>             - x-amt-dept-expense-g                      &
>             - x-amt-rma-expense-plus-gst-g              &
>            )                                            &
>           if      (   (        x-income-gross-minus-net        	&
>                            > (  x-amt-dept-expense-g            &
>                               + x-amt-rma-expense-plus-gst-g    &
>                              )                                 	&
>                         and  amt-gross of f110-compensation > 0 &
>                        )                                        &
>                     or (      x-income-gross-minus-net         	&
>                           < (  x-amt-dept-expense-g            	&
>                              + x-amt-rma-expense-plus-gst-g    	&
>                             )                                  	&
>                         and  amt-gross of f110-compensation < 0 &
>                        )                                        &
> 	          )					   	&
> ;;;;;;;;;;;;;;;;;;;;	      and 1 = 2 & ; set condition always false so that holdback not generated regardless of previous logic
>  else 0
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> 
> ;(IF HOLDBACK IS LESS THAN OR = 10 CENTS AND THERE WAS PREVIOUS
> ; NON-ZERO EXPENSE CALCULATIONS, THEN IGNORE THE CALCULATED HOLDBACK
> ; AND ADD THE AMOUNT OF THE LEFT OVER "HOLDBACK" BACK INTO THE
> ; LAST NON-ZERO EXPENSE CALCUATION)
> ; 2000/nov/23 B.E. changed limit from 10 cents to a dollar
> def  x-amt-holdback-final					&
>     = x-amt-holdback-g						&
> ;	if   x-amt-holdback-g > 10				&
> 	if   x-amt-holdback-g > 100				&
>           or (    x-amt-rma-expense-only = 0			&
>               and x-amt-dept-expense-g   = 0			&
> 	     )							&
>  else 0
> 
> def x-amt-rma-expense-final					&
>     =   x-amt-rma-expense-only					&
>       + x-amt-holdback-g					&
>      	if     x-amt-holdback-g < 10				&
>            and x-amt-rma-expense-only <> 0			&
>    else   x-amt-rma-expense-only
> 
> def x-amt-dept-expense-final					&
>         =   x-amt-dept-expense-g				&
> 	  + x-amt-holdback-g					&
>      if     x-amt-holdback-g < 10				&
>  	and x-amt-dept-expense-g <>  0				&
>    else   x-amt-dept-expense-g
> 
> ;def x-amt-rma-expense-plusgst-final int*8 signed size 4            &
> def x-amt-rma-expense-plusgst-final int*10 signed               &
>          =  x-amt-rma-expense-final                             &
>           + x-amt-gst-only
> 
> ; ----------- CALCULATIONS SUMMED TO DOC-NBR LEVEL ------------
> ;temp    tot-income-gross-reg  int*8 signed size 4
> temp    tot-income-gross-reg  int*10 signed
> item    tot-income-gross-reg                            &
>      =  tot-income-gross-reg                            &
>       + amt-gross of f110-compensation                  &
> ;		   brad2				&
>              if    comp-type     of f190-comp-codes = "I"	&
>                and comp-sub-type of f190-comp-codes = "R"	&
> ;	           2008/06/05 - MC - add criteria	&
>                and (  not record f116-group  exists 	&
> 	            or (     record f116-group exists	&
> ; MC3
> ;	                and tithe-in-ex-clude-flag = 'E'&
> 	                and tithe-in-ex-clude-flag of f116-group = 'E'  &
> 	               )				&
>                     or (     record f116-group exists   &
> ;                     and tithe-in-ex-clude-flag = "I"                  &
> ;                     and flag-display-hide      = "N"                  &
>                       and tithe-in-ex-clude-flag of f116-group = "I"    &
>                       and flag-display-hide      of f116-group = "N"    &
> ; MC3 - end
>                        )                                &
>                    )					&
> ;	    	    2008/06/05 - end			&
>   else tot-income-gross-reg                             &
>   reset at doc-nbr
> ;temp    tot-income-gross-misc int*8 signed size 4
> temp    tot-income-gross-misc int*10 signed
> item    tot-income-gross-misc                           &
>      =  tot-income-gross-misc                           &
>       + amt-gross of f110-compensation                  &
> ;		   brad2				&
>            if    comp-type     of f190-comp-codes = "I"	&
>              and comp-sub-type of f190-comp-codes = "M"	&
> ;	          2008/06/05 - MC - add criteria	&
>               and (  not record f116-group  exists 	&
> 	           or (     record f116-group exists	&
> ; MC3	               and tithe-in-ex-clude-flag = 'E' &
> 	               and tithe-in-ex-clude-flag of f116-group = 'E'   &
> 	              )					&
>                     or (     record f116-group exists   &
> ;                     and tithe-in-ex-clude-flag = "I"                  &
> ;                     and flag-display-hide      = "N"                  &
>                       and tithe-in-ex-clude-flag of f116-group = "I"    &
>                       and flag-display-hide      of f116-group = "N"    &
> ; MC3 - end
>                        )                                &
>                   )					&
> ;	          2008/06/05 - end			&
>   else tot-income-gross-misc                           	&
>   reset at doc-nbr
> ;temp    tot-income-gross-other int*8 signed size 4
> temp    tot-income-gross-other int*10 signed
> item    tot-income-gross-other                          &
>      =  tot-income-gross-other                          &
>       + amt-gross of f110-compensation                  &
> ;		   brad2				&
>             if    comp-type     of f190-comp-codes = "I"	&
>               and comp-sub-type of f190-comp-codes = "O"	&
> ;	          2008/06/05 - MC - add criteria	&
>               and (  not record f116-group  exists 	&
> 	           or (     record f116-group exists	&
> ; MC3
> ;	               and tithe-in-ex-clude-flag = 'E'	&
> 	               and tithe-in-ex-clude-flag of f116-group = 'E'	&
> 	              )					&
>                     or (     record f116-group exists   &
> ;                       and tithe-in-ex-clude-flag = "I"&
> ;                       and flag-display-hide      = "N"&
>                         and tithe-in-ex-clude-flag of f116-group = "I"&
>                         and flag-display-hide      of f116-group = "N"&
> ; MC3 - end
>                        )                                &
>                   )					&
> ;		  2008/06/05 - end			&
>   else tot-income-gross-other                           &
>   reset at doc-nbr
> 
> ;temp    tot-income-net-reg  int*8 signed size 4
> temp    tot-income-net-reg  int*10 signed
> item    tot-income-net-reg                              &
>      =  tot-income-net-reg                              &
>       + amt-net of f110-compensation                    &
> ;		   brad2				&
>       if    comp-type     of f190-comp-codes = "I"	&
>         and comp-sub-type of f190-comp-codes = "R"	&
> ; 2008/06/05 - MC - add criteria			&
>         and (  not record f116-group  exists 		&
> 	    or (     record f116-group exists		&
> ; MC3
> ;	         and tithe-in-ex-clude-flag = 'E'	&
> 	         and tithe-in-ex-clude-flag of f116-group = 'E'	&
> 	       )					&
>             or (     record f116-group exists   	&
> ;                and tithe-in-ex-clude-flag = "I"	&
> ;                and flag-display-hide      = "N"	&
>                  and tithe-in-ex-clude-flag of f116-group = "I"	&
>                  and flag-display-hide      of f116-group = "N"	&
> ; MC3 - end
>                )                                	&
>             )						&
> ; 2008/06/05 - end
>   else tot-income-net-reg                               &
>   reset at doc-nbr
> ;temp    tot-income-net-misc int*8 signed size 4
> temp    tot-income-net-misc int*10 signed
> item    tot-income-net-misc                             &
>      =  tot-income-net-misc                             &
>       + amt-net of f110-compensation                    &
> ;		   brad2				&
>             if    comp-type     of f190-comp-codes = "I"	&
>               and comp-sub-type of f190-comp-codes = "M"	&
> ;	           2008/06/05 - MC - add criteria	&
>               and (  not record f116-group  exists 	&
> 	           or (     record f116-group exists	&
> ; MC3
> ;	               and tithe-in-ex-clude-flag = 'E' &
> 	               and tithe-in-ex-clude-flag of f116-group = 'E' &
> 	              )					&
>             	   or (     record f116-group exists   	&
> ;                      and tithe-in-ex-clude-flag = "I"	&
> ;                      and flag-display-hide      = "N"	&
>                        and tithe-in-ex-clude-flag of f116-group = "I"	&
>                        and flag-display-hide      of f116-group = "N"	&
> ; MC3 - end
>                       )                                	&
>                   )					&
> ; 		   2008/06/05 - end			&
>   else tot-income-net-misc                              &
>   reset at doc-nbr
> ;temp    tot-income-net-other int*8 signed size 4
> temp    tot-income-net-other int*10 signed
> item    tot-income-net-other                            &
>      =  tot-income-net-other                            &
>       + amt-net of f110-compensation                    &
> ;		   brad2				&
>             if    comp-type     of f190-comp-codes = "I"	&
>               and comp-sub-type of f190-comp-codes = "O"	&
> ;	          2008/06/05 - MC - add criteria	&
>               and (  not record f116-group  exists 	&
> 	           or (     record f116-group exists	&
> ; MC3
> ;	               and tithe-in-ex-clude-flag = 'E' &
> 	               and tithe-in-ex-clude-flag of f116-group = 'E' &
> 	              )			 		&
>             	   or (     record f116-group exists   	&
> ;                      and tithe-in-ex-clude-flag = "I"	&
> ;                      and flag-display-hide      = "N"	&
>                        and tithe-in-ex-clude-flag of f116-group = "I"	&
>                        and flag-display-hide      of f116-group = "N"	&
> ; MC3 - end
>                       )                                	&
>                   )					&
> ;		  2008/06/05 - end			&
>   else tot-income-net-other                             &
>   reset at doc-nbr
> 
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> ; 2008/06/05 - MC
> 
> temp    tot-tithe-gross-reg  int*10 signed
> item    tot-tithe-gross-reg                            	&
>      =  tot-tithe-gross-reg                            	&
>       + amt-gross of f110-compensation                  &
> ;		  brad2					&
>        	    if    comp-type     of f190-comp-codes = "I"&
>               and comp-sub-type of f190-comp-codes = "R"&
>               and record f116-group exists		&
> ; MC3
> ;	      and tithe-in-ex-clude-flag = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-group = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-doc  <> 'E'  	&
> ; else tot-tithe-gross-reg                              &
> ; MC3 - end
>   reset at doc-nbr
> 
> ; 2008/11/20 - MC2 - use gross amt instead
> define x-amt-gross-adjust int*10 signed =  		&
> 	     amt-gross of f110-compensation * 4 if comp-code of f110-compensation = 'MICG' &
> 	else amt-gross of f110-compensation
> ; 2008/11/20 - end
> 
> temp    tot-tithe-gross-misc int*10 signed
> item    tot-tithe-gross-misc                            &
>      =  tot-tithe-gross-misc                            &
> ; 2008/11/20 - MC2 - use the new define item above instead
> ;     + amt-gross of f110-compensation                   &
>       + x-amt-gross-adjust                               &
> ; 2008/11/20 - end
> ;	          brad2					&
>             if    comp-type     of f190-comp-codes = "I"&
>               and comp-sub-type of f190-comp-codes = "M"&
>               and record f116-group exists		&
> ; MC3
> ;	      and tithe-in-ex-clude-flag = 'I' 	&
> 	      and tithe-in-ex-clude-flag of f116-group = 'I' 	&
> 	      and tithe-in-ex-clude-flag of f116-doc  <> 'E'  	&
> ; else tot-tithe-gross-misc                           	&
> ; MC3 - end
>   reset at doc-nbr
> 
> temp    tot-tithe-gross-other int*10 signed
> item    tot-tithe-gross-other                          	&
>      =  tot-tithe-gross-other                          	&
>       + amt-gross of f110-compensation                  &
> ;	          brad2					&
>             if    comp-type     of f190-comp-codes = "I"&
>               and comp-sub-type of f190-comp-codes = "O"&
>               and record f116-group exists		&
> ; MC3
> ;	      and tithe-in-ex-clude-flag = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-group = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-doc  <> 'E'  	&
> ; else tot-tithe-gross-other                            &
> ; MC3 - end
>   reset at doc-nbr
> 
> temp    tot-tithe-net-reg  int*10 signed
> item    tot-tithe-net-reg                               &
>      =  tot-tithe-net-reg                               &
>       + amt-net of f110-compensation                    &
> ;	          brad2					&
>             if    comp-type     of f190-comp-codes = "I"&
>               and comp-sub-type of f190-comp-codes = "R"&
>               and record f116-group exists		&
> ; MC3
> ;	      and tithe-in-ex-clude-flag = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-group = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-doc  <> 'E'  	&
> ; else tot-tithe-net-reg                                &
> ; MC3 - end
>   reset at doc-nbr
> 
> 
> temp    tot-tithe-net-misc int*10 signed
> item    tot-tithe-net-misc                              &
>      =  tot-tithe-net-misc                              &
>       + amt-net of f110-compensation                    &
> ;	          brad2					&
>             if    comp-type     of f190-comp-codes = "I"&
>               and comp-sub-type of f190-comp-codes = "M"&
>               and record f116-group exists		&
> ; MC3
> ;	      and tithe-in-ex-clude-flag = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-group = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-doc  <> 'E'  	&
> ; else tot-tithe-net-misc                               &
> ; MC3 - end
>   reset at doc-nbr
> 
> temp    tot-tithe-net-other int*10 signed
> item    tot-tithe-net-other                             &
>      =  tot-tithe-net-other                             &
>       + amt-net of f110-compensation                    &
> ;	          brad2					&
>             if    comp-type     of f190-comp-codes = "I"&
>               and comp-sub-type of f190-comp-codes = "O"&
>               and  record f116-group exists		&
> ; MC3
> ;	      and tithe-in-ex-clude-flag = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-group = 'I'  	&
> 	      and tithe-in-ex-clude-flag of f116-doc  <> 'E'  	&
> ; else tot-tithe-net-other                              &
> ; MC3 - end
>   reset at doc-nbr
> 
> ; 2008/06/05 - end
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> 
> ;temp    tot-dept-expense-reg         int*8 signed size 4
> temp    tot-dept-expense-reg         int*10 signed
> item    tot-dept-expense-reg                            &
>      =  tot-dept-expense-reg                            &
>       + x-amt-dept-expense-final                            &
>           if comp-sub-type = "R"                        &
>   else  tot-dept-expense-reg                            &
>   reset at doc-nbr
> ;temp    tot-dept-expense-misc        int*8 signed size 4
> temp    tot-dept-expense-misc        int*10 signed
> item    tot-dept-expense-misc                           &
>      =  tot-dept-expense-misc                           &
>       + x-amt-dept-expense-final                            &
>           if comp-sub-type = "M"                        &
>   else  tot-dept-expense-misc                           &
>   reset at doc-nbr
> 
> ;temp    tot-rma-expense-plus-gst-reg        int*8 signed size 4
> temp    tot-rma-expense-plus-gst-reg        int*10 signed
> item    tot-rma-expense-plus-gst-reg                            &
>      =  tot-rma-expense-plus-gst-reg                            &
>       + x-amt-rma-expense-plusgst-final                 &
>           if comp-sub-type = "R"                        &
>   else  tot-rma-expense-plus-gst-reg                            &
>   reset at doc-nbr
> 
> ;temp    tot-rma-expense-plus-gst-misc       int*8 signed size 4
> temp    tot-rma-expense-plus-gst-misc       int*10 signed
> item    tot-rma-expense-plus-gst-misc                           &
>      =  tot-rma-expense-plus-gst-misc                           &
>       + x-amt-rma-expense-plusgst-final                        &
>           if comp-sub-type = "M"                                &
>   else  tot-rma-expense-plus-gst-misc                           &
>   reset at doc-nbr
> 
> ;temp    tot-rma-expense-only-reg        int*8 signed size 4
> temp    tot-rma-expense-only-reg        int*10 signed
> item    tot-rma-expense-only-reg                                &
>      =  tot-rma-expense-only-reg                                &
>       + x-amt-rma-expense-final                                  &
>           if comp-sub-type = "R"                                &
>   else  tot-rma-expense-only-reg                                &
>   reset at doc-nbr
> ;temp    tot-rma-expense-only-misc       int*8 signed size 4
> temp    tot-rma-expense-only-misc       int*10 signed
> item    tot-rma-expense-only-misc                               &
>      =  tot-rma-expense-only-misc                               &
>       + x-amt-rma-expense-final                                  &
>           if comp-sub-type = "M"                                &
>   else  tot-rma-expense-only-misc                               &
>   reset at doc-nbr
> 
> ;temp    tot-gst-only-reg        int*8 signed size 4
> temp    tot-gst-only-reg        int*10 signed
> item    tot-gst-only-reg                                &
>      =  tot-gst-only-reg                                &
>       + x-amt-gst-only                                  &
>           if comp-sub-type = "R"                        &
>   else  tot-gst-only-reg                                &
>   reset at doc-nbr
> ;temp    tot-gst-only-misc       int*8 signed size 4
> temp    tot-gst-only-misc       int*10 signed
> item    tot-gst-only-misc                               &
>      =  tot-gst-only-misc                               &
>       + x-amt-gst-only                                  &
>           if comp-sub-type = "M"                        &
>   else  tot-gst-only-misc                       &
>   reset at doc-nbr
> 
> ;temp    tot-holdback-only-reg   int*8 signed size 4
> temp    tot-holdback-only-reg   int*10 signed
> item    tot-holdback-only-reg                           &
>      =  tot-holdback-only-reg                           &
>       + x-amt-holdback-final                                &
>           if comp-sub-type = "R"                        &
>   else  tot-holdback-only-reg                           &
>   reset at doc-nbr
> 
> ;temp    tot-holdback-only-misc  int*8 signed size 4
> temp    tot-holdback-only-misc  int*10 signed
> item    tot-holdback-only-misc                          &
>      =  tot-holdback-only-misc                          &
>       + x-amt-holdback-final                                &
>           if comp-sub-type = "M"                        &
>   else  tot-holdback-only-misc                  &
>   reset at doc-nbr
> 
> ;temp    tot-revhbk	int*8 signed size 4
> temp    tot-revhbk	int*10 signed
> item    tot-revhbk = tot-revhbk + amt-net of f110-compensation &
> 	if  comp-type of f110-compensation = 'E'		&
> 	and (comp-code of f110-compensation = 'REVHBK'		&
> 	 or  comp-code of f110-compensation = 'REVCLA')		&
>    else tot-revhbk    reset at doc-nbr
> 
> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
> 
> ; current EP Manual Payments affect the YTD Earnings (YTDEAR)
> ;temp amt-manpay   integer*8 signed size 4
> temp amt-manpay   integer*10 signed
> item amt-manpay   = amt-manpay   + amt-net of f110-compensation    &
>                         if    comp-type of f110-compensation="M"   &
>                else amt-manpay                                     &
>                         reset at doc-nbr
> 
> ; if new record, initial YTD record in F119.  (required only for
> ; "I"ncome, AND "E"xpense records - .ie calc rec types like CEICEA are
> ;  needed AND the "D"eduction records are handled in the tax/eft processing)
> 
> 
> def x-not-needed integer*10 signed        = 0
> 
> 
> ; (GROSS VALUES ARE USUALLY PUT INTO F119 HOWEVER FOR CEIEXP THE NET VALUE IS REQUIRED)
> 
> def x-amt-net int*10 signed                                     &
>         = amt-gross of f110-compensation                        &
>                  if comp-code of f110-compensation = "CEIEXP"	&
>      else amt-net   of f110-compensation
> 
> def x-amt-gross int*10 signed                                   &
>         = amt-net   of f110-compensation                        &
>                  if comp-code of f110-compensation = "CEIEXP"   &
> ; 2008/11/20 - MC2 - consider MICG
>      else amt-gross of f110-compensation * 4			&
> 		if comp-code of f110-compensation = 'MICG'	&
> ; 2008/11/20 - end
>      else amt-gross of f110-compensation
> 
> def tot-gst-only integer*10 signed        &
>     =  tot-gst-only-reg                   &
>      + tot-gst-only-misc
> 
> def tot-holdback-only integer*10 signed   &
>     =  tot-holdback-only-reg              &
>      + tot-holdback-only-misc
> 
> def tot-income-gross   integer*10 signed        &
>     =  tot-income-gross-reg                     &
>      + tot-income-gross-misc			&
>      + tot-income-gross-other
> 
> def tot-income-net     integer*10 signed        &
>     =  tot-income-net-reg                       &
>      + tot-income-net-misc			&
>      + tot-income-net-other
> 
> ; ('Total Expense" = all "E"xpense trans found in file PLUS the
> ;  expense transactions calculated by the pgm IE. 'RMA EXPENSE', 'GST'
> ;  and 'DEPARTMENT EXPENSE' and 'HOLDBACK')
> temp final-all-expenses integer*10
> item final-all-expenses                                    &
>      =  tot-dept-expense-reg                               &
>       + tot-dept-expense-misc                              &
>       + tot-rma-expense-only-reg                           &
>       + tot-rma-expense-only-misc                          &
>       + tot-gst-only                                       &
>       + tot-holdback-only                                  &
>       + tot-revhbk					   &
>       + doc-ceicex        ; 93/SEP/24
> 
> temp amt-income-minus-expenses-g integer*10 signed
> item amt-income-minus-expenses-g                        &
>        =  tot-income-gross                              &
>         - final-all-expenses
> 
> temp doc-ytdear-plus-amt-manpay  integer*10 signed
> item doc-ytdear-plus-amt-manpay                                 &
>  =   doc-ytdear of f020-doctor-mstr                             &
>    + amt-manpay
> 
> ; this pgm needs only debug file
> ;use $src/u115_debug.qts
> ; 2008/oct/23 brad1 - added to addtion fields to debug file: final-all-expenses-plus-dept-expense-other / tot-dept-expense-other
> ;
> ; u115_debug.qts
> subfile debugu115a_1_at_comp_code keep include &
> doc-nbr of f110-compensation ,                          &
> comp-code of f110-compensation,                         &
> amt-gross  of f110-compensation,                        &
> amt-net    of f110-compensation,                        &
> comp-type     of f190-comp-codes,                       &
> comp-sub-type of f190-comp-codes,                       &
> current-ep-nbr ,                                        &
> doc-dept-expense-percent-reg,                           &
> doc-dept-expense-percent-misc,                          &
> doc-ind-pays-gst,                                       &
> doc-rma-expense-percent-misc,                           &
> doc-rma-expense-percent-reg,                            &
> ep-nbr    of f110-compensation,                         &
> x-income-gross-minus-net,                               &
> x-amt-dept-expense-pot-g,                               &
> x-amt-dept-expense-g,                                   &
> gst-percent,                                            &
> x-amt-gst-pot-g,                                        &
> x-amt-gst-only,                                         &
> x-amt-rma-expense-only,                                 &
> x-amt-rma-expense-pot-g,                                &
> x-amt-rma-expense-plus-gst-g,                           &
> x-amt-holdback-g,                                       &
> x-amt-holdback-final,                                   &
> x-amt-rma-expense-final,                                &
> x-amt-rma-expense-plusgst-final ,                       &
> tot-income-gross-reg,                   &
> tot-income-gross-misc,                  &
> tot-income-gross-other,                 &
> tot-income-net-reg,                     &
> tot-income-net-misc,                    &
> tot-income-net-other,                   &
> tot-dept-expense-reg,                   &
> tot-dept-expense-misc,                  &
> tot-rma-expense-plus-gst-reg,           &
> tot-rma-expense-plus-gst-misc,          &
> tot-rma-expense-only-reg,               &
> tot-rma-expense-only-misc,              &
> tot-gst-only-reg,                       &
> tot-gst-only-misc,                      &
> tot-holdback-only-reg,                  &
> tot-holdback-only-misc,                 &
> tot-revhbk,                             &
> amt-manpay,                             &
> final-all-expenses,                     &       ; not reset at doctor mstr?
> ;brad1 added 2008/oct/23                &
> ;final-all-expenses-plus-dept-expense-other,&
> ;tot-dept-expense-other,                 &
> ;                                       &
> amt-income-minus-expenses-g,            &       ; not reset
> doc-ytdear-plus-amt-manpay,             &       ; not reset
> doc-ytdear of f020-doctor-mstr
> 
> subfile debugu115a_1_at_doc_nbr keep at doc-nbr include &
> doc-nbr of f110-compensation,           &
> tot-income-gross-reg,                   &
> tot-income-gross-misc,                  &
> tot-income-gross-other,                 &
> tot-income-net-reg,                     &
> tot-income-net-misc,                    &
> tot-income-net-other,                   &
> tot-dept-expense-reg,                   &
> tot-dept-expense-misc,                  &
> tot-rma-expense-plus-gst-reg,           &
> tot-rma-expense-plus-gst-misc,          &
> tot-rma-expense-only-reg,               &
> tot-rma-expense-only-misc,              &
> tot-gst-only-reg,                       &
> tot-gst-only-misc,                      &
> tot-holdback-only-reg,                  &
> tot-holdback-only-misc,                 &
> tot-revhbk,                             &
> amt-manpay,                             &
> final-all-expenses,                     &       ; not reset at doctor mstr?
> ;brad1 added 2008/oct/23                &
> ;final-all-expenses-plus-dept-expense-other,&
> ;tot-dept-expense-other,                 &
> ;                                       &
> amt-income-minus-expenses-g,            &       ; not reset
> doc-ytdear-plus-amt-manpay,             &       ; not reset
> doc-ytdear of f020-doctor-mstr
> ;--------------------------------------------
> 
> ; 2008/06/05 - MC - include f119-tithe subfile
> define rec-type-d char*1 = 'D'
> 
> def doc-nbr-summ  char*3 = '000'
> 
> ;output rec with real doc-nbr
> subfile f119_tithe_dtl  append                  &
>   if    comp-type of f190-comp-codes = "I"    	  &
> ; MC3
> ;   and tithe-in-ex-clude-flag = "I"		  &
>     and tithe-in-ex-clude-flag of f116-group = "I"  &
>     and tithe-in-ex-clude-flag of f116-doc  <> "E"  &
> ; MC3 - end
>    include                                        &
>          doc-ohip-nbr of f020-doctor-mstr       , &
>          doc-nbr   of f110-compensation         , &
>          comp-code of f110-compensation         , &
>          reporting-seq   of f190-comp-codes     , &
>          comp-code-group of f190-comp-codes     , &
>          rec-type-d                             , &
>          x-amt-net alias x-amt-net-dtl          , &
>          x-amt-gross alias x-amt-gross-dtl
> 
> ;output summary rec with doc-nbr = "000"
> subfile f119_tithe_dtl alias f119_doc_summ  append    &
>   if    comp-type of f190-comp-codes = "I"    	  &
> ; MC3
> ;   and tithe-in-ex-clude-flag = "I"		  &
>     and tithe-in-ex-clude-flag of f116-group = "I"  &
>     and tithe-in-ex-clude-flag of f116-doc  <> "E"  &
> ; MC3 - end
>    include                                        &
>          doc-ohip-nbr of f020-doctor-mstr       , &
>          doc-nbr-summ                           , &
>          comp-code of f110-compensation         , &
>          reporting-seq   of f190-comp-codes     , &
>          comp-code-group of f190-comp-codes     , &
>          rec-type-d                             , &
>          x-amt-net                              , &
>          x-amt-gross
> 
> ; 2008/11/17 - MC
> subfile f110_tithe_dtl  keep                      &
>   if    comp-type of f190-comp-codes = "I"    	  &
> ; MC3
> ;   and tithe-in-ex-clude-flag = "I"		  &
>     and tithe-in-ex-clude-flag of f116-group = "I"  &
>     and tithe-in-ex-clude-flag of f116-doc  <> "E"  &
> ; MC3 - end
>    include                                        &
>          doc-ohip-nbr of f020-doctor-mstr       , &
>          doc-nbr   of f110-compensation         , &
>          comp-code of f110-compensation         , &
>          reporting-seq   of f190-comp-codes     , &
>          comp-code-group of f190-comp-codes     , &
>          rec-type-d                             , &
>          x-amt-net                              , &
>          x-amt-gross
> ; 2008/11/17 - end
> 
> def x-comp-code-totit char*6 = "TOTITE"	if payroll-flag = 'A'	&
> 			else   "TOTITD"	if payroll-flag = 'C'
> 
> def totit-seq-rpt zoned*2 unsigned  = totite-seq-rpt  if payroll-flag = 'A'	&
> 				else  totitd-seq-rpt  if payroll-flag = 'C'
> 
> def totit-group    char*1           = totite-group    if payroll-flag = 'A'	&
> 				else  totitd-group    if payroll-flag = 'C'
> 
> def tot-tithe-gross   integer*10 signed        &
>     =  tot-tithe-gross-reg                     &
>      + tot-tithe-gross-misc                     &
>      + tot-tithe-gross-other
> def tot-tithe-net     integer*10 signed        &
>     =  tot-tithe-net-reg                       &
>      + tot-tithe-net-misc                       &
>      + tot-tithe-net-other
> 
> ;;; debug for MC
> subfile u115a1_mc keep at doc-nbr  include                       &
>          doc-ohip-nbr of f020-doctor-mstr       , &
>          doc-nbr of f110-compensation   , &
>          x-comp-code-totit             , &
>          totit-seq-rpt                 , &
>          totit-group                   , &
>          rec-type-d                   , &
>          tot-tithe-net                 , &
>          tot-tithe-gross               ,&
>        tot-tithe-net-reg               , &
>        tot-tithe-net-misc              , &
>        tot-tithe-net-other
> ;;;;;;;
> 
> ;output real doctor with totitE/D
> subfile f119_tithe_dtl  alias f119-totit-doc append     at doc-nbr      &
>   if tot-tithe-net <> 0           include                          &
>          doc-ohip-nbr of f020-doctor-mstr       , &
>          doc-nbr of f110-compensation   , &
>          x-comp-code-totit             , &
>          totit-seq-rpt                 , &
>          totit-group                   , &
>          rec-type-d                   , &
>          tot-tithe-net                 , &
>          tot-tithe-gross
> 
> 
> ;output summary doctor '000' with totitE/D
> subfile f119_tithe_dtl  alias f119-totit-summ   append     at doc-nbr      &
>   if tot-tithe-net <> 0           include                          &
>          doc-ohip-nbr of f020-doctor-mstr       , &
>          doc-nbr-summ                   , &
>          x-comp-code-totit             , &
>          totit-seq-rpt                 , &
>          totit-group                   , &
>          rec-type-d                     , &
>          tot-tithe-net                 , &
>          tot-tithe-gross
> 
> 
> ;-------------------------------------------------------------------------------
> 
> request u115_summarize_f119_tithe                              &
>                 on edit        errors report    &
>                 on calculation errors report
> 
> access *f119_tithe_dtl
> 
> sort on doc-ohip-nbr on doc-nbr on comp-code
> 
> temp x-amt-net int*10 signed
> item x-amt-net 		= x-amt-net	+ x-amt-net-dtl		reset at comp-code
> 
> temp x-amt-gross int*10 signed
> item x-amt-gross 	= x-amt-gross	+ x-amt-gross-dtl	reset at comp-code
> 
> subfile f119_tithe_one_comp_code_per_doc_nbr keep at comp-code include  &
>          doc-ohip-nbr                           , &
>          doc-nbr                                , &
>          comp-code                              , &
>          reporting-seq                          , &
>          comp-code-group                        , &
>          rec-type-d                             , &
>          x-amt-net                              , &
>          x-amt-gross
> 
> ;-------------------------------------------------------------------------------
> ; 2008/11/17 - MC - add new request to add/update f119 for titheable comp code
> request u115_add_update_f119_tithe_comp_code                   &
>                 on edit        errors report    &
>                 on calculation errors report
> 
> access *f110_tithe_dtl
> 
> output f119-doctor-ytd update add		&
>   via doc-nbr, comp-code, rec-type, doc-ohip-nbr &
> using doc-nbr		of f110_tithe_dtl,      &
>       comp-code         of f110_tithe_dtl,      &
>       rec-type-d,    	 			&
>       doc-ohip-nbr      of f110_tithe_dtl	&
> 		on errors report
>   item doc-nbr         initial doc-nbr         of f110_tithe_dtl
>   item comp-code       initial comp-code       of f110_tithe_dtl
>   item rec-type        initial rec-type-d
>   item doc-ohip-nbr    initial doc-ohip-nbr    of f110_tithe_dtl
>   item process-seq     initial reporting-seq   of f110_tithe_dtl
>   item comp-code-group initial comp-code-group of f110_tithe_dtl
> ; 2008/11/20 - MC2 - use x-amt-gross instead
> ;  item amt-mtd         final x-amt-net
> ;  item amt-ytd         final amt-ytd + x-amt-net
>   item amt-mtd         final x-amt-gross
>   item amt-ytd         final amt-ytd + x-amt-gross
> ; 2008/11/20 - end
> 
> build $obj/u115a_1
0 ERRORS  1 WARNINGS.
The file /alpha/rmabill/rmabill101/obj/u115a_1.qtc already exists. Ok to delete?
Thu Feb 11 18:07:27 EST 2016
