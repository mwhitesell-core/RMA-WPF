DA0-READ-OMA-FEE-MSTR.

    MOVE 'Y' 					TO OMA-FEE-FLAG.
    MOVE HOLD-OMA-CD				TO FEE-OMA-CD.

    READ OMA-FEE-MSTR
	INVALID KEY
	    MOVE 'N'				TO OMA-FEE-FLAG
  	    GO TO DA0-99-EXIT.

    MOVE FEE-ICC-SEC				TO HOLD-ICC-SEC.
    MOVE FEE-ICC-GRP				TO HOLD-ICC-GRP.

DA0-99-EXIT.
    EXIT.



DB0-CALC-BASIC-FEE.

    IF HOLD-ICC-CD = 'SP98'  OR  'SP99'
    THEN
        MOVE 0 					TO HOLD-FEE-OHIP
        GO TO DB0-98-TECHNICAL.
*   ENDIF

    IF 	   ( FEE-ICC-SEC = 'CV' )
        OR (     ( FEE-ICC-SEC = 'NM' OR 'DR' OR 'PF' OR 'DU')
              AND  HOLD-OMA-SUFF = 'B' )
        OR (     ( FEE-ICC-SEC = 'SP' OR 'CP' OR 'DT')
              AND ( HOLD-OMA-SUFF = 'A' OR 'M' ))
    THEN
        MOVE FEE-CURR-H-FEE-1 			TO HOLD-FEE-OHIP
    ELSE
       IF (     ( FEE-ICC-SEC = 'NM' OR 'DR' OR 'DU' OR 'PF')
             AND  HOLD-OMA-SUFF = 'C' )
       THEN
           MOVE FEE-CURR-H-FEE-2		TO HOLD-FEE-OHIP
       ELSE
           IF (     ( FEE-ICC-SEC = 'NM' OR 'DR' OR 'DU' OR 'PF')
                AND ( HOLD-OMA-SUFF = 'A' OR 'M' ))
  	   THEN
    		ADD  FEE-CURR-H-FEE-1  FEE-CURR-H-FEE-2
		     GIVING	       HOLD-FEE-OHIP
           ELSE
 	        PERFORM DC0-READ-ICONST-MSTR	THRU DC0-99-EXIT
		IF ICONST-FOUND
		THEN
		    IF (     ( FEE-ICC-SEC = 'CP' OR 'DT' OR 'SP')
			 AND   HOLD-OMA-SUFF = 'C' )
		    THEN
			IF  WF-RAT-4-DOC-SPEC = 0
		        THEN
		            MOVE CONST-REG(1,1) TO HOLD-FEE-OHIP
   		        ELSE
  			    MOVE CONST-CERT(1,1) TO HOLD-FEE-OHIP
*			ENDIF
		    ELSE
			IF FEE-ICC-SEC = 'SP' AND
			   HOLD-OMA-SUFF = 'B'
			THEN
			   MOVE CONST-ASST(1,1)	TO HOLD-FEE-OHIP
			ELSE
			   NEXT SENTENCE
*			ENDIF
*	            ENDIF

		ELSE
	    	    MOVE 9			TO ERR-IND
	    	    PERFORM ZA0-COMMON-ERROR	THRU ZA0-99-EXIT
		    PERFORM ZB0-ABEND		THRU ZB0-99-EXIT.
*		ENDIF
*     	    ENDIF
*    	ENDIF
*   ENDIF

DB0-98-TECHNICAL.

*   SAVE BASIC FEE AND BASIC TECHNICAL PORTION FOR LATER CALCULATION
*   OF THE PRICED TECHNICAL PORTION.

    MOVE HOLD-FEE-OHIP				TO HOLD-BASIC-FEE.

    IF  FEE-TECH-IND = 'Y'  OR
        HOLD-OMA-SUFF = 'B'
    THEN
       	MOVE HOLD-BASIC-FEE			TO HOLD-BASIC-TECH
    ELSE
       	IF HOLD-OMA-SUFF = 'C'
       	THEN
            MOVE ZERO				TO HOLD-BASIC-TECH
       	ELSE
            IF FEE-ICC-SEC = 'NM' OR 'DR' OR 'DU' OR 'PF'
       	    THEN
	        MOVE FEE-CURR-H-FEE-1 		TO HOLD-BASIC-TECH
	     	MOVE FEE-CURR-H-FEE-2		TO HOLD-BASIC-PROF
	     	PERFORM DB1-COMPUTE-BASIC-TECH THRU DB1-99-EXIT
            ELSE
             	MOVE  ZERO 			TO HOLD-BASIC-TECH.
*	    ENDIF
*       ENDIF
*   ENDIF


DB0-99-EXIT.
    EXIT.




DB1-COMPUTE-BASIC-TECH.

    ADD  HOLD-BASIC-TECH   HOLD-BASIC-PROF
	 GIVING 	   HOLD-TEMP-FEE.

    IF HOLD-TEMP-FEE =  ZERO
    THEN
       	MOVE  ZERO 				TO HOLD-BASIC-TECH
    ELSE
       	COMPUTE HOLD-BASIC-TECH ROUNDED =
		HOLD-BASIC-TECH  *  ( HOLD-BASIC-FEE / HOLD-TEMP-FEE ).
*   ENDIF

DB1-99-EXIT.
    EXIT.


DC0-READ-ICONST-MSTR.

    MOVE  2					TO ICONST-CLINIC-NBR-1-2.
    MOVE 'Y'					TO ICONST-FLAG.

    READ ICONST-MSTR
  	  INVALID  KEY
    		MOVE 'N'			TO ICONST-FLAG.


DC0-99-EXIT.
    EXIT.


DD0-CALC-TECH-PROF-RAT-PAID.

    COMPUTE  TEMP-TECH-PAID ROUNDED =  RAT-5-AMT-PAID *
			      (HOLD-BASIC-TECH / HOLD-FEE-OHIP).

    COMPUTE  ACCUM-TECH-PAID = ACCUM-TECH-PAID +  TEMP-TECH-PAID.

    COMPUTE  TEMP-PROF-AMT   = RAT-5-AMT-PAID  -  TEMP-TECH-PAID.

DD0-99-EXIT.
    EXIT.
