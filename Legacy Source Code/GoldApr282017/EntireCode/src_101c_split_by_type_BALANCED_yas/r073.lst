* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   1
*                      r073.cbl
* Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Accepted - SHOW-DIR
* Accepted - SOURCEFORMAT"FREE"
* Accepted - SPZERO
* Accepted - TIME
* Accepted - TRUNC
* Accepted - LIST
* Accepted - RESEQ
* End Of Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Options: int(r073.int) verbose nolist endp list(r073.lst)
identification division.
program-id.    r073.
author.        Dyad Infosys LTD.
installation.  rma.
date-written.  81/02/05.
date-compiled. 01-Apr-14 09:23.
security.
*
*    files      : f002          - claims master ( 'NEW' version output of r072)
*               : f090          - constants master
*               : r073          - audit report
*    program purpose:this program is used in conjunction with r071 and u072.
*               its purpose is to verify the values in the purged claims
*               master.  r071 verifies the non-purged claims and u072 purges
*               claims with a value of less than .86 and greater than -.86.
*
*    revision may 27/87 (s.b.) - coversion from aos to aos/vs.
*                                change field size for
*                                status clause to 2 and
*                                feedback clause to 4.
*
*   revised march/89 : - sms 115 s.f.
*                      - make sure file status is pic xx ,feedback is
*                        pic x(4) and infos status is pic x(11).
*
*            feb/89 (s.f.) - pdr 414
*                          - allow for agent 4 to be treated as a
*                            direct bill the same as agent 6
*
*
*   revised nov/91 (m.c.)       - pdr 525
*                               - include agent 8 claims with the cutoff
*                                 dates
*
*   revised jul/93 (y.b.)       - sra 076
*                               - change .64 to .85 write off amount
*
*   revised jun/94 (m.c.)       - pdr 592
*                               - do not purge clinic 81 agent 8 claims
*
*   29/03/95    b.m.l           - pdr 613
*                               - changed purge criteria to include a
*
*   14/04/97    yas.            - pdr 656
*                               - changed purge criteria to include a
*                                 purge of clinic 82
*   16/04/97    yas.            - pdr 659  add mess code "I2"
*   06/08/97    yas.            - pdr 664
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   2
*                      r073.cbl
*                               - changed purge criteria to include a
*                                 purge of clinic 83
*
*    feb/98     j. chau         - s149 unix conversion
*
*   1999/jul/12 B.E.            - cb3 rtn correction due to key corruption
*
*   2000/may/12 B.A.            - y2k
*
*   2002/jul/05 M.C.            - change purge criteria to delete claims if
*                                 balance is between -.99 and +.99 for non-
*                                 clinic 80's
*
*   2002/jul/08 M.C.            - modify the amount picture size
*
*   2002/sep/02     yas         - add new clinic 95
*   2003/jun/03     yas         - add clinic 91,92,93,94,96
*   2003/dec/10     M.C.        - alpha doc nbr
*   2004/mar/16     M.C.       - modify select to use afp-flag instead of clinic
*   2004/may/19     M.C.       - modify the value check on afp-flag(iconst-clini
*                              - value 'O' represents old afp
*   2004/jul/10 b.e.     - correct alpha doctor number "add to claim number" to
*                          consider adding to alpha number
*  2008/apr/17      M.C. - hsc had unique logic for this pgm. merged hsc/rma pgm
*  2011/Sep/13      MC1  - Yasemin  wants to change from < to  <= when comparing
*  2011/Nov/30      MC2  - comment out the display as Yasemin requested
*  2012/Sep/18      MC3  - change the condition when calculating balance due to
*  2014/Mar/29      MC4  - calculate balance due to use clmhdr-tot-claim-ar-ohip
*
*
environment division.
input-output section.
file-control.

    copy  "f002_claims_mstr.slr".
    select claims-mstr
*tobefixed* brad no unique key for this file !!!!!
*               two record keys
*       assign index to "f002_claims_mstr"
*       assign data  to "f002_claims_mstr"

        assign to disk "$pb_data/f002_claims_mstr"

        organization is indexed
        access mode  is dynamic
*mf     (added lock mode so that files aren't open exclusively)
        lock mode is manual

*       record key   is key-claims-mstr     length is 18
        record key   is key-claims-mstr
          with duplicates

*tobefixed*             with  duplicates occurrence is claims-occur
*mf     record key   is key-gen-claims-mstr length is  2
*mf     alternate record key   is key-gen-claims-mstr
        alternate record key   is clmdtl-p-claims-mstr
           with duplicates

* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   3
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
        status       is status-cobol-claims-mstr.

*mf    select claims-mstr
*       assign index to "F002_CLAIMS_MSTR_NEW"
*mf     assign data  to "F002_CLAIMS_MSTR_NEW.DB"
*mf     organization is indexed
*mf     access mode  is dynamic
*mf     record key   is key-claims-mstr     length is 18
*mf             with  duplicates occurrence is claims-occur
*mf     record key   is key-gen-claims-mstr length is  2
*mf     infos status is status-claims-mstr.
*       eof-flag     is eof-claims-mstr
*
*
    copy "f090_constants_mstr.slr".
select iconst-mstr
assign to disk "$pb_data/f090_constants_mstr"
organization is indexed
access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
lock mode is manual
record key   is iconst-clinic-nbr-1-2
*       eof-flag     is eof-iconst-mstr
status is status-cobol-iconst-mstr.
*
*
    select print-file
        assign to printer print-file-name
        file status is status-prt-file.
*
*
*
*
*
*
*
data division.
file section.

    copy "f002_claims_mstr.fd".
* 99/jan/15 B.E  - y2k
* 01/nov/06 B.E. - added clmrec-hdr-payroll as redefine of clmrec-hosp
* 03/aug/21 M.C. - increase the file size by 8 characters
* 03/oct/20 b.e. - alpha doctor nbr
* 04/jun/02 b.e. - added field clmdtl-b-batch-number-numeric

fd  claims-mstr
*            block  contains       224 characters
*            record contains       224 characters .
*!             block  contains       232 characters
*!             record contains       232 characters .
             block  contains       228 characters
             record contains       228 characters .
*       feedback is feedback-claims-mstr.


* insert this warning message from "F000_DUPLICATE_FD_WARNING.FD

* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   4
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*----------------  note -----------------------
*-- any changes to this fd must also be made  --
*-- to the corresponding "..._D001_..." fd    --
*-- and vice versa                            --
*----------------  note -----------------------
01  claims-mstr-rec.

  05  claims-mstr-hdr-rec.

    10  clmrec-hdr-clinic-nbr-1-2               pic 99.
*!    10  filler                                  pic x(09).
    10  filler                                  pic x(08).
    10  clmrec-zeroed-oma-suff-adj              pic x(06).
    10  clmrec-zeroed-area redefines clmrec-zeroed-oma-suff-adj
                                                pic 9(06).
    10  clmrec-hdr-batch-type                   pic x.
    10  filler                                  pic x(15).
    10  clmrec-hdr-diag-cd                      pic 9(3).
    10  clmrec-hdr-loc                          pic x(4).

    10  clmrec-hdr-hosp                         pic x.
    10  clmrec-hdr-payroll redefines clmrec-hdr-hosp pic x.

    10  clmrec-hdr-agent-cd                     pic 9.
    10  filler                                  pic x(2).
    10  clmrec-hdr-i-o-pat-ind                  pic x.
    10  clmrec-hdr-ohip-id-or-chart             pic x(16).
    10  clmrec-hdr-pat-acronym                  pic x(9).
* reference x(11) + date admit 9(8)
    10  filler                                  pic x(19).

    10  clmrec-doc-dept-nbr                     pic 99.

*  (cash payment date 9(8) + curr payment 9(7) + ped 9(8)  + cycle nbr 9(2)
    10  filler                                  pic x(25).

*      (field now refers to clmhdr-date-sys instead of old
*       clmhdr-date-claim, but name remains the same)
    10  clmrec-hdr-date-claim                   pic x(8).
    10  clmrec-hdr-amt-tech-billed              pic s9(4)v99.
    10  clmrec-hdr-amt-tech-paid                pic s9(4)v99.
    10  clmrec-hdr-tot-claim-ar-oma             pic s9(5)v99.
    10  clmrec-hdr-tot-claim-ar-ohip            pic s9(5)v99.
    10  clmrec-hdr-manual-tape-pymnts           pic s9(5)v99.
    10  clmrec-hdr-status-ohip                  pic xx.
*       (review=1,submitdate=8,confidential=1,servdate=8,origbatchid=11)
* 2003/08/21 - MC - 8 chars for 4 new elements (elig-error, elig-status, serv-er
*   10  filler                                  pic x(29).
*!  10  filler                                  pic x(37).
    10  filler                                  pic x(36).
* 2003/08/21 - end

*-------------------
10  k-key-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  clmrec-hdr-b-key-type                        pic x.
    20  clmrec-hdr-b-data.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   5
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*!        25  clmrec-hdr-b-batch-num                   pic 9(9).
        25  clmrec-hdr-b-batch-num                   pic x(8).
        25  clmrec-hdr-b-batch-nbr redefines clmrec-hdr-b-batch-num.
            30  clmrec-hdr-b-clinic-nbr-1-2          pic 99.
*!            30  clmrec-hdr-b-doc-nbr                 pic 9(4).
            30  clmrec-hdr-b-doc-nbr                 pic x(3).
            30  clmrec-hdr-b-doc-nbr-r redefines clmrec-hdr-b-doc-nbr.
*!                35  clmrec-hdr-b-doc-nbr-1           pic 9.
*!                35  clmrec-hdr-b-doc-nbr-2-4         pic 999.
                35  clmrec-hdr-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  clmrec-hdr-b-batch-number.
                35  clmrec-hdr-b-week                pic 99.
                35  clmrec-hdr-b-day                 pic 9.
        25  clmrec-hdr-b-claim-nbr                   pic 99.
        25  clmrec-hdr-b-oma-cd                      pic x999.

        25  clmrec-hdr-b-oma-suff                    pic x.
        25  clmrec-hdr-b-adj-nbr                     pic x.
    20  clmrec-hdr-b-data-r  redefines  clmrec-hdr-b-data.
        25  clmrec-hdr-b-pat-id                      pic x(15).
*!        25  filler                                   pic xx.
        25  filler                                   pic x.

10  k-clmdtl-p-claims-mstr.
    20  clmdtl-p-key-type                        pic x.
    20  clmdtl-p-data.
        25  clmdtl-p-batch-nbr.
            30  clmdtl-p-clinic-nbr-1-2      pic  99.
*!            30  clmdtl-p-doc-nbr             pic 9(4).
            30  clmdtl-p-doc-nbr             pic x(3).
            30  clmdtl-p-week                pic 99.
            30  clmdtl-p-day                 pic 9.
        25  clmdtl-p-claim-nbr               pic 99.
        25  clmdtl-p-oma-cd                  pic x999.
        25  clmdtl-p-oma-suff                pic x.
        25  clmdtl-p-adj-nbr                 pic x.
*-------------------------

01  claims-mstr-dtl-rec.

*!    10  filler                                  pic x(11).
    10  filler                                  pic x(10).
    10  clmrec-dtl-oma-cd                       pic x(4).
    10  filler                                  pic x(5).
    10  clmrec-dtl-agent-cd                     pic  9.
    10  clmrec-dtl-adj-cd                       pic  x.
    10  clmrec-dtl-nbr-serv                     pic 99.
    10  clmrec-dtl-sv-date                      pic x(8).
    10  clmrec-dtl-consec-dates occurs 3 times.
        15  clmrec-dtl-sv-nbr                   pic 9.
        15  filler                              pic xx.
    10  clmrec-dtl-amt-tech-billed              pic s9(4)v99.
    10  clmrec-dtl-fee-oma                      pic s9(5)v99.
    10  clmrec-dtl-fee-ohip                     pic s9(5)v99.
* 2003/08/21 - MC
*   10  filler                                  pic x(127).
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   6
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*!    10  filler                                  pic x(135).
    10  filler                                  pic x(134).
* 2003/08/21 - end

*mf added below copy to include 'external' key within record.
*mfcopy "f002_key_claims_mstr_mf.ws".
*-------------------
10  key-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  clmdtl-b-key-type                        pic x.
    20  clmdtl-b-data.
*!        25  clmdtl-b-batch-num                   pic 9(9).
        25  clmdtl-b-batch-num                   pic x(8).
        25  clmdtl-b-batch-nbr redefines clmdtl-b-batch-num.
            30  clmdtl-b-clinic-nbr-1-2          pic 99.
*!            30  clmdtl-b-doc-nbr                 pic 9(4).
            30  clmdtl-b-doc-nbr                 pic x(3).
            30  clmdtl-b-doc-nbr-r redefines clmdtl-b-doc-nbr.
*!                35  clmdtl-b-doc-nbr-1           pic 9.
*!                35  clmdtl-b-doc-nbr-2-4         pic 999.
                35  clmdtl-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  clmdtl-b-batch-number.
                35  clmdtl-b-week                pic 99.
                35  clmdtl-b-day                 pic 9.
            30  clmdtl-b-batch-number-numeric redefines  clmdtl-b-batch-number
                                                pic 9(3).

        25  clmdtl-b-claim-nbr                   pic 99.
        25  clmdtl-b-oma-cd                      pic x999.

        25  clmdtl-b-oma-suff                    pic x.
        25  clmdtl-b-adj-nbr                     pic x.
    20  clmdtl-b-data-r  redefines  clmdtl-b-data.
        25  clmdtl-b-pat-id                      pic x(15).
*!        25  filler                               pic xx.
        25  filler                               pic x.

10  clmdtl-p-claims-mstr.
    20  clmdtl-p-key-type                        pic x.
    20  clmdtl-p-data.
        25  clmdtl-p-batch-nbr.
            30  clmdtl-p-clinic-nbr-1-2      pic  99.
*!            30  clmdtl-p-doc-nbr             pic 9(4).
            30  clmdtl-p-doc-nbr             pic x(3).
            30  clmdtl-p-week                pic 99.
            30  clmdtl-p-day                 pic 9.
        25  clmdtl-p-claim-nbr               pic 99.
        25  clmdtl-p-oma-cd                  pic x999.
        25  clmdtl-p-oma-suff                pic x.
        25  clmdtl-p-adj-nbr                 pic x.
*-------------------------

*
    copy "f002_claims_mstr_rec1_2.ws".
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   7
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*  yy/mm/dd  whom          why
*  --------  ----          ---
*
*  84/12/19  i.warsh       broke down the reference field so that
*                          each individual character could be looked at
*                          for direct bills.
*  90/09/27  b.elliott     added redefine for clmhdr-claim-source-cd
*
*  91/02/13  m. chan       clmhdr-tape-submit-ind is related to manual
*                          review flag.  if 'n' means manual review is
*                          on; ohterwise, if 'y' means manual review is
*                          off
*
*  91/04/17  m. chan       clmhdr-tape-submit-ind is related to claim
*                          status - 's'ubmit, 'r'esubmit or 'h'old
*  98/01/26  m. chan       moved clmhdr-orig-batch-id after clmhdr-reserve-
*                          for-future
*  98/06/02  d. balmer     y2K date change
*  99/jan/21 B.E.  - added clmhdr-date-sys breakdown of -12 and -38 fields.
*  99/jan/25 B.E.  - added clmhdr-date-admit breakdown of -12 and -38 fields.
*  99/jan/25 B.E.  - added clmhdr-payroll redefine of clmhdr-hosp
*  03/aug/21 M.C.  - add 5 new elements to the files
*  03/nov/05 M.C.  - alpha doc nbr
*  04/jul/07 b.e.  - added  clmdtl-orig-doc-number
*                           clmdtl-orig-batch-number
*                           clmdtl-orig-claim-number
*  04/nov/18 M.C. - correct the redefinition of clmdtl-orig-complete-batch-n-r
*                   by including clmdtl-orig-clinic-number
*  07/jan/16 M.C. - change the definition of clmhdr-week/day from numeric to alp
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

* insert this warning message from "f002_duplicate_fd_warning.fd"

*+++++++++++++++W A R N I N G +++++++++++++++
*                                           *
* any changes to this fd must also be made  *
* to the other 3 in the following list:     *
*                                           *
*        "f002_claims_hdr_rec.ws            *
*        "f002_claims_dtl_rec.ws            *
*        "f002_claims_mstr_rec1_2.ws        *
*        "f002_clm_mstr_p_access.ws         *
*                                           *
*+++++++++++++++W A R N I N G +++++++++++++++

*
*       note 1: key for this file is the claim-id which is prefaced by a
*               1 character type field -- 'p' = patient id (i key)
*                                         'b' = batch nbr
*       note 2: - the claim detail data recs are written with valid oma
*                   codes, the detail description recs use an oma code of 'zzzz'
*                   and adjustment detail records use and 'adj-cd' of "1")

01  claim-header-rec.

    05  clmhdr-claim-id.
*!      10  clmhdr-batch-nbr                    pic 9(9).
        10  clmhdr-batch-nbr                    pic x(8).
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   8
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
        10  clmhdr-batch-nbr-r1 redefines clmhdr-batch-nbr.
            15  clmhdr-clinic-nbr-1-2           pic 99.
*!          15  clmhdr-doc-nbr                  pic 9(4).
            15  clmhdr-doc-nbr                  pic x(3).
*           15  clmhdr-week                     pic 99.
*           15  clmhdr-day                      pic 9.
            15  clmhdr-week                     pic xx.
            15  clmhdr-day                      pic x.
        10  clmhdr-batch-nbr-r2 redefines clmhdr-batch-nbr.
            15  filler                          pic xx.
*!          15  clmhdr-batch-nbr-3-6            pic 9(4).
            15  clmhdr-batch-nbr-3-6            pic x(3).
            15  clmhdr-batch-nbr-7-9            pic 999.
        10  clmhdr-claim-nbr                    pic 9(2).
        10  clmhdr-zeroed-oma-suff-adj.
            15  clmhdr-adj-oma-cd               pic x999.
            15  clmhdr-adj-oma-suff             pic x.
            15  clmhdr-adj-adj-nbr              pic 9.
        10  clmhdr-zeroed-area redefines clmhdr-zeroed-oma-suff-adj
                                                pic 9(6).
*       (valid batch types are 'c' 'a' 'p')
    05  clmhdr-batch-type                       pic x.
*       ('clmhdr-card-colour' replaced by 'adjust-sub-type' --
    05  clmhdr-adj-cd-sub-type                  pic x.
    05  clmhdr-adj-cd-sub-type-ss redefines clmhdr-adj-cd-sub-type
                                                pic 9.
    05  clmhdr-claim-source-cd    redefines clmhdr-adj-cd-sub-type
                                                pic x.
    05  clmhdr-doc-nbr-ohip                     pic 9(6).
    05  clmhdr-doc-spec-cd                      pic 99.
    05  clmhdr-refer-doc-nbr                    pic 9(6).
    05  clmhdr-diag-cd                          pic 999.
    05  clmhdr-loc                              pic x999.

    05  clmhdr-hosp                             pic x.
    05  clmhdr-payroll redefines clmhdr-hosp    pic x.

    05  clmhdr-agent-cd                         pic 9.
    05  clmhdr-adj-cd                           pic x.
    05  clmhdr-tape-submit-ind                  pic x.
    05  clmhdr-i-o-pat-ind                      pic x.
    05  clmhdr-pat-ohip-id-or-chart.
        10  clmhdr-pat-key-type                 pic a.
        10  clmhdr-pat-key-data.
            15  clmhdr-pat-key-ohip             pic x(8).
            15  filler                          pic x(7).
    05  clmhdr-pat-acronym.
        10  clmhdr-pat-acronym6                 pic x(6).
        10  clmhdr-pat-acronym3                 pic x(3).
    05  clmhdr-reference.
        10  clmhdr-ref1                         pic x.
        10  clmhdr-ref2                         pic x.
        10  clmhdr-ref3                         pic x.
        10  clmhdr-ref4                         pic x.
        10  clmhdr-ref5                         pic x.
        10  clmhdr-ref6                         pic x.
        10  clmhdr-ref7                         pic x.
        10  clmhdr-ref8                         pic x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page   9
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
        10  clmhdr-ref9                         pic x.
* y2k
        10  clmhdr-ref10                        pic x.
        10  clmhdr-ref11                        pic x.
    05  clmhdr-reference-r redefines clmhdr-reference.
        10  clmhdr-ref-date1.
* y2k
*           15  clmhdr-ref-date-yy                      pic 9(2).
            15  clmhdr-ref-date-yy              pic 9(4).
            15  clmhdr-ref-date-mm              pic 9(2).
            15  clmhdr-ref-date-dd              pic 9(2).
        10  clmhdr-ref-inits                    pic x(3).
    05  clmhdr-reference-r1 redefines clmhdr-reference-r.
        10  filler                              pic x.
* y2k
*       10  clmhdr-ref-date2                            pic x(6).
        10  clmhdr-ref-date2                    pic x(8).
        10  filler                              pic x(2).
    05  clmhdr-reference-r2 redefines clmhdr-reference-r1.
        10  filler                              pic x(2).
* y2k
*       10  clmhdr-ref-date3                            pic x(6).
        10  clmhdr-ref-date3                    pic x(8).
        10  filler                              pic x(1).
    05  clmhdr-reference-r3 redefines clmhdr-reference-r2.
        10  filler                              pic x(3).
* y2k
*       10  clmhdr-ref-date4                            pic x(6).
        10  clmhdr-ref-date4                    pic x(8).
    05  clmhdr-date-admit.
*           (note - admit-yy must be left alpha-numeric)
* y2k
*       10  clmhdr-date-admit-yy                        pic xx.
        10  clmhdr-date-admit-yy                pic x(4).
        10  clmhdr-date-admit-yy-r redefines
            clmhdr-date-admit-yy.
            15  clmhdr-date-admit-yy-12         pic xx.
            15  clmhdr-date-admit-yy-34         pic xx.
        10  clmhdr-date-admit-mm                pic 99.
        10  clmhdr-date-admit-mm-r redefines clmhdr-date-admit-mm
                                                pic xx.
        10  clmhdr-date-admit-dd                pic 99.
        10  clmhdr-date-admit-dd-r redefines clmhdr-date-admit-dd
                                                pic xx.
    05  clmhdr-date-admit-r redefines clmhdr-date-admit
* y2k                                                pic 9(6).
                                                pic 9(8).
    05  clmhdr-date-admit-r2 redefines clmhdr-date-admit-r.
        10 clmhdr-date-admit-12                 pic 9(2).
        10 clmhdr-date-admit-38                 pic 9(6).
    05  clmhdr-doc-dept                         pic 99.
* y2k    05  clmhdr-date-cash-tape-payment           pic x(6).
    05  clmhdr-date-cash-tape-payment           pic x(8).
    05  clmhdr-date-cash-tape-paymt-r redefines
        clmhdr-date-cash-tape-payment.
        10  clmhdr-date-cash-tape-paymt-12      pic 9(2).
        10  clmhdr-date-cash-tape-paymt-38      pic 9(6).
    05  clmhdr-direct-bills-clm-info  redefines clmhdr-date-cash-tape-payment.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  10
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
        10  clmhdr-msg-nbr                      pic xx.
        10  clmhdr-reprint-flag                 pic x.
        10  clmhdr-sub-nbr                      pic x.
        10  clmhdr-auto-logout                  pic x.
        10  clmhdr-fee-complex                  pic x.
        10  filler                              pic xx.
    05  clmhdr-curr-payment                     pic s9(5)v99.

    05  clmhdr-date-period-end.
* y2k
*       10  clmhdr-period-end-yy                        pic 99.
        10  clmhdr-period-end-yy                pic 9(4).
        10  clmhdr-period-end-mm                pic 99.
        10  clmhdr-period-end-dd                pic 99.
    05  clmhdr-cycle-nbr                        pic 99.
* y2k
*   05  clmhdr-date-sys                                 pic x(6).
    05  clmhdr-date-sys                         pic x(8).
    05  clmhdr-date-sys-r redefines clmhdr-date-sys.
        10  clmhdr-date-sys-12                  pic 9(2).
        10  clmhdr-date-sys-38                  pic 9(6).
    05  clmhdr-amt-tech-billed                  pic s9(4)v99.
    05  clmhdr-amt-tech-paid                    pic s9(4)v99.
    05  clmhdr-tot-claim-ar-oma                 pic s9(5)v99.
    05  clmhdr-tot-claim-ar-ohip                pic s9(5)v99.
    05  clmhdr-manual-and-tape-paymnts          pic s9(5)v99.
    05  clmhdr-status-ohip                      pic xx.

    05  clmhdr-manual-review                    pic x.
    05  clmhdr-submit-date.
* y2k
*       10  clmhdr-submit-yy                            pic 99.
        10  clmhdr-submit-yy                    pic 9(4).
        10  clmhdr-submit-mm                    pic 99.
        10  clmhdr-submit-dd                    pic 99.
    05  clmhdr-confidential-flag                pic x.
* y2k
*   05  clmhdr-serv-date                                pic 9(6).
    05  clmhdr-serv-date                        pic 9(8).
*
* (y2k removed)
*           05  clmhdr-reserve-for-future               pic x(6).

* 2003/08/21 - add 4 new items
    05  clmhdr-elig-error                       pic x(3).
    05  clmhdr-elig-status                      pic x.
    05  clmhdr-serv-error                       pic x(3).
    05  clmhdr-serv-status                      pic x.
* 2003/08/21 - end

    05  clmhdr-orig-batch-id.
        10  clmhdr-orig-batch-nbr.
            15  clmhdr-orig-batch-nbr-1-2       pic  99.
*!          15  clmhdr-orig-batch-nbr-3         pic   9.
*!          15  clmhdr-orig-batch-nbr-4-9       pic 9(6).
            15  clmhdr-orig-batch-nbr-4-9       pic x(6).
        10  clmhdr-orig-batch-nbr-next-def      redefines clmhdr-orig-batch-nbr.
            15  filler                          pic  99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  11
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*!          15  filler                          pic   9.
*!          15  clmhdr-orig-batch-nbr-4-6       pic 9(3).
            15  clmhdr-orig-batch-nbr-4-6       pic x(3).
            15  clmhdr-orig-batch-nbr-7-8       pic  99.
            15  clmhdr-orig-batch-nbr-9         pic   9.
        10  clmhdr-orig-claim-nbr               pic  99.
    05  clmhdr-orig-batch-id-r  redefines clmhdr-orig-batch-id.
*!      10  clmhdr-orig-complete-batch-nbr      pic 9(11).
        10  clmhdr-orig-complete-batch-nbr      pic x(10).
*mf moved external keys into data record
*mfcopy "f002_key_claims_mstr_mf.ws" replacing "key-clm-" by "clmhdr-b-".
*-------------------
05  k-clmhdr-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  k-clmhdr-b-key-type                        pic x.
    20  k-clmhdr-b-data.
*!      25  k-clmhdr-b-batch-num                   pic 9(9).
        25  k-clmhdr-b-batch-num                   pic x(8).
        25  k-clmhdr-b-batch-nbr redefines k-clmhdr-b-batch-num.
            30  k-clmhdr-b-clinic-nbr-1-2          pic 99.
*!          30  k-clmhdr-b-doc-nbr                 pic 9(4).
            30  k-clmhdr-b-doc-nbr                 pic x(3).
            30  k-clmhdr-b-doc-nbr-r redefines k-clmhdr-b-doc-nbr.
*!              35  k-clmhdr-b-doc-nbr-1           pic 9.
*!              35  k-clmhdr-b-doc-nbr-2-4         pic 999.
                35  k-clmhdr-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  k-clmhdr-b-batch-number.
                35  k-clmhdr-b-week                pic 99.
                35  k-clmhdr-b-day                 pic 9.
        25  k-clmhdr-b-claim-nbr                   pic 99.
        25  k-clmhdr-b-oma-cd                      pic x999.
        25  k-clmhdr-b-oma-suff                    pic x.
        25  k-clmhdr-b-adj-nbr                     pic x.
    20  k-clmhdr-b-data-r  redefines  k-clmhdr-b-data.
        25  k-clmhdr-b-pat-id                      pic x(15).
*!      25  filler                                 pic xx.
        25  filler                                 pic x.

*mf10  k-clmhdr-p-claims-mstr.
05  k-clmhdr-p-claims-mstr.
    20  k-clmhdr-p-key-type                        pic x.
    20  k-clmhdr-p-data.
        25  k-clmhdr-p-batch-nbr.
            30  k-clmhdr-p-clinic-nbr-1-2      pic  99.
*!          30  k-clmhdr-p-doc-nbr             pic 9(4).
            30  k-clmhdr-p-doc-nbr             pic x(3).
            30  k-clmhdr-p-week                pic 99.
            30  k-clmhdr-p-day                 pic 9.
        25  k-clmhdr-p-claim-nbr               pic 99.
        25  k-clmhdr-p-oma-cd                  pic x999.
        25  k-clmhdr-p-oma-suff                pic x.
        25  k-clmhdr-p-adj-nbr                 pic x.
*-------------------------

01  claim-detail-rec.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  12
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)

    05  clmdtl-id.
*!      10  clmdtl-batch-nbr                    pic 9(9).
        10  clmdtl-batch-nbr                    pic x(8).
        10  clmdtl-claim-nbr                    pic 9(2).
        10  clmdtl-oma-cd                       pic xxxx.
        10  clmdtl-oma-suff                     pic x.
        10  clmdtl-adj-nbr                      pic 9.

    05  clmdtl-det-rec.
        10  clmdtl-rev-group-cd                 pic xxx.
        10  clmdtl-agent-cd                     pic 9.
        10  clmdtl-adj-cd                       pic x.
        10  clmdtl-nbr-serv                     pic 99.
        10  clmdtl-nbr-serv-r redefines clmdtl-nbr-serv.
            15  clmdtl-adjust-reprint           pic x.
            15  filler                          pic x.
        10  clmdtl-sv-date.
* y2k            15  clmdtl-sv-yy                    pic 99.
            15  clmdtl-sv-yy                    pic 9999.
            15  clmdtl-sv-mm                    pic 99.
            15  clmdtl-sv-dd                    pic 99.

        10  clmdtl-consec-dates.
            15  clmdtl-consecutive-sv-date  occurs 3 times
                                                pic 999.
        10  clmdtl-consec-dates-r  redefines  clmdtl-consec-dates.
            15  clmdtl-consecutive-dates    occurs 3 times.
                20  clmdtl-sv-nbr               pic  9.
                20  clmdtl-sv-day               pic xx.

        10  clmdtl-amt-tech-billed              pic s9(4)v99.
        10  clmdtl-fee-oma                      pic s9(5)v99.
        10  clmdtl-fee-ohip                     pic s9(5)v99.
* y2k        10  clmdtl-date-period-end              pic x(6).
        10  clmdtl-date-period-end              pic x(8).
        10  clmdtl-cycle-nbr                    pic 999.

        10  clmdtl-diag-cd                      pic 999.
        10  clmdtl-line-no                      pic 99.
* (y2k)
*       10  clmdtl-reserve-for-future                   pic x(8).
* 2003/08/21 - MC
*      10  clmdtl-reserve-for-future           pic x(4).
       10  clmdtl-resubmit-flag                pic x.
       10  clmdtl-reserve-for-future           pic x(3).
* 2003/08/21 - end

    05  clmdtl-desc-rec redefines clmdtl-det-rec.
        10  clmdtl-desc                         pic x(22).
        10  filler                              pic x(42).
*mf
*   05  clmdtl-filler                                   pic x(88).
* 2003/08/21 - MC
*   05  clmdtl-filler                           pic x(96).
    05  clmdtl-filler                           pic x(104).
* 2003/08/21 - end

* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  13
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
    05  clmdtl-orig-batch-id.
*!      10  clmdtl-orig-batch-nbr               pic 9(9).
        10  clmdtl-orig-batch-nbr               pic x(8).
        10  clmdtl-orig-batch-nbr-r redefines clmdtl-orig-batch-nbr.
            15  clmdtl-orig-batch-nbr-1-2       pic 99.
*!          15  clmdtl-orig-batch-nbr-3         pic 9.
*!          15  clmdtl-orig-batch-nbr-4-9       pic 9(6).
            15  clmdtl-orig-batch-nbr-4-9       pic x(6).
        10  clmdtl-orig-claim-nbr-in-batch      pic 99.
    05  clmdtl-orig-batch-id-r  redefines clmdtl-orig-batch-id.
*!      10  clmdtl-orig-complete-batch-nbr      pic 9(11).
        10  clmdtl-orig-complete-batch-nbr      pic 9(10).
        10  clmdtl-orig-complete-batch-n-r redefines clmdtl-orig-complete-batch-
* 2004/11/18 - MC - include clinic nbr
            15  clmdtl-orig-clinic-number       pic 99.
* 2004/11/18 - end
            15  clmdtl-orig-doc-number          pic x(3).
            15  clmdtl-orig-batch-number        pic 9(3).
            15  clmdtl-orig-claim-number        pic 9(2).

*mf moved external keys into data record
*mfcopy "f002_key_claims_mstr_mf.ws" replacing "key-clm-" by "clmdtl-b-".
*-------------------
05  k-clmdtl-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  k-clmdtl-b-key-type                        pic x.
    20  k-clmdtl-b-data.
*!      25  k-clmdtl-b-batch-num                   pic 9(9).
        25  k-clmdtl-b-batch-num                   pic x(8).
        25  k-clmdtl-b-batch-nbr redefines k-clmdtl-b-batch-num.
            30  k-clmdtl-b-clinic-nbr-1-2          pic 99.
*!          30  k-clmdtl-b-doc-nbr                 pic 9(4).
            30  k-clmdtl-b-doc-nbr                 pic x(3).
            30  k-clmdtl-b-doc-nbr-r redefines k-clmdtl-b-doc-nbr.
*!              35  k-clmdtl-b-doc-nbr-1           pic 9.
*!              35  k-clmdtl-b-doc-nbr-2-4         pic 999.
                35  k-clmdtl-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  k-clmdtl-b-batch-number.
                35  k-clmdtl-b-week                pic 99.
                35  k-clmdtl-b-day                 pic 9.
        25  k-clmdtl-b-claim-nbr                   pic 99.
        25  k-clmdtl-b-oma-cd                      pic x999.
        25  k-clmdtl-b-oma-suff                    pic x.
        25  k-clmdtl-b-adj-nbr                     pic x.
    20  k-clmdtl-b-data-r  redefines  k-clmdtl-b-data.
        25  k-clmdtl-b-pat-id                      pic x(15).
*!      25  filler                                 pic xx.
        25  filler                                 pic x.

*mf10  k-clmdtl-p-claims-mstr.
05  k-clmdtl-p-claims-mstr.
    20  k-clmdtl-p-key-type                        pic x.
    20  k-clmdtl-p-data.
        25  k-clmdtl-p-batch-nbr.
            30  k-clmdtl-p-clinic-nbr-1-2      pic  99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  14
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*!          30  k-clmdtl-p-doc-nbr             pic 9(4).
            30  k-clmdtl-p-doc-nbr             pic x(3).
            30  k-clmdtl-p-week                pic 99.
            30  k-clmdtl-p-day                 pic 9.
        25  k-clmdtl-p-claim-nbr               pic 99.
        25  k-clmdtl-p-oma-cd                  pic x999.
        25  k-clmdtl-p-oma-suff                pic x.
        25  k-clmdtl-p-adj-nbr                 pic x.
*-------------------------

*
    copy "f090_constants_mstr.fd".
* 99/Jan/29     MC      - change iconst-clinic-nbr from numeric to character
* 03/nov/05 b.e. - alpha doctor nbr
* 06/nov/08     MC      - include iconst-clinic-pay-batch-nbr

fd  iconst-mstr
*       index block contains   2 characters
              block contains 384 characters
        record      contains 384 characters  .
*       feedback is feedback-iconst-mstr.

01 iconst-mstr-rec.
    05  iconst-clinic-nbr-1-2                   pic   99.
*    05  iconst-clinic-nbr                      pic  9(4).
    05  iconst-clinic-nbr                       pic  x(4).
    05  iconst-clinic-name                      pic x(20).
    05  iconst-clinic-cycle-nbr                 pic   99.
    05  iconst-date-period-end.
* y2k   10  iconst-date-period-end-yy           pic   99.
        10  iconst-date-period-end-yy           pic   9999.
        10  iconst-date-period-end-mm           pic   99.
        10  iconst-date-period-end-dd           pic   99.
    05  iconst-clinic-addr.
        10  iconst-clinic-addr-l1               pic  x(25).
        10  iconst-clinic-addr-l2               pic  x(25).
        10  iconst-clinic-addr-l3               pic  x(25).
    05  iconst-clinic-addr-r redefines iconst-clinic-addr.
        10  iconst-clinic-addr                  pic x(25)   occurs  3  times.
    05  iconst-clinic-card-colour               pic    x.
    05  iconst-clinic-over-lim1                 pic 99v99.
    05  iconst-clinic-under-lim2                pic 99v99.
    05  iconst-clinic-under-lim3                pic 99v99.
    05  iconst-clinic-over-lim4                 pic 99v99.

*!    05  iconst-clinic-batch-nbr                 pic 9(6).
    05  iconst-clinic-batch-nbr                 pic x(6).

    05  iconst-reduction-factor                 pic 99v99.
    05  iconst-overpay-factor                   pic 99v99.
* 2006/11/08
*   05  filler                                  pic x(242).
    05  filler                                  pic x(106).
    05  iconst-clinic-pay-batch-nbr             pic x(6).
    05  filler                                  pic x(130).
* 2006/11/08 - end

fd  print-file
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  15
*                      r073.cbl                                      )
    record contains 132 characters.
01  print-record                                pic x(132).
working-storage section.

77  elapsed-hrs                                 pic 99.
77  elapsed-min                                 pic 99.
77  sys-hrs-pr                                  pic 99.
77  sys-min-pr                                  pic 99.
77  ctr-line                                    pic 999.
77  line-advance                                pic 99.
77  nbr-lines-2-advance                         pic 9.
77  max-nbr-lines-per-page                      pic 99  value 64.
77  page-nbr                                    pic 999.
*2000/05/12 - B.A.
*77  save-clinic-ped                            pic x(6).
77  save-clinic-ped                             pic x(8).

77  save-clinic-id                              pic 99.
*2000/05/12 - B.A. begin
*77  ws-ped-purge-from                          pic 9(6).
*77  ws-ped-purge-to                            pic 9(6).
*77  w-clmhdr-date-sys                          pic x(6).
*77  w-clmhdr-date-sys-n redefines
*                       w-clmhdr-date-sys       pic 9(6).
77  ws-ped-purge-from                           pic 9(8).
77  ws-ped-purge-to                             pic 9(8).

* 2002/07/05 - MC
77  cutoff-date                                 pic 9(8).
* 2002/07/05 - end

77  w-clmhdr-date-sys                           pic x(8).
77  w-clmhdr-date-sys-n redefines
                        w-clmhdr-date-sys       pic 9(8).
*2000/05/12 end

*   (tested to allow totals line to be surpressed if not detail lines
*    have been printed)

77  sw-printed-bat-type                         pic x.
77  sw-printed-adj-type                         pic x.

01  begin-time.
    05  begin-hrs                               pic 99.
    05  begin-min                               pic 99.
    05  filler                                  pic 9(4).

77  claims-occur                                pic 9(12).
77  claims-occur-new                            pic 9(12).

*   status file indicators
*mf 77  common-status-file                      pic x(11).
*mf 77  status-claims-mstr                      pic x(11) value zero.
*mf 77  status-cobol-claims-mstr-new            pic xx    value zero.
*mf 77  status-claims-mstr-new                  pic x(11) value zero.
*mf 77  status-iconst-mstr                      pic x(11) value zero.
77  status-prt-file                             pic xx    value zero.
77  feedback-claims-mstr                        pic x(4).
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  16
*                      r073.cbl                                      )
77  feedback-claims-mstr-new                    pic x(4).
77  feedback-iconst-mstr                        pic x(4).
77  const-mstr-rec-nbr                          pic x.

77  common-status-file                          pic xx.
77  status-cobol-claims-mstr                    pic xx    value zero.
77  status-cobol-iconst-mstr                    pic xx    value zero.

*   flag indicators
77  err-ind                                     pic 99  value zero.
77  header-done                                 pic x   value "N".
77  totals-written                              pic x   value "N".
77  display-key-type                            pic x(7).
77  ss                                          pic 9(2) comp.

    copy  "site_id.ws".
77 site-id                                      pic x(3) values "RMA".

01 tmp-doc-nbr-alpha.
    05 tmp-batch-nbr-index                      pic x(1) occurs 8 times.

01  flag-request-complete                       pic x.
    88  flag-request-complete-y                 value "Y".
    88  flag-request-complete-n                 value "N".

01  flag                                        pic x.
    88 ok                                       value "Y".
    88 not-ok                                   value "N".

*   eof flags
77  error-flag                                  pic x   value "N".
77  eof-claims-mstr                             pic x   value "N".
77  eof-claims-dtl                              pic x   value "N".
77  end-search-index                            pic x   value "N".

*   variables
77  ss-var-err                                  pic 99  value 14.
77  age-category                                pic 99.
77  day-old                                     pic s9(5).
77  day-old-r                                   pic xxx.
77  i                                           pic 99.
77  dept-nbr                                    pic 9.
77  age-yy                                      pic s99.
77  age-mm                                      pic s99.
77  age-dd                                      pic s99.
77  ws-reply                                    pic x.
77  ws-date-reply                               pic x.

*   total variables
77  dept-tot-amount                             pic s9(8)v99.
77  balance-due                                 pic s9(6)v99.
77  write-off-nbr-of-clms                       pic 999.

*mf
77  ws-sys-date-long                            pic 9(8).
*2000/05/12 - B.A.
*77  temp-date                                  pic 9(6).
77  temp-date                                   pic 9(8).
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  17
*                      r073.cbl                                      )

01  blank-line                                  pic x(132) value spaces.

01  audit-line.
     05  filler                                 pic x(10) value spaces.
     05  audit-title                            pic x(60).
     05  filler                                 pic x(10) value spaces.
     05  audit-count                            pic 9(10).
     05  filler                                 pic x(42) value spaces.

*   hold-area.
*!77  hold-batch-nbr                            pic 9(9) value zero.
77  hold-batch-nbr                              pic x(8) value zero.
77  hold-claim-nbr                              pic 9(2) value zero.
77  hold-period-end                             pic x(6).

01  hold-key.
    05  hold-key-clm-batch-nbr.
        10  hold-key-clinic-nbr1                pic 99.
*!      10  hold-key-doc-nbr                    pic 9(4).
        10  hold-key-doc-nbr                    pic x(3).
        10  hold-key-week                       pic 99.
        10  hold-key-day                        pic 9.
    05  hold-key-claim-nbr                      pic 99.
    05  hold-key-oma-code                       pic x999.
    05  hold-key-oma-suff                       pic x.
    05  hold-key-adj-nbr                        pic x.

01  sel-report-date.
*2000/05/12 - B.A.
*    05  report-yy                              pic 99.
    05  report-yy                               pic 9(4).
    05  filler                                  pic x  value "/".
    05  report-mm                               pic 99.
    05  filler                                  pic x  value "/".
    05  report-dd                               pic 99.

01  counters-per-clinic.
    05  ctr-clinic-delprev-nbr                  pic 9(9).
    05  ctr-clinic-delcurr-nbr                  pic 9(9).
    05  ctr-clinic-delcurr-amt                  pic s9(9)v99.
    05  ctr-clinic-delprev-amt                  pic s9(9)v99.
    05  ctr-clinic-concurr-nbr                  pic 9(9).
    05  ctr-clinic-conprev-nbr                  pic 9(9).
    05  ctr-clinic-concurr-amt                  pic s9(9)v99.
    05  ctr-clinic-conprev-amt                  pic s9(9)v99.

*   counters for records read/written for all input/output files
01  counters.
    05  ctr-claims-mstr-reads                   pic 9(9).
    05  ctr-nbr-hdr-rec-reads                   pic 9(9).
    05  ctr-nbr-hdr-rec-writes                  pic 9(9).
    05  ctr-nbr-dtl-rec-reads                   pic 9(9).
    05  ctr-nbr-dtl-rec-writes                  pic 9(9).
    05  ctr-claims-mstr-in-acctrec              pic 9(9).
    05  ctr-amt-claims-mstr-in-acctrec          pic s9(9)v99.
    05  ctr-claims-mstr-write-offs              pic 9(9).
    05  ctr-amt-claims-mstr-write-offs          pic s9(9)v99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  18
*                      r073.cbl                                      )




01  tbl-totals.
    05  tbl-bat-type-and-tots   occurs   8  times.
        10  tbl-agent-and-sums  occurs  11  times.
            15  tbl-item        occurs   8  times.
                20  tbl-tot             pic s9(9)v99.
*       (access using tbl-tot (ss-type, ss-agent, ss-item))
01  tbl-totals-variable-ss.
*mf
    05  ss-temp1                        pic 9(6).
    05  ss-type                         pic 99.
    05  ss-agent                        pic 99.
    05  ss-item                         pic 9.

    05  ss-type-from                    pic 99.
    05  ss-type-to                      pic 99.
    05  ss-agent-from                   pic 99.
    05  ss-agent-to                     pic 99.

*       (maximums for subscripts)
    05  max-nbr-types                   pic 99  value  6.
    05  max-nbr-agents                  pic 99  value 10.
    05  max-nbr-items                   pic  9  value  8.


***  subscripts for 'TBL-TOTALS'.
01  ss-tbl-totals.
*     (subscripts for  'TBL-BAT-TYPE-AND-TOTS')
    05  ss-claims                       pic 99  value  1.
    05  ss-adj-a                        pic 99  value  2.
    05  ss-adj-b                        pic 99  value  3.
    05  ss-adj-r                        pic 99  value  4.
    05  ss-pay-m                        pic 99  value  5.
    05  ss-pay-c                        pic 99  value  6.
    05  ss-type-tot                     pic 99  value  7.
    05  ss-grand-tot                    pic 99  value  8.
*         (subscripts for  'TBL-AGENT-AND-SUMS')
*        -- values 1 thru 10 are obtained using (agent code + 1)
        05  ss-agent-tot                pic 99  value 11.
*             (subscripts for  'TBL-ITEM')
*              (values 1 thru 4 used for deleted claims)
*              (values 5 thru 8 (obtained by adding variable offset) are
*               used for retained claims)

            05  ss-a-r-oma              pic 9   value  1.
            05  ss-a-r-ohip             pic 9   value  2.
            05  ss-cash                 pic 9   value  3.
            05  ss-nbr                  pic 9   value  4.
            05  ss-offset               pic 9   value  4.
*               ( variable offset )
            05  del-ret-offset          pic 9.



01  tbl-batch-type-desciptions.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  19
*                      r073.cbl                                      )
    05  tbl-batch-type-descs.
        10  filler                      pic x(18)  value
                "CLAIMS          ".
        10  filler                      pic x(18)  value
                "ADJUSTMENTS- 'A'".
        10  filler                      pic x(18)  value
                "ADJUSTMENTS- 'B'".
        10  filler                      pic x(18)  value
                "ADJUSTMENTS- 'R'".
        10  filler                      pic x(18)  value
                "PAYMENTS   - 'M'".
        10  filler                      pic x(18)  value
                "PAYMENTS   - 'C'".
        10  filler                      pic x(18)  value
                "                ".
        10  filler                      pic x(18)  value
                "GRAND TOTALS    ".
    05  tbl-batch-type-descs-r  redefines   tbl-batch-type-descs.
        10  batch-descs         occurs  8  times.
            15  desc-bat-type           pic x(13).
            15  desc-adj-type           pic x(5).

*mf copy "F002_KEY_CLAIMS_MSTR.WS".

**********    copy "F002_KEY_CLAIMS_MSTR_NEW.WS".

01 print-file-name                              pic x(4)  value "r073".

copy "sysdatetime.ws".
* 98/dec/01 D.B.        - y2k conversion
* 99/jan/13 B.E.        - changed sys-y1/y2 to y1 thru y4
*                       - added 'default-century-...' and century-date variables

01 century-year                                 pic 9(4).
01 century-date                                 pic 9(8).
01 default-century-cc                           pic 9(2) value 19.
01 default-century-cccc                         pic 9(4) value 1900.

01  sys-date.
* y2k    05  sys-date-long                              pic x(6).
    05  sys-date-long                           pic x(8).
    05  sys-date-long-r  redefines  sys-date-long.
* y2k   10  sys-yy                              pic 99.
        10  sys-yy                              pic 9999.
        10  sys-yy-alpha  redefines  sys-yy.
* y2k       15  sys-y1                          pic 9.
* y2k       15  sys-y2                          pic 9.
            15  sys-y1                          pic 9.
            15  sys-y2                          pic 9.
            15  sys-y3                          pic 9.
            15  sys-y4                          pic 9.
        10  sys-mm                              pic 99.
        10  sys-dd                              pic 99.
* remove after y2k upgrade of dgux
01  sys-date-numeric redefines sys-date         pic 9(8).
01  sys-date-y2kfix  redefines sys-date.
    05 sys-date-left                            pic x(6).
    05 filler                                   pic x(2).
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  20
*                      r073.cbl (/alpha/rmabill/rmabill101c/use/sysda)
01  sys-date-y2kfixed redefines sys-date.
    05 sys-date-blank                           pic x(2).
    05 sys-date-right                           pic x(6).
01  sys-date-temp                               pic x(8).

01  run-date.
* y2k    05  run-yy                                     pic 99.
    05  run-yy                                  pic 9999.
    05  filler                                  pic x   value "/".
    05  run-mm                                  pic 99.
    05  filler                                  pic x   value "/".
    05  run-dd                                  pic 99.

01  sys-time.
    05  sys-hrs                                 pic 99.
    05  sys-min                                 pic 99.
    05  sys-sec                                 pic 99.
    05  sys-hdr                                 pic 99.

01  run-time.
    05  run-hrs                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-min                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-sec                                 pic 99.

copy "agent_code.ws".
* 2001/nov/06 B.E. added agent 3 for ICU (revenue clinic 85) direct bills
01 ws-agent-flag                pic x.
   88 ohip-agent                value "0".
   88 direct-bill-agent         value "3" "4" "6".
   88 alt-fund-agent            value "8".
   88 wcb-agent                 value "9".

01  header-1.
    05  filler                          pic x(15)       value
                "R073    P.E.D. ".
* 2002/07/08 - MC
*    05  h1-ped                         pic 99/99/99    blank when zero.
*   05  filler                          pic x(17)       value spaces.
    05  h1-ped                          pic 9999/99/99  blank when zero.
    05  filler                          pic x(15)       value spaces.
* 2002/07/08 - end
    05  filler                          pic x(57)       value "CLAIMS MASTER CON
    05  filler                          pic x(9)        value "RUN DATE".
* 2002/07/08 - MC
*    05  h1-run-date                    pic x(8).
*    05  filler                         pic x(10)       value spaces.
    05  h1-run-date                     pic x(10).
    05  filler                          pic x(08)       value spaces.
* 2002/07/08 - end
    05  filler                          pic x(5)        value "PAGE".
    05  h1-page-nbr                     pic zz9.


01  print-line-1.
    05  l1-msg                          pic x(55).
*2000/05/12 - B.A.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  21
*                      r073.cbl                                      )
*    05  l1-yy                          pic 99.
    05  l1-yy                           pic 9(4).
    05  l1-slash-1                      pic x.
    05  l1-mm                           pic 99.
    05  l1-slash-2                      pic x.
    05  l1-dd                           pic 99.
    05  filler                          pic x.
    05  l1-hrs                          pic 99.
    05  l1-colon                        pic x.
    05  l1-min                          pic 99.
    05  filler                          pic x(63).

01  print-line-2   redefines    print-line-1.

    05  l2-msg                          pic x(55).
    05  l2-ctr                          pic zzz,zzz,zz9.
    05  filler                          pic x(66).

01  print-line-3   redefines    print-line-1.

    05  l3-msg                          pic x(55).
    05  l3-amt                          pic zzz,zzz,zz9.99-.
    05  filler                          pic x(62).

01  t2-print-line  redefines   print-line-1.
    05  t2-desc.
        10  t2-desc-a           pic x(13).
        10  t2-desc-b           pic x(5).
    05  t2-dash                 pic x.
    05  filler                  pic x.
    05  t2-agent-cd             pic 9.
* 2002/07/08 - MC
*    05  filler                 pic x(3).
*    05  t2-detail-1            pic z,zzz,zz9.99-.
*   05  filler                  pic x(2).
*   05  t2-detail-2             pic z,zzz,zz9.99-.
*   05  filler                  pic x(2).
*   05  t2-detail-3             pic z,zzz,zz9.99-.
*   05  filler                  pic x(2).
*   05  t2-detail-4             pic zzz,zz9.
*   05  filler                  pic x(2).
*   05  t2-detail-5             pic z,zzz,zz9.99-.
*   05  filler                  pic x(2).
*   05  t2-detail-6             pic z,zzz,zz9.99-.
*   05  filler                  pic x(2).
*   05  t2-detail-7             pic z,zzz,zz9.99-.
*   05  filler                  pic x(2).
*   05  t2-detail-8             pic zzz,zz9.
    05  filler                  pic x(2).
    05  t2-detail-1             pic zzzzzz,zz9.99-.
    05  filler                  pic x.
    05  t2-detail-2             pic zzzzzz,zz9.99-.
    05  filler                  pic x.
    05  t2-detail-3             pic zzzzzz,zz9.99-.
    05  filler                  pic x.
    05  t2-detail-4             pic zzzz,zz9.
    05  filler                  pic x.
    05  t2-detail-5             pic zzzzzz,zz9.99-.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  22
*                      r073.cbl                                      )
    05  filler                  pic x.
    05  t2-detail-6             pic zzzzzz,zz9.99-.
    05  filler                  pic x.
    05  t2-detail-7             pic zzzzzz,zz9.99-.
    05  filler                  pic x.
    05  t2-detail-8             pic zzzz,zz9.
* 2002/07/08 - end
    05  filler                  pic x(4).

01  h5-head.

    05  filler                                  pic x(2)        value spaces.
    05  filler                                  pic x(8)        value
                "CLINIC".
    05  h5-clinic-nbr                           pic 99.
    05  filler                                  pic x(17)       value spaces.
    05  filler                                  pic x(11)       value
                "-----------".
    05  filler                                  pic x(23)       value
                "WITHIN - WRITEOFF RANGE".
    05  filler                                  pic x(20)       value
                "-------------".
    05  filler                                  pic x(14)       value
                "--------------".
    05  filler                                  pic x(35)       value
                "OUTSIDE - WRITEOFF RANGE---------".

01  h6-head.

    05  filler                                  pic x(17)       value spaces.
    05  filler                                  pic x(12)       value
                "AGENT".
    05  filler                                  pic x(14)       value
                "OMA AMT".
    05  filler                                  pic x(15)       value
                "OHIP AMT".
    05  filler                                  pic x(15)       value
                "CASH AMT".
    05  filler                                  pic x(10)       value
                "NBR".
    05  filler                                  pic x(14)       value
                "OMA AMT".
    05  filler                                  pic x(15)       value
                "OHIP AMT".
    05  filler                                  pic x(15)       value
                "CASH AMT".
    05  filler                                  pic x(5)        value
                "NBR".
01  error-message-table.

    05  error-messages.
        10  filler                              pic x(60)   value
                "INVALID REPLY".
        10  filler                              pic x(60)   value
                "DO NOT DELETE-THIS SLOT USED FOR VARIABLE ERROR MSGS".
        10  filler                              pic x(60)   value
                "INVALID READ CLAIMS MSTR - INVALID KEY ON APPROX".
        10  filler                              pic x(60)   value
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  23
*                      r073.cbl                                      )
                "INVALID READ CLAIMS MSTR - STATUS = 23 OR 99".
        10  err-msg-5.
* #5
            15  filler                          pic x(50)   value
                "INVALID READ ON CONSTANTS MASTER - CLINIC ID = ".
            15  err-msg-clinic-id               pic x(10).
        10  filler                              pic x(60)       value
                "FATAL ERROR - NO CLAIMS IN CLAIMS MASTER".
        10  filler                              pic x(60)       value
                "**** CAN BE RE-USED ****".
        10  filler                              pic x(60)   value
                "**** CAN BE RE-USED ****".
        10  err-msg-9.
            15  filler                          pic x(40)    value
                "INVALID WRITE NEW CLAIMS DTL - 'B' KEY=".
            15  bkey-clmdtl-err-msg             pic x(20) value spaces.
        10  err-msg-10.
* #10
            15  filler                          pic x(40)    value
                "INVALID WRITE NEW CLAIMS HDR - 'B' KEY=".
            15  bkey-clmhdr-err-msg             pic x(20) value spaces.
        10  err-msg-11.
            15  filler                          pic x(40)    value
                "INVALID WRITE NEW CLAIMS HDR -'P' KEY = ".
            15  pkey-clm-err-msg                pic x(20) value spaces.
        10  filler                              pic x(60)       value
                "**** CAN BE RE-USED ****".
        10  filler                              pic x(60)       value
                "**** CAN BE RE-USED ****".
        10  filler                              pic x(60)    value
                "**** CAN BE RE-USED ****".

    05  error-messages-r redefines error-messages.
        10  err-msg                             pic x(60)
                        occurs 14 times.

01  err-msg-comment                             pic x(60).


01  e1-error-line.

    05  e1-error-word                           pic x(13)    value
                        "***  ERROR - ".
    05  e1-error-msg                            pic x(67).
screen section.

01  scr-title.
    05  blank screen.
    05  line 01 col 01 value is "R073".
    05  line 01 col 29 value is "CLAIMS MASTER VERIFICATION".
*2000/05/12 - B.A.
*    05  line 01 col 73 pic 99 from sys-yy.
*    05  line 01 col 75 value is "/".
*    05  line 01 col 76 pic 99 from sys-mm.
*    05  line 01 col 78 value is "/".
*    05  line 01 col 79 pic 99 from sys-dd.
    05  line 01 col 71 pic 9(4) from sys-yy.
    05  line 01 col 75 value is "/".
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  24
*                      r073.cbl                                      )
    05  line 01 col 76 pic 99 from sys-mm.
    05  line 01 col 78 value is "/".
    05  line 01 col 79 pic 99 from sys-dd.
*2000/05/12 end

01  msg-continue.
    05  line 16 col 10 value is "CONTINUE?  (ENTER Y OR N )".
    05  reply line 16 col 40 pic x using ws-reply auto required.



01  scr-purge-ped.
* 2002/07/05 - MC
*    05  line 16 col 10 value is "ENTER PED TO PURGE FROM YYMMDD :".
    05  line 16 col 10 value is "ENTER PED CUTOFF DATE YYYYMM01: " .
    05  scr-ped-date  line 16 col 44 pic 9(8) using cutoff-date       auto requi
* 2002/07/05 - END
*2000/05/12 - B.A begin
*    05  scr-ped-from line 16 col 44 pic 9(6) using ws-ped-purge-from auto requi
*2002/07/05 - MC - comment out with **
**    05  scr-ped-from line 16 col 44 pic 9(8) using ws-ped-purge-from auto requ
**    05  line 17 col 10 value is "ENTER PED TO PURGE TO   YYMMDD :".
*    05  scr-ped-to   line 17 col 44 pic 9(6) using ws-ped-purge-to auto require
**    05  scr-ped-to   line 17 col 44 pic 9(8) using ws-ped-purge-to auto requir
*2002/07/05 - end
*2000/05/12 end
    05  line 18 col 10 value is "CONTINUE?  (ENTER Y OR N )".
    05  scr-reply line 18 col 40 pic x using ws-reply auto required.

01  program-in-progress.
    05  line 20 col 10 value "PROGRAM R073 IN PROGRESS".

01  test-key-display.
    05  line 22 col 05 pic x(17) using key-claims-mstr.
    05  line 22 col 30 pic 9(7)  using ctr-claims-mstr-reads.

01  confirm.
    05  line 23 col 01  value " ".

01  blank-screen.
    05  blank screen.

01  file-status-display.
    05  line 24 col 56 value "FILE STATUS = ".
*mf    05  line 24 col 70 pic x(11) using common-status-file  bell blink.
    05  line 24 col 70 pic x(2) using common-status-file  bell blink.

01  err-msg-line.
    05  line 24 col 01 value " ERROR - "  bell blink.
    05  line 24 col 11 pic x(60) from err-msg-comment.

01  blank-line-24.
    05  line 24 col 1 blank line.

01  blank-screen.
    05  blank screen.

01  scr-closing-screen.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  25
*                      r073.cbl                                      )
    05  blank screen.
    05  line 11 col 20  value "NUMBER OF CLAIM MSTR READS = ".
    05  line 11 col 60  pic zzz,zzz,zz9  using ctr-claims-mstr-reads.
    05  line 12 col 20  value "NUMBER OF HEADER RECS READ =".
    05  line 12 col 60  pic zzz,zzz,zz9  using ctr-nbr-hdr-rec-reads.
    05  line 13 col 20  value "NUMBER OF DETAIL RECS READ =".
    05  line 13 col 60  pic zzz,zzz,zz9  using ctr-nbr-dtl-rec-reads.
    05  line 20 col 20  value "PROGRAM R073 BEGAN".
*2000/05/12 - B.A.
*    05  line 20 col 55  pic 99  from run-yy.
*    05  line 20 col 57 value "/".
*    05  line 20 col 58  pic 99  from run-mm.
*    05  line 20 col 60  value "/".
*    05  line 20 col 61  pic 99  from run-dd.
*    05  line 20 col 64  pic 99  from begin-hrs.
*    05  line 20 col 66  value ":".
*    05  line 20 col 67  pic 99  from begin-min.
    05  line 20 col 55  pic 9(4) from run-yy.
    05  line 20 col 59 value "/".
    05  line 20 col 60  pic 99  from run-mm.
    05  line 20 col 62 value "/".
    05  line 20 col 63  pic 99  from run-dd.
    05  line 20 col 66  pic 99  from begin-hrs.
    05  line 20 col 68  value ":".
    05  line 20 col 69  pic 99  from begin-min.
*2000/05/12 end
    05  line 21 col 20  value "PROGRAM R073 ENDING".
*2000/05/12 - B.A. begin
*    05  line 21 col 55  pic 99  from sys-yy.
*    05  line 21 col 57 value "/".
*    05  line 21 col 58 pic 99  from sys-mm.
*    05  line 21 col 60 value "/".
*    05  line 21 col 61 pic 99  from sys-dd.
*    05  line 21 col 64  pic 99  from sys-hrs-pr.
*    05  line 21 col 66  value ":".
*    05  line 21 col 67  pic 99  from sys-min-pr.
    05  line 21 col 55 pic 9(4)  from sys-yy.
    05  line 21 col 59  value "/".
    05  line 21 col 60  pic 99  from sys-mm.
    05  line 21 col 62  value "/".
    05  line 21 col 63  pic 99  from sys-dd.
    05  line 21 col 66  pic 99  from sys-hrs-pr.
    05  line 21 col 68  value ":".
    05  line 21 col 69  pic 99  from sys-min-pr.
*2000/05/12 end
    05  line 22 col 20  value "TOTAL ELAPSED TIME (HH:MM) -".
    05  line 22 col 64  pic 99  using elapsed-hrs.
    05  line 22 col 66  value ":".
    05  line 22 col 67  pic 99  using elapsed-min.
    05  line 23 col 20  value "REPORT FOUND IN".
    05  line 23 col 36 pic x(4) using print-file-name.
procedure division.
declaratives.

err-constants-mstr-file section.
    use after standard error procedure on iconst-mstr.

err-constants-mstr.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  26
*                      r073.cbl                                      )
    stop "ERROR IN ACCESSING ICONSTANTS MASTER".
*mf    move status-iconst-mstr                  to common-status-file.
    move status-cobol-iconst-mstr               to common-status-file.
    display file-status-display.
    stop run.

err-claim-header-mstr-file section.
    use after standard error procedure on claims-mstr.

err-claims-mstr.
    stop "ERROR IN ACCESSING CLAIMS MASTER".
*mf    move status-claims-mstr                  to common-status-file.
    move status-cobol-claims-mstr               to common-status-file.
    display file-status-display.

end declaratives.

mainline section.

    perform aa0-initialization                  thru aa0-99-exit.
    perform ab0-processing              thru ab0-99-exit.
    perform az0-finalization                    thru az0-99-exit.
    stop run.
aa0-initialization.

    accept sys-date                     from    date.
*2000/05/12 - B.a.
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.

    move sys-yy                         to      run-yy.
    move sys-mm                         to      run-mm.
    move sys-dd                         to      run-dd.

    accept begin-time                   from    time.

    open input  claims-mstr
                iconst-mstr.
*********    open i-o           claims-mstr-new.

*   delete existing print file

*    expunge print-file.

    open output print-file.

    move spaces                         to      day-old-r
                                                print-line-1.
    move zeros                          to      balance-due
                                                hold-key
                                                page-nbr
                                                tbl-totals
                                                counters.

    move 98                             to      ctr-line.
    move run-date                       to      h1-run-date.

*    (display screen title)
    display scr-title.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  27
*                      r073.cbl                                      )

*   display msg-continue.

*   accept reply.


    display scr-purge-ped.

*2002/07/05 - MC
*   accept scr-ped-from.
*   accept scr-ped-to.
    accept scr-ped-date.
*2002/07/05 - end

    accept scr-reply.

    if  ws-reply not = "Y"
    then
        go to az0-finalization
    else
        display program-in-progress.
*   endif


*       (zero clinic audit ctrs)
    perform xc0-zero-clinic-ctrs        thru    xc0-99-exit.

aa0-20-read-claims-mstr.

*mf    move "B"                         to      key-clm-key-type.
    move "B"                            to      clmdtl-b-key-type.
*************************************************************************
*mf    move zero                                to      key-clm-data.
       move zero                                to      clmdtl-b-data.
****    move "60"                               to      key-clm-data.
*************************************************************************

    perform cb0-read-claims-approx      thru    cb0-99-exit.
    if eof-claims-mstr = "Y"
    then
        move 6                          to      err-ind
        perform za0-common-error        thru    za0-99-exit
        go to az0-finalization
    else
        next sentence.
*   endif

    move clmhdr-clinic-nbr-1-2          to      save-clinic-id.

    perform xe0-obtain-clinic-ped       thru    xe0-99-exit.

aa0-99-exit.
    exit.
ab0-processing.


    if clmhdr-clinic-nbr-1-2 not = save-clinic-id
    then
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  28
*                      r073.cbl                                      )
        perform zb0-print-totals-summary        thru    zb0-99-exit
        move zero                               to      tbl-totals
        perform la0-print-clinic-totals         thru    la0-99-exit
        perform xc0-zero-clinic-ctrs            thru    xc0-99-exit
        move clmhdr-clinic-nbr-1-2              to      save-clinic-id
        perform xe0-obtain-clinic-ped           thru    xe0-99-exit.
*   (else)
*   endif

*       (note - 'PAYMENTS' field is stored as negative amt so
*               amt owing = original bal - payments
*               can be calculated by *adding* payment field

*       (if    agent = 'OHIP'
*          or agent not = 'OHIP' but claim was one that was retained from old sy
*       then   use 'OHIP' amt as value of claims rather than 'OMA' amt)
*   (pdr #414 - treat agent 4 as direct bill)
    move clmhdr-agent-cd                        to ws-agent-flag.
*  2012/09/18 - MC3 - if agent not = 6, use ohip amt ;otherwise, use oma amt to
*   if   ohip-agent

** MC4
**   if   clmhdr-agent-cd not = 6
* 2012/09/18 -end
**    then
        add clmhdr-manual-and-tape-paymnts, clmhdr-tot-claim-ar-ohip
**                                           giving balance-due
**    else
**        add clmhdr-manual-and-tape-paymnts, clmhdr-tot-claim-ar-oma
                                            giving balance-due.
*   endif
** MC4 -end



*         note: 'A'djustment and 'P'ayment entries as well as any
*                claim with it'S CURRENT CLINIC's ped are not deleted.
*
*  delete(ie. bypass) a claim if no balance owing or balance
*  owing within write-off range.
*
*  delete(ie bypass) an alternative funding claim (agent 8)  if claim'S
*  p.e.d. is between the cut off dates
*
*  delete(ie bypass) a clinic 81 claim if the claim has no cash date
*  and is older than 1 year
*
*  delete(ie bypass) a clinic 81 claim if the claim has a cash date and
*  the claim has a message code of ev, ea, ef, 48 or blank
*

   move clmhdr-date-sys                 to w-clmhdr-date-sys.
*mf
   move sys-date-long-r                 to ws-sys-date-long.
   subtract w-clmhdr-date-sys-n from ws-sys-date-long giving temp-date.


* 2008/04/17 - MC
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  29
*                      r073.cbl                                      )
    if   (    site-id = "RMA"
          and clmhdr-batch-type          = "C"
* 2011/09/13 - MC1 - Yasemin wants to change from < to <= (ie inclusive of the c
*        and clmhdr-date-period-end     < cutoff-date
         and clmhdr-date-period-end     <=  cutoff-date
* 2011/09/13 - end
          and (     (     (balance-due > -1.00 and balance-due <  1.00)
*                         2004/05/19 - MC - check value 'O' - represents old AFP
*                     and (iconst-clinic-card-colour = 'N')
                      and (iconst-clinic-card-colour <> 'O')
                    )
                or  (    iconst-clinic-card-colour = 'O'
                    )
               )
          )
        or
          (     site-id = "HSC"
           and clmhdr-batch-type          = "C"
           and clmhdr-date-period-end not greater than cutoff-date
           and (   clmhdr-agent-cd = 1
*                   2001/04/17 - MC - shelley requested to purge if zero balance
*                or (balance-due > -.65 and balance-due <  .65))
                 or (balance-due = 0)
               )
          )
* 2008/04/17 - end
    then
*       (delete)
        perform ab1-ctr-del             thru    ab1-99-exit
        move zero                       to      del-ret-offset
        perform sa0-add-batch-totals    thru    sa0-99-exit
        perform cb3-add-to-claim-nbr    thru    cb3-99-exit
        perform cb0-read-claims-approx  thru    cb0-99-exit
    else
*       (retain)
        perform ab2-ctr-con             thru    ab2-99-exit
        move 4                          to      del-ret-offset
        perform sa0-add-batch-totals    thru    sa0-99-exit
        perform da6-save-clmhdr-info    thru    da6-99-exit
******   perform fa0-write-new-clmhdr   thru    fa0-99-exit
        move "N"                        to      eof-claims-dtl
        perform ha0-read-dtl-recs       thru    ha0-99-exit
                    until eof-claims-dtl = "Y".
*   endif


    if eof-claims-mstr not = "Y"
    then
        go to ab0-processing.
*   (else)
*   endif

ab0-99-exit.
    exit.
ab1-ctr-del.

    add balance-due                     to      ctr-amt-claims-mstr-write-offs.
    add 1                               to      ctr-claims-mstr-write-offs.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  30
*                      r073.cbl                                      )

*       (if claims ped is < present ped then consider as 'PREV'
*        months' VALUES -- ELSE CONSIDER AS 'curr' CURRENT MONTH's values)
    if clmhdr-date-period-end < save-clinic-ped
    then
        add 1                           to      ctr-clinic-delprev-nbr
        add balance-due                 to      ctr-clinic-delprev-amt
    else
        add 1                           to      ctr-clinic-delcurr-nbr
        add balance-due                 to      ctr-clinic-delcurr-amt.
*   endif

ab1-99-exit.
    exit.



ab2-ctr-con.

    add 1                               to      ctr-claims-mstr-in-acctrec.
    add balance-due                     to      ctr-amt-claims-mstr-in-acctrec.

*       (if claims ped is < present ped then consider as 'PREV'
*        months' VALUES -- ELSE CONSIDER AS 'curr' CURRENT MONTH's values)
    if clmhdr-date-period-end < save-clinic-ped
    then
        add 1                           to      ctr-clinic-conprev-nbr
        add balance-due                 to      ctr-clinic-conprev-amt
    else
        add 1                           to      ctr-clinic-concurr-nbr
        add balance-due                 to      ctr-clinic-concurr-amt.
*   endif

ab2-99-exit.
    exit.
az0-finalization.

*       (print last clinic'S TOTALS)
    perform zb0-print-totals-summary            thru    zb0-99-exit.
    perform la0-print-clinic-totals             thru    la0-99-exit.

    accept sys-date                             from    date.
    accept sys-time                             from    time.
    move sys-hrs                                to      sys-hrs-pr.
    move sys-min                                to      sys-min-pr.

    perform az1-determine-elapsed-time          thru    az1-99-exit.

    perform az2-print-audit-report-tots         thru    az2-99-exit.

    display scr-closing-screen.
    display confirm.

    close iconst-mstr
          claims-mstr
          print-file.

    stop run.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  31
*                      r073.cbl                                      )

az0-99-exit.
    exit.
az1-determine-elapsed-time.

    if sys-min < begin-min
    then
        add 60                                  to      sys-min
        subtract 1                              from    sys-hrs
    else
        next sentence.
*   endif

    move sys-min                                to      elapsed-min.
    move sys-hrs                                to      elapsed-hrs.
    subtract begin-min                          from    elapsed-min.
    subtract begin-hrs                          from    elapsed-hrs.

az1-99-exit.
    exit.
az2-print-audit-report-tots.

    move 98                                     to      ctr-line.
    move "G R A N D   T O T A L S"              to      l1-msg.
    move 3                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

*2002/07/05 - MC
*    move "CLAIMS BETWEEN -.85 +.85 - NUMBER"   to      l2-msg.
    move "CLAIMS BETWEEN -.99 +.99 - NUMBER"    to      l2-msg.
*2002/07/05 - end
    move ctr-claims-mstr-write-offs             to      l2-ctr.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

*2002/07/05 - MC
*   move "CLAIMS BETWEEN -.85 +.85 - AMOUNT"    to      l3-msg.
    move "CLAIMS BETWEEN -.99 +.99 - AMOUNT"    to      l3-msg.
*2002/07/05 - end
    move ctr-amt-claims-mstr-write-offs         to      l3-amt.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

    move "CLAIMS IN A/R            - NUMBER"    to      l2-msg.
    move ctr-claims-mstr-in-acctrec             to      l2-ctr.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

    move "CLAIMS IN A/R            - AMOUNT"    to      l3-msg.
    move ctr-amt-claims-mstr-in-acctrec         to      l3-amt.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

    move "(TOTAL CLAIMS RECORDS READ - NUMBER)" to      l2-msg.
    move ctr-claims-mstr-reads                  to      l2-ctr.
    move 2                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  32
*                      r073.cbl                                      )
    move "(HEADERS READ              - NUMBER)" to      l2-msg.
    move ctr-nbr-hdr-rec-reads                  to      l2-ctr.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.






    move "(DETAILS READ              - NUMBER)" to      l2-msg.
    move ctr-nbr-dtl-rec-reads                  to      l2-ctr.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.






    move "PROGRAM STATISTICS"                   to      l1-msg.
    move 98                                     to      ctr-line.
    move 4                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

    move "PROGRAM R073 BEGAN"                   to      l1-msg.
    move run-yy                                 to      l1-yy.
    move "/"                                    to      l1-slash-1.
    move run-mm                                 to      l1-mm.
    move "/"                                    to      l1-slash-2.
    move run-dd                                 to      l1-dd.
    move begin-hrs                              to      l1-hrs.
    move begin-min                              to      l1-min.
    move ":"                                    to      l1-colon.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

    move "PROGRAM R073 ENDED"                   to      l1-msg.
    move sys-yy                                 to      l1-yy.
    move "/"                                    to      l1-slash-1.
    move sys-mm                                 to      l1-mm.
    move "/"                                    to      l1-slash-2.
    move sys-dd                                 to      l1-dd.
    move sys-hrs-pr                             to      l1-hrs.
    move sys-min-pr                             to      l1-min.
    move ":"                                    to      l1-colon.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

    move "ELAPSED TIME"                         to      l1-msg.
    move elapsed-hrs                            to      l1-hrs.
    move elapsed-min                            to      l1-min.
    move ":"                                    to      l1-colon.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line            thru    xa0-99-exit.

az2-99-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  33
*                      r073.cbl                                      )
cb0-read-claims-approx.

    move zero                                   to      claims-occur
                                                        feedback-claims-mstr.

*mf    read claims-mstr  key is key-claims-mstr approximate
*mf      invalid key
*mf          move 3                     to      err-ind
*mf          perform za0-common-error   thru    za0-99-exit
*mf          go to az0-finalization.

    start claims-mstr  key is greater than or equal to key-claims-mstr
      invalid key
          move 3                        to      err-ind
          perform za0-common-error      thru    za0-99-exit
          go to az0-finalization.
    read claims-mstr next.

    if status-cobol-claims-mstr = 23 or
       status-cobol-claims-mstr = 99
    then
        move 4                          to      err-ind
        perform za0-common-error        thru za0-99-exit
        go to az0-finalization
    else
        if status-cobol-claims-mstr = 10
        then
            move "Y"                    to      eof-claims-mstr
            go to cb0-99-exit
        else
            move "N"                    to      eof-claims-mstr.
*       endif
*   endif

*mf    retrieve claims-mstr key fix position
*mf    into key-claims-mstr.

* 2011/11/30 - MC2
*    display test-key-display.
* 2011/11/30 - end

cb0-10-check-for-clmhdr.

*mf    if key-clm-key-type not = 'B'
    if clmdtl-b-key-type not = 'B'
    then
        move "Y"                        to      eof-claims-mstr
        go to cb0-99-exit
    else
        next sentence.
*   endif

    add 1                               to      ctr-claims-mstr-reads
                                                ctr-nbr-hdr-rec-reads.


cb0-99-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  34
*                      r073.cbl                                      )
cb3-add-to-claim-nbr.

    if  clmdtl-b-claim-nbr = 99
    then
        move zeros                      to clmdtl-b-claim-nbr
*!      add 1                           to clmdtl-b-batch-num
*!      add 1                           to clmdtl-b-day
        perform xx0-increment-batch-nbr thru    xx0-99-exit
    else
* 2003/12/10 - MC - I believe that the following condition is obseleted
*        if    clmdtl-b-batch-num = 220441756
*          and clmdtl-b-claim-nbr = 03
*        then
*            move 220441757              to clmdtl-b-batch-num
*            move 01                     to clmdtl-b-claim-nbr
*        else
* 2003/12/10 - end
            add 1                       to clmdtl-b-claim-nbr
            move spaces                 to clmdtl-b-adj-nbr.
*       endif
*   endif

cb3-99-exit.
    exit.


da6-save-clmhdr-info.

    if clmhdr-batch-type = "C"
    then
        move clmhdr-batch-nbr           to      hold-batch-nbr
        move clmhdr-claim-nbr           to      hold-claim-nbr
    else
        move clmhdr-orig-batch-nbr      to      hold-batch-nbr
        move clmhdr-orig-claim-nbr      to      hold-claim-nbr.
*   endif

da6-99-exit.
    exit.
ha0-read-dtl-recs.

*       (read the detail records for the claim being processed and write
*        to the new claims mstr)

    perform ja0-read-claims-next        thru    ja0-99-exit.

*       (if not end of claim, then write to new file)
    if eof-claims-dtl = "N"
    then
        go to ha0-99-exit
    else
        next sentence.
*   endif

ha0-99-exit.
    exit.


* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  35
*                      r073.cbl                                      )

ja0-read-claims-next.

    move zero                           to      claims-occur
                                                feedback-claims-mstr.

    read claims-mstr    next
            at end
                move "Y"                to      eof-claims-mstr
                                                eof-claims-dtl
                go to ja0-99-exit.

*mf    retrieve  claims-mstr    key  fix position
*mf             into key-claims-mstr.

*mf    if key-clm-key-type not = "B"
    if clmdtl-b-key-type not = "B"
    then
        move "Y"                        to      eof-claims-mstr
                                                eof-claims-dtl
        go to ja0-99-exit
    else
        next sentence.
*   endif

*       (determine if claim rec read belongs to claim being processed)
*mf    if    key-clm-batch-num = hold-batch-nbr
*mf      and key-clm-claim-nbr = hold-claim-nbr
    if    clmdtl-b-batch-num = hold-batch-nbr
      and clmdtl-b-claim-nbr = hold-claim-nbr
    then
        move "N"                        to      eof-claims-dtl
        add 1                           to      ctr-nbr-dtl-rec-reads
    else
        move "Y"                        to      eof-claims-dtl
        add 1                           to      ctr-nbr-hdr-rec-reads.
*   endif

    add 1                               to      ctr-claims-mstr-reads.

ja0-99-exit.
    exit.
la0-print-clinic-totals.

    move "CLINIC NUMBER"                        to      l1-msg.
    move save-clinic-id                         to      l1-yy.
    move 3                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

*2002/07/05 - MC
*    move "CLAIMS BETWEEN -.85 +.85 CURRENT  PED - NUMBER"      to      l2-msg.
    move "CLAIMS BETWEEN -.99 +.99 CURRENT  PED - NUMBER"       to      l2-msg.
*2002/07/05 - end
    move ctr-clinic-delcurr-nbr                 to      l2-ctr.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

*2002/07/05 - MC
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  36
*                      r073.cbl                                      )
*    move "CLAIMS BETWEEN -.85 +.85 PREVIOUS PED - NUMBER"      to      l2-msg.
    move "CLAIMS BETWEEN -.99 +.99 PREVIOUS PED - NUMBER"       to      l2-msg.
*2002/07/05 - end
    move ctr-clinic-delprev-nbr                 to      l2-ctr.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

*2002/07/05 - MC
*   move "CLAIMS BETWEEN -.85 +.85 CURRENT  PED - AMOUNT"       to      l3-msg.
    move "CLAIMS BETWEEN -.99 +.99 CURRENT  PED - AMOUNT"       to      l3-msg.
*2002/07/05 - end
    move ctr-clinic-delcurr-amt                 to      l3-amt.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

*2002/07/05 - MC
*   move "CLAIMS BETWEEN -.85 +.85 PREVIOUS PED - AMOUNT"       to      l3-msg.
    move "CLAIMS BETWEEN -.99 +.99 PREVIOUS PED - AMOUNT"       to      l3-msg.
*2002/07/05 - end
    move ctr-clinic-delprev-amt                 to      l3-amt.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

    move "CLAIMS IN A/R            CURRENT  PED - NUMBER"       to      l2-msg.
    move ctr-clinic-concurr-nbr                 to      l2-ctr.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

    move "CLAIMS IN A/R            PREVIOUS PED - NUMBER"       to      l2-msg.
    move ctr-clinic-conprev-nbr                 to      l2-ctr.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

    move "CLAIMS IN A/R            CURRENT  PED - AMOUNT"       to      l3-msg.
    move ctr-clinic-concurr-amt                 to      l3-amt.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

    move "CLAIMS IN A/R            PREVIOUS PED - AMOUNT"       to      l3-msg.
    move ctr-clinic-conprev-amt                 to      l3-amt.
    move 1                                      to      line-advance.
    perform xa0-write-audit-rpt-line                    thru    xa0-99-exit.

la0-99-exit.
    exit.
sa0-add-batch-totals.

    perform sa1-find-ss-type            thru    sa1-99-exit.

*       (calculate ss-agent from batch'S AGENT CODE)
    add  1, clmhdr-agent-cd             giving  ss-agent.

    add del-ret-offset, ss-a-r-oma      giving ss-temp1.
    add clmhdr-tot-claim-ar-oma         to      tbl-tot (ss-type, ss-agent, ss-t
    add del-ret-offset, ss-a-r-ohip     giving ss-temp1.
    add clmhdr-tot-claim-ar-ohip        to      tbl-tot (ss-type, ss-agent, ss-t
    add del-ret-offset, ss-cash         giving ss-temp1.
    add clmhdr-manual-and-tape-paymnts  to      tbl-tot (ss-type, ss-agent, ss-t
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  37
*                      r073.cbl                                      )
    add del-ret-offset, ss-nbr          giving ss-temp1.
    add 1                               to      tbl-tot (ss-type, ss-agent, ss-t

*mf    add clmhdr-tot-claim-ar-oma              to      tbl-tot (ss-type, ss-age
*mf    add clmhdr-tot-claim-ar-ohip     to      tbl-tot (ss-type, ss-agent, del-
*mf    add clmhdr-manual-and-tape-paymnts       to      tbl-tot (ss-type, ss-age
*mf    add 1                            to      tbl-tot (ss-type, ss-agent, del-

sa0-99-exit.
    exit.



sa1-find-ss-type.

    if clmhdr-batch-type = "C"
    then
        move ss-claims                  to      ss-type
    else
        if clmhdr-batch-type = "A"
        then
            if clmhdr-adj-cd = "A"
            then
                move ss-adj-a           to      ss-type
            else
                if clmhdr-adj-cd = "B"
                then
                    move ss-adj-b       to      ss-type
                else
***                      clmhdr-adj-cd = "R"
                    move ss-adj-r       to      ss-type
*               endif
*           endif
        else
***                     (clmhdr-batch-type = "P")
            if clmhdr-adj-cd = "M"
            then
                move ss-pay-m           to      ss-type
            else
***                     (clmhdr-adj-cd = "C")
                move ss-pay-c           to      ss-type.
*           endif
*       endif
*    endif

sa1-99-exit.
    exit.
tb0-write-line.

    add  nbr-lines-2-advance                            to      ctr-line.
    if ctr-line > max-nbr-lines-per-page
    then
        perform tc0-print-headings                      thru    tc0-99-exit.
*   (else)
*   endif

    write   print-record  from print-line-1    after advancing  nbr-lines-2-adva

* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  38
*                      r073.cbl                                      )
    move spaces                                         to      print-line-1.
    move 1                                              to      nbr-lines-2-adva

tb0-99-exit.
    exit.

tc0-print-headings.

    add 1                                       to      page-nbr.
    move save-clinic-ped                        to      h1-ped.
    move page-nbr                               to      h1-page-nbr.
    write print-record from header-1 after advancing page.
    move save-clinic-id                         to      h5-clinic-nbr.
    write print-record from h5-head after advancing 2 lines.
    write print-record from h6-head after advancing 1 line.
    write print-record from blank-line after advancing 1 line.
    move 6                                      to      ctr-line.


tc0-99-exit.
    exit.
tc1-roll-type-tot-to-grand.

*    (roll 'TYPE' totals to 'GRAND' total level and zero 'TYPE' --
*       -- note: "+ 1" limit in 'UNTIL' statement allows agent totals level
*                to be rolled and zeroed)
    move ss-type-tot                    to      ss-type-from.
    move ss-grand-tot                   to      ss-type-to.
    perform te0-roll-and-zero-totals    thru    te0-99-exit
        varying  ss-agent-from
        from  1
        by    1
        until    ss-agent-from > max-nbr-agents + 1.


tc1-99-exit.
    exit.
te0-roll-and-zero-totals.
*       (rtn called varying 'SS-AGENT-FROM' after setting 'SS-TYPE-FROM' and 'SS
*        ( hard coded values 1 thru 8 give every item for each agent and type)

    add tbl-tot (ss-type-from, ss-agent-from, 1 )  to tbl-tot (ss-type-to, ss-ag
    add tbl-tot (ss-type-from, ss-agent-from, 2 )  to tbl-tot (ss-type-to, ss-ag
    add tbl-tot (ss-type-from, ss-agent-from, 3 )  to tbl-tot (ss-type-to, ss-ag
    add tbl-tot (ss-type-from, ss-agent-from, 4 )  to tbl-tot (ss-type-to, ss-ag
    add tbl-tot (ss-type-from, ss-agent-from, 5 )  to tbl-tot (ss-type-to, ss-ag
    add tbl-tot (ss-type-from, ss-agent-from, 6 )  to tbl-tot (ss-type-to, ss-ag
    add tbl-tot (ss-type-from, ss-agent-from, 7 )  to tbl-tot (ss-type-to, ss-ag
    add tbl-tot (ss-type-from, ss-agent-from, 8 )  to tbl-tot (ss-type-to, ss-ag

    move zero                                      to  tbl-tot (ss-type-from, ss
    move zero                                      to  tbl-tot (ss-type-from, ss
    move zero                                      to  tbl-tot (ss-type-from, ss
    move zero                                      to  tbl-tot (ss-type-from, ss
    move zero                                      to  tbl-tot (ss-type-from, ss
    move zero                                      to  tbl-tot (ss-type-from, ss
    move zero                                      to  tbl-tot (ss-type-from, ss
    move zero                                      to  tbl-tot (ss-type-from, ss
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  39
*                      r073.cbl                                      )

te0-99-exit.
    exit.
tg0-move-vals-to-line.

    move tbl-tot (ss-type-from, ss-agent, 1 )   to      t2-detail-1 .
    move tbl-tot (ss-type-from, ss-agent, 2 )   to      t2-detail-2 .
    move tbl-tot (ss-type-from, ss-agent, 3 )   to      t2-detail-3 .
    move tbl-tot (ss-type-from, ss-agent, 4 )   to      t2-detail-4 .
    move tbl-tot (ss-type-from, ss-agent, 5 )   to      t2-detail-5 .
    move tbl-tot (ss-type-from, ss-agent, 6 )   to      t2-detail-6 .
    move tbl-tot (ss-type-from, ss-agent, 7 )   to      t2-detail-7 .
    move tbl-tot (ss-type-from, ss-agent, 8 )   to      t2-detail-8 .

tg0-99-exit.
    exit.
xa0-write-audit-rpt-line.

*       (variables that must be set before calling curr routine are:
*        'LINE-ADVANCE', 'CTR-LINE' if new page is to be forced, and
*        detail line must be built up in 'PRINT-LINE-1' or any line
*        that redefines it)

    add line-advance                            to      ctr-line.

    if ctr-line > max-nbr-lines-per-page
    then
        perform xb0-print-headings              thru    xb0-99-exit
        add line-advance                        to      ctr-line.
*   (else)
*   endif

    write print-record          from    print-line-1
            after advancing  line-advance  lines.

    move spaces                                 to      print-line-1.

xa0-99-exit.
    exit.



xb0-print-headings.

    add 1                                       to      page-nbr.
*mf    move spaces                              to      h1-ped.
    move zero                                   to      h1-ped.
    move page-nbr                               to      h1-page-nbr.

    write  print-record         from    header-1
            after advancing page.

    move 1                                      to      ctr-line.

xb0-99-exit.
    exit.
xc0-zero-clinic-ctrs.

* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  40
*                      r073.cbl                                      )
    move zero                           to      ctr-clinic-delcurr-nbr
                                                ctr-clinic-delprev-nbr
                                                ctr-clinic-delcurr-amt
                                                ctr-clinic-delprev-amt
                                                ctr-clinic-concurr-nbr
                                                ctr-clinic-conprev-nbr
                                                ctr-clinic-concurr-amt
                                                ctr-clinic-conprev-amt.

xc0-99-exit.
    exit.
xe0-obtain-clinic-ped.

    move save-clinic-id                 to iconst-clinic-nbr-1-2.

    read iconst-mstr
        invalid key
            move iconst-clinic-nbr-1-2  to err-msg-clinic-id
            move 5                      to err-ind
            perform za0-common-error    thru za0-99-exit
            go to az0-finalization.

    move iconst-date-period-end         to save-clinic-ped.

xe0-99-exit.
    exit.

xx0-increment-batch-nbr.
*0 - 9 A - Z
    move "N"                            to      flag-request-complete.

    if clmdtl-b-batch-number = 999
    then
        move clmdtl-b-doc-nbr           to      tmp-doc-nbr-alpha
* 2011/11/30 - MC2
*        display "BEFORE: " clmdtl-b-doc-nbr
* 2011/11/30 - end
        perform xx1-process-1-doc-position  thru xx1-99-exit
            varying   ss from 3 by -1
            until     ss = 0
               or      flag-request-complete-y
        move tmp-doc-nbr-alpha          to      clmdtl-b-doc-nbr
* 2011/11/30 - MC2
*       display "AFTER : " clmdtl-b-doc-nbr
*       display " "
* 2011/11/30 - end
        move 000                        to      clmdtl-b-batch-number
    else
        add 1                           to      clmdtl-b-batch-number-numeric.
*   endif


xx0-99-exit.
   exit.

xx1-process-1-doc-position.
*if pos(1) = 0 then 1 , if 1 then 2 if 9 then A, if A then B if Z then 0 and!

* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  41
*                      r073.cbl                                      )
    if tmp-batch-nbr-index(ss) = "0"
    then
        move "1"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "1"
    then
        move "2"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "2"
    then
        move "3"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "3"
    then
        move "4"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "4"
    then
        move "5"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "5"
    then
        move "6"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "6"
    then
        move "7"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "7"
    then
        move "8"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "8"
    then
        move "9"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "9"
    then
        move "A"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "A"
    then
        move "B"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "B"
    then
        move "C"                        to      tmp-batch-nbr-index(ss)
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  42
*                      r073.cbl                                      )
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "C"
    then
        move "D"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "D"
    then
        move "E"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "E"
    then
        move "F"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "F"
    then
        move "G"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "G"
    then
        move "H"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "H"
    then
        move "I"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "I"
    then
        move "J"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "J"
    then
        move "K"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "K"
    then
        move "L"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "L"
    then
        move "M"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "M"
    then
        move "N"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "N"
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  43
*                      r073.cbl                                      )
    then
        move "O"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "O"
    then
        move "P"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "P"
    then
        move "Q"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "B"
    then
        move "R"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "R"
    then
        move "S"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "S"
    then
        move "T"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "T"
    then
        move "U"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "U"
    then
        move "V"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "V"
    then
        move "W"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "W"
    then
        move "X"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "X"
    then
        move "Y"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
    else
    if tmp-batch-nbr-index(ss) = "Y"
    then
        move "Z"                        to      tmp-batch-nbr-index(ss)
        go to xx1-90-return
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  44
*                      r073.cbl                                      )
    else
    if tmp-batch-nbr-index(ss) = "Z"
    then
        move "0"                        to      tmp-batch-nbr-index(ss)
        go to xx0-99-exit.
*   endif

xx1-90-return.
    move "Y"                            to      flag-request-complete.

xx1-99-exit.
    exit.



za0-common-error.

    move err-msg (err-ind)              to      e1-error-msg.
    display e1-error-line.

    perform za1-print-err-in-rpt        thru    za1-99-exit.

    display confirm.
****    stop " ".

****    display blank-line-24.

za0-99-exit.
    exit.


za1-print-err-in-rpt.

    move e1-error-line                  to      print-line-1.

    move 4                              to      line-advance.
    perform xa0-write-audit-rpt-line    thru    xa0-99-exit.

za1-99-exit.
    exit.
zb0-print-totals-summary.

*       (start totals on new page)
    move 98                             to      ctr-line.
*   (flags will determine if batch type and adjustment type desciptions are to b
    move "N"                            to      sw-printed-bat-type
                                                sw-printed-adj-type.

    perform zc0-process-batch-totals    thru    zc0-99-exit
            varying ss-type
            from  1
            by    1
            until   ss-type > max-nbr-types.

*    (print 'GRAND' totals - ss-grand-tot moved to ss-type)

    move ss-grand-tot                   to      ss-type.
    perform zc0-process-batch-totals    thru    zc0-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  45
*                      r073.cbl                                      )

zb0-99-exit.
    exit.
zc0-process-batch-totals.
*       (this rtn called varying 'SS-TYPE' except for grand totals
*        where ss-type = ss-grand-tot)


    perform zd0-prt-agent-vals-and-sum  thru    zd0-99-exit
            varying ss-agent
            from  1
            by    1
            until    ss-agent > max-nbr-agents.

*    (print totals for all agents except for 'CLAIMS' and 'GRAND TOTALS)
    if ss-type not =     ss-claims
                     and ss-grand-tot
    then
*       (only print totals if a detail line has been printed)
        if sw-printed-adj-type = "Y"
        then
            move "             TOTAL"           to      t2-desc
            move ss-type                        to      ss-type-from
            move ss-agent-tot                   to      ss-agent
            perform tg0-move-vals-to-line       thru    tg0-99-exit
            perform tb0-write-line              thru    tb0-99-exit
        else
            next sentence
    else
        next sentence.
*   endif

    move "N"                                    to      sw-printed-adj-type.
*    (roll this type'S TOTALS INTO 'batch type totals')
    if ss-type not = ss-grand-tot
    then
        move ss-type                            to      ss-type-from
        move ss-type-tot                                to      ss-type-to
        perform te0-roll-and-zero-totals                thru    te0-99-exit
                varying ss-agent-from
                from  1
                by    1
                until   ss-agent-from > max-nbr-agents + 1.
*   (else)
*   endif


*   (if necessary print 'BATCH TYPE TOTALS' for batch types after appropriate ty
    if ss-type =    ss-claims
                 or ss-adj-r
                 or ss-pay-c
                 or ss-grand-tot
    then
        if sw-printed-bat-type = "Y"
        then
            move "N"                            to      sw-printed-bat-type
            move 2                              to      nbr-lines-2-advance
            move "    TOTALS"                   to      t2-desc
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  46
*                      r073.cbl                                      )
            if ss-type = ss-grand-tot
            then
                move ss-grand-tot               to      ss-type-from
                move ss-agent-tot               to      ss-agent
                perform tg0-move-vals-to-line   thru    tg0-99-exit
                perform tb0-write-line          thru    tb0-99-exit
            else
                move ss-type-tot                to      ss-type-from
                move ss-agent-tot               to      ss-agent
                perform tg0-move-vals-to-line   thru    tg0-99-exit
                perform tb0-write-line          thru    tb0-99-exit
                perform tc1-roll-type-tot-to-grand
                                                thru    tc1-99-exit
*           endif
        else
            if ss-type not = ss-grand-tot
            then
                perform tc1-roll-type-tot-to-grand
                                                thru    tc1-99-exit.
*           (else)
*           endif
*       endif
*   (else)
*   endif

zc0-99-exit.
    exit.
zd0-prt-agent-vals-and-sum.
*    (this routine called varying 'SS-AGENT')

*    (print line only if non-zero values for 'AGENT')
*    ( 'NBR + OFFSET' gives retained types. 'OFFSET' = 4)

    add ss-nbr, ss-offset               giving ss-temp1.
    if     tbl-tot (ss-type, ss-agent, ss-nbr)              = zero
*mf       and tbl-tot (ss-type, ss-agent, ss-nbr + ss-offset ) = zero
       and tbl-tot (ss-type, ss-agent, ss-temp1 ) = zero
    then
        go to zd0-99-exit.
*   (else)
*   endif

    move spaces                         to      t2-desc.

*    (if printing 1st detail line for this batch type then include
*     batch type description)
    if sw-printed-bat-type = "N"
    then
        move "Y"                        to      sw-printed-bat-type
        move desc-bat-type (ss-type)    to      t2-desc-a
        move 3                          to      nbr-lines-2-advance.
*   (else)
*   endif

*    (if printing 1st detail line for this adjustment type then include
*     adjustment type description)
    if sw-printed-adj-type = "N"
    then
* Micro Focus COBOL for UNIX         V4.0 revision 005 01-Apr-14 09:23 Page  47
*                      r073.cbl                                      )
        move "Y"                        to      sw-printed-adj-type
        move desc-adj-type (ss-type)    to      t2-desc-b.
*   (else)
*   endif

    move "-"                            to      t2-dash.
    subtract 1                          from    ss-agent
                                        giving  t2-agent-cd.
    move ss-type                        to      ss-type-from.
    perform tg0-move-vals-to-line       thru    tg0-99-exit.
    perform tb0-write-line              thru    tb0-99-exit.

*   (sum the batch "TYPE'S" totals for all agents)
*   (bypass if grand totals)

    if ss-type = ss-grand-tot
    then
        go to zd0-99-exit.
*   (else)
*   endif

    add tbl-tot (ss-type, ss-agent, 1 )         to tbl-tot (ss-type    ,ss-agent
    add tbl-tot (ss-type, ss-agent, 2 )         to tbl-tot (ss-type    ,ss-agent
    add tbl-tot (ss-type, ss-agent, 3 )         to tbl-tot (ss-type    ,ss-agent
    add tbl-tot (ss-type, ss-agent, 4 )         to tbl-tot (ss-type    ,ss-agent
    add tbl-tot (ss-type, ss-agent, 5 )         to tbl-tot (ss-type    ,ss-agent
    add tbl-tot (ss-type, ss-agent, 6 )         to tbl-tot (ss-type    ,ss-agent
    add tbl-tot (ss-type, ss-agent, 7 )         to tbl-tot (ss-type    ,ss-agent
    add tbl-tot (ss-type, ss-agent, 8 )         to tbl-tot (ss-type    ,ss-agent

zd0-99-exit.
    exit.

*2000/05/12 - B.A. begin
   copy "y2k_default_sysdate_century.rtn".
y2k-default-sysdate.

    move sys-date-left                  to sys-date-temp.
    move sys-date-temp                  to sys-date-right.
    move zeros                          to sys-date-blank.
* 1999/dec/30 B.E.
*   add 19000000                        to sys-date-numeric.
    add 20000000                        to sys-date-numeric.

y2k-default-sysdate-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 Compiler
* Copyright (C) 1984-1995 Micro Focus Ltd.     URN 2XUPG/GB0/00000F
*                                              REF GNB-030056000AA
*
* Total Messages:     0
* Data:       13580     Code:        8335
