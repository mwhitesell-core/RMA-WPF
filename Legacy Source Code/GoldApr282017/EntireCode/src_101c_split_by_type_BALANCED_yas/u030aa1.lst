* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   1
*                      u030aa1.cbl
* Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Accepted - SHOW-DIR
* Accepted - SOURCEFORMAT"FREE"
* Accepted - SPZERO
* Accepted - TIME
* Accepted - TRUNC
* Accepted - RESEQ
* Accepted - SEQCHK
* End Of Directives File: /usr/opt/mfcobol4.0/cobol.dir
identification division.
program-id. u030aa1.
author. dyad systems inc.
installation. rma.
date-written. septmber  1993.
date-compiled. 18-May-06 15:42.
security.
*
*    files      : u030 -   ohip remittance advice tape
*               : f090 -   isam constants master
*               : u030 -   out ohip rat tape
*               : f071 -   client-rma-claim-nbr
*               : f072 -   client-mstr
*               : f073 -   client-doc-mstr
*
*    Program Purpose : - monthly processing of ohip Remittance
*                        Advice (RA)  file. This program is run only for
*                        doctors who submit claims via diskette and wants
*                        their own RA to apply directly against their database.
*                      - this program is the 1st program in a series of 2
*                        programs. Only on doctor can be processed each time
*                        this series of program runs. The first step is to ask
*                        for the 'client id' which is a 4 character code. This
*                        is verified in f072 as valid.
*                      - As each record is read from the RA the 3 digit
*                        'account' number(ie. claim nbr) that was submitted
*                        is separated into the 3 digit doctor number and the
*                        remainding batch nbr(3) and claim number(2). The 3
*                        digit doctor is looked up on f073 to find the
*                        corresponding 5 character Client ID.
*                     - If it matches the ID of the client being processed then:
*                          for u030aa1.cbl the matching record's $ amounts
*                          are added up and the grand total written to the
*                          u030_parm_file.
*                          - This parm file is then used by u030aa2 to select
*                            the doctors records from the RA and write them
*                            to the output RA file.
*                          - The new output RA file containing only records for
*                            the selected doctor is then sent to that doctor.
*                      - note that a similar program (u030aa3.qzs) exists
*                        for uploading OHIP payments to Web claims.
*
*    93/jul/21    m. chan       - sms 142
*                               - clone from u030.cb
*                               - first pass of u030aa
*                               - modify this program to only read the
*                                 input tape and extract records based
*                                 on certain client/doc/claim #
*    97/sep/08    m. chan       - pdr 663 - change the pgm to accept the
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   2
*                      u030aa1.cbl
*                                 group nbr instead of clinic nbr, make
*                                 the necessary changes for checking
*                               - read constant mstr rec 1 instead of
*                                 clinic record
*    98/sep/09    B. E.         - allow user to enter clinic '0000'
*  2000/jan/07    B. E.         - fixed ws-scr-year y2k changed that was missed
*  2005/Jan/04    M.C.          - check up to 63 clinics instead of 40


*
environment division.
input-output section.
file-control.
*
    select ohip-rat-tape
          assign to "$pb_data/ohip_rat_ascii".
*
    select u030aa-parm-file
          assign to "u030aa_parm_file".
*


* 2003/dec/10 - MC - comment out the following 3 select, use copybook instead

**    select client-rma-claim-nbr
*mf       assign index to "f071_claim_nbr_rma"
*mf       assign data  to "f071_client_rma_claim_nbr.db"
**        assign to disk  "$pb_data/f071_client_rma_claim_nbr"
**          organization is indexed
**        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
**        lock mode is manual
**        record key   is claim-nbr-rma
*          infos status is status-client-rma-claim-nbr.
**          status      is status-cobol-client-rma-nbr.

copy "f071_client_rma_claim_nbr.slr".
    select client-rma-claim-nbr
*mf       assign index to "F071_CLAIM_NBR_RMA"
*mf       assign data  to "F071_CLIENT_RMA_CLAIM_NBR.DB"
          assign to disk  "$pb_data/f071_client_rma_claim_nbr"
          organization is indexed
          access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
          lock mode is manual

*mf changed primary key to alternative  (B.E. 98/Sep/09)
          record key   is claim-nbr-client

*mf added alternative key below (B.E. 98/Sep/09)
* 2003/06/10 - MC
*          alternate key is claim-nbr-rma
          alternate key is claim-nbr-rma-clinic
* 2003/06/10 - end

          status is status-cobol-client-rma-nbr.
*          infos status is status-client-rma-claim-nbr.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   3
*                      u030aa1.cbl                                   )
*
**    select client-mstr
*mf       assign index to "F072_CLIENT_ID"
*mf       assign data  to "F072_CLIENT_MSTR.DB"
**        assign to disk  "$pb_data/f072_client_mstr"
**          organization is indexed
**        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
**        lock mode is manual
**        record key   is client-id of client-mstr-rec
*          infos status is status-client-mstr.
**          status      is status-cobol-client-mstr.
*

copy "f072_client_mstr.slr".
    select client-mstr
*mf       assign index to "F072_CLIENT_ID"
*mf       assign data  to "F072_CLIENT_MSTR.DB"
          assign to disk  "$pb_data/f072_client_mstr"
          organization is indexed
          access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
          lock mode is manual
          record key   is client-id of client-mstr-rec
*         infos status is status-client-mstr.
          status is status-cobol-client-mstr.

**   select client-doc-mstr
*mf       assign index to "F073_DOC_NBR"
*mf       assign data  to "F073_CLIENT_DOC_MSTR.DB"
**        assign to disk  "$pb_data/f073_client_doc_mstr"
**        organization is indexed
** access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
**      lock mode is manual
**      record key   is doc-nbr
*          infos status is status-client-doc-mstr.
**        status        is status-cobol-client-doc-mstr.
*

copy "f073_client_doc_mstr.slr".
    select client-doc-mstr
*mf       assign index to "F073_DOC_NBR"
*mf       assign data  to "F073_CLIENT_DOC_MSTR.DB"
          assign to disk  "$pb_data/f073_client_doc_mstr"
          organization is indexed
          access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
          lock mode is manual
          record    key is doc-nbr   of client-doc-rec
*         alternate key is client-id of client-doc-rec with duplicates
          alternate key is client-doc of  client-doc-rec
*         infos status is status-client-doc-mstr.
          status is status-cobol-client-doc-mstr.

* 2003/dec/10 - end

    copy "f090_constants_mstr.slr".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   4
*                      u030aa1.cbl (/alpha/rmabill/rmabill101c/use/f0)
select iconst-mstr
assign to disk "$pb_data/f090_constants_mstr"
organization is indexed
access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
lock mode is manual
record key   is iconst-clinic-nbr-1-2
*       eof-flag     is eof-iconst-mstr
status is status-cobol-iconst-mstr.
*
data division.
file section.
*
    copy "u030_ohip_rat_tape.fd".
* 1999/mar/26 B.E.      - y2k format - changed to allow 'old format' processing
* 1999/dec/26 B.E.      - total y2k format usage
* 2003/feb/05 B.E.      - added 1 bytes to length of record with move
*                         to EDT file
*
fd  ohip-rat-tape
    record contains 80 characters.

01  rat-record-1.

    05  rat-1-trans-cd                          pic xx.
    05  rat-1-record-type                       pic x.
* y2k
    05  rat-1-release-id                        pic x(3).

    05  rat-1-filler-1                          pic x.
    05  rat-1-group-nbr                         pic x(4).
    05  rat-1-doc-nbr                           pic 9(6).
*   05  rat-1-specialty-cd                      pic 99.
    05  rat-1-specialty-cd                      pic xx.
    05  rat-1-moh-off-cd                        pic x.
    05  rat-1-data-seq-nbr                      pic 9.
    05  rat-1-payment-date.
* y2k
        10  rat-1-payment-date-yy               pic 9(4).
        10  rat-1-payment-date-mm               pic 99.
        10  rat-1-payment-date-dd               pic 99.
    05  rat-1-payee-name.
        10  rat-1-last-name                     pic x(25).
        10  rat-1-title                         pic xxx.
        10  rat-1-initials                      pic xx.
    05  rat-1-tot-amt-pay                       pic 9(7)v99.
    05  rat-1-tot-amt-pay-sign                  pic x.
    05  rat-1-cheq-nbr                          pic x(8).
* y2k
*   05  rat-1-filler-2                          pic x(7).
* 2003/feb/5 B.E.
*    05  rat-1-filler-2                         pic x(2).
     05  rat-1-filler-2                         pic x(3).

01  rat-record-2-3.
    05  filler                                  pic x(79).

01  rat-record-4.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   5
*                      u030aa1.cbl (/alpha/rmabill/rmabill101c/use/u0)

    05  rat-4-trans-id                          pic xx.
    05  rat-4-record-type                       pic x.
    05  rat-4-claim-nbr                         pic x(11).
    05  rat-4-trans-type                        pic 9.
    05  rat-4-doc-nbr                           pic 9(6).
    05  rat-4-specialty-cd                      pic 99.
    05  rat-4-account-nbr                       pic x(8).
    05  rat-4-last-name                         pic x(14).
    05  rat-4-first-name                        pic x(5).
    05  rat-4-prov-cd                           pic xx.
    05  rat-4-health-ohip-nbr                   pic x(12).
    05  rat-4-version-cd                        pic xx.
    05  rat-4-pay-prog                          pic xxx.

* y2k
    05  rat-4-ministry-location-cd              pic x(4).
*   05  rat-4-conv-health-nbr                   pic x(10).
* 2003/feb/5 B.E.
*    05  rat-4-filler                            pic x(6).
    05  rat-4-filler                            pic x(8).


01  rat-record-5.
    05  rat-5-trans-id                          pic xx.
    05  rat-5-record-type                       pic x.
    05  rat-5-claim-nbr                         pic x(11).
    05  rat-5-trans-type                        pic 9.
* y2k
    05  rat-5-service-date                      pic 9(8).

    05  rat-5-nbr-of-serv                       pic 99.
    05  rat-5-service-cd                        pic x(5).

* y2k
*   05  rat-5-filler-1                          pic xx.

    05  rat-5-eligibility-ind                   pic x.
    05  rat-5-amount-sub                        pic 9(4)v99.
    05  rat-5-amt-paid                          pic 9(4)v99.
    05  rat-5-amt-paid-sign                     pic x.
    05  rat-5-explan-cd                         pic xx.
* 2003/feb/5 B.E.
*    05  rat-5-filler-2                         pic x(33).
    05  rat-5-filler-2                          pic x(35).

01  rat-record-6.
    05  rat-6-trans-id                          pic xx.
    05  rat-6-record-type                       pic x.
    05  rat-6-amt-claims-adj                    pic 9(7)v99.
    05  rat-6-amt-claims-adj-sgn                pic x.
    05  rat-6-amt-advances                      pic 9(7)v99.
    05  rat-6-amt-advances-sgn                  pic x.
    05  rat-6-amt-reductions                    pic 9(7)v99.
    05  rat-6-amt-reductions-sgn                pic x.
    05  rat-6-amt-deductions                    pic 9(7)v99.
    05  rat-6-amt-deductions-sgn                pic x.
* 2003/feb/5 B.E.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   6
*                      u030aa1.cbl (/alpha/rmabill/rmabill101c/use/u0)
*    05  rat-6-filler                           pic x(36).
    05  rat-6-filler                            pic x(38).

01  rat-record-7.
    05  rat-7-trans-id                          pic xx.
    05  rat-7-record-type                       pic x.
    05  rat-7-trans-cd                          pic xx.
    05  rat-7-cheque-ind                        pic x.
* y2k
    05  rat-7-trans-date                        pic 9(8).

    05  rat-7-trans-amt                         pic 9(6)v99.
    05  rat-7-trans-amt-sgn                     pic x.
    05  rat-7-trans-message                     pic x(50).
* y2k
*   05  rat-7-filler                            pic x(8).
* 2003/feb/5 B.E. removed filler with move to EDT file
*    05  rat-7-filler                           pic x(6).
    05  rat-7-filler                            pic x(4).

01  rat-record-8.

    05  rat-8-trans-id                          pic xx.
    05  rat-8-record-type                       pic x.
    05  rat-8-mess-text                         pic x(70).
* 2003/feb/5 B.E. removed filler with move to EDT file
*    05  rat-8-filler                           pic x(6).
    05  rat-8-filler                            pic x(4).

*
    copy "f090_constants_mstr.fd".
* 99/Jan/29     MC      - change iconst-clinic-nbr from numeric to character
* 03/nov/05 b.e. - alpha doctor nbr

fd  iconst-mstr
*       index block contains   2 characters
              block contains 384 characters
        record      contains 384 characters  .
*       feedback is feedback-iconst-mstr.

01 iconst-mstr-rec.
    05  iconst-clinic-nbr-1-2                   pic   99.
*    05  iconst-clinic-nbr                      pic  9(4).
    05  iconst-clinic-nbr                       pic  x(4).
    05  iconst-clinic-name                      pic x(20).
    05  iconst-clinic-cycle-nbr                 pic   99.
    05  iconst-date-period-end.
* y2k   10  iconst-date-period-end-yy           pic   99.
        10  iconst-date-period-end-yy           pic   9999.
        10  iconst-date-period-end-mm           pic   99.
        10  iconst-date-period-end-dd           pic   99.
    05  iconst-clinic-addr.
        10  iconst-clinic-addr-l1               pic  x(25).
        10  iconst-clinic-addr-l2               pic  x(25).
        10  iconst-clinic-addr-l3               pic  x(25).
    05  iconst-clinic-addr-r redefines iconst-clinic-addr.
        10  iconst-clinic-addr                  pic x(25)   occurs  3  times.
    05  iconst-clinic-card-colour               pic    x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   7
*                      u030aa1.cbl (/alpha/rmabill/rmabill101c/use/f0)
    05  iconst-clinic-over-lim1                 pic 99v99.
    05  iconst-clinic-under-lim2                pic 99v99.
    05  iconst-clinic-under-lim3                pic 99v99.
    05  iconst-clinic-over-lim4                 pic 99v99.

*!    05  iconst-clinic-batch-nbr                 pic 9(6).
    05  iconst-clinic-batch-nbr                 pic x(6).

    05  iconst-reduction-factor                 pic 99v99.
    05  iconst-overpay-factor                   pic 99v99.
    05  filler                                  pic x(242).
*
    copy "f090_const_mstr_rec_1.ws".
* 2005/jan/04   - extend from 40 clinic to the max clinics allowed (63)

01 constants-mstr-rec-1.
    05  const-rec-1-rec-nbr                     pic 99.
    05  const-max-nbr-clinics                   pic 99.
    05  const-clinic-data.
* 2005/01/04 - MC
*       10  const-clinic-data-r occurs  40  times.
        10  const-clinic-data-r occurs  63  times.
            15  const-clinic-nbr-1-2            pic 99.
            15  const-clinic-nbr                pic x(4).
    05  const-scr-data  redefines  const-clinic-data.
        10  const-clinic-1-2-nbr-1              pic 99.
        10  const-clinic-nbr-1                  pic x(4).
        10  const-clinic-1-2-nbr-2              pic 99.
        10  const-clinic-nbr-2                  pic x(4).
        10  const-clinic-1-2-nbr-3              pic 99.
        10  const-clinic-nbr-3                  pic x(4).
        10  const-clinic-1-2-nbr-4              pic 99.
        10  const-clinic-nbr-4                  pic x(4).
        10  const-clinic-1-2-nbr-5              pic 99.
        10  const-clinic-nbr-5                  pic x(4).
        10  const-clinic-1-2-nbr-6              pic 99.
        10  const-clinic-nbr-6                  pic x(4).
        10  const-clinic-1-2-nbr-7              pic 99.
        10  const-clinic-nbr-7                  pic x(4).
        10  const-clinic-1-2-nbr-8              pic 99.
        10  const-clinic-nbr-8                  pic x(4).
        10  const-clinic-1-2-nbr-9              pic 99.
        10  const-clinic-nbr-9                  pic x(4).
        10  const-clinic-1-2-nbr-10             pic 99.
        10  const-clinic-nbr-10                 pic x(4).
        10  const-clinic-1-2-nbr-11             pic 99.
        10  const-clinic-nbr-11                 pic x(4).
        10  const-clinic-1-2-nbr-12             pic 99.
        10  const-clinic-nbr-12                 pic x(4).
        10  const-clinic-1-2-nbr-13             pic 99.
        10  const-clinic-nbr-13                 pic x(4).
        10  const-clinic-1-2-nbr-14             pic 99.
        10  const-clinic-nbr-14                 pic x(4).
        10  const-clinic-1-2-nbr-15             pic 99.
        10  const-clinic-nbr-15                 pic x(4).
        10  const-clinic-1-2-nbr-16             pic 99.
        10  const-clinic-nbr-16                 pic x(4).
        10  const-clinic-1-2-nbr-17             pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   8
*                      u030aa1.cbl (/alpha/rmabill/rmabill101c/use/f0)
        10  const-clinic-nbr-17                 pic x(4).
        10  const-clinic-1-2-nbr-18             pic 99.
        10  const-clinic-nbr-18                 pic x(4).
        10  const-clinic-1-2-nbr-19             pic 99.
        10  const-clinic-nbr-19                 pic x(4).
        10  const-clinic-1-2-nbr-20             pic 99.
        10  const-clinic-nbr-20                 pic x(4).
        10  const-clinic-1-2-nbr-21             pic 99.
        10  const-clinic-nbr-21                 pic x(4).
        10  const-clinic-1-2-nbr-22             pic 99.
        10  const-clinic-nbr-22                 pic x(4).
        10  const-clinic-1-2-nbr-23             pic 99.
        10  const-clinic-nbr-23                 pic x(4).
        10  const-clinic-1-2-nbr-24             pic 99.
        10  const-clinic-nbr-24                 pic x(4).
        10  const-clinic-1-2-nbr-25             pic 99.
        10  const-clinic-nbr-25                 pic x(4).
        10  const-clinic-1-2-nbr-26             pic 99.
        10  const-clinic-nbr-26                 pic x(4).
        10  const-clinic-1-2-nbr-27             pic 99.
        10  const-clinic-nbr-27                 pic x(4).
        10  const-clinic-1-2-nbr-28             pic 99.
        10  const-clinic-nbr-28                 pic x(4).
        10  const-clinic-1-2-nbr-29             pic 99.
        10  const-clinic-nbr-29                 pic x(4).
        10  const-clinic-1-2-nbr-30             pic 99.
        10  const-clinic-nbr-30                 pic x(4).
        10  const-clinic-1-2-nbr-31             pic 99.
        10  const-clinic-nbr-31                 pic x(4).
        10  const-clinic-1-2-nbr-32             pic 99.
        10  const-clinic-nbr-32                 pic x(4).
        10  const-clinic-1-2-nbr-33             pic 99.
        10  const-clinic-nbr-33                 pic x(4).
        10  const-clinic-1-2-nbr-34             pic 99.
        10  const-clinic-nbr-34                 pic x(4).
        10  const-clinic-1-2-nbr-35             pic 99.
        10  const-clinic-nbr-35                 pic x(4).
        10  const-clinic-1-2-nbr-36             pic 99.
        10  const-clinic-nbr-36                 pic x(4).
        10  const-clinic-1-2-nbr-37             pic 99.
        10  const-clinic-nbr-37                 pic x(4).
        10  const-clinic-1-2-nbr-38             pic 99.
        10  const-clinic-nbr-38                 pic x(4).
        10  const-clinic-1-2-nbr-39             pic 99.
        10  const-clinic-nbr-39                 pic x(4).
        10  const-clinic-1-2-nbr-40             pic 99.
        10  const-clinic-nbr-40                 pic x(4).
* 2005/01/04 - MC - include clinic 41 to 63
*    05  filler                                 pic x(140).
        10  const-clinic-1-2-nbr-41             pic 99.
        10  const-clinic-nbr-41                 pic x(4).
        10  const-clinic-1-2-nbr-42             pic 99.
        10  const-clinic-nbr-42                 pic x(4).
        10  const-clinic-1-2-nbr-43             pic 99.
        10  const-clinic-nbr-43                 pic x(4).
        10  const-clinic-1-2-nbr-44             pic 99.
        10  const-clinic-nbr-44                 pic x(4).
        10  const-clinic-1-2-nbr-45             pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   9
*                      u030aa1.cbl (/alpha/rmabill/rmabill101c/use/f0)
        10  const-clinic-nbr-45                 pic x(4).
        10  const-clinic-1-2-nbr-46             pic 99.
        10  const-clinic-nbr-46                 pic x(4).
        10  const-clinic-1-2-nbr-47             pic 99.
        10  const-clinic-nbr-47                 pic x(4).
        10  const-clinic-1-2-nbr-48             pic 99.
        10  const-clinic-nbr-48                 pic x(4).
        10  const-clinic-1-2-nbr-49             pic 99.
        10  const-clinic-nbr-49                 pic x(4).
        10  const-clinic-1-2-nbr-50             pic 99.
        10  const-clinic-nbr-50                 pic x(4).
        10  const-clinic-1-2-nbr-51             pic 99.
        10  const-clinic-nbr-51                 pic x(4).
        10  const-clinic-1-2-nbr-52             pic 99.
        10  const-clinic-nbr-52                 pic x(4).
        10  const-clinic-1-2-nbr-53             pic 99.
        10  const-clinic-nbr-53                 pic x(4).
        10  const-clinic-1-2-nbr-54             pic 99.
        10  const-clinic-nbr-54                 pic x(4).
        10  const-clinic-1-2-nbr-55             pic 99.
        10  const-clinic-nbr-55                 pic x(4).
        10  const-clinic-1-2-nbr-56             pic 99.
        10  const-clinic-nbr-56                 pic x(4).
        10  const-clinic-1-2-nbr-57             pic 99.
        10  const-clinic-nbr-57                 pic x(4).
        10  const-clinic-1-2-nbr-58             pic 99.
        10  const-clinic-nbr-58                 pic x(4).
        10  const-clinic-1-2-nbr-59             pic 99.
        10  const-clinic-nbr-59                 pic x(4).
        10  const-clinic-1-2-nbr-60             pic 99.
        10  const-clinic-nbr-60                 pic x(4).
        10  const-clinic-1-2-nbr-61             pic 99.
        10  const-clinic-nbr-61                 pic x(4).
        10  const-clinic-1-2-nbr-62             pic 99.
        10  const-clinic-nbr-62                 pic x(4).
        10  const-clinic-1-2-nbr-63             pic 99.
        10  const-clinic-nbr-63                 pic x(4).

    05  filler                                  pic x(2).
* 2005/01/04 - end

*
fd  u030aa-parm-file
*   record contains 18 characters.
    record contains 20 characters.

01  u030aa-parm-rec.
    05  u030aa-client-id                pic x(5).
    05  u030aa-total-amt-paid           pic s9(7)v99.
*   05  u030aa-clinic-nbr               pic 99.
    05  u030aa-clinic-nbr               pic 9(4).
    05  u030aa-month-id                 pic 99.


*
* 2003/dec/10 - MC - comment out the following 3 fd, use copybook instead

**fd  client-rma-claim-nbr
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  10
*                      u030aa1.cbl                                   )
*    index block contains  8 characters
*    data  block contains 22 characters
**  block  contains      22 characters
**  record contains      22 characters .
*    feedback is feedback-client-rma-claim-nbr.

**01  client-rma-claim-nbr-rec.
**  05  claim-nbr-client.
**      10  doc-ohip-nbr                pic x(6).
**      10  doc-account-nbr             pic x(8).
**  05  claim-nbr-rma                   pic 9(8).

copy "f071_client_rma_claim_nbr.fd".
* 2000/jan/18 m.c.      - include clinic nbr
* 2003/jun/10 m.c.      - include clinic nbr as part of claim-nbr-rma-clinic
* 2003/dec/10 m.c.      - alphd doc nbr

fd  client-rma-claim-nbr
*    index block contains  8 characters
*    data  block contains 22 characters
*    block contains 22 characters
*    record contains 22 characters .
     block contains 24 characters
     record contains 24 characters .
*    feedback is feedback-client-rma-claim-nbr.

01  client-rma-claim-nbr-rec.
    05  claim-nbr-client.
        10  doc-ohip-nbr                pic x(6).
        10  doc-account-nbr             pic x(8).
* 2003/06/10 - MC
*   05  claim-nbr-rma                   pic 9(8).
*   05  clinic-nbr                      pic 9(2).
    05  claim-nbr-rma-clinic.
        10  clinic-nbr                  pic 9(2).
*!        10  claim-nbr-rma               pic 9(8).
        10  claim-nbr-rma               pic x(8).
* 2003/06/10 - end


*

**fd  client-mstr
*    index block contains  5 characters
*    data  block contains 38 characters
**   block  contains      38 characters
**  record contains      38 characters .
*    feedback is feedback-client-mstr.

**01  client-mstr-rec.
**  05  client-id                       pic x(5).
**  05  client-operator-nbr             pic 9(3).
**  05  client-desc                     pic x(30).

copy "f072_client_mstr.fd".
fd  client-mstr
*    index block contains  5 characters
*    data  block contains 38 characters
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  11
*                      u030aa1.cbl (/alpha/rmabill/rmabill101c/use/f0)
    block contains 38 characters
    record contains 38 characters .
*   feedback is feedback-client-mstr.

01  client-mstr-rec.
    05  client-id                       pic x(5).
    05  client-operator-nbr             pic 9(3).
    05  client-desc                     pic x(30).


*

**fd  client-doc-mstr
*    index block contains  3 characters
*    data  block contains  8 characters
**  block  contains       8 characters
**  record contains       8 characters .
*    feedback is feedback-client-doc-mstr.

**01  client-doc-rec.
**  05  doc-nbr                         pic 9(3).
**  05  client-id                       pic x(5).

copy "f073_client_doc_mstr.fd".
fd  client-doc-mstr
*    index block contains  3 characters
*    data  block contains  8 characters
     block contains  8 characters
     record contains 8 characters .
*    feedback is feedback-client-doc-mstr.

01  client-doc-rec.
* 2003/11/25 - MC - change sequence
*   05  doc-nbr                         pic 9(3).
*   05  client-id                       pic x(5).
    05  client-doc.
        10  client-id                   pic x(5).
*!      10  doc-nbr                     pic 9(3).
        10  doc-nbr                     pic x(3).
* 2003/11/25 - end


* 2003/dec/10 - end

*

working-storage section.

77  err-ind                                     pic 99  value zero.
77  last-claim-nbr                              pic x(11).
*77  ws-request-clinic-ident                    pic 99.
77  ws-request-clinic-ident                     pic 9(4).
77  ws-sel-client                               pic x(5).
77  ws-sel-month                                pic 99.
77  ws-flag-tape-mth                            pic x.
77  ws-flag-over-mth                            pic x.
77  ws-scr-day                                  pic 99.
* (y2k)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  12
*                      u030aa1.cbl                                   )
*77  ws-scr-year                                        pic 99.
77  ws-scr-year                                 pic 9(4).
77  ws-scr-month                                pic x(9).
77  ws-doll-amt                                 pic 9(7)v99.
77  ws-reply                                    pic x.
77  ws-confirm-reply                            pic x.


*
*  status file indicators
*
*mf 77  status-file                                     pic x(11).
*mf 77  status-iconst-mstr                              pic x(11) value zero.
*mf 77  status-client-mstr                              pic x(11) value zero.
*mf 77  status-client-doc-mstr                  pic x(11) value zero.
*mf 77  status-client-rma-claim-nbr                     pic x(11) value zero.
77  status-file                                 pic x(2).
77  status-cobol-iconst-mstr                    pic x(2) value zero.
77  status-cobol-client-mstr                    pic x(2) value zero.
77  status-cobol-client-doc-mstr                pic x(2) value zero.
77  status-cobol-client-rma-nbr                 pic x(2) value zero.
77  feedback-iconst-mstr                        pic x(4).
77  feedback-client-mstr                        pic x(4).
77  feedback-client-doc-mstr            pic x(4).
77  feedback-client-rma-claim-nbr               pic x(4).

77  i                                           pic 99.

01  group-nbr-flag                              pic x.
    88  group-nbr-found                         value 'Y'.
    88  group-nbr-not-found                     value 'N'.


01  rat-eof-flag                                pic x.
    88  rat-eof                                 value "Y".

01  hcp-rmb-flag                                pic x.
    88  rmb-claims                              value 'Y'.
    88  hcp-claims                              value 'N'.

01  doc-flag                                    pic x.
    88 doc-found                                value 'Y'.
    88 doc-not-found                            value 'N'.

01  client-flag                                 pic x.
    88 correct-client                           value 'Y'.
    88 wrong-client                             value 'N'.

01  hold-account-nbr.
*!    05  hold-doc-nbr                          pic 9(3).
    05  hold-doc-nbr                            pic x(3).
    05  hold-doc-claim                          pic 9(5).

01  ws-rat-1-tot-amt-pay                        pic s9(7)v99.


*   counters for records read/written for all input/output files

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  13
*                      u030aa1.cbl                                   )
01  counters.
    05  ctr-rat-tape-reads                      pic 9(7).
    05  ctr-rat-rec1-reads                      pic 9(7).
    05  ctr-rat-rec2-reads                      pic 9(7).
    05  ctr-rat-rec3-reads                      pic 9(7).
    05  ctr-rat-rec4-reads                      pic 9(7).
    05  ctr-rat-rec5-reads                      pic 9(7).
    05  ctr-rat-rec6-reads                      pic 9(7).
    05  ctr-rat-rec7-reads                      pic 9(7).
    05  ctr-rat-rec8-reads                      pic 9(7).
    05  hcp-records                             pic 9(7).
    05  rmb-records                             pic 9(7).


    copy "sysdatetime.ws".
* 98/dec/01 D.B.        - y2k conversion
* 99/jan/13 B.E.        - changed sys-y1/y2 to y1 thru y4
*                       - added 'default-century-...' and century-date variables

01 century-year                                 pic 9(4).
01 century-date                                 pic 9(8).
01 default-century-cc                           pic 9(2) value 19.
01 default-century-cccc                         pic 9(4) value 1900.

01  sys-date.
* y2k    05  sys-date-long                              pic x(6).
    05  sys-date-long                           pic x(8).
    05  sys-date-long-r  redefines  sys-date-long.
* y2k   10  sys-yy                              pic 99.
        10  sys-yy                              pic 9999.
        10  sys-yy-alpha  redefines  sys-yy.
* y2k       15  sys-y1                          pic 9.
* y2k       15  sys-y2                          pic 9.
            15  sys-y1                          pic 9.
            15  sys-y2                          pic 9.
            15  sys-y3                          pic 9.
            15  sys-y4                          pic 9.
        10  sys-mm                              pic 99.
        10  sys-dd                              pic 99.
* remove after y2k upgrade of dgux
01  sys-date-numeric redefines sys-date         pic 9(8).
01  sys-date-y2kfix  redefines sys-date.
    05 sys-date-left                            pic x(6).
    05 filler                                   pic x(2).
01  sys-date-y2kfixed redefines sys-date.
    05 sys-date-blank                           pic x(2).
    05 sys-date-right                           pic x(6).
01  sys-date-temp                               pic x(8).

01  run-date.
* y2k    05  run-yy                                     pic 99.
    05  run-yy                                  pic 9999.
    05  filler                                  pic x   value "/".
    05  run-mm                                  pic 99.
    05  filler                                  pic x   value "/".
    05  run-dd                                  pic 99.

01  sys-time.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  14
*                      u030aa1.cbl (/alpha/rmabill/rmabill101c/use/sy)
    05  sys-hrs                                 pic 99.
    05  sys-min                                 pic 99.
    05  sys-sec                                 pic 99.
    05  sys-hdr                                 pic 99.

01  run-time.
    05  run-hrs                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-min                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-sec                                 pic 99.

    copy "mth_desc_max_days.ws".
*
*       (each position contains:
*               - maximum nbr of days in month
*               - non-abreviated spelling of month
*               - nbr of julian days from jan-01 until last day of month
*       note: table does not take into consideration leap year)
*
01  month-descs-and-max-days-mth.
    05  mth-desc-max-days.
        10  filler                      pic x(14) value '31  JANUARY031'.
        10  filler                      pic x(14) value '29 FEBRUARY059'.
        10  filler                      pic x(14) value '31    MARCH090'.
        10  filler                      pic x(14) value '30    APRIL120'.
        10  filler                      pic x(14) value '31      MAY151'.
        10  filler                      pic x(14) value '30     JUNE181'.
        10  filler                      pic x(14) value '31     JULY212'.
        10  filler                      pic x(14) value '31   AUGUST243'.
        10  filler                      pic x(14) value '30SEPTEMBER273'.
        10  filler                      pic x(14) value '31  OCTOBER304'.
        10  filler                      pic x(14) value '30 NOVEMBER334'.
        10  filler                      pic x(14) value '31 DECEMBER365'.
    05  mth-desc-max-days-r   redefines mth-desc-max-days.
        10  mth-desc-max-days-occur     occurs  12  times.
            15  max-nbr-days            pic 99.
            15  mth-desc                pic x(9).
            15  nbr-julian-days-ytd     pic 9(3).


01  error-message-table.

    05  error-messages.
        10  filler                              pic x(70)   value
                        "NO RAT TAPE HEADER - RECORD #1 ".
        10  filler                              pic x(70)   value
                        "RAT TAPE RECORD #5 DOES NOT BELONG IN SERIES".
        10  filler                              pic x(70)    value
                        "INVALID GROUP IDENTIFIER".
        10  filler                              pic x(70)   value
                        "RAT TAPE MONTH MUST BE NUMERIC ONLY".
        10  filler                              pic x(70)   value
                        "GROUP IDENTIFICATION MUST BE NUMERIC".
        10  filler                              pic x(70)   value
                        "INVALID REPLY".
        10  filler                              pic x(70)    value
                        "INVALID CLIENT".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  15
*                      u030aa1.cbl                                   )
        10  filler                              pic x(70)   value
                        "CONSTANT MSTR RECORD 1 DOES NOT EXIST".
    05  error-messages-r redefines error-messages.
        10  err-msg                             pic x(70)
                        occurs  8 times.

01  err-msg-comment                             pic x(70).

01  e1-error-line.

    05  e1-error-word                           pic x(13)    value
                        "***  ERROR - ".
    05  e1-error-msg                            pic x(119).


screen section.

01  scr-title.

    05  blank screen.
    05  line 01 col 01 value is "U030AA1".
    05  line 01 col 20 value is "RAT TAPE APPLICATION FOR DISKETTE".
* (y2k - auto fix)
*   05  line 01 col 73 pic 99 from sys-yy.
    05  line 01 col 73 pic 9(4) from sys-yy.
    05  line 01 col 75 value is "/".
    05  line 01 col 76 pic 99 from sys-mm.
    05  line 01 col 78 value is "/".
    05  line 01 col 79 pic 99 from sys-dd.
    05  line 06 col 20 value is "ENTER CLINIC IDENT".
* 98/sep/09: clinic '0000' now valid
*   05  scr-clinic-nbr line 06 col 40 pic 9(4) using ws-request-clinic-ident aut
    05  scr-clinic-nbr line 06 col 40 pic 9(4) using ws-request-clinic-ident aut
    05  line 08 col 20 value is "ENTER CLIENT ID".
    05  scr-client-id  line 08 col 40 pic x(5)  using ws-sel-client auto require

01  msg-continue.

    05  line 10 col 10 value is "CONTINUE?  (ENTER Y OR N)".
    05  reply line 10 col 40 pic x using ws-reply auto required.

01  program-in-progress.

    05  line 21 col 20 value "PROGRAM U030AA1 IN PROGRESS".

01  confirm.
    05  line 23 col 01 value " ".

01  blank-line-24.

    05  line 24 col 01 blank line.

01  blank-screen.
    05  blank screen.

01  err-msg-line.
    05  line 24 col 01 value " ERROR -   " bell blink.
    05  line 24 col 11 pic x(60) from err-msg-comment.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  16
*                      u030aa1.cbl                                   )


01  scr-month-id.

    05  line 12 col 20  value is "ENTER RAT TAPE MONTH".
    05  line 12 col 41  pic 99    using ws-sel-month   auto.


01  scr-search-rec-type-1.

    05  line 14 col 20  value is "NOW SEARCHING FOR RAT TAPE RECORD TYPE 1".

01  scr-date-and-dol-amount.

    05  line 16 col 20  value is "DATE OF TAPE IS".
    05  line 16 col 36  pic 99    using ws-scr-day           auto.
    05  line 16 col 39  pic x(9)  using ws-scr-month         auto.
* (y2k - auto fix)
*   05  line 16 col 49  pic 99    using ws-scr-year          auto.
    05  line 16 col 49  pic 9(4)    using ws-scr-year          auto.
    05  line 17 col 20  value is "RAT TAPE CLINIC AMOUNT $".
    05  line 17 col 45  pic z,zzz,zz9.99  using ws-doll-amt      auto.

01  scr-accept-mth.

    05                line 18  col 20  value is "ACCEPT THIS TAPE MONTH (Y/N)".
    05  scr-tape-mth  line 18  col 51  pic x using ws-flag-tape-mth   auto.

01  scr-override-mth.

    05                line 19 col 20 value is "MONTH ENTERED AND MONTH FOUND ON
    05                line 20 col 20 value is "DO YOU STILL WANT TO CONTINUE (Y
    05  scr-over-mth  line 20 col 60 pic x using ws-flag-over-mth   auto.

01  scr-confirm-neg-response.

    05  line 22 col 20 value is "* WARNING * YOU HAVE ENTERED 'N' ! RE-ENTER TO
    05                line 23 col 20 value is "DO YOU STILL WANT TO CONTINUE (Y
    05  confirm-reply line 23 col 60 pic x using ws-confirm-reply  auto.

01  ring-bell.
    05  line 23 col 01 value " " bell.

procedure division.

mainline.

    perform aa0-initialization          thru aa0-99-exit.
    perform ab0-processing              thru ab0-99-exit
        until rat-eof.

    perform az0-end-of-job              thru az0-99-exit.
*
    stop run.
aa0-initialization.

* (y2k)
    accept sys-date                     from date.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  17
*                      u030aa1.cbl                                   )
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.
    move sys-mm                         to run-mm.
    move sys-dd                         to run-dd.
* (y2k)
    move sys-yy                         to run-yy.

    accept sys-time                     from time.
    move sys-hrs                        to run-hrs.
    move sys-min                        to run-min.
    move sys-sec                        to run-sec.

    move zeros                          to counters.

    move "N"                            to rat-eof-flag.
    move "N"                            to hcp-rmb-flag.
    move "N"                            to group-nbr-flag.

    open input iconst-mstr.

    move 01                             to iconst-clinic-nbr-1-2.

    read iconst-mstr
        invalid key
                move 8 to err-ind
                perform za0-common-error        thru za0-99-exit
                perform zb0-abend               thru zb0-99-exit.

    display scr-title.

aa0-10-accept-clinic.

    accept scr-clinic-nbr.

*   if ws-request-clinic-ident not numeric
*   then
*       move  5                         to      err-ind
*       perform za0-common-error        thru    za0-99-exit
*       move spaces                     to      ws-request-clinic-ident
*       move zero                       to      err-ind
*       go to aa0-10-accept-clinic
*   else
        perform aa3-verify-group-nbr    thru aa3-99-exit
        varying i from 1 by 1
* 2005/01/04 - MC
*       until   group-nbr-found or i > 40.
        until   group-nbr-found or i > 63.
* 2005/01/04 - end

        if group-nbr-not-found
        then
            move 3                      to err-ind
            perform za0-common-error    thru za0-99-exit
            go to aa0-10-accept-clinic.
*       endif
*    endif



* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  18
*                      u030aa1.cbl                                   )
    open input client-mstr.

    display scr-client-id.

aa0-12-accept-client-id.

    accept scr-client-id.

    move ws-sel-client to client-id of client-mstr-rec.

    read client-mstr
        invalid key
                move 7                  to err-ind
                perform za0-common-error thru za0-99-exit
                go to aa0-12-accept-client-id.

    display scr-month-id.

aa0-15-accept-month.

    accept scr-month-id.

    if ws-sel-month  is not numeric
    then
        move  4                                 to  err-ind
        perform za0-common-error                thru za0-99-exit
*        move spaces                            to  ws-sel-month
        move zero                               to  ws-sel-month
        move zero                               to err-ind
        go to aa0-15-accept-month.
*   endif

    display scr-search-rec-type-1.

    open input  ohip-rat-tape
                client-doc-mstr
                client-rma-claim-nbr.

*    expunge u030aa-parm-file.

    open output u030aa-parm-file.

aa0-20-continue-reading.

    perform xa0-read-rat-tape           thru xa0-99-exit
        until rat-1-record-type = "1"
           or rat-eof.

    if not rat-eof
    then
*       if iconst-clinic-nbr = rat-1-group-nbr
        if ws-request-clinic-ident = rat-1-group-nbr
        then
            if rat-1-record-type = "1"
            then
                add 1                           to ctr-rat-rec1-reads
                perform aa1-record-1-process    thru    aa1-99-exit
                perform aa2-certify-month       thru    aa2-99-exit
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  19
*                      u030aa1.cbl                                   )
            else
                go to aa0-20-continue-reading
*               endif
        else
            perform xa0-read-rat-tape           thru    xa0-99-exit
            go to aa0-20-continue-reading
*       endif
    else
        move 1                                  to      err-ind
        perform za0-common-error                thru    za0-99-exit
        perform zb0-abend                       thru    zb0-99-exit.
*   endif


    move ws-sel-client                          to u030aa-client-id.
    move ws-sel-month                           to u030aa-month-id.
    move ws-request-clinic-ident                to u030aa-clinic-nbr.

    move zero                                   to ws-rat-1-tot-amt-pay.

    perform xa0-read-rat-tape                   thru    xa0-99-exit.


aa0-99-exit.
    exit.

aa1-record-1-process.

    if rat-1-tot-amt-pay-sign = ' '
    then
        move rat-1-tot-amt-pay          to ws-rat-1-tot-amt-pay
    else
        multiply rat-1-tot-amt-pay by -1 giving
                                           ws-rat-1-tot-amt-pay.
*   endif

aa1-99-exit.
    exit.


aa2-certify-month.

    move rat-1-payment-date-dd          to      ws-scr-day.
    move rat-1-payment-date-yy          to      ws-scr-year.
    move mth-desc ( rat-1-payment-date-mm )
                                        to      ws-scr-month.
    move ws-rat-1-tot-amt-pay           to      ws-doll-amt.

    display scr-date-and-dol-amount.

    display scr-accept-mth.
    accept  scr-tape-mth.

    if ws-sel-month  not = rat-1-payment-date-mm
    then
        if ws-flag-tape-mth = "Y"
        then

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  20
*                      u030aa1.cbl                                   )
*       if selected month and month found on tape don'T MATCH AND THE
*       user wishes to continue with the program a warning appears on
*       the screen telling the user so. it also gives the user the
*       option of continuing with the program or rejecting it.

            next sentence
        else
            go to  zb1-close-files
    else
        if ws-flag-tape-mth = "Y"
        then
            display program-in-progress
            go to aa2-99-exit
        else
            go to  zb1-close-files.
*       endif
*   endif

    display scr-override-mth.
    accept  scr-override-mth.

    if ws-flag-over-mth  = "Y"
    then
        display program-in-progress
        go to aa2-99-exit.
*   (else)
*   endif

aa2-10-confirm-neg-response.

    display scr-confirm-neg-response.
    accept confirm-reply.

    if ws-confirm-reply =   "Y"
                         or "N"
    then
        next sentence
    else
        move  6                         to      err-ind
        perform za0-common-error        thru    za0-99-exit
        go to aa2-10-confirm-neg-response.
*   endif

    if ws-confirm-reply = "Y"
    then
        next sentence
    else
        go to zb1-close-files.
*   endif


aa2-99-exit.
    exit.

aa3-verify-group-nbr.

    if ws-request-clinic-ident = const-clinic-nbr(i)
    then
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  21
*                      u030aa1.cbl                                   )
        move 'Y'                to group-nbr-flag.
*   endif

aa3-99-exit.
    exit.

ab0-processing.

    if rat-1-record-type = "1"
    then
*       if iconst-clinic-nbr not = rat-1-group-nbr
        if ws-request-clinic-ident not = rat-1-group-nbr
        then
            move "Y"                    to rat-eof-flag
            go to ab0-99-exit.
*       endif
*   endif

    perform xa1-create-tape-files       thru xa1-99-exit.

    if rat-1-record-type = "4"
    then
        move rat-4-claim-nbr            to last-claim-nbr.
*   endif

    if rat-1-record-type = "5"
    then
        if rat-5-claim-nbr = last-claim-nbr
        then
            next sentence
        else
            move 2                      to err-ind
            perform za0-common-error    thru za0-99-exit
            display "RAT 5 CLAIM NBR=", rat-5-claim-nbr
            display "LAST CLAIM NBR =", last-claim-nbr
            stop "HIT NEW-LINE TO CONTINUE"
            move zero                   to err-ind
            go to ab0-10-read-next-rat.
*       endif
*   endif

    if rat-1-record-type = '7'
    then
        move 'Y'                        to hcp-rmb-flag.
*   endif


ab0-10-read-next-rat.

    perform xa0-read-rat-tape           thru xa0-99-exit.


ab0-99-exit.
    exit.

az0-end-of-job.


* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  22
*                      u030aa1.cbl                                   )
    move ws-rat-1-tot-amt-pay           to u030aa-total-amt-paid.
    write u030aa-parm-rec.

    display blank-screen.
    display " ".
    display "OHIP RATS READ          "  ctr-rat-tape-reads.
    display "OHIP RATS REC 1 READ    "  ctr-rat-rec1-reads.
    display "OHIP RATS REC 2 READ    "  ctr-rat-rec2-reads.
    display "OHIP RATS REC 3 READ    "  ctr-rat-rec3-reads.
    display "OHIP RATS REC 4 READ    "  ctr-rat-rec4-reads.
    display "OHIP RATS REC 5 READ    "  ctr-rat-rec5-reads.
    display "OHIP RATS REC 6 READ    "  ctr-rat-rec6-reads.
    display "OHIP RATS REC 7 READ    "  ctr-rat-rec7-reads.
    display "OHIP RATS REC 8 READ    "  ctr-rat-rec8-reads.
    display "HCP HEADER REC READ     "  hcp-records.
    display "RMB HEADER REC READ     "  rmb-records.

    close iconst-mstr
          ohip-rat-tape
          u030aa-parm-file
          client-rma-claim-nbr
          client-mstr
          client-doc-mstr.

    display " ".
    display "NORMAL END OF JOB - U030AA1".

    stop run.

az0-99-exit.
    exit.
xa0-read-rat-tape.

    read ohip-rat-tape
        at end
            move "Y" to rat-eof-flag
            go to xa0-99-exit.

    add 1 to ctr-rat-tape-reads.


xa0-99-exit.
    exit.


xa1-create-tape-files.

    if rat-1-record-type = '1'
    then
        add 1                                   to ctr-rat-rec1-reads
    else
    if rat-1-record-type = '2'
    then
        add 1                                   to ctr-rat-rec2-reads
    else
    if rat-1-record-type = '3'
    then
        add 1                                   to ctr-rat-rec3-reads
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  23
*                      u030aa1.cbl                                   )
    else
    if rat-1-record-type = '4'
    then
        add 1                                   to ctr-rat-rec4-reads
        perform xb0-process-rec-4               thru xb0-99-exit
    else
    if rat-1-record-type = '5'
    then
        add 1                                   to ctr-rat-rec5-reads
        perform xb1-process-rec-5               thru xb1-99-exit
    else
    if rat-1-record-type = '6'
    then
        add 1                                   to ctr-rat-rec6-reads
    else
    if rat-1-record-type = '7'
    then
        add 1                                   to ctr-rat-rec7-reads
    else
    if rat-1-record-type = '8'
    then
        add 1                                   to ctr-rat-rec8-reads.
*   endif
*   endif
*   endif
*   endif
*   endif
*   endif
*   endif

xa1-99-exit.
    exit.

xb0-process-rec-4.

    if rat-4-prov-cd = 'ON'
    then
        move "N"                        to hcp-rmb-flag
    else
        move "Y"                        to hcp-rmb-flag.
*   endif

    move rat-4-account-nbr              to hold-account-nbr.
    move hold-doc-nbr                   to doc-nbr.
    move 'Y'                            to doc-flag
                                           client-flag.
    if doc-nbr = 204
    then
        next sentence.

    read client-doc-mstr
        invalid key
                move 'N'                to doc-flag
                go to xb0-99-exit.

    if client-id of client-doc-rec not = ws-sel-client
    then
        move 'N'                        to client-flag
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  24
*                      u030aa1.cbl                                   )
        go to xb0-99-exit.
*   endif

    if hcp-claims
    then
        add 1                           to hcp-records
    else
    if rmb-claims
    then
        add 1                           to rmb-records.
*   endif

xb0-99-exit.
    exit.


xb1-process-rec-5.

    if doc-not-found or wrong-client
    then
        go to xb1-99-exit
    else
        if rat-5-amt-paid-sign = ' '
        then
            add rat-5-amt-paid          to ws-rat-1-tot-amt-pay
        else
            compute ws-rat-1-tot-amt-pay = ws-rat-1-tot-amt-pay +
                        (rat-5-amt-paid * -1).
*       endif
*   endif

xb1-99-exit.
    exit.



za0-common-error.

    move err-msg (err-ind)              to      e1-error-msg.
    display confirm.
    display e1-error-line.

za0-99-exit.
    exit.

zb0-abend.

    display "U030AA1 ABENDING"
    display " ".


zb1-close-files.
    close iconst-mstr
          ohip-rat-tape
          u030aa-parm-file
          client-rma-claim-nbr
          client-mstr
          client-doc-mstr.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  25
*                      u030aa1.cbl                                   )


    stop run.

zb0-99-exit.
    exit.


    copy "y2k_default_sysdate_century.rtn".
y2k-default-sysdate.

    move sys-date-left                  to sys-date-temp.
    move sys-date-temp                  to sys-date-right.
    move zeros                          to sys-date-blank.
* 1999/dec/30 B.E.
*   add 19000000                        to sys-date-numeric.
    add 20000000                        to sys-date-numeric.

y2k-default-sysdate-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 Compiler
* Copyright (C) 1984-1995 Micro Focus Ltd.     URN 2XUPG/GB0/00000F
*                                              REF GNB-030056000AA
*
* Total Messages:     0
* Data:        4864     Code:        3958
