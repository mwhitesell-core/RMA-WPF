* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   1
*                      r070a.cbl
* Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Accepted - SHOW-DIR
* Accepted - SOURCEFORMAT"FREE"
* Accepted - SPZERO
* Accepted - TIME
* Accepted - TRUNC
* Accepted - RESEQ
* Accepted - SEQCHK
* End Of Directives File: /usr/opt/mfcobol4.0/cobol.dir
identification division.
program-id. r070a.
author. dyad computer systems inc.
installation. rma.
date-written. 80/02/07.
date-compiled. 18-May-06 15:41.
security.
*
*    files      : f002  - claims master
*               : f010  - patient master
*               : f090i - constants master
*               : r070_work_mstr_cc  - claims work file (where "CC" = clinic nbr
*               : r070_par_file      - parameter file indicating to the programs
*                                      that follow r070a which clinic is being p
*               : r070a - error report
*
*    program purpose: this program is the first in a series of 3 programs
*                       whose purpose is to produce the accounts receivable
*                       trial balance report. this program produces the
*                       claims work file.
*
*
*   revised feb/84 (a.j.) - adjust the work file to carry the clmhdr-
*                           sub-nbr and clmhdr-tape-submit-ind
*
*   revised nov/84 (m.s.) - add subscriber master,
*                           modify the program to access subscr mstr
*                           to get subscr-date-last-statement for
*                           direct billing.
*
*   revised nov/84 (m.s.) - provide two further aging categories,
*                           replace 'OVER 120' with '120-150',
*                           add '150-180' and 'OVER 180'.
*
*   revised jan 23/85 (iw) - open all files for input only.
*
*   revised feb 26/85 (ms) - sms 85.2
*                          - pat-mstr and subscr-mstr are not used.
*                            the field "SUBSCR-DATE-LAST-STATEMENT"
*                            is not used; INSTEAD, THE FIELD
*                            "CLMHDR-REFERENCE" is used.  all the
*                            unnecessary codes are being commented
*                            instead of deleting them.
*
*           mar 12/85 (iw) - added a move of clmhdr-orig-batch-nbr-3 to the
*                            wk-batch-nbr-3 so it is not null.
*
*   revised nov 05/85 (ms) - print patient id instead of ikey.
*                            lookup on pat-mstr since claims master
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   2
*                      r070a.cbl
*                            no longer stores the patient id.
*
*   revised dec 10/85 (ms) - pdr 294
*                          - print error message if there is a
*                            blank ikey in the claims mstr
*
*   revised dec 20/85 (ms) - pdr 296
*                          - print error on the error report if the
*                            claim header contains the blank ikey
*
*   revised may 27/87 (sb) - coversion from aos to aos/vs.
*                            change field size for
*                            status clause to 2 and
*                            feedback clause to 4.
*
*   revised march/89 : - sms 115 s.f.
*                      - make sure file status is pic xx ,feedback is
*                        pic x(4) and infos status is pic x(11).
*
*   revised march/91 : - sms 138  (b.m.l.)
*                      - print health number in place of ohip if it
*                        is not blank.
*
*   revised july/93  : - sra 076  (y.b.)
*                      - change purge amount to .85
*
*   revised feb/98 j. chau  : - s149 unix conversion
*
*  1999/jan/31 B.E.    - y2k
*
*  1999/Nov/24 M.C.    - y2k
*                      - convert changes into copybook, "r070a_ab1.rtn"
*                                 copybook is added
*
*  2001/Sep/25 M.C.    - According to Thelka, balance due should be calculated
*                        based on ohip fee and amount paid for all agents
*  2003/dec/10 M.C.     - alpha doc nbr
*  2004/jun/04 b.e.     - correct alpha doctor number "add to claim number" to
*                         consider adding to alpha number

environment division.
input-output section.
file-control.

    copy "f002_claims_mstr.slr".
    select claims-mstr
*tobefixed* brad no unique key for this file !!!!!
*               two record keys
*       assign index to "f002_claims_mstr"
*       assign data  to "f002_claims_mstr"

        assign to disk "$pb_data/f002_claims_mstr"

        organization is indexed
        access mode  is dynamic
*mf     (added lock mode so that files aren't open exclusively)
        lock mode is manual

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   3
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
*       record key   is key-claims-mstr     length is 18
        record key   is key-claims-mstr
          with duplicates

*tobefixed*             with  duplicates occurrence is claims-occur
*mf     record key   is key-gen-claims-mstr length is  2
*mf     alternate record key   is key-gen-claims-mstr
        alternate record key   is clmdtl-p-claims-mstr
           with duplicates

        status       is status-cobol-claims-mstr.
*
*
*mf    copy "f002_clm_mstr_p_access.slr".
*
    copy "f010_new_patient_mstr.slr".
*   (2002/jun/26 B.E. added chart nbrs 2-5)

    select pat-mstr
        assign to disk "$pb_data/f010_pat_mstr"
        organization is indexed
        access mode  is dynamic
        lock mode is manual

        record    key is key-pat-mstr    of pat-mstr
        alternate key is pat-health-nbr  of pat-mstr with duplicates
        alternate key is pat-acronym     of pat-mstr with duplicates
        alternate key is pat-ohip-mmyy   of pat-mstr with duplicates
        alternate key is pat-chart-nbr   of pat-mstr with duplicates
        alternate key is pat-chart-nbr-2 of pat-mstr with duplicates
        alternate key is pat-chart-nbr-3 of pat-mstr with duplicates
        alternate key is pat-chart-nbr-4 of pat-mstr with duplicates
        alternate key is pat-chart-nbr-5 of pat-mstr with duplicates
        alternate key is pat-full-name   of pat-mstr with duplicates

        status       is status-cobol-pat-mstr.
*
*
*   copy "f011_new_subscriber_mstr.slr".
*
    copy "f090_constants_mstr.slr".
select iconst-mstr
assign to disk "$pb_data/f090_constants_mstr"
organization is indexed
access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
lock mode is manual
record key   is iconst-clinic-nbr-1-2
*       eof-flag     is eof-iconst-mstr
status is status-cobol-iconst-mstr.
*
    copy "r070_claims_work_mstr.sls".
    select claims-work-mstr
          assign to work-file-name
          organization sequential
          status       is status-cobol-work-mstr.
*         infos status is status-work-mstr.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   4
*                      r070a.cbl                                     )
*
    copy "r070_param_file.sls".
    select param-file
          assign to par-file-name
          organization sequential
          status       is status-cobol-param-file.
*         infos status is status-param-file.

*
    select print-file
        assign to printer prt-file-name
        file status is status-prt-file.

data division.
file section.

    copy "f002_claims_mstr.fd".
* 99/jan/15 B.E  - y2k
* 01/nov/06 B.E. - added clmrec-hdr-payroll as redefine of clmrec-hosp
* 03/aug/21 M.C. - increase the file size by 8 characters
* 03/oct/20 b.e. - alpha doctor nbr
* 04/jun/02 b.e. - added field clmdtl-b-batch-number-numeric

fd  claims-mstr
*            block  contains       224 characters
*            record contains       224 characters .
*!             block  contains       232 characters
*!             record contains       232 characters .
             block  contains       228 characters
             record contains       228 characters .
*       feedback is feedback-claims-mstr.


* insert this warning message from "F000_DUPLICATE_FD_WARNING.FD

*----------------  note -----------------------
*-- any changes to this fd must also be made  --
*-- to the corresponding "..._D001_..." fd    --
*-- and vice versa                            --
*----------------  note -----------------------
01  claims-mstr-rec.

  05  claims-mstr-hdr-rec.

    10  clmrec-hdr-clinic-nbr-1-2               pic 99.
*!    10  filler                                  pic x(09).
    10  filler                                  pic x(08).
    10  clmrec-zeroed-oma-suff-adj              pic x(06).
    10  clmrec-zeroed-area redefines clmrec-zeroed-oma-suff-adj
                                                pic 9(06).
    10  clmrec-hdr-batch-type                   pic x.
    10  filler                                  pic x(15).
    10  clmrec-hdr-diag-cd                      pic 9(3).
    10  clmrec-hdr-loc                          pic x(4).

    10  clmrec-hdr-hosp                         pic x.
    10  clmrec-hdr-payroll redefines clmrec-hdr-hosp pic x.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   5
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
    10  clmrec-hdr-agent-cd                     pic 9.
    10  filler                                  pic x(2).
    10  clmrec-hdr-i-o-pat-ind                  pic x.
    10  clmrec-hdr-ohip-id-or-chart             pic x(16).
    10  clmrec-hdr-pat-acronym                  pic x(9).
* reference x(11) + date admit 9(8)
    10  filler                                  pic x(19).

    10  clmrec-doc-dept-nbr                     pic 99.

*  (cash payment date 9(8) + curr payment 9(7) + ped 9(8)  + cycle nbr 9(2)
    10  filler                                  pic x(25).

*      (field now refers to clmhdr-date-sys instead of old
*       clmhdr-date-claim, but name remains the same)
    10  clmrec-hdr-date-claim                   pic x(8).
    10  clmrec-hdr-amt-tech-billed              pic s9(4)v99.
    10  clmrec-hdr-amt-tech-paid                pic s9(4)v99.
    10  clmrec-hdr-tot-claim-ar-oma             pic s9(5)v99.
    10  clmrec-hdr-tot-claim-ar-ohip            pic s9(5)v99.
    10  clmrec-hdr-manual-tape-pymnts           pic s9(5)v99.
    10  clmrec-hdr-status-ohip                  pic xx.
*       (review=1,submitdate=8,confidential=1,servdate=8,origbatchid=11)
* 2003/08/21 - MC - 8 chars for 4 new elements (elig-error, elig-status, serv-er
*   10  filler                                  pic x(29).
*!  10  filler                                  pic x(37).
    10  filler                                  pic x(36).
* 2003/08/21 - end

*-------------------
10  k-key-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  clmrec-hdr-b-key-type                        pic x.
    20  clmrec-hdr-b-data.
*!        25  clmrec-hdr-b-batch-num                   pic 9(9).
        25  clmrec-hdr-b-batch-num                   pic x(8).
        25  clmrec-hdr-b-batch-nbr redefines clmrec-hdr-b-batch-num.
            30  clmrec-hdr-b-clinic-nbr-1-2          pic 99.
*!            30  clmrec-hdr-b-doc-nbr                 pic 9(4).
            30  clmrec-hdr-b-doc-nbr                 pic x(3).
            30  clmrec-hdr-b-doc-nbr-r redefines clmrec-hdr-b-doc-nbr.
*!                35  clmrec-hdr-b-doc-nbr-1           pic 9.
*!                35  clmrec-hdr-b-doc-nbr-2-4         pic 999.
                35  clmrec-hdr-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  clmrec-hdr-b-batch-number.
                35  clmrec-hdr-b-week                pic 99.
                35  clmrec-hdr-b-day                 pic 9.
        25  clmrec-hdr-b-claim-nbr                   pic 99.
        25  clmrec-hdr-b-oma-cd                      pic x999.

        25  clmrec-hdr-b-oma-suff                    pic x.
        25  clmrec-hdr-b-adj-nbr                     pic x.
    20  clmrec-hdr-b-data-r  redefines  clmrec-hdr-b-data.
        25  clmrec-hdr-b-pat-id                      pic x(15).
*!        25  filler                                   pic xx.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   6
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
        25  filler                                   pic x.

10  k-clmdtl-p-claims-mstr.
    20  clmdtl-p-key-type                        pic x.
    20  clmdtl-p-data.
        25  clmdtl-p-batch-nbr.
            30  clmdtl-p-clinic-nbr-1-2      pic  99.
*!            30  clmdtl-p-doc-nbr             pic 9(4).
            30  clmdtl-p-doc-nbr             pic x(3).
            30  clmdtl-p-week                pic 99.
            30  clmdtl-p-day                 pic 9.
        25  clmdtl-p-claim-nbr               pic 99.
        25  clmdtl-p-oma-cd                  pic x999.
        25  clmdtl-p-oma-suff                pic x.
        25  clmdtl-p-adj-nbr                 pic x.
*-------------------------

01  claims-mstr-dtl-rec.

*!    10  filler                                  pic x(11).
    10  filler                                  pic x(10).
    10  clmrec-dtl-oma-cd                       pic x(4).
    10  filler                                  pic x(5).
    10  clmrec-dtl-agent-cd                     pic  9.
    10  clmrec-dtl-adj-cd                       pic  x.
    10  clmrec-dtl-nbr-serv                     pic 99.
    10  clmrec-dtl-sv-date                      pic x(8).
    10  clmrec-dtl-consec-dates occurs 3 times.
        15  clmrec-dtl-sv-nbr                   pic 9.
        15  filler                              pic xx.
    10  clmrec-dtl-amt-tech-billed              pic s9(4)v99.
    10  clmrec-dtl-fee-oma                      pic s9(5)v99.
    10  clmrec-dtl-fee-ohip                     pic s9(5)v99.
* 2003/08/21 - MC
*   10  filler                                  pic x(127).
*!    10  filler                                  pic x(135).
    10  filler                                  pic x(134).
* 2003/08/21 - end

*mf added below copy to include 'external' key within record.
*mfcopy "f002_key_claims_mstr_mf.ws".
*-------------------
10  key-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  clmdtl-b-key-type                        pic x.
    20  clmdtl-b-data.
*!        25  clmdtl-b-batch-num                   pic 9(9).
        25  clmdtl-b-batch-num                   pic x(8).
        25  clmdtl-b-batch-nbr redefines clmdtl-b-batch-num.
            30  clmdtl-b-clinic-nbr-1-2          pic 99.
*!            30  clmdtl-b-doc-nbr                 pic 9(4).
            30  clmdtl-b-doc-nbr                 pic x(3).
            30  clmdtl-b-doc-nbr-r redefines clmdtl-b-doc-nbr.
*!                35  clmdtl-b-doc-nbr-1           pic 9.
*!                35  clmdtl-b-doc-nbr-2-4         pic 999.
                35  clmdtl-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   7
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
*             rather than the old  week-day combination )
            30  clmdtl-b-batch-number.
                35  clmdtl-b-week                pic 99.
                35  clmdtl-b-day                 pic 9.
            30  clmdtl-b-batch-number-numeric redefines  clmdtl-b-batch-number
                                                pic 9(3).

        25  clmdtl-b-claim-nbr                   pic 99.
        25  clmdtl-b-oma-cd                      pic x999.

        25  clmdtl-b-oma-suff                    pic x.
        25  clmdtl-b-adj-nbr                     pic x.
    20  clmdtl-b-data-r  redefines  clmdtl-b-data.
        25  clmdtl-b-pat-id                      pic x(15).
*!        25  filler                               pic xx.
        25  filler                               pic x.

10  clmdtl-p-claims-mstr.
    20  clmdtl-p-key-type                        pic x.
    20  clmdtl-p-data.
        25  clmdtl-p-batch-nbr.
            30  clmdtl-p-clinic-nbr-1-2      pic  99.
*!            30  clmdtl-p-doc-nbr             pic 9(4).
            30  clmdtl-p-doc-nbr             pic x(3).
            30  clmdtl-p-week                pic 99.
            30  clmdtl-p-day                 pic 9.
        25  clmdtl-p-claim-nbr               pic 99.
        25  clmdtl-p-oma-cd                  pic x999.
        25  clmdtl-p-oma-suff                pic x.
        25  clmdtl-p-adj-nbr                 pic x.
*-------------------------

*
    copy "f002_claims_mstr_rec1_2.ws".
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
*  yy/mm/dd  whom          why
*  --------  ----          ---
*
*  84/12/19  i.warsh       broke down the reference field so that
*                          each individual character could be looked at
*                          for direct bills.
*  90/09/27  b.elliott     added redefine for clmhdr-claim-source-cd
*
*  91/02/13  m. chan       clmhdr-tape-submit-ind is related to manual
*                          review flag.  if 'n' means manual review is
*                          on; ohterwise, if 'y' means manual review is
*                          off
*
*  91/04/17  m. chan       clmhdr-tape-submit-ind is related to claim
*                          status - 's'ubmit, 'r'esubmit or 'h'old
*  98/01/26  m. chan       moved clmhdr-orig-batch-id after clmhdr-reserve-
*                          for-future
*  98/06/02  d. balmer     y2K date change
*  99/jan/21 B.E.  - added clmhdr-date-sys breakdown of -12 and -38 fields.
*  99/jan/25 B.E.  - added clmhdr-date-admit breakdown of -12 and -38 fields.
*  99/jan/25 B.E.  - added clmhdr-payroll redefine of clmhdr-hosp
*  03/aug/21 M.C.  - add 5 new elements to the files
*  03/nov/05 M.C.  - alpha doc nbr
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   8
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
*  04/jul/07 b.e.  - added  clmdtl-orig-doc-number
*                           clmdtl-orig-batch-number
*                           clmdtl-orig-claim-number
*  04/nov/18 M.C. - correct the redefinition of clmdtl-orig-complete-batch-n-r
*                   by including clmdtl-orig-clinic-number
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

* insert this warning message from "f002_duplicate_fd_warning.fd"

*+++++++++++++++W A R N I N G +++++++++++++++
*                                           *
* any changes to this fd must also be made  *
* to the other 3 in the following list:     *
*                                           *
*        "f002_claims_hdr_rec.ws            *
*        "f002_claims_dtl_rec.ws            *
*        "f002_claims_mstr_rec1_2.ws        *
*        "f002_clm_mstr_p_access.ws         *
*                                           *
*+++++++++++++++W A R N I N G +++++++++++++++

*
*       note 1: key for this file is the claim-id which is prefaced by a
*               1 character type field -- 'p' = patient id (i key)
*                                         'b' = batch nbr
*       note 2: - the claim detail data recs are written with valid oma
*                   codes, the detail description recs use an oma code of 'zzzz'
*                   and adjustment detail records use and 'adj-cd' of "1")

01  claim-header-rec.

    05  clmhdr-claim-id.
*!      10  clmhdr-batch-nbr                    pic 9(9).
        10  clmhdr-batch-nbr                    pic x(8).
        10  clmhdr-batch-nbr-r1 redefines clmhdr-batch-nbr.
            15  clmhdr-clinic-nbr-1-2           pic 99.
*!          15  clmhdr-doc-nbr                  pic 9(4).
            15  clmhdr-doc-nbr                  pic x(3).
            15  clmhdr-week                     pic 99.
            15  clmhdr-day                      pic 9.
        10  clmhdr-batch-nbr-r2 redefines clmhdr-batch-nbr.
            15  filler                          pic xx.
*!          15  clmhdr-batch-nbr-3-6            pic 9(4).
            15  clmhdr-batch-nbr-3-6            pic x(3).
            15  clmhdr-batch-nbr-7-9            pic 999.
        10  clmhdr-claim-nbr                    pic 9(2).
        10  clmhdr-zeroed-oma-suff-adj.
            15  clmhdr-adj-oma-cd               pic x999.
            15  clmhdr-adj-oma-suff             pic x.
            15  clmhdr-adj-adj-nbr              pic 9.
        10  clmhdr-zeroed-area redefines clmhdr-zeroed-oma-suff-adj
                                                pic 9(6).
*       (valid batch types are 'c' 'a' 'p')
    05  clmhdr-batch-type                       pic x.
*       ('clmhdr-card-colour' replaced by 'adjust-sub-type' --
    05  clmhdr-adj-cd-sub-type                  pic x.
    05  clmhdr-adj-cd-sub-type-ss redefines clmhdr-adj-cd-sub-type
                                                pic 9.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   9
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
    05  clmhdr-claim-source-cd    redefines clmhdr-adj-cd-sub-type
                                                pic x.
    05  clmhdr-doc-nbr-ohip                     pic 9(6).
    05  clmhdr-doc-spec-cd                      pic 99.
    05  clmhdr-refer-doc-nbr                    pic 9(6).
    05  clmhdr-diag-cd                          pic 999.
    05  clmhdr-loc                              pic x999.

    05  clmhdr-hosp                             pic x.
    05  clmhdr-payroll redefines clmhdr-hosp    pic x.

    05  clmhdr-agent-cd                         pic 9.
    05  clmhdr-adj-cd                           pic x.
    05  clmhdr-tape-submit-ind                  pic x.
    05  clmhdr-i-o-pat-ind                      pic x.
    05  clmhdr-pat-ohip-id-or-chart.
        10  clmhdr-pat-key-type                 pic a.
        10  clmhdr-pat-key-data.
            15  clmhdr-pat-key-ohip             pic x(8).
            15  filler                          pic x(7).
    05  clmhdr-pat-acronym.
        10  clmhdr-pat-acronym6                 pic x(6).
        10  clmhdr-pat-acronym3                 pic x(3).
    05  clmhdr-reference.
        10  clmhdr-ref1                         pic x.
        10  clmhdr-ref2                         pic x.
        10  clmhdr-ref3                         pic x.
        10  clmhdr-ref4                         pic x.
        10  clmhdr-ref5                         pic x.
        10  clmhdr-ref6                         pic x.
        10  clmhdr-ref7                         pic x.
        10  clmhdr-ref8                         pic x.
        10  clmhdr-ref9                         pic x.
* y2k
        10  clmhdr-ref10                        pic x.
        10  clmhdr-ref11                        pic x.
    05  clmhdr-reference-r redefines clmhdr-reference.
        10  clmhdr-ref-date1.
* y2k
*           15  clmhdr-ref-date-yy                      pic 9(2).
            15  clmhdr-ref-date-yy              pic 9(4).
            15  clmhdr-ref-date-mm              pic 9(2).
            15  clmhdr-ref-date-dd              pic 9(2).
        10  clmhdr-ref-inits                    pic x(3).
    05  clmhdr-reference-r1 redefines clmhdr-reference-r.
        10  filler                              pic x.
* y2k
*       10  clmhdr-ref-date2                            pic x(6).
        10  clmhdr-ref-date2                    pic x(8).
        10  filler                              pic x(2).
    05  clmhdr-reference-r2 redefines clmhdr-reference-r1.
        10  filler                              pic x(2).
* y2k
*       10  clmhdr-ref-date3                            pic x(6).
        10  clmhdr-ref-date3                    pic x(8).
        10  filler                              pic x(1).
    05  clmhdr-reference-r3 redefines clmhdr-reference-r2.
        10  filler                              pic x(3).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  10
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
* y2k
*       10  clmhdr-ref-date4                            pic x(6).
        10  clmhdr-ref-date4                    pic x(8).
    05  clmhdr-date-admit.
*           (note - admit-yy must be left alpha-numeric)
* y2k
*       10  clmhdr-date-admit-yy                        pic xx.
        10  clmhdr-date-admit-yy                pic x(4).
        10  clmhdr-date-admit-yy-r redefines
            clmhdr-date-admit-yy.
            15  clmhdr-date-admit-yy-12         pic xx.
            15  clmhdr-date-admit-yy-34         pic xx.
        10  clmhdr-date-admit-mm                pic 99.
        10  clmhdr-date-admit-mm-r redefines clmhdr-date-admit-mm
                                                pic xx.
        10  clmhdr-date-admit-dd                pic 99.
        10  clmhdr-date-admit-dd-r redefines clmhdr-date-admit-dd
                                                pic xx.
    05  clmhdr-date-admit-r redefines clmhdr-date-admit
* y2k                                                pic 9(6).
                                                pic 9(8).
    05  clmhdr-date-admit-r2 redefines clmhdr-date-admit-r.
        10 clmhdr-date-admit-12                 pic 9(2).
        10 clmhdr-date-admit-38                 pic 9(6).
    05  clmhdr-doc-dept                         pic 99.
* y2k    05  clmhdr-date-cash-tape-payment           pic x(6).
    05  clmhdr-date-cash-tape-payment           pic x(8).
    05  clmhdr-date-cash-tape-paymt-r redefines
        clmhdr-date-cash-tape-payment.
        10  clmhdr-date-cash-tape-paymt-12      pic 9(2).
        10  clmhdr-date-cash-tape-paymt-38      pic 9(6).
    05  clmhdr-direct-bills-clm-info  redefines clmhdr-date-cash-tape-payment.
        10  clmhdr-msg-nbr                      pic xx.
        10  clmhdr-reprint-flag                 pic x.
        10  clmhdr-sub-nbr                      pic x.
        10  clmhdr-auto-logout                  pic x.
        10  clmhdr-fee-complex                  pic x.
        10  filler                              pic xx.
    05  clmhdr-curr-payment                     pic s9(5)v99.

    05  clmhdr-date-period-end.
* y2k
*       10  clmhdr-period-end-yy                        pic 99.
        10  clmhdr-period-end-yy                pic 9(4).
        10  clmhdr-period-end-mm                pic 99.
        10  clmhdr-period-end-dd                pic 99.
    05  clmhdr-cycle-nbr                        pic 99.
* y2k
*   05  clmhdr-date-sys                                 pic x(6).
    05  clmhdr-date-sys                         pic x(8).
    05  clmhdr-date-sys-r redefines clmhdr-date-sys.
        10  clmhdr-date-sys-12                  pic 9(2).
        10  clmhdr-date-sys-38                  pic 9(6).
    05  clmhdr-amt-tech-billed                  pic s9(4)v99.
    05  clmhdr-amt-tech-paid                    pic s9(4)v99.
    05  clmhdr-tot-claim-ar-oma                 pic s9(5)v99.
    05  clmhdr-tot-claim-ar-ohip                pic s9(5)v99.
    05  clmhdr-manual-and-tape-paymnts          pic s9(5)v99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  11
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
    05  clmhdr-status-ohip                      pic xx.

    05  clmhdr-manual-review                    pic x.
    05  clmhdr-submit-date.
* y2k
*       10  clmhdr-submit-yy                            pic 99.
        10  clmhdr-submit-yy                    pic 9(4).
        10  clmhdr-submit-mm                    pic 99.
        10  clmhdr-submit-dd                    pic 99.
    05  clmhdr-confidential-flag                pic x.
* y2k
*   05  clmhdr-serv-date                                pic 9(6).
    05  clmhdr-serv-date                        pic 9(8).
*
* (y2k removed)
*           05  clmhdr-reserve-for-future               pic x(6).

* 2003/08/21 - add 4 new items
    05  clmhdr-elig-error                       pic x(3).
    05  clmhdr-elig-status                      pic x.
    05  clmhdr-serv-error                       pic x(3).
    05  clmhdr-serv-status                      pic x.
* 2003/08/21 - end

    05  clmhdr-orig-batch-id.
        10  clmhdr-orig-batch-nbr.
            15  clmhdr-orig-batch-nbr-1-2       pic  99.
*!          15  clmhdr-orig-batch-nbr-3         pic   9.
*!          15  clmhdr-orig-batch-nbr-4-9       pic 9(6).
            15  clmhdr-orig-batch-nbr-4-9       pic x(6).
        10  clmhdr-orig-batch-nbr-next-def      redefines clmhdr-orig-batch-nbr.
            15  filler                          pic  99.
*!          15  filler                          pic   9.
*!          15  clmhdr-orig-batch-nbr-4-6       pic 9(3).
            15  clmhdr-orig-batch-nbr-4-6       pic x(3).
            15  clmhdr-orig-batch-nbr-7-8       pic  99.
            15  clmhdr-orig-batch-nbr-9         pic   9.
        10  clmhdr-orig-claim-nbr               pic  99.
    05  clmhdr-orig-batch-id-r  redefines clmhdr-orig-batch-id.
*!      10  clmhdr-orig-complete-batch-nbr      pic 9(11).
        10  clmhdr-orig-complete-batch-nbr      pic x(10).
*mf moved external keys into data record
*mfcopy "f002_key_claims_mstr_mf.ws" replacing "key-clm-" by "clmhdr-b-".
*-------------------
05  k-clmhdr-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  k-clmhdr-b-key-type                        pic x.
    20  k-clmhdr-b-data.
*!      25  k-clmhdr-b-batch-num                   pic 9(9).
        25  k-clmhdr-b-batch-num                   pic x(8).
        25  k-clmhdr-b-batch-nbr redefines k-clmhdr-b-batch-num.
            30  k-clmhdr-b-clinic-nbr-1-2          pic 99.
*!          30  k-clmhdr-b-doc-nbr                 pic 9(4).
            30  k-clmhdr-b-doc-nbr                 pic x(3).
            30  k-clmhdr-b-doc-nbr-r redefines k-clmhdr-b-doc-nbr.
*!              35  k-clmhdr-b-doc-nbr-1           pic 9.
*!              35  k-clmhdr-b-doc-nbr-2-4         pic 999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  12
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
                35  k-clmhdr-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  k-clmhdr-b-batch-number.
                35  k-clmhdr-b-week                pic 99.
                35  k-clmhdr-b-day                 pic 9.
        25  k-clmhdr-b-claim-nbr                   pic 99.
        25  k-clmhdr-b-oma-cd                      pic x999.
        25  k-clmhdr-b-oma-suff                    pic x.
        25  k-clmhdr-b-adj-nbr                     pic x.
    20  k-clmhdr-b-data-r  redefines  k-clmhdr-b-data.
        25  k-clmhdr-b-pat-id                      pic x(15).
*!      25  filler                                 pic xx.
        25  filler                                 pic x.

*mf10  k-clmhdr-p-claims-mstr.
05  k-clmhdr-p-claims-mstr.
    20  k-clmhdr-p-key-type                        pic x.
    20  k-clmhdr-p-data.
        25  k-clmhdr-p-batch-nbr.
            30  k-clmhdr-p-clinic-nbr-1-2      pic  99.
*!          30  k-clmhdr-p-doc-nbr             pic 9(4).
            30  k-clmhdr-p-doc-nbr             pic x(3).
            30  k-clmhdr-p-week                pic 99.
            30  k-clmhdr-p-day                 pic 9.
        25  k-clmhdr-p-claim-nbr               pic 99.
        25  k-clmhdr-p-oma-cd                  pic x999.
        25  k-clmhdr-p-oma-suff                pic x.
        25  k-clmhdr-p-adj-nbr                 pic x.
*-------------------------

01  claim-detail-rec.

    05  clmdtl-id.
*!      10  clmdtl-batch-nbr                    pic 9(9).
        10  clmdtl-batch-nbr                    pic x(8).
        10  clmdtl-claim-nbr                    pic 9(2).
        10  clmdtl-oma-cd                       pic xxxx.
        10  clmdtl-oma-suff                     pic x.
        10  clmdtl-adj-nbr                      pic 9.

    05  clmdtl-det-rec.
        10  clmdtl-rev-group-cd                 pic xxx.
        10  clmdtl-agent-cd                     pic 9.
        10  clmdtl-adj-cd                       pic x.
        10  clmdtl-nbr-serv                     pic 99.
        10  clmdtl-nbr-serv-r redefines clmdtl-nbr-serv.
            15  clmdtl-adjust-reprint           pic x.
            15  filler                          pic x.
        10  clmdtl-sv-date.
* y2k            15  clmdtl-sv-yy                    pic 99.
            15  clmdtl-sv-yy                    pic 9999.
            15  clmdtl-sv-mm                    pic 99.
            15  clmdtl-sv-dd                    pic 99.

        10  clmdtl-consec-dates.
            15  clmdtl-consecutive-sv-date  occurs 3 times
                                                pic 999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  13
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
        10  clmdtl-consec-dates-r  redefines  clmdtl-consec-dates.
            15  clmdtl-consecutive-dates    occurs 3 times.
                20  clmdtl-sv-nbr               pic  9.
                20  clmdtl-sv-day               pic xx.

        10  clmdtl-amt-tech-billed              pic s9(4)v99.
        10  clmdtl-fee-oma                      pic s9(5)v99.
        10  clmdtl-fee-ohip                     pic s9(5)v99.
* y2k        10  clmdtl-date-period-end              pic x(6).
        10  clmdtl-date-period-end              pic x(8).
        10  clmdtl-cycle-nbr                    pic 999.

        10  clmdtl-diag-cd                      pic 999.
        10  clmdtl-line-no                      pic 99.
* (y2k)
*       10  clmdtl-reserve-for-future                   pic x(8).
* 2003/08/21 - MC
*      10  clmdtl-reserve-for-future           pic x(4).
       10  clmdtl-resubmit-flag                pic x.
       10  clmdtl-reserve-for-future           pic x(3).
* 2003/08/21 - end

    05  clmdtl-desc-rec redefines clmdtl-det-rec.
        10  clmdtl-desc                         pic x(22).
        10  filler                              pic x(42).
*mf
*   05  clmdtl-filler                                   pic x(88).
* 2003/08/21 - MC
*   05  clmdtl-filler                           pic x(96).
    05  clmdtl-filler                           pic x(104).
* 2003/08/21 - end

    05  clmdtl-orig-batch-id.
*!      10  clmdtl-orig-batch-nbr               pic 9(9).
        10  clmdtl-orig-batch-nbr               pic x(8).
        10  clmdtl-orig-batch-nbr-r redefines clmdtl-orig-batch-nbr.
            15  clmdtl-orig-batch-nbr-1-2       pic 99.
*!          15  clmdtl-orig-batch-nbr-3         pic 9.
*!          15  clmdtl-orig-batch-nbr-4-9       pic 9(6).
            15  clmdtl-orig-batch-nbr-4-9       pic x(6).
        10  clmdtl-orig-claim-nbr-in-batch      pic 99.
    05  clmdtl-orig-batch-id-r  redefines clmdtl-orig-batch-id.
*!      10  clmdtl-orig-complete-batch-nbr      pic 9(11).
        10  clmdtl-orig-complete-batch-nbr      pic 9(10).
        10  clmdtl-orig-complete-batch-n-r redefines clmdtl-orig-complete-batch-
* 2004/11/18 - MC - include clinic nbr
            15  clmdtl-orig-clinic-number       pic 99.
* 2004/11/18 - end
            15  clmdtl-orig-doc-number          pic x(3).
            15  clmdtl-orig-batch-number        pic 9(3).
            15  clmdtl-orig-claim-number        pic 9(2).

*mf moved external keys into data record
*mfcopy "f002_key_claims_mstr_mf.ws" replacing "key-clm-" by "clmdtl-b-".
*-------------------
05  k-clmdtl-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  14
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f002)
    20  k-clmdtl-b-key-type                        pic x.
    20  k-clmdtl-b-data.
*!      25  k-clmdtl-b-batch-num                   pic 9(9).
        25  k-clmdtl-b-batch-num                   pic x(8).
        25  k-clmdtl-b-batch-nbr redefines k-clmdtl-b-batch-num.
            30  k-clmdtl-b-clinic-nbr-1-2          pic 99.
*!          30  k-clmdtl-b-doc-nbr                 pic 9(4).
            30  k-clmdtl-b-doc-nbr                 pic x(3).
            30  k-clmdtl-b-doc-nbr-r redefines k-clmdtl-b-doc-nbr.
*!              35  k-clmdtl-b-doc-nbr-1           pic 9.
*!              35  k-clmdtl-b-doc-nbr-2-4         pic 999.
                35  k-clmdtl-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  k-clmdtl-b-batch-number.
                35  k-clmdtl-b-week                pic 99.
                35  k-clmdtl-b-day                 pic 9.
        25  k-clmdtl-b-claim-nbr                   pic 99.
        25  k-clmdtl-b-oma-cd                      pic x999.
        25  k-clmdtl-b-oma-suff                    pic x.
        25  k-clmdtl-b-adj-nbr                     pic x.
    20  k-clmdtl-b-data-r  redefines  k-clmdtl-b-data.
        25  k-clmdtl-b-pat-id                      pic x(15).
*!      25  filler                                 pic xx.
        25  filler                                 pic x.

*mf10  k-clmdtl-p-claims-mstr.
05  k-clmdtl-p-claims-mstr.
    20  k-clmdtl-p-key-type                        pic x.
    20  k-clmdtl-p-data.
        25  k-clmdtl-p-batch-nbr.
            30  k-clmdtl-p-clinic-nbr-1-2      pic  99.
*!          30  k-clmdtl-p-doc-nbr             pic 9(4).
            30  k-clmdtl-p-doc-nbr             pic x(3).
            30  k-clmdtl-p-week                pic 99.
            30  k-clmdtl-p-day                 pic 9.
        25  k-clmdtl-p-claim-nbr               pic 99.
        25  k-clmdtl-p-oma-cd                  pic x999.
        25  k-clmdtl-p-oma-suff                pic x.
        25  k-clmdtl-p-adj-nbr                 pic x.
*-------------------------

*
*mf    copy "f002_clm_mstr_p_access.fd".
*
    copy "f010_patient_mstr.fd".
* file:  f010_patient_mstr.fd
* modification history
* --------------------
* 98/dec/01 D.B.        -y2k
* 99/jan/01 B.E.        - switch expiry date from mmyy to yymm
* 99/Jan/21 M.C.        - change pat-reserve-for-future from 21 to 1, andd
*                         pat-last-mod-by, change size from 330 to 315
* 99/mar/16 B.E.        - added pat-health-nbr-unvalidated,
*                         pat-version-cd-unvalidated, and
*                         pat-ohip-validiation-status for additional 13 bytes
*                         plus increase given name from 12 to 17 and surname
*                         from 15 to 25 characters for an addition 15 bytes for
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  15
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f010)
*                         a total increase in sisze 13+15 = 28 bytes.
* 2000/mar/24 B.E.      - redefined pat-version-cd into 1 and 2 characters.
* 2002/may/10 B.E.      - phone-nbr from 7 to 20
*                       - added 4 addition hospital chart nbrs:
*                               pat-chart-nbr   = MUMC
*                               pat-chart-nbr-2 = CHEDOKE
*                               pat-chart-nbr-3 = HENDERSON
*                               pat-chart-nbr-4 = GENERAL
*                               pat-chart-nbr-5 = ST JOES
*                       - changed subscr-addr, subscr-addr-unvalidated and
*                         pat-old-addr elements to:
*                               addr1/2/3 from 21 to 30
*                        - change country from x(20) to x(1)
*                        - added an 'address' prov-cd x(2) as compared to the
*                          health insurance card prov-cd
* 2002/sep/13 B.E.      - postal code from 6 to 10
* 2003/apr/09 M.C.      - substitute pat-reserve-for-future with pat-obec-status
* 2003/nov/24 M.C.      - change pat-last-doc-nbr-seen from 9(6) to x(3)
*
* Note: The following files must be kept in sync:
*               f010_patient_mstr.fd
*               f010_patient_mstr_new.fd
*               f010_patient_mstr.ws


fd  pat-mstr
*          record      contains 343 characters .
*       record      contains 379 characters [+10(addr3) +4(pc) -19(country)]
*       record      contains 394 characters .  [ - 3(last doc seen)]
        record      contains 391 characters .
*       feedback is feedback-pat-mstr.

01 pat-mstr-rec.

    05  pat-acronym.
        10  pat-acronym-first6          pic x(6).
        10  pat-acronym-last3           pic xxx.

    05  pat-ohip-mmyy.
        10  pat-ohip-out-prov.
            15  pat-ohip-nbr            pic 9(8).
            15  pat-mm                  pic 99.
            15  pat-yy                  pic 99.
        10  filler                      pic x(3).
    05  pat-ohip-mmyy-r  redefines pat-ohip-mmyy.
        10  pat-direct-alpha.
            15  pat-alpha1              pic x.
            15  pat-alpha2-3            pic xx.
        10  pat-direct-yy               pic xx.
        10  pat-direct-mm               pic xx.
        10  pat-direct-dd               pic xx.
        10  pat-direct-filler           pic x(6).

*       (MUMC)
    05  pat-chart-nbr.
*        10  pat-chart-m                        pic x.
*        10  pat-chart-yy               pic xx.
*        10  pat-chart-mm               pic xx.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  16
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f010)
*        10  pat-chart-4-5              pic x(5).
*        10  filler                     pic x(5).
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(9).

*       (CHEDOKE)
    05  pat-chart-nbr-2.
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(9).

*       (HENDERSON)
    05  pat-chart-nbr-3.
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(9).
*       (GENERAL)
    05  pat-chart-nbr-4.
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(9).
*       (ST JOES)
    05  pat-chart-nbr-5.
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(10).

    05  pat-full-name.
*          05  pat-surname                              pic x(15).
        10  pat-surname                 pic x(25).
        10  pat-surname-r  redefines  pat-surname.
            15  pat-surname-first6      pic x(6).
* MC        15  pat-surname-last14      pic x(14).
            15  pat-surname-last19      pic x(19).
        10  pat-surname-rr  redefines  pat-surname.
            15  pat-surname-first3      pic x(3).
            15  pat-surname-last22      pic x(22).

*           05  pat-given-name                  pic x(12).
        10  pat-given-name              pic x(17).
        10  pat-given-name-r  redefines  pat-given-name.
            15  pat-given-name-first3   pic xxx.
            15  pat-given-name-last14   pic x(14).
        10  pat-given-name-rr redefines pat-given-name-r.
            15  pat-given-name-first1   pic x.
            15  filler                  pic x(16).

    05  pat-init.
        10  pat-init1                   pic x.
        10  pat-init2                   pic x.
        10  pat-init3                   pic x.
    05  pat-location-field.
        10  pat-location-field-1-3      pic x(3).
        10  filler                      pic x(1).
* 2003/11/24 - MC
*    05  pat-last-doc-nbr-seen          pic 9(6).
    05  pat-last-doc-nbr-seen           pic x(3).
* 2003/11/24 - end

    05  pat-birth-date                  pic 9(8).
    05  pat-birth-date-r  redefines  pat-birth-date.
        10  pat-birth-date-yy           pic 9999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  17
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f010)
        10  pat-birth-date-mm           pic 99.
        10  pat-birth-date-dd           pic 99.
    05  pat-date-last-maint             pic 9(8).
    05  pat-date-last-maint-r redefines pat-date-last-maint.
        10  pat-date-last-maint-yy      pic 9999.
        10  pat-date-last-maint-mm      pic 99.
        10  pat-date-last-maint-dd      pic 99.
    05  pat-date-last-visit             pic 9(8).
    05  pat-date-last-visit-r redefines pat-date-last-visit.
        10  pat-date-last-visit-yy      pic 9999.
        10  pat-date-last-visit-mm      pic 99.
        10  pat-date-last-visit-dd      pic 99.
    05  pat-date-last-admit             pic 9(8).
    05  pat-date-last-admit-r redefines pat-date-last-admit.
        10  pat-date-last-admit-yy      pic 9999.
        10  pat-date-last-admit-mm      pic 99.
        10  pat-date-last-admit-dd      pic 99.
     05  pat-phone-nbr.
        10  pat-phone-nbr-first3        pic 999.
        10  pat-phone-nbr-last4         pic 9(4).
        10  pat-phone-nbr-remainder     pic x(13).

    05  pat-total-nbr-visits            pic 9(5).
    05  pat-total-nbr-claims            pic 9(5).
    05  pat-sex                         pic x.
    05  pat-in-out                      pic x.
    05  pat-nbr-outstanding-claims      pic 9(4).
    05  key-pat-mstr.
        10  pat-i-key                   pic x.
        10  pat-con-nbr                 pic 99.
        10  pat-i-nbr                   pic 9(12).
        10  filler                      pic x.
    05  pat-health-nbr                  pic 9(10).
    05  pat-version-cd.
        10  pat-version-cd-1            pic x.
        10  pat-version-cd-2            pic x.
    05  pat-health-65-ind               pic x.
    05  pat-expiry-date.
        10  pat-expiry-yy               pic 99.
        10  pat-expiry-mm               pic 99.
    05  pat-prov-cd                     pic xx.

*          05  subscr-addr1                     pic x(21).
    05  subscr-addr1                    pic x(30).
*          05  subscr-addr2                     pic x(21).
    05  subscr-addr2                    pic x(30).
*          05  subscr-addr3                     pic x(21).
    05  subscr-addr3                    pic x(30).

    05  subscr-prov-cd                  pic xx.

* 2002/sep/13 B.E.
*    05  subscr-postal-cd               pic x(6).
    05  subscr-postal-cd                pic x(10).
    05  subscr-postal-cd-r  redefines  subscr-postal-cd.
        10  subscr-post-code1.
            15  subscr-post-cd1         pic x.
            15  subscr-post-cd2         pic 9.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  18
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f010)
            15  subscr-post-cd3         pic x.
        10  subscr-post-code2.
            15  subscr-post-cd4         pic 9.
            15  subscr-post-cd5         pic x.
            15  subscr-post-cd6         pic 9.
        10  filler                      pic x(4).

    05  subscr-msg-data.
        10  subscr-msg-nbr              pic xx.
        10  subscr-date-msg-nbr-eff-to          pic 9(8).
        10  subscr-date-msg-nbr-eff-to-r
              redefines subscr-date-msg-nbr-eff-to.
            15  subscr-date-msg-nbr-eff-to-yy   pic 9999.
            15  subscr-date-msg-nbr-eff-to-mm   pic 99.
            15  subscr-date-msg-nbr-eff-to-dd   pic 99.
        10  subscr-date-msg-nbr-eff-to-r1
              redefines subscr-date-msg-nbr-eff-to-r
                                                pic x(8).
        10  subscr-date-last-statement          pic 9(8).
        10  subscr-date-last-statement-r
              redefines subscr-date-last-statement.
            15  subscr-date-last-statement-yy           pic 9999.
            15  subscr-date-last-statement-mm           pic 99.
            15  subscr-date-last-statement-dd           pic 99.
    05  subscr-auto-update                              pic x.
    05  pat-last-mod-by                                 pic x(5).
    05  pat-date-last-elig-mailing                      pic 9(8).
    05  pat-date-last-elig-maint                        pic 9(8).
    05  pat-last-birth-date                             pic 9(8).
    05  pat-last-version-cd                             pic x(2).
    05  pat-mess-code                                   pic x(3).
***    05  pat-country                                     pic x(20).
    05  pat-country                                     pic x(1).
    05  pat-no-of-letter-sent                           pic 99.
    05  pat-dialysis                                    pic x(1).

***    05  pat-health-nbr-unvalidated                      pic 9(10).
***    05  pat-version-cd-unvalidated                      pic xx.
    05  pat-ohip-validiation-status                     pic x.

* 2003/04/09 - MC
*    05  pat-reserve-for-future                         pic x(1).
    05  pat-obec-status                                 pic x(1).
* 2004/04/09 - end
*
    copy "r070_claims_work_mstr.fd".


fd  claims-work-mstr
* y2k        block  contains 108 characters
        block  contains 114 characters
        record contains 114 characters.

01  claims-work-rec.
    05  wk-dept-nbr                             pic 99.
    05  wk-sort-record-status                   pic 9.
    05  wk-agent-cd                             pic 9.
    05  wk-age-category                         pic 9.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  19
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/r070)
    05  wk-pat-acronym                          pic x(9).
    05  wk-pat-id.
        10 wk-pat-id-1                          pic xxx.
        10 wk-pat-id-2                          pic x(12).
    05  wk-pat-id-r redefines wk-pat-id.
        10  wk-ohip-nbr                         pic x(8).
        10  filler                              pic x(7).
    05  wk-pat-hc-r redefines wk-pat-id.
        10  wk-health-nbr                       pic x(10).
        10  filler                              pic x(5).
    05  wk-clm-nbr.
        10 wk-clinic-nbr                        pic 99.
*!        10 wk-doc-nbr                         pic 9(3).
        10 wk-doc-nbr                           pic x(3).
        10 wk-week                              pic 99.
        10 wk-day                               pic 9.
        10  wk-claim-nbr                        pic 99.
    05  wk-ohip-stat.
        10  wk-ohip-stat-1                      pic x.
        10  wk-ohip-stat-2                      pic 9.
    05  wk-sub-nbr                              pic x.
    05  wk-oma-fee                              pic s9(6)v99.
    05  wk-ohip-fee                             pic s9(6)v99.
    05  wk-amount-paid                          pic s9(6)v99.
    05  wk-balance-due                          pic s9(6)v99.
    05  wk-period-end-date.
* y2k        10  wk-period-end-yy                       pic 99.
        10  wk-period-end-yy                    pic 9999.
        10  wk-period-end-mm                    pic 99.
        10  wk-period-end-dd                    pic 99.
    05  wk-ser-date.
* y2k        10  wk-ser-yy                              pic 99.
        10  wk-ser-yy                           pic 9999.
        10  wk-ser-mm                           pic 99.
        10  wk-ser-dd                           pic 99.
    05  wk-day-old                              pic xxx.
    05  wk-batch-nbr-1-2                        pic 99.
*   05  wk-batch-nbr-3                          pic 9.
*!    05  wk-batch-nbr-4-9                      pic 9(6).
    05  wk-batch-nbr-4-9                        pic x(6).
    05  wk-tape-submit-ind                      pic x.
    05  wk-act-taken.
        10 wk-act-taken-1                       pic xxx.
*  Y2K
* 99/11/22 - MC
*       10 wk-act-taken-2                       pic 9(6).
        10 wk-act-taken-2                       pic 9(8).





*
*   copy "f011_subscriber_mstr.fd".
*
    copy "f090_constants_mstr.fd".
* 99/Jan/29     MC      - change iconst-clinic-nbr from numeric to character
* 03/nov/05 b.e. - alpha doctor nbr
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  20
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/f090)

fd  iconst-mstr
*       index block contains   2 characters
              block contains 384 characters
        record      contains 384 characters  .
*       feedback is feedback-iconst-mstr.

01 iconst-mstr-rec.
    05  iconst-clinic-nbr-1-2                   pic   99.
*    05  iconst-clinic-nbr                      pic  9(4).
    05  iconst-clinic-nbr                       pic  x(4).
    05  iconst-clinic-name                      pic x(20).
    05  iconst-clinic-cycle-nbr                 pic   99.
    05  iconst-date-period-end.
* y2k   10  iconst-date-period-end-yy           pic   99.
        10  iconst-date-period-end-yy           pic   9999.
        10  iconst-date-period-end-mm           pic   99.
        10  iconst-date-period-end-dd           pic   99.
    05  iconst-clinic-addr.
        10  iconst-clinic-addr-l1               pic  x(25).
        10  iconst-clinic-addr-l2               pic  x(25).
        10  iconst-clinic-addr-l3               pic  x(25).
    05  iconst-clinic-addr-r redefines iconst-clinic-addr.
        10  iconst-clinic-addr                  pic x(25)   occurs  3  times.
    05  iconst-clinic-card-colour               pic    x.
    05  iconst-clinic-over-lim1                 pic 99v99.
    05  iconst-clinic-under-lim2                pic 99v99.
    05  iconst-clinic-under-lim3                pic 99v99.
    05  iconst-clinic-over-lim4                 pic 99v99.

*!    05  iconst-clinic-batch-nbr                 pic 9(6).
    05  iconst-clinic-batch-nbr                 pic x(6).

    05  iconst-reduction-factor                 pic 99v99.
    05  iconst-overpay-factor                   pic 99v99.
    05  filler                                  pic x(242).
*
    copy "r070_param_file.fd".
*
*
*
fd  param-file
* y2k      block contains  48 characters
           block contains  52 characters
           record contains 52 characters.

01   param-file-rec.
     05  param-clinic-nbr-1-2                   pic 99.
     05  param-clinic-nbr                       pic 9(4).
     05  param-clinic-name                      pic x(20).
* y2k     05  param-date-period-end-yy          pic 99.
     05  param-date-period-end-yy               pic 9999.
     05  param-date-period-end-dd               pic 99.
     05  param-date-period-end-mm               pic x(11).
     05  param-run-date.
* y2k         10  param-date-yy                 pic 99.
         10  param-date-yy                      pic 9999.
         10  param-date-mm                      pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  21
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/r070)
         10  param-date-dd                      pic 99.
     05  filler                                 pic x.
*
*
*
fd  print-file
    record contains 132 characters.

01  print-rec                           pic x(132).

working-storage section.

77  prt-file-name                               pic x(5) value "r070a".

77  pat-occur                                   pic 9(12).
77  claims-pat-access-occur                     pic 9(12).
77  claims-occur                                pic 9(12).

*   status file indicators
*mf 77  common-status-file                      pic x(11).
*mf 77  status-claims-mstr                      pic x(11) value zero.
*mf 77  status-claims-mstr-pat-access           pic x(11) value zero.
*mf 77  status-work-mstr                        pic x(11) value zero.
*mf 77  status-param-file                       pic x(11) value zero.
*mf 77  status-iconst-mstr                      pic x(11) value zero.
*mf 77  status-pat-mstr                         pic x(11) value zero.
* 77  status-subscr-mstr                        pic x(11) value zero.

77  common-status-file                          pic xx.
77  status-cobol-claims-mstr                    pic xx    value zero.
77  status-cobol-work-mstr                      pic xx    value zero.
77  status-cobol-param-file                     pic xx    value zero.
77  status-cobol-iconst-mstr                    pic xx    value zero.
77  status-cobol-pat-mstr                       pic xx    value zero.
77  status-prt-file                             pic xx    value zero.

77  feedback-pat-mstr                           pic x(4).
77  feedback-claims-mstr                        pic x(4).
77  feedback-iconst-mstr                        pic x(4).
*mf 77  feedback-claims-mstr-pat-access         pic x(4).

77  const-mstr-rec-nbr                          pic x.

*   flag indicators
77  err-ind                                     pic 99  value zero.
77  header-done                                 pic x   value "N".
77  totals-written                              pic x   value "N".
77  display-key-type                            pic x(7).
77  ss                                          pic 99  comp.


01  flag-request-complete                       pic x.
    88  flag-request-complete-y                 value "Y".
    88  flag-request-complete-n                 value "N".

01  flag                                        pic x.
    88 ok                                       value "Y".
    88 not-ok                                   value "N".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  22
*                      r070a.cbl                                     )

*   eof flags
77  error-flag                                  pic x   value "N".
77  eof-claims-mstr                             pic x   value "N".
77  end-search-index                            pic x   value "N".
*mf 77  eof-claims-mstr-pat-access              pic x     value "N".

*   variables
77  ss-var-err                                  pic 99  value 14.
77  age-category                                pic 99.
77  mth-old                                     pic s9(5).
77  day-old-r                                   pic xxx.
77  i                                           pic 99.
77  dept-nbr                                    pic 9.
77  request-clinic                              pic 9(4).
77  sel-clinic-nbr                              pic xx.
77  age-yy                                      pic s9(4).
77  age-mm                                      pic s99.
77  age-dd                                      pic s99.
77  ws-reply                                    pic x.
77  ws-date-reply                               pic x.

*   total variables
77  dept-tot-amount                             pic s9(8)v99.
77  balance-due                                 pic s9(6)v99.
77  write-off-nbr-of-clms                       pic 999.

01  blank-line                                  pic x(132) value spaces.

01  audit-line.
     05  filler                                 pic x(10) value spaces.
     05  audit-title                            pic x(60).
     05  filler                                 pic x(10) value spaces.
     05  audit-count                            pic 9(10).
     05  filler                                 pic x(42) value spaces.

*   hold-area.
*!77  hold-batch-nbr                            pic 9(9) value zero.
77  hold-batch-nbr                              pic x(8) value zero.
77  hold-claim-nbr                              pic 9(2) value zero.

01 tmp-doc-nbr-alpha.
*01 tmp-batch-nbr-r redefines tmp-doc-nbr-alpha.
    05 tmp-batch-nbr-index                      pic x(1) occurs 8 times.

01  hold-key.
    05  hold-key-clm-batch-nbr.
        10  hold-key-clinic-nbr1                pic 99.
*!      10  hold-key-doc-nbr                    pic 9(4).
        10  hold-key-doc-nbr                    pic x(3).
        10  hold-key-week                       pic 99.
        10  hold-key-day                        pic 9.
    05  hold-key-claim-nbr                      pic 99.
    05  hold-key-oma-code                       pic x999.
    05  hold-key-oma-suff                       pic x.
    05  hold-key-adj-nbr                        pic x.

01 hold-pat-key.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  23
*                      r070a.cbl                                     )
    05  hold-pat-key-type                       pic a.
    05  hold-pat-key-data                       pic x(15).

01  sel-report-date.
    05  report-yy                               pic 9(4).
    05  filler                                  pic x  value "/".
    05  report-mm                               pic 99.
    05  filler                                  pic x  value "/".
    05  report-dd                               pic 99.

01  save-agent-cd                               pic 9.



*   counters for records read/written for all input/output files
01  counters.
    05  ctr-claims-mstr-reads                   pic 9(7).
    05  ctr-pat-mstr-reads                      pic 9(7).
    05  ctr-claims-mstr-writes                  pic 9(7).
    05  ctr-claims-mstr-del                     pic 9(7).
    05  ctr-claims-mstr-p-access-reads          pic 9(7).
    05  ctr-claims-mstr-p-access-del            pic 9(7).
    05  ctr-claims-work-mstr-writes             pic 9(7).

* copy "F010_KEY_PAT_MSTR.WS".

*mf copy "F002_KEY_CLAIMS_MSTR.WS".

01  work-file-name.
    05  filler                                  pic x(15) value
        "r070_work_mstr_".
    05  work-file-clinic-nbr                    pic x(2).

01  par-file-name.
    05  filler                                  pic x(14) value
        "r070_par_file".

copy "mth_desc_max_days.ws".
*
*       (each position contains:
*               - maximum nbr of days in month
*               - non-abreviated spelling of month
*               - nbr of julian days from jan-01 until last day of month
*       note: table does not take into consideration leap year)
*
01  month-descs-and-max-days-mth.
    05  mth-desc-max-days.
        10  filler                      pic x(14) value '31  JANUARY031'.
        10  filler                      pic x(14) value '29 FEBRUARY059'.
        10  filler                      pic x(14) value '31    MARCH090'.
        10  filler                      pic x(14) value '30    APRIL120'.
        10  filler                      pic x(14) value '31      MAY151'.
        10  filler                      pic x(14) value '30     JUNE181'.
        10  filler                      pic x(14) value '31     JULY212'.
        10  filler                      pic x(14) value '31   AUGUST243'.
        10  filler                      pic x(14) value '30SEPTEMBER273'.
        10  filler                      pic x(14) value '31  OCTOBER304'.
        10  filler                      pic x(14) value '30 NOVEMBER334'.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  24
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/mth_)
        10  filler                      pic x(14) value '31 DECEMBER365'.
    05  mth-desc-max-days-r   redefines mth-desc-max-days.
        10  mth-desc-max-days-occur     occurs  12  times.
            15  max-nbr-days            pic 99.
            15  mth-desc                pic x(9).
            15  nbr-julian-days-ytd     pic 9(3).


copy "sysdatetime.ws".
* 98/dec/01 D.B.        - y2k conversion
* 99/jan/13 B.E.        - changed sys-y1/y2 to y1 thru y4
*                       - added 'default-century-...' and century-date variables

01 century-year                                 pic 9(4).
01 century-date                                 pic 9(8).
01 default-century-cc                           pic 9(2) value 19.
01 default-century-cccc                         pic 9(4) value 1900.

01  sys-date.
* y2k    05  sys-date-long                              pic x(6).
    05  sys-date-long                           pic x(8).
    05  sys-date-long-r  redefines  sys-date-long.
* y2k   10  sys-yy                              pic 99.
        10  sys-yy                              pic 9999.
        10  sys-yy-alpha  redefines  sys-yy.
* y2k       15  sys-y1                          pic 9.
* y2k       15  sys-y2                          pic 9.
            15  sys-y1                          pic 9.
            15  sys-y2                          pic 9.
            15  sys-y3                          pic 9.
            15  sys-y4                          pic 9.
        10  sys-mm                              pic 99.
        10  sys-dd                              pic 99.
* remove after y2k upgrade of dgux
01  sys-date-numeric redefines sys-date         pic 9(8).
01  sys-date-y2kfix  redefines sys-date.
    05 sys-date-left                            pic x(6).
    05 filler                                   pic x(2).
01  sys-date-y2kfixed redefines sys-date.
    05 sys-date-blank                           pic x(2).
    05 sys-date-right                           pic x(6).
01  sys-date-temp                               pic x(8).

01  run-date.
* y2k    05  run-yy                                     pic 99.
    05  run-yy                                  pic 9999.
    05  filler                                  pic x   value "/".
    05  run-mm                                  pic 99.
    05  filler                                  pic x   value "/".
    05  run-dd                                  pic 99.

01  sys-time.
    05  sys-hrs                                 pic 99.
    05  sys-min                                 pic 99.
    05  sys-sec                                 pic 99.
    05  sys-hdr                                 pic 99.

01  run-time.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  25
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/sysd)
    05  run-hrs                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-min                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-sec                                 pic 99.

01  key-claims-mstr-pat-access.
    05  key-clm-pat-access-type                 pic a.
    05  key-clm-pat-access-data.
        10  key-clm-pat-access-pat-id           pic x(15).
        10  filler                              pic xx.

01  key-gen-claims-mstr-pat-access.
    05  key-gen-clm-pat-access                  pic a.
    05  key-gen-clm-pat-access-data             pic x(17).


01  h1-head.

    05  filler                                  pic x(50) value spaces.
    05  filler                                  pic x(82) value
                                "ERROR REPORT FOR R070A".


01  h2-head.

    05  filler                                  pic x(20) value spaces.
    05  filler                                  pic x(22) value
                                "CLAIMS NBR".
    05  filler                                  pic x(90) value
                                "ACRONYM".


01  d1-line.

    05  filler                                  pic x(20) value spaces.
*!    05  d1-batch-nbr                          pic 9(9).
    05  d1-batch-nbr                            pic x(8).
    05  d1-claim-nbr                            pic 9(2).
    05  filler                                  pic x(11) value spaces.
    05  d1-acronym                              pic x(9).
    05  filler                                  pic x(81) value spaces.

01  error-message-table.

    05  error-messages.
        10  filler                              pic x(60)   value
                        "INVALID REPLY".
        10  filler                              pic x(60)   value
        "NO CLAIMS MASTER SUPPLIED OR NO CLAIMS FOR THIS CLINIC".
        10  filler                              pic x(60)   value
                        "INVALID DEPARTMENT NUMBER     ".
        10  filler                              pic x(60)   value
                        "PATIENT INDEX NOT FOUND NO DELETE".
        10  filler                              pic x(60)   value
                        "INVALID READS ON DOCTOR MASTER".
        10  filler                              pic x(60)       value
                        "INVALID CLINIC IDENTIFIER".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  26
*                      r070a.cbl                                     )
        10  filler                              pic x(40)       value
                        "CLAIM DETAIL MISSING - KEY IS = ".
        10  clm-dtl-err-msg                     pic x(20) value spaces.
        10  filler                              pic x(60)   value
                        "INVALID KEY FOUND - WHEN DELETING FROM CLAIMS-MSTR".
        10  filler                              pic x(60)    value
                        "INVALID READ ON PATIENT MASTER".
        10  filler                              pic x(40)    value
                        "INVALID REWRITE TO PAT MAST KEY IS ".
        10  pat-key-err-msg                     pic x(20) value spaces.
        10  filler                              pic x(40)       value
                        "INVALID P-KEY READ ON CLM MSTR KEY IS ".
        10  clm-hdr-err-msg                     pic x(20) value spaces.
        10  filler                              pic x(60)       value
                        "INVALID DELETE ON CLAIMS MSTR USING P-KEY".
        10  filler                              pic x(60)       value
                        "WRONG RECORD ACCESSED USING P-KEY".
        10  filler                              pic x(60)    value
                "DO NOT DELETE-THIS SLOT USED FOR VARIABLE ERROR INFO".
        10  filler                              pic x(60)    value
                "BLANK IKEY IN CLAIMS MSTR".

    05  error-messages-r redefines error-messages.
        10  err-msg                             pic x(60)
                        occurs 15 times.

01  err-msg-comment                             pic x(60).


01  e1-error-line.

    05  e1-error-word                           pic x(13)    value
                        "***  ERROR - ".
    05  e1-error-msg                            pic x(119).
procedure division.
declaratives.

err-constants-mstr-file section.
    use after standard error procedure on iconst-mstr.
err-constants-mstr.
    stop "ERROR IN ACCESSING ICONSTANTS MASTER".
*mf    move status-iconst-mstr                  to common-status-file.
    move status-cobol-iconst-mstr               to common-status-file.
*   display file-status-display.
    display common-status-file.
    stop run.

* err-subscr-mstr-file section.
*   use after standard error procedure on subscr-mstr.
* err-subscr-mstr.
*   stop "ERROR IN ACCESSING SUBSCRIBER MASTER".
*   move status-subscr-mstr                     to common-status-file.
*   display file-status-display.
*   stop run.

err-claim-header-mstr-file section.
    use after standard error procedure on claims-mstr.
err-claims-mstr.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  27
*                      r070a.cbl                                     )
    stop "ERROR IN ACCESSING CLAIMS MASTER".
*mf    move status-claims-mstr                  to common-status-file.
    move status-cobol-claims-mstr               to common-status-file.
*   display file-status-display.
    display common-status-file.
    stop run.

  err-pat-mstr-file section.
    use after standard error procedure on pat-mstr.
   err-pat-mstr.
*   if key-pat-key-type = 'A'
*   then
*       move 'ACRONYM'                          to display-key-type
*   else
*       if key-pat-key-type = 'O'
*       then
*           move 'OHIP'                         to display-key-type
*       else
*           if key-pat-key-type = 'C'
*           then
*               move 'CHART'                    to display-key-type
*           else
*               move 'UNKNOWN'                  to display-key-type.
*           endif
*       endif
*   endif

*mf    move status-pat-mstr                     to common-status-file.
    move status-cobol-pat-mstr                  to common-status-file.
*   display file-pat-status-display.
    display common-status-file.
    stop " ".
    stop run.

*mf err-claims-mstr-pat-access-file section.
*mf    use after standard error procedure on claims-mstr-pat-access.

*mf err-claims-mstr-pat-access.
*mf    move status-claims-mstr-pat-access       to      common-status-file.
*   display file-status-display.
*mf    display common-status-file.
*mf    stop "ERROR IN ACCESSING CLAIMS MSTR PAT ACCESS".

err-work-mstr-file section.
    use after standard error procedure on claims-work-mstr.

err-work-mstr.
*mf    move status-work-mstr            to      common-status-file.
    move status-cobol-work-mstr         to      common-status-file.
*   display file-status-display.
    display common-status-file.
    stop "ERROR IN ACCESSING WORK MSTR".

err-parameter-file section.
    use after standard error procedure on param-file.

err-param-file.
*mf    move status-param-file           to      common-status-file.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  28
*                      r070a.cbl                                     )
    move status-cobol-param-file        to      common-status-file.
*   display file-status-display.
    display common-status-file.
    stop "ERROR IN ACCESSING PARAM FILE".

end declaratives.


mainline section.

    perform aa0-initialization                  thru aa0-99-exit.
    perform ab1-wk-file-creation                thru ab1-99-exit.
    perform az0-finalization                    thru az0-99-exit.
    stop run.
aa0-initialization.

    accept sys-date                             from date.
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.

    open input  claims-mstr
*mf             claims-mstr-pat-access
                pat-mstr
                iconst-mstr.
*               subscr-mstr.


    move spaces                         to      day-old-r.
    move zeros                          to         balance-due
                                                   hold-key
                                                   save-agent-cd
                                                   age-category
                                                   mth-old
                                                   age-yy
                                                   age-mm
                                                   age-dd
                                                   counters.

*    (display screen title)
*   display scr-title.

aa0-10-enter-clinic-nbr.

*   accept scr-clinic-nbr.
    accept sel-clinic-nbr.

    if  sel-clinic-nbr = "**"
    then
        move  0                         to iconst-clinic-nbr-1-2
    else
        move sel-clinic-nbr             to iconst-clinic-nbr-1-2.
*   endif

    read iconst-mstr
        invalid key
                move 6                          to err-ind
                perform za0-common-error        thru za0-99-exit
                go to aa0-10-enter-clinic-nbr.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  29
*                      r070a.cbl                                     )
*   display msg-month.

*   display scr-accept-date.

aa0-11.

*   accept date-reply.
    accept ws-date-reply.

*   if  ws-date-reply not = "Y"
*   then
*       accept scr-year
*       accept scr-month
*       accept scr-day
*       go to aa0-11.
*   (else)
*   endif

*   display msg-continue.

*   accept reply.
    accept ws-reply.

    if  ws-reply not = "Y"
    then
        go to az0-finalization
    else
*       display program-in-progress.
*  (endif)

    move sel-clinic-nbr                 to      work-file-clinic-nbr.
*    expunge param-file.
*    expunge claims-work-mstr.
*    expunge print-file.

    open output param-file
                print-file
                claims-work-mstr.

    move spaces                         to      param-file-rec.
    move sel-clinic-nbr                 to      param-clinic-nbr-1-2.
    move sys-date-long                  to      param-run-date.
    move iconst-date-period-end-yy      to  param-date-period-end-yy.
    move iconst-date-period-end-dd      to  param-date-period-end-dd.
    move mth-desc (iconst-date-period-end-mm)   to
                                            param-date-period-end-mm.
    move iconst-clinic-name             to  param-clinic-name.
    move iconst-clinic-nbr              to      param-clinic-nbr.
    write param-file-rec.

aa0-20-read-claims-mstr.

*mf    move "B"                         to key-clm-key-type.
*mf    move zero                        to key-clm-data.
*mf    move sel-clinic-nbr              to key-clm-clinic-nbr-1-2.

    move zero                           to clmdtl-b-data.
    move "B"                            to clmdtl-b-key-type.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  30
*                      r070a.cbl                                     )
    move sel-clinic-nbr                 to clmdtl-b-clinic-nbr-1-2.

    perform cb0-read-select-claim-apprx thru    cb0-99-exit.

    if eof-claims-mstr = "Y"
    then
        move 2                          to      err-ind
        perform za0-common-error        thru    za0-99-exit
        go to az0-finalization.
*   (else)
*   endif

    move clmhdr-agent-cd                to save-agent-cd.

    write print-rec from h1-head after advancing page.

    write print-rec from h2-head after advancing 3 lines.

aa0-99-exit.
    exit.
ab1-wk-file-creation.

    if clmhdr-agent-cd not = save-agent-cd
    then
        move clmhdr-agent-cd                    to save-agent-cd.
*   (else)
*   endif

*       (note - 'PAYMENTS' field is stored as negative amt so
*               amt owing = original bal - payments
*               can be calculated by *adding* payment field

*       (if    agent = 'OHIP'
*          or agent not = 'OHIP' but claim was one that was converted from old s
*       then   use 'OHIP' amt as value of claims rather than 'OMA' amt)

** 2001/09/25 - MC - determine balance due based on ohip feee regardless of agen

**  if clmhdr-agent-cd = "0"    or
**     clmhdr-date-sys = "19800730"
**  then
        add clmhdr-manual-and-tape-paymnts, clmhdr-tot-claim-ar-ohip
                                                giving balance-due.
**  else
**      add clmhdr-manual-and-tape-paymnts, clmhdr-tot-claim-ar-oma
**                              giving balance-due.
*   endif

** 2001/09/25 - end

*************************
*
* 99/11/24 - MC
*
    copy "r070a_ab1.rtn".

*       (if balance due is with -.85 and .85 then claim is deleted from
*        claims file and noted in report)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  31
*                      r070a.cbl (/alpha/rmabill/rmabill101c/use/r070)

    if  balance-due = 0.00
    then
        perform da6-save-clmhdr-info            thru da6-99-exit
        perform cb3-add-to-claim-nbr            thru cb3-99-exit
        perform cb0-read-select-claim-apprx     thru cb0-99-exit
    else
        if  balance-due < .86 and balance-due > -.86
        then
            perform da6-save-clmhdr-info        thru da6-99-exit
            move "9"                            to wk-sort-record-status
            perform ca1-calculate-age-category  thru ca1-99-exit
            perform wa0-write-to-wk-file        thru wa0-99-exit
            perform cb3-add-to-claim-nbr        thru cb3-99-exit
            perform cb0-read-select-claim-apprx thru cb0-99-exit
        else
            move "0"                            to wk-sort-record-status
            perform ca1-calculate-age-category  thru ca1-99-exit
            perform wa0-write-to-wk-file        thru wa0-99-exit
            perform cb3-add-to-claim-nbr        thru cb3-99-exit
            perform cb0-read-select-claim-apprx thru cb0-99-exit.
*       endif
*   endif




*************************

    if eof-claims-mstr not = "Y"
    then
        go to ab1-wk-file-creation.
*   (else)
*   endif

ab1-99-exit.
    exit.
az0-finalization.

    close claims-mstr
          iconst-mstr
          pat-mstr
*         subscr-mstr
*mf       claims-mstr-pat-access
          param-file
          print-file
          claims-work-mstr.

    accept sys-time                             from time.
*   display scr-closing-screen.
*   display confirm.

*   call program "MENU".

    stop run.

az0-99-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  32
*                      r070a.cbl                                     )
ca1-calculate-age-category.

    compute age-yy rounded = iconst-date-period-end-yy - clmhdr-period-end-yy.
    compute age-mm rounded = iconst-date-period-end-mm - clmhdr-period-end-mm.
**    compute age-dd rounded = iconst-date-period-end-dd - clmhdr-period-end-dd.

    compute mth-old rounded = (age-yy * 12) + age-mm.

    if  mth-old < 0
    then
        move 0 to mth-old.
*   (else)
*   endif

    if  mth-old < 1
    then
        move 0                          to age-category
        move "CUR"                      to day-old-r
    else
        if  mth-old < 2
        then
            move 1                      to age-category
            move "30"                   to day-old-r
        else
            if  mth-old < 3
            then
                move 2                  to age-category
                move "60"               to day-old-r
            else
                if  mth-old < 4
                then
                    move 3              to age-category
                    move "90"           to day-old-r
                else
                    if mth-old < 5
                    then
                        move 4          to age-category
                        move "120"      to day-old-r
                    else
                        if mth-old < 6
                        then
                            move 5      to age-category
                            move "150"  to day-old-r
                        else
                            move 6      to age-category
                            move "180"  to day-old-r.
*                       endif
*                   endif
*               endif
*           endif
*       endif
*   endif

ca1-99-exit.
    exit.
cb0-read-select-claim-apprx.

    move zero                           to      feedback-claims-mstr
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  33
*                      r070a.cbl                                     )
                                                claims-occur.

*mf    read claims-mstr  key is key-claims-mstr approximate
*mf      invalid key
*mf          move "Y"                   to      eof-claims-mstr
*mf        go to cb0-99-exit.

    start claims-mstr  key is greater than or equal to key-claims-mstr
      invalid key
          move "Y"                      to      eof-claims-mstr
          go to cb0-99-exit.

    read claims-mstr next.

    if   status-cobol-claims-mstr = 23
      or
         status-cobol-claims-mstr = 99
    then
        move "Y"                        to      eof-claims-mstr
        go to cb0-99-exit
    else
        if status-cobol-claims-mstr = 10
        then
            move "Y"                    to      eof-claims-mstr
            go to cb0-99-exit
        else
            move "N"                    to      eof-claims-mstr.
*       endif
*   endif

*mf    retrieve claims-mstr key fix position
*mf    into key-claims-mstr.

    if eof-claims-mstr = "Y"
    then
        go to cb0-99-exit
    else
        next sentence.
*   endif

*brad
*  display test-key-display.
*  display key-claims-mstr.
*  if  clmdtl-b-doc-nbr = "029" and clmdtl-b-claim-nbr = 99 then
*       next sentence.
* endif

*       (check for end of 'B'atch type keys)
    if   ( sel-clinic-nbr  not = clmhdr-clinic-nbr-1-2 )
*mf      or ( key-clm-key-type not = 'B' )
      or ( clmdtl-b-key-type not = 'B' )
    then
        move "Y"                        to      eof-claims-mstr
        go to cb0-99-exit.
*   (else)
*   endif


* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  34
*                      r070a.cbl                                     )

*       (only 'C'laim batch type claim header records are to be processed --
*           --   'C' type 'P'ayments (p/c)
*              and 'A' and 'B' type 'A'djustments (a/a and a/b)
*                 adjust existing claims and their adjustment is reflected
*                 in the adjusted claim'S CLMHDR-REC. THEREFORE THE
*                 adjustment'S CLMHDR-REC CAN BE IGNORED.
*           --   'R' and 'M' types adjust 'REVENUE' only and do not adjust
*                the accounts receivable -- thus their clmhdr recs are ignored a

    if clmhdr-batch-type not = "C"
    then
        perform cb3-add-to-claim-nbr    thru    cb3-99-exit
        go to cb0-read-select-claim-apprx.
*   (else)
*   endif

    add 1                               to      ctr-claims-mstr-reads.


cb0-99-exit.
    exit.
cb2-read-claim-next-for-index.

    move zero                           to      feedback-claims-mstr
                                                claims-occur.

*mf    read claims-mstr-pat-access next
*mf        at end
*mf            move "Y" to end-search-index.

*mf    if       hold-pat-key-data not = pat-access-pat-key-data
*mf    then
*mf        move "Y" to end-search-index.
*  (else)
*       endif

    read claims-mstr key is clmdtl-p-claims-mstr
        invalid key
            move "Y" to end-search-index.

    if  hold-pat-key-data not = clmdtl-p-data of k-clmdtl-p-claims-mstr
    then
        move "Y" to end-search-index.

*mf    retrieve claims-mstr-pat-access key fix position
*mf    into key-claims-mstr-pat-access.


cb2-99-exit.
    exit.
cb3-add-to-claim-nbr.

*mf    if  key-clm-claim-nbr = 99
    if  clmdtl-b-claim-nbr = 99
    then
*mf     move zeros                      to key-clm-claim-nbr
        move zeros                      to clmdtl-b-claim-nbr
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  35
*                      r070a.cbl                                     )
*mf     add 1                           to key-clm-batch-num

* b.e. 2004/jun/01 fix bug
*!      add 1                           to clmdtl-b-batch-num
***     add 1                           to clmdtl-b-day
*       add 1                           to clmdtl-b-batch-number-numeric
        perform xx0-increment-batch-nbr thru    xx0-99-exit

*mf     move spaces                     to key-clm-adj-nbr
        move spaces                     to clmdtl-b-adj-nbr
    else
*mf     add 1                           to key-clm-claim-nbr
        add 1                           to clmdtl-b-claim-nbr

*mf     move spaces                     to key-clm-adj-nbr.
        move spaces                     to clmdtl-b-adj-nbr.

* 99/11/25 - MC - initialize oma-cd-suff

        move spaces                     to clmdtl-b-oma-cd
                                           clmdtl-b-oma-suff.
*  (endif)

cb3-99-exit.
    exit.

xx0-increment-batch-nbr.
*0 - 9 A - Z
    move "N"                            to      flag-request-complete.

    if clmdtl-b-batch-number = 999
    then
        move clmdtl-b-doc-nbr           to      tmp-doc-nbr-alpha
        display "BEFORE: " clmdtl-b-doc-nbr
        perform xx1-process-1-doc-position  thru xx1-99-exit
            varying   ss from 3 by -1
            until     ss = 0
               or      flag-request-complete-y
        move tmp-doc-nbr-alpha          to      clmdtl-b-doc-nbr
        display "AFTER : " clmdtl-b-doc-nbr
        display " "
        move 000                        to      clmdtl-b-batch-number
    else
        add 1                           to      clmdtl-b-batch-number-numeric.
*   endif


xx0-99-exit.
   exit.

xx1-process-1-doc-position.
*if pos(1) = 0 then 1 , if 1 then 2 if 9 then A, if A then B if Z then 0 and!

    if tmp-batch-nbr-index(ss) = "0"
    then
        move "1"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  36
*                      r070a.cbl                                     )
    if tmp-batch-nbr-index(ss) = "1"
    then
        move "2"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "2"
    then
        move "3"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "3"
    then
        move "4"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "4"
    then
        move "5"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "5"
    then
        move "6"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "6"
    then
        move "7"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "7"
    then
        move "8"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "8"
    then
        move "9"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "9"
    then
        move "A"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "A"
    then
        move "B"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "B"
    then
        move "C"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "C"
    then
        move "D"                        to      tmp-batch-nbr-index(ss)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  37
*                      r070a.cbl                                     )
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "D"
    then
        move "E"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "E"
    then
        move "F"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "F"
    then
        move "G"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "G"
    then
        move "H"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "H"
    then
        move "I"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "I"
    then
        move "J"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "J"
    then
        move "K"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "K"
    then
        move "L"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "L"
    then
        move "M"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "M"
    then
        move "N"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "N"
    then
        move "O"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "O"
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  38
*                      r070a.cbl                                     )
    then
        move "P"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "P"
    then
        move "Q"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "B"
    then
        move "R"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "R"
    then
        move "S"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "S"
    then
        move "T"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "T"
    then
        move "U"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "U"
    then
        move "V"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "V"
    then
        move "W"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "W"
    then
        move "X"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "X"
    then
        move "Y"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "Y"
    then
        move "Z"                        to      tmp-batch-nbr-index(ss)
        go to xx0-90-return
    else
    if tmp-batch-nbr-index(ss) = "Z"
    then
        move "0"                        to      tmp-batch-nbr-index(ss)
        go to xx0-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  39
*                      r070a.cbl                                     )
*   endif

xx0-90-return.
    move "Y"                            to      flag-request-complete.

xx1-99-exit.
    exit.




* da4-update-pat.
da4-read-pat.

*   (check for blank ikey).

    if clmhdr-pat-key-data = spaces
    then

*       (the two lines below are commented on 85/12/20 by m.s. - pdr 296,
*        and replaced by the next four lines (print the error report).)

*       move 15                                 to err-ind
*       perform za0-common-error                thru za0-99-exit
        move clmhdr-batch-nbr                   to d1-batch-nbr
        move clmhdr-claim-nbr                   to d1-claim-nbr
        move clmhdr-pat-acronym                 to d1-acronym
        write print-rec from d1-line after advancing 2 lines

        move "**BLANK IKEY**"                   to pat-ohip-mmyy-r
        go to da4-99-exit.
*   endif

    move clmhdr-pat-ohip-id-or-chart            to key-pat-mstr.

    read pat-mstr
        invalid key
*           move 9                              to err-ind
*           perform za0-common-error            thru za0-99-exit
*           perform err-pat-mstr.
*
*  above three lines are commented and replaced by the following
*  5 lines by mc on 91/jun/20

             move clmhdr-batch-nbr              to d1-batch-nbr
             move clmhdr-claim-nbr              to d1-claim-nbr
             move clmhdr-pat-acronym            to d1-acronym
            write print-rec from d1-line after advancing 2 lines
            move "*** UNKNOWN ***"              to pat-ohip-mmyy-r
            go to da4-99-exit.

*   retrieve pat-mstr key fix position
*       into key-pat-mstr.

    add 1                                       to ctr-pat-mstr-reads.

*   subtract 1                                  from pat-nbr-outstanding-claims.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  40
*                      r070a.cbl                                     )
*   rewrite pat-mstr-rec
*       invalid key
*           move 10                             to err-ind
*           move key-pat-mstr                   to pat-key-err-msg
*           perform za0-common-error            thru za0-99-exit.

da4-99-exit.
    exit.


da6-save-clmhdr-info.

    move clmhdr-batch-nbr               to      hold-batch-nbr.
    move clmhdr-claim-nbr               to      hold-claim-nbr.
    move clmhdr-pat-ohip-id-or-chart    to      hold-pat-key.

da6-99-exit.
    exit.
ma0-move-to-wk-file.

    move clmhdr-doc-dept                        to wk-dept-nbr.
    move age-category                           to wk-age-category.
    move clmhdr-clinic-nbr-1-2                  to wk-clinic-nbr.
    move clmhdr-doc-nbr                         to wk-doc-nbr.
    move clmhdr-week                            to wk-week.
    move clmhdr-day                             to wk-day.
    move clmhdr-claim-nbr                       to wk-claim-nbr.
    move clmhdr-agent-cd                        to wk-agent-cd.
    move clmhdr-pat-acronym                     to wk-pat-acronym.

    move spaces                                 to wk-pat-id.
* the following changed 85/11
*   move clmhdr-pat-key-data                    to wk-pat-id.
    perform da4-read-pat                        thru da4-99-exit.
    if pat-health-nbr not = 0
    then
        move pat-health-nbr                     to wk-health-nbr
    else
        if pat-ohip-mmyy-r not = spaces
        then
            move pat-ohip-mmyy-r                to wk-pat-id
        else
            move pat-chart-nbr                  to wk-pat-id.
*       endif
*   endif

    move clmhdr-status-ohip                     to wk-ohip-stat.
    if clmhdr-agent-cd = 6
    then
        move clmhdr-sub-nbr                     to wk-sub-nbr
    else
        move zero                               to wk-sub-nbr.
    move clmhdr-tot-claim-ar-oma                to wk-oma-fee.
    move clmhdr-tot-claim-ar-ohip               to wk-ohip-fee.
    move clmhdr-manual-and-tape-paymnts         to wk-amount-paid.
    move balance-due                            to wk-balance-due.
    move clmhdr-date-period-end                 to wk-period-end-date.
    move day-old-r                              to wk-day-old.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  41
*                      r070a.cbl                                     )
    move clmhdr-orig-batch-nbr-1-2              to wk-batch-nbr-1-2.
*2003/12/10 - MC
*   move clmhdr-orig-batch-nbr-3                to wk-batch-nbr-3.
*2003/12/10 - end
    move clmhdr-orig-batch-nbr-4-9              to wk-batch-nbr-4-9.
    move clmhdr-tape-submit-ind                 to wk-tape-submit-ind.
*   if (clmhdr-agent-cd = 6) and (clmhdr-auto-logout = "Y")
*   then
*       perform ya0-read-subscr                 thru ya0-99-exit
*       move spaces                             to wk-act-taken
*       move subscr-date-last-statement         to wk-act-taken-2
*   else
*       move clmhdr-reference                   to wk-act-taken.


*
*   (the following statement is added for sms85.2)
*
    move clmhdr-reference                       to wk-act-taken.

*   ( read claim detail to obtain service date ).

*mf    read claims-mstr  retain position next
*       invalid key
    read claims-mstr next
        at end
                move 7 to err-ind
                move key-claims-mstr            to clm-dtl-err-msg
                perform za0-common-error        thru za0-99-exit
                move 0                          to wk-ser-date.

    move clmdtl-sv-date                         to wk-ser-date.

ma0-99-exit.
    exit.
wa0-write-to-wk-file.

    perform ma0-move-to-wk-file                 thru ma0-99-exit.
    write claims-work-rec.

wa0-99-exit.
    exit.


* ya0-read-subscr.

*   move clmhdr-pat-key-data                    to subscr-id.

*   read subscr-mstr
*       invalid key
*               move spaces                     to subscr-date-last-statement.

* ya0-99-exit.
*   exit.
za0-common-error.

    move err-msg (err-ind)              to      err-msg-comment.
*   display err-msg-line.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  42
*                      r070a.cbl                                     )
    display err-msg-comment.
*   display confirm.
*   stop " ".
*   display blank-line-24.

za0-99-exit.
    exit.


    copy "y2k_default_sysdate_century.rtn".
y2k-default-sysdate.

    move sys-date-left                  to sys-date-temp.
    move sys-date-temp                  to sys-date-right.
    move zeros                          to sys-date-blank.
* 1999/dec/30 B.E.
*   add 19000000                        to sys-date-numeric.
    add 20000000                        to sys-date-numeric.

y2k-default-sysdate-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 Compiler
* Copyright (C) 1984-1995 Micro Focus Ltd.     URN 2XUPG/GB0/00000F
*                                              REF GNB-030056000AA
*
* Total Messages:     0
* Data:        5824     Code:        5036
