* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   1
*                      u095.cbl
* Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Accepted - SHOW-DIR
* Accepted - SOURCEFORMAT"FREE"
* Accepted - SPZERO
* Accepted - TIME
* Accepted - TRUNC
* Accepted - RESEQ
* Accepted - SEQCHK
* End Of Directives File: /usr/opt/mfcobol4.0/cobol.dir
identification division.
program-id. u095.
author. dyad computer systems inc.
installation. rma.
date-written. 80/01/31.
date-compiled. 18-May-06 15:42.
security.
*
*    files      : f001   - batch control file
*               : f020 - doctor master
*               : f090   - iconstants master
*               : "r095" - audit report file

*    program purpose : delete the "CLAIMS" batch control records in the
*                      batch control file (f001) for all "CLAIMS" batches that
*                      have been processed into the claims audit
*                      section (ie. their status = '3') whose p.e.d. falls
*                      with range as input by operator.
*                      an audit report is printed of all batches deleted
*                      and with totals by type of batch.
*
*    revised may/87 (s.b.) - coversion from aos to aos/vs.
*                            change field size for
*                            status clause to 2 and
*                            feedback clause to 4.
*
*    revised mar/89 (s.f.) - sms 115
*                          - make sure file status is pic xx ,feedback
*                            is pic x(4) and infos status is pic x(11).
*
*    revised apr/89 (s.f.) - sms 116
*                          - print the dept code and/or name
*
*    revised jun/92 (m.c.) - sms 139
*                          - change the logic to include the new clinic
*                            60'S
*
*    revised may/94 (m.c.) - pdr 592
*                          - change  the logic to include the new clinic
*                            80'S
*    revised apr/97 (yas.) - pdr 656
*                          - change  the logic to include the new clinic
*                            82'S
*    revised aug/97 (yas.) - pdr 664
*                          - change  the logic to include the new clinic
*                            83'S
*
*    revised feb/98 (j. chau) - s149 unix conversion
*    2003/dec/11  M.C.    - alpha doc nbr
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   2
*                      u095.cbl

environment division.
input-output section.
file-control.
*
*   place your file select statements here
*
    copy "f001_batch_control_file.slr".
    select batch-ctrl-file
*       assign index to "f001_batch_control_file"
*       assign data  to "f001_batch_control_file"
        assign to disk "$pb_data/f001_batch_control_file"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual

*       record key   is key-batctrl-file length is 9
        record key   is key-batctrl-file
*tobefixed*     record key   is key-gen-batctrl-file length is 2   S
              status is status-cobol-batctrl-file.
*       infos status is status-batctrl-file.
*       eof-flag     is eof-batctrl-file
*
*
    copy "f090_constants_mstr.slr".
select iconst-mstr
assign to disk "$pb_data/f090_constants_mstr"
organization is indexed
access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
lock mode is manual
record key   is iconst-clinic-nbr-1-2
*       eof-flag     is eof-iconst-mstr
status is status-cobol-iconst-mstr.
*
    copy "f020_doctor_mstr.slr".
    select doc-mstr
*mf     assign index to "f020_doctor_mstr"
*mf     assign data  to "f020_doctor_mstr"
        assign to disk "$pb_data/f020_doctor_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual

        record key   is doc-nbr of doc-mstr-rec

*mf added two  alternative keys below
        alternate key is doc-name-soundex
         with duplicates
        alternate key is doc-ohip-nbr of doc-mstr
         with duplicates
              status  is status-cobol-doc-mstr.
*       infos status  is status-doc-mstr.
*       eof-flag     is eof-doc-mstr
*
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   3
*                      u095.cbl                                      )
    select print-file
        assign to printer print-file-name
        file status is status-prt-file.
*
*
data division.
file section.
*
    copy "f001_batch_control_file.fd".
*  98/aug/01 B.E.      - unix conversion - moved external key to internal keyp
*  98/dec/01 D.B.       - y2k
*  99/Jan/21 M.C.       - move 'adj-cd' and 'adj-cd-sub-type' between
*                         'batch-type' and 'last-claim-nbr' fields
*                       - comment out filler
*  99/Apr/23 M.C.       - change key-batctrl-file from numeric to alpha
*  99/May/27 M.C.       - change batctrl-clinic-nbr numeric to alpha
*  99/nov/18 B.E.       - location changed from x999 to x(4).
*  01/nov/06 B.E.       - added batctrl-payroll as redefine of batctrl-hosp
*  03/oct/20 b.e. - alpha doctor nbr

fd batch-ctrl-file
*!          block  contains 112 characters
*!          record contains 112 characters.
          block  contains 111 characters
          record contains 111 characters.

01  batctrl-rec.

    05  batctrl-batch-nbr.
        10  batctrl-bat-clinic-nbr-1-2          pic 99.
*!      10  batctrl-bat-doc-nbr                 pic 9(4).
        10  batctrl-bat-doc-nbr                 pic x(3).
        10  batctrl-bat-week-day.
            15  batctrl-bat-week                pic 99.
            15  batctrl-bat-day                 pic 9.
        10  batctrl-bat-week-day-r redefines batctrl-bat-week-day
                                                pic 999.
    05  key-batctrl-file-r redefines batctrl-batch-nbr.
*mc     10  key-batctrl-file                    pic 9(9).
* mc - redefined from numeric to alpha so that programs moving
*      alphabetic fields to this field get left justified results
*      rather than right justified results which the numeric
*      definition gives.  For example,  cobol programs doing
*      'read approximates' move "22" to this field and with the
*      numeric definition get "00000022" to read. By changing
*      to alphabetic field, we get "22     " and the read
*      aproximate works the same with this internal key as
*      before when we had  external key.
*!        10  key-batctrl-file                  pic x(9).
        10  key-batctrl-file                    pic x(8).


    05  batctrl-batch-type                      pic x.
    05  batctrl-adj-cd                          pic x.
    05  batctrl-adj-cd-sub-type                 pic x.
    05  batctrl-last-claim-nbr                  pic 99.
    05  batctrl-clinic-nbr.
*       10  batctrl-clinic-nbr-1-2              pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   4
*                      u095.cbl (/alpha/rmabill/rmabill101c/use/f001_)
*       10  batctrl-clinic-nbr-3-4              pic 99.
        10  batctrl-clinic-nbr-1-2              pic xx.
        10  batctrl-clinic-nbr-3-4              pic xx.
    05  batctrl-doc-nbr-ohip                    pic 9(6).

    05  batctrl-hosp                            pic x.
    05  batctrl-payroll redefines batctrl-hosp  pic x.

    05  batctrl-loc.
        10  batctrl-loc1                        pic x.
* 99/nov/19 B.E.
*       10  batctrl-loc2-4                      pic 999.
        10  batctrl-loc2-4                      pic xxx.
    05  batctrl-agent-cd                        pic 9.
*   05  batctrl-adj-cd                          pic x.
    05  batctrl-i-o-pat-ind                     pic x.
*       ('batctrl-date-batch-entered' formerly called 'batctrl-date-claimed-sys'
    05  batctrl-date-batch-entered              pic x(8).
*       ('filler' formerly called 'batctrl-date-sv')
*   05  filler                                  pic x(6).  - use for y2k
    05  batctrl-date-period-end.
        10 batctrl-date-period-end-yy           pic xxxx.
        10 batctrl-date-period-end-mm           pic xx.
        10 batctrl-date-period-end-dd           pic xx.
    05  batctrl-cycle-nbr                       pic 999.
    05  batctrl-amt-est                         pic s9(5)v99.
    05  batctrl-amt-act                         pic s9(5)v99.
    05  batctrl-svc-est                         pic 9(4).
    05  batctrl-svc-act                         pic 9(4).
    05  batctrl-ar-yy-mm                        pic x(6).
    05  batctrl-calc-ar-due                     pic s9(5)v99.
    05  batctrl-calc-tot-rev                    pic s9(5)v99.
    05  batctrl-manual-pay-tot                  pic s9(5)v99.
    05  batctrl-batch-status                    pic x.
    05  batctrl-nbr-claims-in-batch             pic 99.
    05  filler                                  pic x(10).
*--------------------------------------------------------------------
*       the 'adj-cd' field above and 'adj-cd-sub-type' below should
*       be moved between 'batch-type' and 'last-claim-nbr' fields
*--------------------------------------------------------------------
*   05  batctrl-adj-cd-sub-type                 pic x.
*
    copy "f090_constants_mstr.fd".
* 99/Jan/29     MC      - change iconst-clinic-nbr from numeric to character
* 03/nov/05 b.e. - alpha doctor nbr

fd  iconst-mstr
*       index block contains   2 characters
              block contains 384 characters
        record      contains 384 characters  .
*       feedback is feedback-iconst-mstr.

01 iconst-mstr-rec.
    05  iconst-clinic-nbr-1-2                   pic   99.
*    05  iconst-clinic-nbr                      pic  9(4).
    05  iconst-clinic-nbr                       pic  x(4).
    05  iconst-clinic-name                      pic x(20).
    05  iconst-clinic-cycle-nbr                 pic   99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   5
*                      u095.cbl (/alpha/rmabill/rmabill101c/use/f090_)
    05  iconst-date-period-end.
* y2k   10  iconst-date-period-end-yy           pic   99.
        10  iconst-date-period-end-yy           pic   9999.
        10  iconst-date-period-end-mm           pic   99.
        10  iconst-date-period-end-dd           pic   99.
    05  iconst-clinic-addr.
        10  iconst-clinic-addr-l1               pic  x(25).
        10  iconst-clinic-addr-l2               pic  x(25).
        10  iconst-clinic-addr-l3               pic  x(25).
    05  iconst-clinic-addr-r redefines iconst-clinic-addr.
        10  iconst-clinic-addr                  pic x(25)   occurs  3  times.
    05  iconst-clinic-card-colour               pic    x.
    05  iconst-clinic-over-lim1                 pic 99v99.
    05  iconst-clinic-under-lim2                pic 99v99.
    05  iconst-clinic-under-lim3                pic 99v99.
    05  iconst-clinic-over-lim4                 pic 99v99.

*!    05  iconst-clinic-batch-nbr                 pic 9(6).
    05  iconst-clinic-batch-nbr                 pic x(6).

    05  iconst-reduction-factor                 pic 99v99.
    05  iconst-overpay-factor                   pic 99v99.
    05  filler                                  pic x(242).
*
    copy "f020_doctor_mstr.fd".
* sms 137  bml  05-dec-90  increase fields by 2
* sms 139  mc   10-jun-92  add 5 clinic nbr and 2 spec codes in
*                          reserved for nip
*          mc   24-nov-93  include brad's fields of earning subsystem
*          mc   12-feb-94  include doc-ep-pay-code and doc-ep-pay-sub-code
*          db   03-jun-98  Year 2000
*          mc   16-jul-02  add 5 additional batch nbr for each additional
*                          clinic
*          mc   23-sep-02  rename the second occurrence of group-regular-service
*                          to group-over-serviced
*          be   05-nov-03  alpha doctor nbr
*          mc   03-mar-04  reuse filler x(4) for doc-afp-paym-group from filler2
*          be   06-apr-17  - increase to 800 when $1M payroll figures changed th

fd  doc-mstr
*       block  contains 680 characters
*       record contains 680 characters.
*       block  contains 695 characters
*       record contains 695 characters.
        block  contains 800 characters
        record contains 800 characters.

01 doc-mstr-rec.
*    05  doc-nbr                                        pic 9(3).
    05  doc-nbr                                 pic x(3).
    05  doc-dept                                pic 99.
    05  doc-ohip-nbr                            pic 9(6).
    05  doc-pract-nbr redefines doc-ohip-nbr    pic 9(6).
    05  doc-sin-nbr.
        10  doc-sin-123                         pic 999.
        10  doc-sin-456                         pic 999.
        10  doc-sin-789                         pic 999.
    05  doc-clinic-nbr                          pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   6
*                      u095.cbl (/alpha/rmabill/rmabill101c/use/f020_)
    05  doc-spec-cd                             pic 99.
    05  doc-hosp-nbr                            pic x999.
    05  doc-name                                pic x(24).
    05  doc-name-soundex                        pic x(4).

    05  doc-inits.
        10  doc-init1                           pic x.
        10  doc-init2                           pic x.
        10  doc-init3                           pic x.
    05  doc-address-office.
        10  doc-addr-office-1                   pic x(24).
        10  doc-addr-office-2                   pic x(24).
        10  doc-addr-office-3                   pic x(24).
    05  doc-addr-office-r  redefines  doc-address-office.
        10  doc-addr-office  occurs 3 times     pic x(24).
    05  doc-addr-office-pc.
        10  doc-addr-office-pc-123.
            15  doc-addr-office-pc1             pic a.
            15  doc-addr-office-pc2             pic 9.
            15  doc-addr-office-pc3             pic a.
        10  doc-addr-office-pc-456.
            15  doc-addr-office-pc4             pic 9.
            15  doc-addr-office-pc5             pic a.
            15  doc-addr-office-pc6             pic 9.
    05  doc-address-home.
        10  doc-addr-home-1                     pic x(24).
        10  doc-addr-home-2                     pic x(24).
        10  doc-addr-home-3                     pic x(24).
    05  doc-addr-home-r  redefines doc-address-home.
        10  doc-addr-home  occurs 3 times       pic x(24).
    05  doc-addr-home-pc.
        10  doc-addr-home-pc-123.
            15  doc-addr-home-pc1               pic a.
            15  doc-addr-home-pc2               pic 9.
            15  doc-addr-home-pc3               pic a.
        10  doc-addr-home-pc-456.
            15  doc-addr-home-pc4               pic 9.
            15  doc-addr-home-pc5               pic a.
            15  doc-addr-home-pc6               pic 9.
    05  doc-full-part-ind                       pic x.
    05  doc-class-code redefines doc-full-part-ind pic x.
    05  doc-bank-info.
        10  doc-bank-nbr                        pic 9(4).
        10  doc-bank-branch                     pic 9(5).
        10  doc-bank-acct                       pic x(12).
*   05  doc-tax-info.
*       10  doc-billing-percent                 pic 9v99.
*       10  doc-misc-percent                    pic 9v99.
*       10  doc-tax-percent                     pic 9v99.
*       10  doc-billing-percent                 pic 9v9999.
*       10  doc-misc-percent                    pic 9v9999.
*       10  doc-tax-percent                     pic 9v9999.
*       10  doc-pay-code                        pic x.
    05  doc-fac-dates.
        10  doc-date-fac-start.
* y2k       15  doc-date-fac-start-yy           pic 99.
            15  doc-date-fac-start-yy           pic 9999.
            15  doc-date-fac-start-mm           pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   7
*                      u095.cbl (/alpha/rmabill/rmabill101c/use/f020_)
            15  doc-date-fac-start-dd           pic 99.
        10  doc-date-fac-term.
* y2k       15  doc-date-fac-term-yy            pic 99.
            15  doc-date-fac-term-yy            pic 9999.
            15  doc-date-fac-term-mm            pic 99.
            15  doc-date-fac-term-dd            pic 99.
    05    doc-fac-dates-r redefines doc-fac-dates.
        10  doc-date-fac occurs 2 times.
* y2k       15  doc-date-fac-yy                 pic 99.
            15  doc-date-fac-yy                 pic 9999.
            15  doc-date-fac-mm                 pic 99.
            15  doc-date-fac-dd                 pic 99.
    05  doc-annual-ceiling-info.
*        10  doc-ytdgua                          pic s9(7)v99 comp.
        10  doc-ytdgua                          pic s9(7)v99.
*        10  doc-ytdgub                          pic s9(7)v99 comp.
        10  doc-ytdgub                          pic s9(7)v99.
*        10  doc-ytdguc                          pic s9(7)v99 comp.
        10  doc-ytdguc                          pic s9(7)v99.
*        10  doc-ytdgud                          pic s9(7)v99 comp.
        10  doc-ytdgud                          pic s9(7)v99.
*        10  doc-ytdcea                          pic s9(7)v99 comp.
        10  doc-ytdcea                          pic s9(7)v99.
*        10  doc-ytdcex                          pic s9(7)v99 comp.
        10  doc-ytdcex                          pic s9(7)v99.
*        10  doc-ytdear                          pic s9(7)v99 comp.
        10  doc-ytdear                          pic s9(7)v99.
*        10  doc-ytdinc                          pic s9(7)v99 comp.
        10  doc-ytdinc                          pic s9(7)v99.
*        10  doc-ytdeft                          pic s9(7)v99 comp.
        10  doc-ytdeft                          pic s9(7)v99.
*        10  doc-totinc-g                        pic s9(7)v99 comp.
        10  doc-totinc-g                        pic s9(7)v99.
* y2k
*       10  doc-ep-date-deposit                 pic 9(4) comp.
        10  doc-ep-date-deposit                 pic 9(8).
*        10  doc-totinc                          pic s9(7)v99 comp.
        10  doc-totinc                          pic s9(7)v99.
*        10  doc-ep-ceiexp                       pic s9(7)v99 comp.
        10  doc-ep-ceiexp                       pic s9(7)v99.
*        10  doc-adjcea                          pic s9(7)v99 comp.
        10  doc-adjcea                          pic s9(7)v99.
*        10  doc-adjcex                          pic s9(7)v99 comp.
        10  doc-adjcex                          pic s9(7)v99.
*        10  doc-ceicea                          pic s9(7)v99 comp.
        10  doc-ceicea                          pic s9(7)v99.
*        10  doc-ceicex                          pic s9(7)v99 comp.
        10  doc-ceicex                          pic s9(7)v99.
        10  ceicea-prt-format                   pic x(13).
        10  ceicex-prt-format                   pic x(13).
        10  ytdcea-prt-format                   pic x(13).
        10  ytdcex-prt-format                   pic x(13).
        10  doc-clinic-nbr-2                    pic 99.
        10  doc-clinic-nbr-3                    pic 99.
        10  doc-clinic-nbr-4                    pic 99.
        10  doc-clinic-nbr-5                    pic 99.
        10  doc-clinic-nbr-6                    pic 99.
        10  doc-spec-cd-2                       pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   8
*                      u095.cbl (/alpha/rmabill/rmabill101c/use/f020_)
        10  doc-spec-cd-3                       pic 99.
*        10  doc-ytdinc-g                        pic s9(7)v99 comp.
        10  doc-ytdinc-g                        pic s9(7)v99.
    05  doc-locations.
        10  doc-loc-1                           pic x999.
        10  doc-loc-2                           pic x999.
        10  doc-loc-3                           pic x999.
        10  doc-loc-4                           pic x999.
        10  doc-loc-5                           pic x999.
        10  doc-loc-6                           pic x999.
        10  doc-loc-7                           pic x999.
        10  doc-loc-8                           pic x999.
        10  doc-loc-9                           pic x999.
        10  doc-loc-10                          pic x999.
        10  doc-loc-11                          pic x999.
        10  doc-loc-12                          pic x999.
        10  doc-loc-13                          pic x999.
        10  doc-loc-14                          pic x999.
        10  doc-loc-15                          pic x999.
        10  doc-loc-16                          pic x999.
        10  doc-loc-17                          pic x999.
        10  doc-loc-18                          pic x999.
        10  doc-loc-19                          pic x999.
        10  doc-loc-20                          pic x999.
        10  doc-loc-21                          pic x999.
        10  doc-loc-22                          pic x999.
        10  doc-loc-23                          pic x999.
        10  doc-loc-24                          pic x999.
        10  doc-loc-25                          pic x999.
        10  doc-loc-26                          pic x999.
        10  doc-loc-27                          pic x999.
        10  doc-loc-28                          pic x999.
        10  doc-loc-29                          pic x999.
        10  doc-loc-30                          pic x999.
    05  doc-locations-r  redefines  doc-locations.
        10  doc-loc     occurs 30 times         pic x999.
*
    05  doc-rma-expense-percent-misc            pic 9(5)v9(4) comp.
* 2004/03/03 - MC
*   05  filler2                                 pic x(8).
    05  doc-afp-paym-group                      pic x(4).
    05  filler2                                 pic x(4).
* 2004/030/03 - end
    05  doc-ind-pays-gst                        pic x.
    05  doc-nx-avail-batch                      pic 999.
* 2002/07/16 - MC - add 5 more next batch nbr for each clinic
    05  doc-nx-avail-batch-2                    pic 999.
    05  doc-nx-avail-batch-3                    pic 999.
    05  doc-nx-avail-batch-4                    pic 999.
    05  doc-nx-avail-batch-5                    pic 999.
    05  doc-nx-avail-batch-6                    pic 999.
** 2002/07/16 - end
*    05  doc-yrly-ceiling-computed               pic 9(7)v99 comp.
    05  doc-yrly-ceiling-computed               pic 9(7)v99.
*    05  doc-yrly-expense-computed               pic 9(7)v99 comp.
    05  doc-yrly-expense-computed               pic 9(7)v99.
    05  doc-rma-expense-percent-reg             pic 9(5)v9(4) comp.
    05  doc-sub-specialty                       pic x(15).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   9
*                      u095.cbl (/alpha/rmabill/rmabill101c/use/f020_)
*    05  doc-payeft                              pic s9(7)v99 comp.
    05  doc-payeft                              pic s9(7)v99.
*    05  doc-ytdded                              pic s9(7)v99 comp.
    05  doc-ytdded                              pic s9(7)v99.
    05  doc-dept-expense-percent-misc           pic 9(5)v9(4) comp.
    05  doc-dept-expense-percent-reg            pic 9(5)v9(4) comp.
    05  doc-ep-ped                              pic s9(9) comp.
    05  doc-ep-pay-code                         pic x.
    05  doc-ep-pay-sub-code                     pic x.
    05  filler3                                 pic x(1).
    05  doc-ind-holdback-active                 pic x(1).
    05  group-regular-service                   pic x(4).
* 2002/09/23 - MC
*    05  group-regular-service                  pic x(4).
    05  group-over-serviced                     pic x(4).
* 2002/09/23 - end
    05  doc-specialties                         pic x(90).

*
fd  print-file
        record contains 132 characters.

01  print-record                        pic x(132).
*
working-storage section.

77  err-ind                                     pic 99  value zero.

77  print-file-name                             pic x(5) value "r095".
77  max-nbr-lines                               pic 99   value 55.
77  ctr-page                                    pic 9(4)  value zero.
77  ctr-line                                    pic 99   value 65.
77  agent-cd-ws                                 pic 9.
77  prt-sw                                      pic x.

77  feedback-iconst-mstr                        pic x(4).
77  feedback-batctrl-file                       pic x(4).

77  ws-reply                                    pic x.
77  ws-reply2                                   pic x.
77  sel-month                                   pic 99.
77  blank-line                                  pic x(132) value spaces.

*  eof indicators
*
77  eof-batctrl-file                            pic x   value "N".

*
*  status file indicators
*
*mf 77  common-status-file                      pic x(11).
*mf 77  status-iconst-mstr                      pic x(11) value zero.
*mf 77  status-batctrl-file                     pic x(11) value zero.
*mf 77  status-doc-mstr                         pic x(11) value zero.

77  common-status-file                          pic x(2).
77  status-cobol-iconst-mstr                    pic x(2) value zero.
77  status-cobol-batctrl-file                   pic x(2) value zero.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  10
*                      u095.cbl                                      )
77  status-cobol-doc-mstr                       pic x(2) value zero.
77  status-prt-file                             pic xx    value zero.



01  flag-rec                                    pic x.
    88  valid-rec                               value "Y".
    88  invalid-rec                             value "N".

01  sel-clinic-nbr                              pic xx.

* (y2k)
01  input-date.
* (y2k)
    05  input-yy                                pic 99.
* (y2k - auto fix)
*   05  input-yy-r redefines input-yy           pic xx.
    05  input-yy-r redefines input-yy           pic x(4).
    05  input-mm                                pic 99.
    05  input-dd                                pic 99.


*mf copy "f001_key_batctrl_file.ws".

01  batch-table-totals.
    10  batch-totals occurs 2 times.
***             (1=batches retained, 2= batches deleted)
        15  batch-totals-type occurs 19 times.
***             (index 1 - 10: claims, ag.cd 0 - 9
***                    11:     sum of 1 - 10
***                    12 -14: adj, adj cd - a, b, r
***                    15:     sum of 12 - 14
***                    16 -17: paym'T, ADJ CD - M, C
***                    18:     sum of 16 - 17
***                    18:     sum of 11, 15, 18
            20 batch-totals-item occurs 4 times
                                        pic s9(9)v99.
***             (1=a/r, 2=rev, 3=cash, 4=total nbr)


***subscripts for batch-table-totals and claims-table-totals tables
01  batch-table-totals-ss.
    05  ss-r-d                          pic 9.
    05  ss-type                         pic 99.
    05  ss-item                         pic 9.
01  batch-type-table.
    05  batch-type-heading.
        10  filler                      pic x(20)  value
                " ADJUSTMENTS- 'A'".
        10  filler                      pic x(20)  value
                "            - 'B'".
        10  filler                      pic x(20)  value
                "            - 'R'".
        10  filler                      pic x(20)  value
                "     TOTALS".
        10  filler                      pic x(20)  value
                " PAYMENTS   - 'M'".
        10  filler                      pic x(20)  value
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  11
*                      u095.cbl                                      )
                "            - 'C'".
        10  filler                      pic x(20)  value
                "     TOTALS".
        10  filler                      pic x(20)  value
                "     GRAND TOTALS".
    05  batch-type-heading-r redefines batch-type-heading.
        10  batch-type occurs 8 times  pic x(20).


*   counters for records read/written for all input/output files

01  counters.
    05  doc-mstr-reads                          pic 9(7).
    05  ctr-batctrl-file-reads                  pic 9(7).
    05  ctr-batch-deleted                       pic 9(7).
    05  ctr-batch-deleted-amt-ar                pic 9(8)v99.
    05  ctr-batch-deleted-amt-rev               pic 9(8)v99.
    05  ctr-batch-deleted-amt-pay               pic 9(8)v99.
01  error-message-table.

    05  error-messages.
        10  filler                              pic x(60)   value
                "INVALID REPLY".
        10  filler                              pic x(60)   value
                "INVALID CLINIC NBR OR NO CONSTANTS MASTER SUPPLIED".
        10  filler                              pic x(60)   value
                "INVALID KEY FOUND ON   DELETE ".
        10  filler                              pic x(60)   value
                "NO BATCTRL FILE SUPPLIED FOR THIS CLINIC".
        10  filler                              pic x(60)   value
                "NO MORE BATCH CONTROL RECORDS FOR THIS CLINIC NUMBER".
        10  filler                              pic x(60)   value
                "NO APPROPRIATE RECORDS IN BATCTRL FILE".
        10  filler                              pic x(60)   value
                "NO CLAIMS FOR THIS CLINIC".
        10  filler                              pic x(60)   value
                "NO HEADER FOR CURRENT BATCH".
        10  filler                              pic x(60)    value
                "INVALID MONTH".
        10  filler                              pic x(60)    value
                "ORIGINAL CLMHDR RECORD FOR ADJUSTMENT DETAIL IS MISSING".
        10  filler                              pic x(60)     value
                "INVALID BATCH TYPE".
        10  filler                              pic x(60)       value
                "WORK FILE EMPTY".
        10  filler                              pic x(60)       value
                "INVALID READ ON DOCTOR MASTER FILE".
        10  filler                              pic x(60)       value
                "INVALID DELETE ON BATCH CONTROL FILE".
        10  filler                              pic x(60)       value
                "INVALID DAY".
        10  filler                              pic x(60)       value
                "DOCTOR MASTER READ ERROR".

    05  error-messages-r redefines error-messages.
        10  err-msg                             pic x(60)
                        occurs 16 times.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  12
*                      u095.cbl                                      )
01  err-msg-comment                             pic x(60).

01  e1-error-line.

    05  e1-error-word                           pic x(13)    value
                        "***  ERROR - ".
    05  e1-error-msg                            pic x(119).




    copy "sysdatetime.ws".
* 98/dec/01 D.B.        - y2k conversion
* 99/jan/13 B.E.        - changed sys-y1/y2 to y1 thru y4
*                       - added 'default-century-...' and century-date variables

01 century-year                                 pic 9(4).
01 century-date                                 pic 9(8).
01 default-century-cc                           pic 9(2) value 19.
01 default-century-cccc                         pic 9(4) value 1900.

01  sys-date.
* y2k    05  sys-date-long                              pic x(6).
    05  sys-date-long                           pic x(8).
    05  sys-date-long-r  redefines  sys-date-long.
* y2k   10  sys-yy                              pic 99.
        10  sys-yy                              pic 9999.
        10  sys-yy-alpha  redefines  sys-yy.
* y2k       15  sys-y1                          pic 9.
* y2k       15  sys-y2                          pic 9.
            15  sys-y1                          pic 9.
            15  sys-y2                          pic 9.
            15  sys-y3                          pic 9.
            15  sys-y4                          pic 9.
        10  sys-mm                              pic 99.
        10  sys-dd                              pic 99.
* remove after y2k upgrade of dgux
01  sys-date-numeric redefines sys-date         pic 9(8).
01  sys-date-y2kfix  redefines sys-date.
    05 sys-date-left                            pic x(6).
    05 filler                                   pic x(2).
01  sys-date-y2kfixed redefines sys-date.
    05 sys-date-blank                           pic x(2).
    05 sys-date-right                           pic x(6).
01  sys-date-temp                               pic x(8).

01  run-date.
* y2k    05  run-yy                                     pic 99.
    05  run-yy                                  pic 9999.
    05  filler                                  pic x   value "/".
    05  run-mm                                  pic 99.
    05  filler                                  pic x   value "/".
    05  run-dd                                  pic 99.

01  sys-time.
    05  sys-hrs                                 pic 99.
    05  sys-min                                 pic 99.
    05  sys-sec                                 pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  13
*                      u095.cbl (/alpha/rmabill/rmabill101c/use/sysda)
    05  sys-hdr                                 pic 99.

01  run-time.
    05  run-hrs                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-min                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-sec                                 pic 99.

01  h10-head.
    05  h10-prg-nbr                     pic x(4).
    05  filler                          pic x(36) value spaces.
    05  filler                          pic x(65) value
                "BATCH CONTROL FILE DELETIONS".
    05  filler                          pic x(9)  value
                "RUN DATE".
* (y2k)
    05  h10-run-date-yy                 pic 99.
    05  filler                          pic x     value "/".
* (y2k)
    05  h10-run-date-mm                 pic 99.
    05  filler                          pic x     value "/".
* (y2k)
    05  h10-run-date-dd                 pic 99.
    05  filler                          pic xx     value spaces.
    05  filler                          pic x(4)   value
                "PAGE".
    05  h10-page                        pic zzz9.

01  h20-head.
    05  filler                          pic x(39)  value spaces.
    05  h20-batch-type                  pic x(31).
    05  filler                          pic x(62)  value spaces.

01  h30-head.
    05  filler                          pic x(8)   value
                "CLINIC".
    05  h30-clinic-nbr                  pic 99.
    05  filler                          pic x(5)   value spaces.
    05  filler                          pic x(17)  value
                "PERIOD END DATE".
* (y2k)
    05  h30-prd-end-yy                  pic 99.
    05  filler                          pic x      value "/".
    05  h30-prd-end-mm                  pic 99.
    05  filler                          pic x      value "/".
    05  h30-prd-end-dd                  pic 99.
    05  filler                          pic x(4)   value spaces.
    05  filler                          pic x(6)   value
                "CYCLE".
    05  h30-cycle-nbr                   pic zz9.
    05  filler                          pic x(4)    value spaces.
    05  filler                          pic x(14)   value
                "CUT-OFF DATE".
* (y2k)
    05  h30-cut-off-yy                  pic 99.
    05  filler                          pic x      value "/".
    05  h30-cut-off-mm                  pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  14
*                      u095.cbl                                      )
    05  filler                          pic x      value "/".
    05  h30-cut-off-dd                  pic 99.
    05  filler                          pic x(53)   value spaces.

01  h40-head.
    05  filler                          pic x(21)   value spaces.
    05  filler                          pic x(20)   value
                "--------------------".
    05  filler                          pic x(15)   value
                "R E T A I N E D".
    05  filler                          pic x(18)   value
                "------------------".
    05  filler                          pic x(4)    value spaces.
    05  filler                          pic x(20)   value
                "--------------------".
    05  filler                          pic x(13)   value
                "D E L E T E D".
    05  filler                          pic x(21)   value
                "--------------------".

01  h50-head.
    05  h50-col1                        pic x(21).
    05  h50-col2                        pic x(15).
    05  h50-col3                        pic x(15).
    05  h50-col4                        pic x(16).
    05  h50-col5                        pic x(11).
    05  h50-col6                        pic x(15).
    05  h50-col7                        pic x(15).
    05  h50-col8                        pic x(16).
    05  h50-col9                        pic x(8).

01  h3-head.

    05  filler                                  pic x(30)       value
                "CYCLE  BATCH     FORMS       N".
    05  filler                                  pic x(30)       value
                "ET            NET".
    05  filler                                  pic x(30)       value
                "CASH          ACTUAL".
    05  filler                                  pic x(30)       value
                "CONTROL    ACTUAL  CONTROL".
    05  filler                                  pic x(12)       value
                "BATCH  AGENT".



01  h4-head.

    05  filler                                  pic x(30)       value
                " NBR   NUMBER DP COUNT       A".
    05  filler                                  pic x(30)       value
                "/R          REVENUE         EN".
    05  filler                                  pic x(30)       value
                "TERED          TOTAL".
    05  filler                                  pic x(30)       value
                " TOTAL       SVC     SVC".
    05  filler                                  pic x(12)       value
                "TYPE   CODE".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  15
*                      u095.cbl                                      )
01  print-line.

    05  l1-print-line.
        10  filler                              pic x.
        10  l1-cycle                            pic zzz.
        10  filler                              pic x.
        10  l1-batch-nbr.
            15  l1-batch-nbr-1-2                pic   99.
*!          15  l1-doc-nbr                      pic  999.
            15  l1-doc-nbr                      pic  xxx.
            15  l1-week                         pic   99.
            15  l1-day                          pic    9.
        10  l1-slash                            pic x.
        10  l1-dept-code                        pic 99.
        10  filler                              pic x(2).
        10  l1-forms-count                      pic z9.
        10  filler                              pic x(5).
        10  l1-net-a-r                          pic zz,zzz.99-.
        10  filler                              pic x(6).
        10  l1-net-revenue                      pic zz,zzz.99-.
        10  filler                              pic x(6).
        10  l1-cash-entered                     pic zz,zzz.99-.
        10  filler                              pic x(5).
        10  l1-actual-total                     pic zz,zzz.99-.
        10  filler                              pic x(7).
        10  l1-control-total                    pic zz,zzz.99-.
        10  filler                              pic x(4).
        10  l1-actual-svc                       pic zzz9.
        10  filler                              pic x(4).
        10  l1-control-svc                      pic zzz9.
        10  filler                              pic x(3).
        10  l1-batch-type                       pic x(8).
        10  filler                              pic x(3).
        10  l1-agent-code                       pic 9.
        10  filler                              pic x(2).
    05  t1-print-line redefines l1-print-line.
        10  t1-total-titles.
            15  t1-cycle-lit                    pic x(7).
            15  t1-cycle                        pic zz9.
            15  t1-ttls-lit                     pic x(5).
        10  t2-total-titles redefines t1-total-titles.
* (y2k)
            15  t1-mth-to-date                  pic x(15).
        10  t1-tot-forms-count                  pic z(4)9.
        10  filler                              pic xxx.
        10  t1-net-a-r                          pic zz,zzz,zzz.99-.
        10  filler                              pic xx.
        10  t1-net-revenue                      pic zz,zzz,zzz.99-.
        10  filler                              pic xx.
        10  t1-cash-entered                     pic zz,zzz,zzz.99-.
        10  filler                              pic x.
        10  t1-actual-total                     pic zz,zzz,zzz.99-.
        10  filler                              pic x.
        10  t1-control-total                    pic zz,zzz,zzz.99-.
        10  filler                              pic x.
        10  t1-actual-svc                       pic zzz9.
        10  filler                              pic x(6).
        10  t1-control-svc                      pic zzz9.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  16
*                      u095.cbl                                      )
        10  filler                              pic x(18).

    05  t10-totals-line redefines t1-print-line.
        10  t10-type.
            15  filler                  pic x.
            15  t10-batch-type          pic x(11).
            15  t10-slash               pic x.
            15  filler                  pic xx.
            15  t10-batch-code          pic x(5).
            15  t10-batch-code-r redefines t10-batch-code.
                20  t10-agent-code      pic 9.
                20  filler              pic x(4).
        10  t10-type-r redefines t10-type
                                        pic x(20).
        10  t10-a-r-ret                 pic zz,zzz,zz9.99-.
        10  filler                      pic x.
        10  t10-rev-ret                 pic zz,zzz,zz9.99-.
        10  filler                      pic x.
        10  t10-cash-ret                pic zz,zzz,zz9.99-.
        10  filler                      pic xx.
        10  t10-nbr-ret                 pic zzz,zz9.
        10  filler                      pic x(4).
        10  t10-a-r-del                 pic zz,zzz,zz9.99-.
        10  filler                      pic x.
        10  t10-rev-del                 pic zz,zzz,zz9.99-.
        10  filler                      pic x.
        10  t10-cash-del                pic zz,zzz,zz9.99-.
        10  filler                      pic xx.
        10  t10-nbr-del                 pic zzz,zz9.
        10  filler                      pic xx.

screen section.

01  scr-title.

    05  blank screen.
    05                  line 01 col 01 value "U095".
    05                  line 01 col 20 value "BATCH FILE DELETIONS".
    05                  line 01 col 19 value "FOR CLAIMS BATCHES ONLY" blink.
* (y2k - auto fix)
*   05                  line 01 col 73 pic 99 from sys-yy.
    05                  line 01 col 73 pic 9(4) from sys-yy.
    05                  line 01 col 75 value "/".
    05                  line 01 col 76 pic 99 from sys-mm.
    05                  line 01 col 78 value "/".
    05                  line 01 col 79 pic 99 from sys-dd.
    05                  line 06 col 30 value "FOR THE CLINIC AND P.E.D. SELECTED
    05                  line 07 col 30 value "ALL BATCHES WITH A STATUS OF '3'".
    05                  line 08 col 30 value "WILL BE DELETED FROM BATCH CONTROL
    05                  line 12 col 30 value "ENTER CLINIC NBR".
    05  scr-clinic-nbr  line 12 col 48 pic x(2) to sel-clinic-nbr auto required.


* (y2k)
01  msg-enter-date.

    05                  line 15 col 01 value is "ALL BATCHES WITH A PERIOD END D
    05                  line 15 col 44 value is "THE DATE YOU ENTER WILL BE DELE
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  17
*                      u095.cbl                                      )
    05                  line 16 col 30 value is "ENTER CUT OFF DATE --".
* (y2k - auto fix)
*   05  scr-input-yy    line 16 col 55 pic xx using input-yy-r auto required.
    05  scr-input-yy    line 16 col 55 pic x(4) using input-yy-r auto required.
    05                  line 16 col 57  value is "/".
    05  scr-input-mm    line 16 col 58 pic 99 using input-mm auto required.
    05                  line 16 col 60  value is "/".
    05  scr-input-dd    line 16 col 61 pic 99 using input-dd auto required.

* (y2k)
01  scr-check-date.
    05                  line 18 col 30 value "CHANGE DATE (ENTER Y OR N)".
    05  reply           line 18 col 58 pic x using ws-reply auto required.

01  scr-continue.
    05                  line 20 col 30 value "CONTINUE? (ENTER Y OR N)".
    05  scr-cont        line 20 col 58 pic x using ws-reply2 auto required.

01  program-in-progress.
    05                  line 22 col 30 value "PROGRAM U095 IN PROGRESS".

01  msg-line.
    05                  line 15 col 25 value "*** NO CLAIMS BATCHES DELETED ***"



*
01  file-status-display.
    05                  line 24 col 56 value "FILE STATUS = ".
*mf    05                       line 24 col 70 pic x(11) from common-status-file
    05                  line 24 col 70 pic x(2) from common-status-file    bell
*
01  err-msg-line.
    05                  line 24 col 01  value " ERROR -  "      bell blink.
    05                  line 24 col 11  pic x(60)       from err-msg-comment.

01  blank-line-24.
    05  line 24 col 1   blank line.

01  confirm.
    05  line 23 col 01 value " ".

01  blank-screen.
    05  blank screen.

01  scr-closing-screen.
    05  blank screen.
    05  line  3 col 20  value "NUMBER OF DOCTOR-MSTR-FILE ACCESSES = ".
    05  line  3 col 60  pic 9(7) from doc-mstr-reads.
    05  line  7 col 20  value "NUMBER OF BATCTRL-FILE ACCESSES = ".
    05  line  7 col 60  pic 9(7) from ctr-batctrl-file-reads.
    05  line 11 col 20  value "NUMBER BATCHES DELETED = ".
    05  line 11 col 60  pic 9(7) from ctr-batch-deleted.
    05  line 12 col 20  value "TOTAL A/R VALUE DELETED = ".
    05  line 12 col 60  pic 9(8).99 using ctr-batch-deleted-amt-ar.
    05  line 13 col 20  value "TOTAL REV VALUE DELETED = ".
    05  line 13 col 60  pic 9(8).99 using ctr-batch-deleted-amt-rev.
    05  line 14 col 20  value "TOTAL PAY'T VALUE DELETED = ".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  18
*                      u095.cbl                                      )
    05  line 14 col 60  pic 9(8).99 using ctr-batch-deleted-amt-pay.
    05  line 21 col 20  value "PROGRAM U095 ENDING".
* (y2k - auto fix)
*   05  line 21 col 40  pic 99  from sys-yy.
    05  line 21 col 40  pic 9(4)        from sys-yy.
    05  line 21 col 42  value "/".
    05  line 21 col 43  pic 99  from sys-mm.
    05  line 21 col 45  value "/".
    05  line 21 col 46  pic 99  from sys-dd.
    05  line 21 col 50  pic 99  from sys-hrs.
    05  line 21 col 52  value ":".
    05  line 21 col 53  pic 99  from sys-min.
    05  line 23 col 20  value "PRINT REPORT IS IN FILE ".
    05  line 23 col 51  pic x(5) from print-file-name.

procedure division.
declaratives.

err-batctrl-file section.
    use after standard error procedure on batch-ctrl-file.
err-batctrl.
*mf    move status-batctrl-file         to common-status-file.
    move status-cobol-batctrl-file      to common-status-file.
    display file-status-display.
    stop "ERROR IN ACCESSING BATCH CONTROL FILE".

err-doc-mstr-file section.
    use after standard error procedure on doc-mstr.
err-doc-mstr.
    stop "ERROR IN ACCESSING DOC MASTER ".
*mf    move status-doc-mstr             to common-status-file.
    move status-cobol-doc-mstr          to common-status-file.
    display file-status-display.
    stop run.

end declaratives.

main-line section.
mainline.

    perform aa0-initialization          thru aa0-99-exit.
    perform ab0-processing              thru ab0-99-exit
        until eof-batctrl-file = 'Y'.
    perform az0-end-of-job              thru az0-99-exit.
*
    stop run.
aa0-initialization.

* (y2k)
    accept sys-date                     from date.
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.
    move sys-mm                         to run-mm.
    move sys-dd                         to run-dd.
* (y2k)
    move sys-yy                         to run-yy.

    accept sys-time                     from time.
    move sys-hrs                        to run-hrs.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  19
*                      u095.cbl                                      )
    move sys-min                        to run-min.
    move sys-sec                        to run-sec.

*       (delete print file)
*    expunge print-file

    open i-o    batch-ctrl-file.
    open input  iconst-mstr
                doc-mstr.
    open output print-file.



    move zeros                          to counters
                                           batch-table-totals
                                           batch-table-totals-ss.

    move spaces                         to print-line
                                           blank-line
                                           h50-head.





*       (display screen title/option)
    display scr-title.

aa0-10-enter-clinic-nbr.

    accept scr-clinic-nbr.

    if sel-clinic-nbr =   "**"
    then
        go to az0-end-of-job
    else
        move sel-clinic-nbr             to iconst-clinic-nbr-1-2.
*   endif

    read iconst-mstr
        invalid key
                move 2 to err-ind
                perform za0-common-error        thru za0-99-exit
                go to aa0-10-enter-clinic-nbr.


* (y2k)
    move iconst-date-period-end         to input-date.

* (y2k)
    display msg-enter-date.

***************************************************************
*       (bypass first override of deletion date)
*
    go to aa0-50-continue.
***************************************************************

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  20
*                      u095.cbl                                      )
aa0-20-enter-date.

* (y2k)
    accept scr-input-yy.

* (y2k)
    if input-yy-r = "**"
    then
        go to az0-end-of-job.
*   (else).
*   endif

aa0-30.

    accept scr-input-mm.
    if input-mm  > 12 or input-mm  < 1
    then
        move 9                          to      err-ind
        perform za0-common-error        thru za0-99-exit
        go to aa0-30.
*   (else)
*   endif


aa0-40.


    accept scr-input-dd.

    if input-dd < 1 and input-dd > 31
    then
        move 15                         to err-ind
        perform za0-common-error        thru za0-99-exit
        go to aa0-40.
*   (else)
*    endif

aa0-50-continue.
* (y2k)
    display scr-check-date.

    accept reply.

    if ws-reply not = "N"
    then
        go to aa0-20-enter-date.
*   (else)
*   endif


    display scr-continue.

    accept scr-cont.

    if ws-reply2 not = "Y"
    then
        go to az0-end-of-job.
*  (else)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  21
*                      u095.cbl                                      )
*   endif

    display program-in-progress.

    move "U095"                         to      h10-prg-nbr.
* (y2k)
    move run-yy                         to      h10-run-date-yy.
* (y2k)
    move run-mm                         to      h10-run-date-mm.
* (y2k)
    move run-dd                         to      h10-run-date-dd.
    move sel-clinic-nbr                 to      h30-clinic-nbr.
    move iconst-clinic-cycle-nbr        to      h30-cycle-nbr.
* (y2k)
    move iconst-date-period-end-yy      to      h30-prd-end-yy.
* (y2k)
    move iconst-date-period-end-mm      to      h30-prd-end-mm.
* (y2k)
    move iconst-date-period-end-dd      to      h30-prd-end-dd.
* (y2k)
    move input-yy                       to      h30-cut-off-yy.
    move input-mm                       to      h30-cut-off-mm.
    move input-dd                       to      h30-cut-off-dd.
    move "        CLAIMS BATCHES"
                                        to      h20-batch-type.



*mf move zero                           to key-batctrl-file.
    move spaces         to key-batctrl-file.

    move sel-clinic-nbr                 to key-batctrl-file.

*mf    read batch-ctrl-file key is key-batctrl-file approximate
*mf     invalid key
*mf         move 4                      to err-ind
*mf         perform za0-common-error    thru za0-99-exit
*mf         go to aa0-10-enter-clinic-nbr.

    start batch-ctrl-file key is greater than or equal to key-batctrl-file
        invalid key
            move 4                      to err-ind
            perform za0-common-error    thru za0-99-exit
            go to aa0-10-enter-clinic-nbr.
    read batch-ctrl-file next.

*mf    retrieve batch-ctrl-file key fix position
*mf     into key-batctrl-file.

    add 1                               to ctr-batctrl-file-reads.

    perform ra1-sel-read-next-batctrl   thru ra1-99-exit
        until   eof-batctrl-file = "Y"
             or valid-rec.

    if eof-batctrl-file = "Y"
    then
        perform za0-common-error        thru za0-99-exit
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  22
*                      u095.cbl                                      )
        go to az0-end-of-job.
*   (else)
*   endif

aa0-99-exit.
    exit.
ab0-processing.

    if flag-rec = 'Y'
    then
        perform ba0-delete-batch        thru ba0-99-exit.
*   (else)
*   endif

    perform ca0-read-next-batch         thru ca0-99-exit.

ab0-99-exit.
    exit.
az0-end-of-job.

    perform ta0-process-totals          thru ta0-99-exit.

    close batch-ctrl-file
          doc-mstr
          print-file.

    display blank-screen.
    accept sys-time                     from time.

    display scr-closing-screen.

    if ctr-batch-deleted  < 1
    then
        display msg-line.
*   (else)
*    endif

    display blank-line-24.

*   call program "MENU".

    stop run.

az0-99-exit.
    exit.

ba0-delete-batch.

    add batctrl-calc-ar-due             to ctr-batch-deleted-amt-ar.
    add batctrl-calc-tot-rev            to ctr-batch-deleted-amt-rev.
    add batctrl-manual-pay-tot          to ctr-batch-deleted-amt-pay.

*mf    delete batch-ctrl-file record physical
    delete batch-ctrl-file record
        invalid key
            move 14                     to err-ind
            perform za0-common-error    thru za0-99-exit
            go to az0-end-of-job.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  23
*                      u095.cbl                                      )

    add 1                               to ctr-batch-deleted.

ba0-99-exit.
    exit.
ca0-read-next-batch.

    read batch-ctrl-file next
        at end
            move "Y"                    to eof-batctrl-file
            go to ca0-99-exit.

*mf    retrieve batch-ctrl-file key fix position
*mf     into key-batctrl-file.

    add 1                               to ctr-batctrl-file-reads.

    move "N"                            to      flag-rec.

    perform ra1-sel-read-next-batctrl   thru ra1-99-exit
        until   eof-batctrl-file = "Y"
             or valid-rec.

ca0-99-exit.
    exit.
ca1-read-doc-mstr.

    read doc-mstr
        invalid key
            move "INVALID DOCTOR"       to      doc-name
            go to ca1-99-exit.

    add 1                               to      doc-mstr-reads.


ca1-99-exit.
    exit.

ra1-sel-read-next-batctrl.

*   if batctrl-clinic-nbr-1-2 not = sel-clinic-nbr
*     and sel-clinic-nbr < 60
*   if    batctrl-clinic-nbr-1-2 not = sel-clinic-nbr
*     and ((sel-clinic-nbr < 60 and batctrl-clinic-nbr-1-2 > 59)
*      or  (sel-clinic-nbr > 59 and sel-clinic-nbr < 80   and
*           batctrl-clinic-nbr-1-2 > 79)
*      or  (sel-clinic-nbr = 80 and batctrl-clinic-nbr-1-2 > 80)
*      or  (sel-clinic-nbr = 81 and batctrl-clinic-nbr-1-2 > 81))


    if    batctrl-bat-clinic-nbr-1-2 not = sel-clinic-nbr
      and (   (sel-clinic-nbr = 22 and batctrl-bat-clinic-nbr-1-2 > 22)
           or (    sel-clinic-nbr > 59
               and sel-clinic-nbr < 66
               and batctrl-bat-clinic-nbr-1-2 > 65)
           or (    sel-clinic-nbr = 80
               and batctrl-bat-clinic-nbr-1-2 > 80)
           or (    sel-clinic-nbr = 81
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  24
*                      u095.cbl                                      )
               and batctrl-bat-clinic-nbr-1-2 > 81)
           or (    sel-clinic-nbr = 82
               and batctrl-bat-clinic-nbr-1-2 > 82)
           or (    sel-clinic-nbr = 83
               and batctrl-bat-clinic-nbr-1-2 > 83)
           )
    then
            move 5                      to err-ind
            move "Y"                    to eof-batctrl-file
            go to ra1-99-exit.
*   (else)
*   endif

*       (payments are stored as negative amounts in f001 file but are to
*        appear as positive amounts in report so sign is reversed)

    if batctrl-batch-type = "P"
      and batctrl-adj-cd  = "C"
    then
        subtract batctrl-calc-ar-due    from zero
                                        giving batctrl-calc-ar-due
        subtract batctrl-calc-tot-rev   from zero
                                        giving batctrl-calc-tot-rev
        subtract batctrl-manual-pay-tot from zero
                                        giving batctrl-manual-pay-tot.
*   (else)
*   endif

    if    ( batctrl-batch-type           = 'C'          )
* (y2k)
      and ( batctrl-date-period-end  not > input-date   )
      and ( batctrl-batch-status         = '4'          )
    then
        move "Y"                        to      flag-rec
        perform sa4-process-detail-line thru    sa4-99-exit
        move 2                          to      ss-r-d
        perform sa2-add-batch-totals    thru    sa2-99-exit
        go to ra1-99-exit.
*   (else)
*   endif

    move 1                              to      ss-r-d.
    perform sa2-add-batch-totals        thru    sa2-99-exit.

    read batch-ctrl-file next
        at end
            move 6                      to err-ind
            move "Y"                    to eof-batctrl-file
            go to ra1-99-exit.

*mf    retrieve batch-ctrl-file key fix position
*mf     into key-batctrl-file.

    add 1                               to ctr-batctrl-file-reads.

ra1-99-exit.
    exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  25
*                      u095.cbl                                      )
sa2-add-batch-totals.

    perform sa3-find-ss-type            thru    sa3-99-exit.
    add batctrl-calc-ar-due             to
                                        batch-totals-item (ss-r-d, ss-type, 1).
    add batctrl-calc-tot-rev            to
                                        batch-totals-item (ss-r-d, ss-type, 2).
    add batctrl-manual-pay-tot          to
                                        batch-totals-item (ss-r-d, ss-type, 3).
    add 1                               to
                                        batch-totals-item (ss-r-d, ss-type, 4).

sa2-99-exit.
    exit.

sa3-find-ss-type.

    if batctrl-batch-type = "C"
    then
        add 1, batctrl-agent-cd         giving  ss-type
    else
        if batctrl-batch-type = "A"
        then
            if batctrl-adj-cd = "A"
            then
                move 12                 to      ss-type
            else
                if batctrl-adj-cd = "B"
                then
                    move 13             to      ss-type
                else
***                      batctrl-adj-cd = "R"
                    move 14             to      ss-type
*               endif
*           endif
        else
***                     (batctrl-batch-type = "P")
            if batctrl-adj-cd = "M"
            then
                move 16                 to      ss-type
            else

***                     (batctrl-adj-cd = "C")
                move 17                 to      ss-type.
*           endif
*       endif
*    endif

sa3-99-exit.
    exit.

sa4-process-detail-line.

    perform sb1-move-fields             thru    sb1-99-exit.
    perform xa3-write-detail-line       thru    xa3-99-exit.

sa4-99-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  26
*                      u095.cbl                                      )

sb1-move-fields.

    move batctrl-cycle-nbr              to l1-cycle.
    move batctrl-bat-clinic-nbr-1-2     to l1-batch-nbr-1-2.
    move batctrl-bat-doc-nbr            to l1-doc-nbr.
    move batctrl-bat-week               to l1-week.
    move batctrl-bat-day                to l1-day.
    move batctrl-bat-doc-nbr            to doc-nbr.
    perform ca1-read-doc-mstr           thru ca1-99-exit.
    move "/"                            to l1-slash.
    move doc-dept                       to l1-dept-code.
    move batctrl-last-claim-nbr         to l1-forms-count.


    move batctrl-calc-ar-due            to      l1-net-a-r.
    move batctrl-calc-tot-rev           to      l1-net-revenue.
    move batctrl-manual-pay-tot         to      l1-cash-entered.

    move batctrl-amt-act                to l1-actual-total.
    move batctrl-amt-est                to l1-control-total.
    move batctrl-svc-act                to l1-actual-svc.

    move batctrl-svc-est                to l1-control-svc.

    if batctrl-batch-type = "C"
    then
        move "CLAIMS"                   to l1-batch-type
    else
        if batctrl-batch-type = "P"
        then
            move "PAYMENT"              to l1-batch-type
        else
            if batctrl-batch-type = "A"
            then
                move "ADJSTMNT"         to l1-batch-type
            else
                move "UNKNOWN"          to l1-batch-type.
*           endif
*       endif
*   endif

    move batctrl-agent-cd               to l1-agent-code.

sb1-99-exit.
    exit.
ta0-process-totals.

    perform ta1-get-grand-totals        thru ta1-99-exit.
    perform tb3-print-totals            thru tb3-99-exit.

ta0-99-exit.
    exit.

ta1-get-grand-totals.

    perform ta2-batch-grand-totals      thru    ta2-99-exit
        varying ss-r-d from 1 by 1 until ss-r-d > 2
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  27
*                      u095.cbl                                      )
        after ss-item from 1 by 1 until ss-item > 4.

ta1-99-exit.
    exit.

ta2-batch-grand-totals.

    perform ta4-add-batch-claims-totals thru    ta4-99-exit
        varying ss-type from 1 by 1 until ss-type > 10.

    add batch-totals-item (ss-r-d, 12, ss-item)
        batch-totals-item (ss-r-d, 13, ss-item)
        batch-totals-item (ss-r-d, 14, ss-item)
                                to
                                batch-totals-item (ss-r-d, 15, ss-item)
                                batch-totals-item (ss-r-d, 19, ss-item).
    add batch-totals-item (ss-r-d, 16, ss-item)
        batch-totals-item (ss-r-d, 17, ss-item)
                                to
                                batch-totals-item (ss-r-d, 18,ss-item)
                                batch-totals-item (ss-r-d, 19,ss-item).

ta2-99-exit.
    exit.



ta4-add-batch-claims-totals.

    add batch-totals-item (ss-r-d, ss-type, ss-item)
                                to
                                batch-totals-item (ss-r-d, 11, ss-item)
                                batch-totals-item (ss-r-d, 19, ss-item).

ta4-99-exit.
    exit.


tb3-print-totals.

    perform xa1-headings                thru    xa1-99-exit.
    perform tb4-move-prt-batch-totals   thru    tb4-99-exit.
tb3-99-exit.
    exit.

tb4-move-prt-batch-totals.

    move "N"                                    to      prt-sw.
    perform tb5-print-batch-claims-totals       thru    tb5-99-exit
                varying ss-type from 1 by 1 until ss-type > 10.

*       (check whether any claims printed)
    if prt-sw = "Y"
        move "     TOTALS"                      to      t10-type-r
        move 11                                 to      ss-type
        perform tb7-move-batch-totals           thru    tb7-99-exit
        write print-record from t1-print-line after advancing 1 line
        move spaces                             to      print-line
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  28
*                      u095.cbl                                      )
        write print-record from blank-line after advancing 1 line
        add 2                                   to      ctr-line.
*   (else)
*   endif

    perform tb6-print-batch-adj-totals          thru    tb6-99-exit
                varying ss-type from 12 by 1 until ss-type > 15.
    write print-record from blank-line after advancing 1 line.
    add 1                                       to      ctr-line.

    perform tb6-print-batch-adj-totals          thru    tb6-99-exit
                varying ss-type from 16 by 1 until ss-type > 18.
    write print-record from blank-line after advancing 2 lines.
    add 2                                       to      ctr-line.

    move 19                                     to      ss-type.
    perform tb6-print-batch-adj-totals          thru    tb6-99-exit.

tb4-99-exit.
    exit.

tb5-print-batch-claims-totals.

*       (if no totals for agent don'T PRINT LINE)
    if   batch-totals-item (1,ss-type,4) = 0
     and batch-totals-item (2, ss-type,4) = 0
    then
        go to tb5-99-exit.
*   (else)
*   endif

    subtract 1                          from ss-type
                                        giving agent-cd-ws.

    move agent-cd-ws                    to      t10-agent-code.
    move "-"                            to      t10-slash.

*       (if this the first agent printed, print "claims")
    if prt-sw = "Y"
    then
        move spaces                     to      t10-batch-type
    else
        move "CLAIMS"                   to      t10-batch-type
        move "Y"                        to      prt-sw.
*   endif

    perform tb7-move-batch-totals       thru    tb7-99-exit.
    write print-record from t1-print-line after advancing 1 line.
    add 1                               to      ctr-line.
    move spaces                         to      t1-print-line.

tb5-99-exit.
    exit.

tb6-print-batch-adj-totals.

    move batch-type (ss-type - 11)      to t10-type-r.
    perform tb7-move-batch-totals       thru    tb7-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  29
*                      u095.cbl                                      )
    write print-record from t1-print-line after advancing 1 line.
    move spaces                         to      print-line.
    add 1                               to      ctr-line.

tb6-99-exit.
    exit.

tb7-move-batch-totals.

    move batch-totals-item (1,ss-type,1)        to t10-a-r-ret.
    move batch-totals-item (1,ss-type,2)        to t10-rev-ret.
    move batch-totals-item (1,ss-type,3)        to t10-cash-ret.
    move batch-totals-item (1,ss-type,4)        to t10-nbr-ret.
    move batch-totals-item (2,ss-type,1)        to t10-a-r-del.
    move batch-totals-item (2,ss-type,2)        to t10-rev-del.
    move batch-totals-item (2,ss-type,3)        to t10-cash-del.
    move batch-totals-item (2,ss-type,4)        to t10-nbr-del.


tb7-99-exit.
    exit.



xa0-headings.

    add 1                               to ctr-page.
    move ctr-page                       to h10-page.
    write print-record from h10-head after advancing page.
    write print-record from h20-head after advancing 1 line.
    write print-record from h30-head after advancing 3 lines.
    move 4                              to ctr-line.

xa0-99-exit.
    exit.



xa1-headings.

*       (if no deletes have occurred, no detail lines have been printed.
*        set ctr-page to 0)
    if ctr-batch-deleted < 1
        move 0                          to      ctr-page.
*   (else)
*   endif

    perform xa0-headings                thru    xa0-99-exit.
    write print-record from h40-head after advancing 2 lines.
    move "BATCH-CONTROL FILE"           to      h50-col1.
    move "EFFECT ON A/R"                to      h50-col2
                                                h50-col6.
    move "EFFECT ON REV"                to      h50-col3
                                                h50-col7.
    move "EFFECT ON CASH"               to      h50-col4
                                                h50-col8.
    move "NUMBER"                       to      h50-col5
                                                h50-col9.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  30
*                      u095.cbl                                      )
    write print-record from h50-head after advancing 2 lines.
    move spaces                         to h50-head.
    write print-record from blank-line after advancing 1 line.
    add 5                               to      ctr-line.

xa1-99-exit.
    exit.

xa3-write-detail-line.

    add 1                               to ctr-line.
    if ctr-line > max-nbr-lines
    then
        perform xa4-headings            thru xa4-99-exit.
*   (else)
*   endif

    write print-record    from print-line after advancing 1 line.
    move spaces                         to print-line.

xa3-99-exit.
    exit.
xa4-headings.
    perform xa0-headings                thru    xa0-99-exit.
    write print-record from h3-head after advancing 2 lines.
    write print-record from h4-head after advancing 1 line.
    write print-record from blank-line after advancing 1 line.
    add 5                               to      ctr-line.

xa4-99-exit.
    exit.



za0-common-error.

    move err-msg (err-ind)              to      err-msg-comment.
    display err-msg-line.
    display confirm.
    stop " ".
    display blank-line-24.

za0-99-exit.
    exit.


    copy "y2k_default_sysdate_century.rtn".
y2k-default-sysdate.

    move sys-date-left                  to sys-date-temp.
    move sys-date-temp                  to sys-date-right.
    move zeros                          to sys-date-blank.
* 1999/dec/30 B.E.
*   add 19000000                        to sys-date-numeric.
    add 20000000                        to sys-date-numeric.

y2k-default-sysdate-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  31
*                      u095.cbl                                      )
* Micro Focus COBOL for UNIX         V4.0 revision 005 Compiler
* Copyright (C) 1984-1995 Micro Focus Ltd.     URN 2XUPG/GB0/00000F
*                                              REF GNB-030056000AA
*
* Total Messages:     0
* Data:        8900     Code:        6007
