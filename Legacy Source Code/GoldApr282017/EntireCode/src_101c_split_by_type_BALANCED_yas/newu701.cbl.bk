identification division. 
program-id.    newu701. 
author.        dyad technologies. 
installation.  rma. 
date-written.  90/06/15. 
date-compiled. 
security. 
* 
* 
*  REMARKS:   - OHIP DISKETTE UPLOAD INTO SUSPENSE FILES 
*             - CREATE SUSPENSE HEADER, DETAIL, AND ADDRESS RECORDS 
*               FROM THE DISKETTES. VALIDATE EACH FIELD. 
* 
* 
*  REV 91/04/23 (M.C.)  - SMS  138 
*                       - SET 'CLMHDR-PAT-KEY-DATA' TO HEALTH-NBR IF 
*                         PRESENT;OTHERWISE, USE OHIP NBR. 
* 
*  REV 91/09/11 (B.M.L.) - CHANGED PROGRAM TO IGNORE BLANK OR ZERO OHIP 
*                          EDIT CHECKS NOW WORK ON HEALTH INSTEAD. 
* 
*  REV 91/09/18 (M.C.)  - INVALID DIGIT ON BATCH-SPECIALITY BECAUSE 
*                         MOVE '???' TO NUMERIC FIELD, CORRECTION MADE 
*                         ON PAGE 26 (FB0-BUILD-SUSP-HDR-REC) 
* 
*  REV 92/09/25 (M.C.)  - PDR 558 
*                       - SELECT ONLY THE ACTIVE DOCTOR, AND IF THE 
*                         DOCTOR HAS MORE THAN 1 ACTIVE NUMBER, USER 
*                         SHOULD ENTER THE NUMBER THEY WANT 
* 
*  REV 93/06/16 (A.G.K.) - MODIFY THE INPUT FILE DEFINITION FOR THE NEW 
*                          OHIP LAYOUT 
* 
*  REV 93/07/13 (M.C.)  - SMS 142 
*                       - MODIFY THE INPUT FILE TO THE SAME AS CURRENT 
*                         OHIP LAYOUT (79 CHARS) 
*                       - MODIFY THE NECESSARY CHANGES TO THE FILES 
*                       - EXTEND 12 CHARS IN F002-SUSPEND-ADDRESS FILE 
* 
*  REV 93/11/16 (M.C.)  - PDR 591 
*                       - MODIFY THE VALIDATION ON REFERRING DOC NBR 
* 
*  REV 96/07/30 (M.C.)  - PDR 649 
*                       - INCLUDE 'I' AND 'O' AS PART OF HDR-I-O-IND 
*                         WHEN EDITING 
*###  CHECK OUT SETTING OF DETAIL-WRITTEN 
*###  CHECK THAT FEE- VARIABLES ARE IN THE HOLD AREA 
*  REV 97/09/10 (B.E.)  - EDIT SERVICE DATE NOT LESS THAN ADMIT DATE 
*			  ENSURE THAT IF 'OP'/'MR' (OVERRIDE PRICE) IS SPECIFIED 
*			 OR INCOMING FEES ARE ALREADY PRICED THEN SKIP 
*			 RMA PRICING (INCLUDING ADD ONS) 
*  REV 97/10/01 (B.E.)  - ADD ABILITY TO PROCESS MULTIPLE CLINICS WITHIN 
*			  A SINGLE BATCH. 
*  REV 97/11/01 (B.E.)  - ADD USER SELECTION PARAMETER TO ALLOW 
*			  DEFAULTING OF CLINIC NBR IF NOT SPECIFIED 
*			  WITHIN THE BATCH 
* 
*  REV 97/11/11 (B.E.)  - CLINIC DEFAULT WAS 2215 WHICH THEN OVERRODE 
*			  WHAT WAS IN BATCH. CHANGE LOGIC TO USE USER 
*			  SELECTION CLINIC NBR ONLY IF INCOMING BATCH'S 
*			  CLINIC NBR IS ZERO OR BLANK. 
*  REV 97/11/14 (B.E.)  - PROGRAM LOGIC TAKEN FROM D001 ALLOWED ONLY 8 
*			  DETAIL RECORDS. 'OCCURS' CHANGED FROM 8 TO 40. 
*			  TO ALLOW WEB INPUT OF UP TO 40 LINES 
*			  (ARBRITRARY DECISION TO THIS NUMBER) 
*	97/12/10 (B.E.)	- BUG FIXED. LENGTH OF HOLD-OMA-REC CHANGED AND 
*			  ASSOCIATED SORT-REC NOT INCREASED TO LARGE 
*			  ENOUGH VALUE - CHANGED TO LENGTH OF 250. 
* 
*	98/03/18 (B.E.)	- ADDED DEFAULTING OF BATCH LOCATION AND I/O INDIATOR 
*			  SO THAT RMA OPERATORS CAN INPUT THESE FILES 
*			  INTO THE 'HEB' RECORD IF PROCESSING A NON- 
*			  RMA-ALTERED SUBMISSION DISKETTE. 
 
*	98/03/31 (M.C.) - SOME DOCTOR DISKETTES DO NOT HAVE 'HER' RECORD 
*			  (HEADER 2), IF OPERATOR WANTS TO DEFAULT TO 
*			  AGENT 0 AND TAPE-SUBMIT-IND = 'Y', SET IN 
*			  HEADER 1 SUBROUTINE.  FOR OTHER DISKETTES 
*			  THAT HAVE HEADER 2 RECORD, SET AGENT AND 
*			  TAPE-SUBMIT-IND FROM HEADER 2 RECORD. 
* 
*	98/04/06 (M.C.) - MOVE SPACES TO HEADER-REC IN FB0 SUBROUTINE 
*			- FIX MINOR PROBLEM (2 DIGITS TO CLINIC NBR) 
*			- CHANGE PGM NAME U701 TO NEWU701 IN SCREEN 
*			  SECTION 
*       1999/mar/2 B.E. - added logic at 2nd test section of code to only require
*                         diagnosic code if oma-suffix is "A" or "M"  
*     1999/May/06 S.B.  - Marked by 'S.B.' (brought from 102)
*                       - Put in check against the Referring physician
*                       being the same sas the Billing doctor.
*                       - Put in check for missing Referring physician.
*                       - Added a check to insure that Service dates are
*                       after Run dates.
*                       - Added a check to make sure that the correct
*                       specialty for the doctor is used.
*                       - Added a check to make sure that each claim
*                       has a detail record.
*                       - Changed the err-msg to occur 50 times to
*                       reflect the new error messages possible.
*                       - Changed the claim value being put out on
*                       error 50 from unpriced-clmhdr-claim to
*                       clmhdr-accounting-nbr to show the correct
*                       claim for the error.
*                       - Added a reset for the ctr-hdr2-rec and
*                       ctr-addr-rec counters to prevent a missing
*                       detail from appearing on the first
*                       batch record after a previous batch that
*                       had any detail records in it.
* 2000/feb/08 B.A. - added 'confidentiality flag' field to tape in file in
*		     anticipation of this value being passed from Web site
*		   - code to process this field to be added later
* 2000/feb/29 B.A. - added logic to only allow a 'Y' or ' ' in the confid 
*		     flag field 
* 2000/mar/02 B.E. - pricing algorithm (ye0) used hard coded '7' for original
*		     restriction of 8 detail lines.  Changed code to have
*		     maximun allowed detail lines (40) set into variable
*		     "ss-max-nbr-oma-det-rec-allow" and use this
*		     variable in pricing algorthim.
* 2000/mar/13 B.E. - if incoming patient's phone number is only 7 digits long
*		     then default the area code stored in copy book code.
*
* 2000/mar/20 M.C. - open f030-location-mstr, retrieve hospital nbr and i/o ind
*		     from locations mstr by loc-code.
*		     If the original doctor ohip nbr is the same as referring 
*		     doctor ohip nbr, print error.
*		     If diskette price is different than the way rma prices, 
*		     print error
* 2000/mar/29 M.C. - If the incoming I/O ind is different than RMA i/o ind, 
*		     print error
* 2000/apr/05 M.C. - If the input file comes with amount and the oma code 
*		     suffix is either 'B' or 'C' (ie anesthesia), do not change
*                    nbr of svc (ie basic + time), but do for web
* 2000/apr/10 M.C. - Change the pricing algorithm correctly for add on codes
*		     (ie suffix = 'B' or 'C')
*		     suffix is either 'B' or 'C' (ie anesthesia), do not change
* 2000/apr/14 M.C. - Yas requested this verion not to check price difference 
* 2000/apr/28 B.A. - Added additional checks for confidential flag at dtl level
* 2000/jun/05 B.E. - correct pricing of tech portion of fee
* 2000/jun/30 B.E. - keep BI and OP flags by moving them into consecutives 
*		     services area
* 2000/jul/31 B.E. - when determining current vs previous rates use the 
*		     effective date in the oma code's f040 record rather
*		     than effective date in constants master
* 2000/aug/03 B.E. - pricing modified to take into consideration that
*                    oma fees now 9(4).999 rather than 9(5).99
* 00/sep/08 B.E. - modified to keep original sequence details when writing
*		   claim details to suspend dtl file
* 00/sep/10 B.E. - rtn yz0-reset-verify-prices that resets prices to incoming
*		   values moved from this pgm into ya0- copybook so that
*		   that calcuation of 'tech' amounts can be made on 
*		   new priced amounts or the incoming amounts depending
*		   upon whether they are reset or not
*		 - set clmhdr-nbr-suspend-desc-recs to zero
* 00/sep/14 B.E. - comment out error message is hospital number is missing.
*		   Since the location code is now used to derive the hospital
*		   number it is no longer a problem of the incoming 
*		   hospital number is missing/wrong
* 00/oct/02 B.E. - ctr-tot-dollars-claim was used to sum OHIP detail amts
*		   and update header's oma/ohip $ amounts. Pgm changed to 
*		   reprice diskette uploads and save 'rma' prices in oma
*		   amt and diskette's original price in ohip amt. Therefore
*		   setup 2 separate ctr-tot.. fields to keep oma / ohip
*		   running claim totals to update header
*		 - renamed 'override' flag as 'retain incoming' price
*		   flag to make it easier to distinguish between OP override
*		   price logic
* 00/oct/26 B.E. - allow operator to override the current system date. This
*		   options is only used in test when running the "master 
*		   test claims batch" which are "old" dates that will
*		   be greater than 6 months from the real system date
*		   and will thus give errors (state dates). We want the
*		   'master test claims" to price the same time after time
*		   so allow operator to set system back (this date is 
*		   usually set based upon the current pricing old/new
*		   date of 2000/04/01)
*		 - if any dates wrong move 8 "?" rather than 6 to date field
*			    	
* 00/nov/27 M.C. - for clinic 61-65 only, if referring doc nbr is same as orig
*		   doc nbr, do not print error 47; if referring doc nbr is blank
*		   set the same as orig doc nbr.  Yas requested the changes.
* 01/feb/06 B.E. - change to pricing routine to price loc G420 / oma code
*                  G259 at 85%
* 01/feb/07 M.C. - save RMB ohip nbr if exists  
* 01/feb/12 M.C. - when edit RMB registration nbr, the size has changed;
*		   please refer to MOH technical specification book.
* 01/feb/28 M.C. - if agent cd = 6 or 9, set clmhdr-status and clmdtl-status
*		   equal to 'I'gnore  
* 01/mar/08 M.C. - if service date is greater than the admit date, instead of
*		   putting ????/??/?? in the service date field, put ????/??/??
*		   in the admit date
* 01/mar/27 B.E. - tech/prof rules of DU/PF icc codes changed to
*                  substitute "B" or "C" suffix for "A" if tech/prof
*                  only pricing, or to split into two separate lines
*                  if tech and prof fees involved.
* 01/apr/23 B.E. - 'fee' amount for PERCENTAGE addon's now divided by 100 as
*	  	   read in from f040 into hold variables that allow a 
*		   4 decimal percentage
* 01/sep/28 B.E. - added create-error-file (an 88 flag) that controls the output
*		   of files and the errors that are generated. If the program
*		   is run 'print only' then the defaults are set to NOT upload
*		   the claims into the SUSPENSE files but to write them to
*		   the output 'priced' file. Also ALL errors are surpressed
*		   so that although the edits are performed the error message
*		   is bypassed and the claim is priced regardless. Subsequent
*		   changes should allow the program to be called and ONLY edit
*		   applied. The output file would then be a collection of
*		   errors. 
* 01/oct/03 B.E. - added clinic-nbr to diskout (priced) file
* 02/mar/25 B.E. - added PAYROLL-FLAG to HEB record (unpriced-bathdr-rec)
* 02/apr/23 M.C. - move  PAYROLL-FLAG to clmhdr-hosp, according to Brad, they
*		   are no longer used the hospital code  
* 02/may/03 M.C. - temporary edit check against staled svc date (< 20010901)
*	         - Yas want to set payroll-flag to 'B' if incoming clinic from HEB is 85
*		   otherwise set to 'A'		
* 02/may/27 M.C. - reinstate the staled svc date check
* 02/jun/12 M.C. - if billing special premiums K994 to K997 and facility number is blank or zero,
*		   error needs facility number
* 02/aug/12 M.C. - if billing special premiums K990 to K997 and facility number is blank or zero,
*		   error needs facility number
* 02/aug/21 M.C. - if clinic = 80 or 95, bypass the edit check against svc date within 6 months
* 03/jun/11 M.C. - if billing special premiums K990 to K997 and location code does not end with 112
*		   error wrong location needs to end with 112
* 03/oct/22 M.C. - error if clinic nbr is not valid for the doctor
* 03/dec/08 M.C. - alpha doc nbr
* 04/jan/20 M.C. - add location code 153 or 400 or 250 or 422 when checking OMA cd K990 to K997
*                  with location code 112
* 04/apr/07 M.C. - error if admit date is prior to birth date
* 04/sep/27 M.C. - add location code 401 when checking OMA cd K990 to K997
*                  with location code 112
* 05/mar/03 M.C. - error if doctor specialty = 07 and patient age < 60  
*		   or doctor specialty = 07 and oma codes = A775 or W775 or C775
*		   and patient age < 75
* 05/may/04 M.C. - edit check to make sure birth date < service date
*		 - if clinic 61 to 65, must be certain location code; otherwise errors
* 05/may/09 M.C. - If location = G420 and oma code = G259 and R761, add manual review
*		   "REFER TO ADJUDICATION" on description record
* 		   add open/close of f002-suspend-desc file
* 05/jun/23 M.C. - manitoba should have 9 digits instead of 6
*                  change province from NF to NL
* 05/aug/09 M.C. - set clmhdr-tape-submit-ind to blank for all conditions before writing
*		   suspend header record
* 05/aug/17 M.C. - change description from "REFER TO ADJUDICATION"  to
*		   "G259 BILLED AT 85%"
*		 - xx3-write-susp-desc subroutine is created
* 05/oct/31 M.C. - If oma code = 'E420', then error - check pricing               
*		   if doc nbr = '049' and oma cd = 'Z425', then error - take out manual review
*		   if oma code is A073 or A074..etc (45 codes altogether) and diag code is 042 or 043..etc
*		   (26 altogether) and E078 is not on the same claim , error - check for E078 premium
*		   if oma code is A073 or A074..etc (45 codes altogether) and diag code is NOT 042 or 043..etc
*		   (26 altogether) and E078 is on the same claim , error - check for E078 premium
* 05/dec/14 M.C. - add oma code 'A340', 'A341', 'A343' and 'A348' to the list above  done on 05/oct/31       
* 06/feb/15 M.C. - YAS requested to change from 40 to 60 detail record allowance
*                  change  maximun allowed detail lines (60) set into variable
*                    "ss-max-nbr-oma-det-rec-allow" and use this
*                    variable in pricing algorthim.

* 06/dec/12 M.C. - Yas requested to more edit checks in the program
*                - If billing code is C122 and the admit date is 1 day or more from the  service date,
*                  then report on ru701 (newu701) with message "Check C122".
*                - If billing code is C123 and the admit date is 2 days or more from the service date,
*                  then report on ru701 (newu701) with message "Check C123".
*                - If billing code is C124 and the admit date is less than 3 days from service date,
*                  then report on ru701 (newu701) with message "Check C124".

* 07/jan/25 M.C. - Yas requested to fine tuned the recent edit checks
*                - If billing code is C122 and the service date < 1 or >= 2 days from the admit date,
*          	   then report on ru701 (newu701) with message "Check C122".
*                - If billing code is C123 and the service date < 2 or >= 3 days from the admit date,
*                  then report on ru701 (newu701) with message "Check C123".
*                - If billing code is C124 and the service date <= 1 day from the admit date,
*                  then report on ru701 (newu701) with message "Check C124".
* 07/aug/16 M.C. - for clinic 71-75 only, if referring doc nbr is same as orig
*		   doc nbr, do not print error 47; if referring doc nbr is blank
*		   set the same as orig doc nbr.  Yas requested the changes.
* 07/oct/24 M.C. - add location code 055 when checking OMA cd K990 to K997
*                  with location code 112
* 07/oct/24 M.C. - add location code 326 when checking OMA cd K990 to K997
*                  with location code 112
* 07/nov/27 M.C. - do the same check for clinic 71 to 75 as 
*		    if clinic 61 to 65, must be certain location code; otherwise errors
* 08/jan/03 Y.B. - add location code 122 when checking OMA cd K990 to K997
*                  with location code 112
* 08/jan/09 M.C. - allow diagnostic 299, 313, 315, 765 & 902 with oma code E078A
* 08/jan/17 M.C. - include oma cd A262 to check with E078 premium
* 08/feb/19 M.C. - add location code 344 when checking OMA cd K990 to K997
*                  with location code 112
* 08/feb/28 M.C. - add location code 111 & 354  when checking OMA cd K990 to K997
*                  with location code 112
* 08/mar/18 M.C. - add location code 333 when checking OMA cd K990 to K997
*                  with location code 112
* 08/Apr/23 M.C. - add more edit check for messages 69 to 84
* 08/Apr/29 M.C. - if claims have 'A---A' code and 'G---A' code and one of the following
*		   K991A, K993A, K995A, K997A, U991A, U993A, u995A, U997A, then
*		   create  'Pay visit premium based on "A---A" code' to 2 description records
*		   and set clmhdr-manual-review  to 'Y'

environment division. 
input-output section. 
file-control. 
 
copy "f002_suspend_hdr.slr".
 
 
copy "f002_suspend_dtl.slr".
 
 
copy "f002_suspend_address.slr".
 
* 2005/05/09 - add description file
copy "f002_suspend_desc.slr".
* 2005/05/09 - end  
 
 
*COPY "F020_DOCTOR_MSTR_OHIP.SLR". 
copy "f020_doctor_mstr.slr".

*2000/03/20 - MC - include locations mstr
copy "f030_locations_mstr.slr".

copy "f040_oma_fee_mstr.slr".
 
copy "f090_constants_mstr.slr".
 
copy "f091_diagnostic_codes.slr". 
 
 
select unpriced-claims-file 
    assign to       "submit_disk_susp.in"
    organization is sequential 
    access mode  is sequential 
    status       is status-cobol-unpriced-claims. 
 
select priced-claims-file 
    assign to       "submit_disk_susp.out"
    organization is sequential 
    access mode  is sequential 
    status       is status-cobol-priced-claims. 

*2002/04/22 - MC - comment out 
*select error-claims-file 
*    assign to       "submit_disk_susp.err"
*    organization is sequential 
*    access mode  is sequential 
*    status       is status-cobol-error-claims. 
*2002/04/22 - end

 
select report-file 
    assign to        printer audit-file 
    Status       is  status-report. 
 
 
data division. 
file section. 
 
*COPY "F002_SUBMIT_DISKETTE_COMMON.FD". 
 
* MODIFICATION HISTORY 
*  97/JUN/21 B.E.	-ADDED OP_OVERRIDE_PRICE_IND 
*			 AND   BI_BILATERAL_IND 
*  97/SEP/25 B.E.	-ADDED CLINIC-NBR-1-2 
*  98/MAR/18 B.E.	-ADDED TAPEOUT-DEFAULT-BATCH-LOCATION. IF PROCESSING 
*		         AN 'UNALTERED' OHIP SUBMISSION DISKETTE 
*			 THEN NO RMA LOCATION HAS BEEN INCLUDED 
*			 ON EACH DETAIL RECORD. ALLOW RMA OPERATOR 
*			 TO EDIT DISKETTE FILE AND MANUALLY ADD 
*			 LOCATION TO 'HEB' BATCH HEADER RECORD. 
*2002/mar/25 B.E.	- added PAYROLL-FLAG to HEB record (unpriced-bathdr-rec)
* 
fd  unpriced-claims-file 
*mf    recording mode is data-sensitive 
    data records are unpriced-claims-record. 
 
01  unpriced-claims-record. 
    05  unpriced-trans-id                        pic xx. 
    05  unpriced-input-rec-type                  pic x. 
    05  unpriced-bathdr-rec. 
* (y2k additional field)
        10  unpriced-release-id                  pic x(3).

        10  unpriced-moh-code                    pic x. 
        10  unpriced-bathdr-batch-nbr. 
* (y2k)
*           15  unpriced-bathdr-batch-nbr-date   pic 9(6).
            15  unpriced-bathdr-batch-nbr-date   pic 9(8).
            15  unpriced-bathdr-batch-nbr-seq    pic 9(4).
        10  unpriced-bathdr-opr-nbr              pic x(6). 
        10  unpriced-bathdr-fac-no               pic x(4). 
        10  unpriced-bathdr-prov-ohip-no         pic 9(6). 
        10  unpriced-bathdr-spec-cd              pic 9(2). 
*       10  FILLER                              PIC X(40). 
* (y2k)
*       10  filler                              pic x(35). 
*       10  filler                              pic x(30). 
*       (2002/mar/25 added payroll flag - "A" regular 22 payroll
*					- "B" ICU payroll)
        10  filler                              pic x(29). 
        10  unpriced-payroll-flag               pic x(1). 
        10  unpriced-default-batch-i-o-ind      pic x(1). 
        10  unpriced-default-batch-loc      	pic x(4). 
        10  unpriced-bathdr-clinic-1-2          pic 99. 
        10  unpriced-bathdr-dept                pic 99. 
*!        10  unpriced-bathdr-doc-nbr             pic 9(3). 
        10  unpriced-bathdr-doc-nbr             pic x(3). 
 
    05  unpriced-clmhdr1-rec redefines unpriced-bathdr-rec. 
 
        10  unpriced-clmhdr-health-nbr           pic x(10). 
        10  unpriced-clmhdr-version-cd           pic x(2). 
        10  unpriced-clmhdr-birth-date. 
* (y2k)
*           15  unpriced-clmhdr-birth-date-yy    pic 99. 
            15  unpriced-clmhdr-birth-date-yy    pic 9(4). 
            15  unpriced-clmhdr-birth-date-mm    pic 99. 
            15  unpriced-clmhdr-birth-date-dd    pic 99. 
        10  unpriced-clmhdr-claim. 
*!            15  unpriced-clmhdr-doc-nbr          pic 9(3). 
            15  unpriced-clmhdr-doc-nbr          pic x(3). 
            15  unpriced-clmhdr-wk               pic xx. 
            15  unpriced-clmhdr-day              pic x. 
            15  unpriced-clmhdr-claim-nbr        pic xx. 
        10  unpriced-clmhdr-pay-pgm              pic x(3). 
        10  unpriced-clmhdr-payee                pic x. 
        10  unpriced-clmhdr-ref-doc-nbr          pic 9(6). 
        10  unpriced-clmhdr-hosp-nbr             pic x(4). 
        10  unpriced-clmhdr-admit-date. 
* (y2k)
*           15  unpriced-clmhdr-admit-date-yy    pic xx. 
            15  unpriced-clmhdr-admit-date-yy    pic x(4). 
            15  unpriced-clmhdr-admit-date-mm    pic xx. 
            15  unpriced-clmhdr-admit-date-dd    pic xx. 
        10  unpriced-clmhdr-ref-lab-no           pic 9(4). 
        10  unpriced-clmhdr-man-review           pic x. 
* (y2k additional field)
	10  unpriced-moh-location-code		pic 9(4).
	10  unpriced-reserved-for-ooc		pic x(11).
*       10  filler                              pic x(25). 
        10  filler                              pic x(06). 

*	(FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT 
*	 HAD 81 BYTES IN IT) 
*mf        10  filler                              pic x(40). 
 
    05  unpriced-clmhdr2-rec redefines unpriced-bathdr-rec. 
 
        10  unpriced-clmhdr-pat-ohip-nbr         pic x(12). 
        10  unpriced-clmhdr-pat-surname          pic x(9). 
        10  unpriced-clmhdr-given-name           pic x(5). 
        10  unpriced-clmhdr-sex                  pic 9. 
        10  unpriced-clmhdr-prov-cd              pic x(2). 

* *1999/dec/30 B.E. added new field in anticipation of this value
*	            being passed from Web site)
*       10  filler                              pic x(31). 
        10  filler                              pic x(30). 
        10  unpriced-confidentiality-flag        pic x(1). 

        10  unpriced-clmhdr-loc-code             pic x(4). 
        10  unpriced-clmhdr-agent-cd             pic x. 
        10  unpriced-clmhdr-i-o-ind              pic x. 

* (2000/mar/15 B.E. - added redefine of phone nbr field)
        10  unpriced-clmhdr-phone-no.
            15 unpriced-clmhdr-phone-no-1-7	pic x(07).
            15 unpriced-clmhdr-phone-no-8-10	pic x(03).
        10  unpriced-clmhdr-phone-no-r redefines unpriced-clmhdr-phone-no.
            15 unpriced-clmhdr-phone-no-1-3	pic x(03).
            15 unpriced-clmhdr-phone-no-4-10	pic x(07).
    

*	(FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT 
*	 HAD 81 BYTES IN IT) 
*mf        10  filler                              pic x(40). 
 
 
    05  unpriced-item-rec redefines unpriced-bathdr-rec. 
 
        10  unpriced-itm1-oma-svc-cd. 
            15  unpriced-itm1-oma-svc-code       pic x(4). 
            15  unpriced-itm1-oma-svc-suff       pic x. 
        10  filler                              pic x(2). 
        10  unpriced-itm1-oma-amt-billed         pic 9(4)v99. 
        10  unpriced-itm1-nbr-serv               pic 99. 
        10  unpriced-itm1-svc-date. 
* (y2k)
*           15  unpriced-itm1-svc-date-yy        pic 99. 
            15  unpriced-itm1-svc-date-yy        pic 9(4).
            15  unpriced-itm1-svc-date-mm        pic 99. 
            15  unpriced-itm1-svc-date-dd        pic 99. 
        10  unpriced-itm1-diag-cd                pic x(3). 
        10  filler-diag                         pic x(1). 
*++ W A R N I N G +++++++ W A R N I N G ++++++++ W A R N I N G +++++
* (y2k)
*
*    (this following reserved field should be 10 digits but
*     we have used 2 bytes for price override and bilateral so the
*     space is not there to reserve the full 10 bytes. Thus the 9
*     byte filler is used which may lead to future problems. If this
*     occ field is eventually used, then the record length will have
*     to be increased and two separate definitions/pgms will
*     be needed to process 'normal' format diskettes vs the 'rma web' diskette
*	10  unpriced-reserved-for-ooc		pic x(10).
	10  unpriced-reserved-for-ooc		pic x(09).
*++ W A R N I N G +++++++ W A R N I N G ++++++++ W A R N I N G +++++
*       10  FILLER                              PIC X(13). 
*       10  filler                              pic x(11). 
        10  unpriced-itm1-override-price         pic x(1). 
        10  unpriced-itm1-bilateral              pic x(1). 
 
        10  unpriced-itm2-oma-svc-cd. 
            15  unpriced-itm2-oma-svc-code       pic x(4). 
            15  unpriced-itm2-oma-svc-suff       pic x. 
        10  filler                              pic x(2). 
        10  unpriced-itm2-oma-amt-billed         pic 9(4)v99. 
        10  unpriced-itm2-nbr-serv               pic 99. 
        10  unpriced-itm2-svc-date. 
* (y2k)
*           15  unpriced-itm2-svc-date-yy        pic 99. 
            15  unpriced-itm2-svc-date-yy        pic 9(4).
            15  unpriced-itm2-svc-date-mm        pic 99. 
            15  unpriced-itm2-svc-date-dd        pic 99. 
        10  unpriced-itm2-diag-cd                pic x(4). 
*++ W A R N I N G +++++++ W A R N I N G ++++++++ W A R N I N G +++++
*
*    (this following reserved field should be 10 digits but
*     we have used 2 bytes for price override and bilateral so the
*     space is not there to reserve the full 10 bytes. Thus the 9
*     byte filler is used which may lead to future problems. If this
*     occ field is eventually used, then the record length will have
*     to be increased and two separate definitions/pgms will
*     be needed to process 'normal' format diskettes vs the 'rma web' diskette
*	10  unpriced-reserved-for-ooc		pic x(10).
	10  unpriced-reserved-for-ooc		pic x(09).
*++ W A R N I N G +++++++ W A R N I N G ++++++++ W A R N I N G +++++
*       10  FILLER                              PIC X(13). 
*       10  filler                              pic x(11). 
        10  unpriced-itm2-override-price         pic x(1). 
        10  unpriced-itm2-bilateral              pic x(1). 
*	(FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT 
*	 HAD 81 BYTES IN IT) 
*mf        10  filler                              pic x(40). 
 
    05  unpriced-pat-addr-rec redefines unpriced-bathdr-rec. 
 
        10  unpriced-pat-addr-1                  pic x(25). 
        10  unpriced-pat-addr-2                  pic x(25). 
        10  unpriced-pat-addr-3                  pic x(18). 
        10  unpriced-pat-addr-post-cd. 
            15  unpriced-pat-addr-post-cd1       pic x. 
            15  unpriced-pat-addr-post-cd2       pic 9. 
            15  unpriced-pat-addr-post-cd3       pic x. 
            15  unpriced-pat-addr-post-cd4       pic 9. 
            15  unpriced-pat-addr-post-cd5       pic x. 
            15  unpriced-pat-addr-post-cd6       pic 9. 
        10  filler                              pic x(2). 
*	(FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT 
*	 HAD 81 BYTES IN IT) 
*mf        10  filler                              pic x(40). 
 
    05  unpriced-trailer-rec redefines unpriced-bathdr-rec. 
 
        10  unpriced-trailer-clmhdr1-cnt         pic 9(4). 
        10  unpriced-trailer-clmhdr2-cnt         pic 9(4). 
        10  unpriced-trailer-itm-cnt             pic 9(5). 
        10  unpriced-trailer-pat-addr-cnt        pic 9(4). 
        10  filler                              pic x(59). 
*	(FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT 
*	 HAD 81 BYTES IN IT) 
*mf        10  filler                              pic x(40). 
 
    05  unpriced-cr                              pic x. 
fd  priced-claims-file 
*   RECORDING MODE IS DATA-SENSITIVE 
*     (2001/oct/03 B.E. added new clinic-nbr field)
**    record contains 59  characters 
    record contains 61  characters 
    data records are diskout-output-rec. 
 
01  diskout-output-rec. 
*	    (2001/oct/03 B.E. added new clinic-nbr field)
	10  diskout-clmhdr-clinic-nbr		pic x(2).

        10  diskout-clmhdr-claim		pic x(8). 
        10  diskout-oma-svc-cd. 
            15  diskout-oma-svc-code	        pic x(4). 
            15  diskout-oma-svc-suff	        pic x. 
        10  diskout-ohip-amt-billed	        pic 9(4)v99. 
 
        10  diskout-svc-date. 
* (y2k)
*           15  diskout-svc-date-yy	        pic 99. 
            15  diskout-svc-date-yy	        pic 9(4). 
            15  diskout-svc-date-mm	        pic 99. 
            15  diskout-svc-date-dd	        pic 99. 
        10  diskout-nbr-serv	                pic 99. 
        10  diskout-oma-amt-billed	        pic 9(4)v99. 
        10  diskout-priced-tech   	        pic 9(4)v99. 
        10  diskout-basic-tech    	        pic 9(4)v99. 
        10  diskout-basic-prof     	        pic 9(4)v99. 
        10  diskout-basic-fee      	        pic 9(4)v99. 
        10  diskout-cr                          pic x. 
        10  diskout-lf                          pic x. 
copy "f002_suspend_hdr.fd".
 
copy "f002_suspend_dtl.fd".

copy "f002_suspend_address.fd".

* 2005/05/09 - add description file
copy "f002_suspend_desc.fd".
* 2005/05/09 - end  
 
* COPY "F020_DOCTOR_MSTR_OHIP.FD". 
copy "f020_doctor_mstr.fd".
 
*2000/03/20 - MC - include locations mstr
copy "f030_locations_mstr.fd". 

copy "f040_oma_fee_mstr.fd".
 
copy "f090_constants_mstr.fd".
 
copy "f090_const_mstr_rec_2.ws".
copy "f091_diagnostic_codes.fd".
 
fd  report-file 
    record contains 132 characters. 
 
01  rpt-line                    pic x(132). 
working-storage section. 

************************************************************************
*   (variables below are needed by ya0- pricing copybook logic but 
*    are only referenced within d001 so they are dummied up here so that
*    this pgm will compile)
77  password-input                              pic x(3).
77  password-special-privledges                 pic x(3)  value "xxx".
77  confirm                               	pic x   value space.
77  scr-hold-oma-cd				pic x	value space.
77  scr-hold-oma-suff				pic x	value space.
77  scr-hold-sv-date-yy-12			pic x	value space.
77  scr-hold-sv-date-yy-34			pic x	value space.
77  scr-hold-sv-date-mm				pic x	value space.
77  scr-hold-sv-date-dd				pic x	value space.
77  scr-hold-sv-nbr-0				pic x   value space.
77  scr-hold-fee-oma				pic x   value space.
77  scr-hold-fee-ohip				pic x   value space.
77  scr-acpt-det-desc				pic x   value space.
77  scr-last-claim      	pic x   value space.
77  pline					pic 9   value zero.
************************************************************************

 
*mf 77 ws-1-null				pic x(1) value "<000>". 
*mf 77 ws-4-nulls				pic x(4) value "<000><000><000><000>". 
77 ws-1-null					pic x(1) value x"00".   
77 ws-4-nulls					pic x(4) value x"00000000".

77  ws-warning-literal				pic x(14) value "* Warning * -".
77  ws-error-literal				pic x(14) value "**ERROR** - ".

01  temp-phone-nbr.
   05 temp-phone-nbr-justified-left.
      10 temp-phone-nbr-1-7			pic 9(7).
      10 temp-phone-nbr-8-10			pic 9(3).
   05 temp-phone-nbr-justified-right redefines temp-phone-nbr-justified-left.
      10 temp-phone-nbr-1-3			pic 9(3).
      10 temp-phone-nbr-4-10			pic 9(7).

01  batch-rec. 
  05  batch-dist-cd                             pic x. 
  05  batch-identifier                          pic x(10). 
  05  batch-group-nbr                           pic x(4). 
  05  batch-provider-nbr                        pic 9(6). 
  05  batch-speciality                          pic 9(2). 
  05  batch-pay-type                            pic 9. 

* ('dummy' field added to allow compile of common code shared between
*  this pgm and d001)
01 nbr-of-services 				pic 99. 
 
01  header-rec. 
  05  hdr-ohip-nbr. 
      10  nf-ohip-nbr                           pic x(12). 
*2001/02/12 - MC - change the size of the ohip nbr for various provinces
*     10  ab-ns-ohip-nbr redefines nf-ohip-nbr. 
*         15  ab-ns-11-digits                   pic x(11). 
*         15  ab-ns-last-digits                 pic x. 
*     10  bc-ohip-nbr redefines nf-ohip-nbr. 
*         15  bc-10-digits                      pic x(10). 
*         15  bc-last-digits                    pic xx. 
      10  bc-ns-ohip-nbr redefines nf-ohip-nbr. 
          15  bc-ns-10-digits                   pic x(10). 
          15  bc-ns-last-digits                 pic xx. 
*     10  nb-pe-sk-yt-ohip-nbr  redefines nf-ohip-nbr. 
*         15  nb-pe-sk-yt-9-digits              pic x(9). 
*         15  nb-pe-sk-yt-last-digits           pic xxx. 
      10  ab-nb-sk-yt-ohip-nbr  redefines nf-ohip-nbr. 
          15  ab-nb-sk-yt-9-digits              pic x(9). 
          15  ab-nb-sk-yt-last-digits           pic xxx. 
      10  pe-ohip-nbr redefines	nf-ohip-nbr.
	  15  pe-8-digits			pic x(8).
	  15  pe-last-digits			pic x(4).
*** end
      10  nt-ohip-nbr redefines nf-ohip-nbr. 
          15  nt-first-digit                    pic x. 
          15  nt-7-digits                       pic x(7). 
          15  nt-last-digits                    pic x(4). 
      10  mb-ohip-nbr redefines nf-ohip-nbr. 
* 2005/06/23 - MC - Manitoba should have 9 digits
*         15  mb-6-digits                       pic x(6).
*         15  mb-last-digits                    pic x(6).
          15  mb-9-digits                       pic x(9).
          15  mb-last-digits                    pic x(3).
* 2005/06/23 - end

  05  hdr-surname                               pic x(9). 
  05  hdr-first-name                            pic x(5). 

  05  hdr-birth-date-long. 
*  Birth Date split up into yymm and dd 
* (y2k)
*   10  hdr-birth-date                          pic 9(4). 
    10  hdr-birth-date                          pic 9(6). 
    10  hdr-birth-date-dd                       pic 9(2). 
  05  hdr-sex                                   pic x. 
  05  hdr-accounting-nbr                        pic x(8). 
  05  hdr-refer-pract-nbr                       pic 9(6). 
  05  hdr-hosp-nbr                              pic x(4). 
  05  hdr-i-o-ind                               pic x. 
  05  hdr-admit-date. 
* (y2k)
*   15  hdr-admit-yy                            pic xx. 
    15  hdr-admit-yy                            pic x(4).
    15  hdr-admit-mm                            pic 99. 
    15  hdr-admit-dd                            pic 99. 
  05  hdr-manual-review                         pic x(1). 
  05  hdr-health-care-nbr                       pic x(12). 
  05  hdr-health-care-ver                       pic x(02). 
  05  hdr-health-care-prov                      pic x(02). 
  05  hdr-relationship                          pic x(01). 
  05  hdr-patient-surname                       pic x(09). 
  05  hdr-subscr-initials                       pic x(03). 
  05  hdr-agent-cd                              pic x(01). 

* 2003/06/11 - MC
*  05  hdr-loc-code                              pic x(04). 
  05  hdr-loc-code.  
      10 hdr-loc-alpha                           pic x. 
      10 hdr-loc-nbr                             pic x(03). 
* 2003/06/11 - end
 
*     DATA STORED IN WORKING-STORAGE FROM FILES THAT SHARE I-O BUFFER AREAS. 
 
*   (THE FOLLOWING 'DOC' FIELDS WERE CLONED FROM D001 WHEN THE D001 PRICING 
*    CODE WAS MERGED INTO U701. THESE VALUES ARE *NOT* USED IN THIS PGM 
*    AND THE PRICING CODE HAS BEEN CHANGED WERE APPROPRIATE) 
01  ws-doc-mstr-rec-data. 
    05  ws-doc-nx-batch-nbr                     pic  999. 
    05  ws-doc-dept                             pic   99. 
    05  ws-doc-ohip-nbr                         pic 9(6). 
    05  ws-doc-spec-cd                          pic   99. 
    05  ws-doc-locations. 
        10  ws-doc-loc  occurs 30               pic x999. 
 
01    detail-rec. 
  05  dtl-oma-cd                                pic x(4). 
  05  dtl-oma-suff                              pic x(1). 
  05  dtl-fee-billed                            pic 9999v99. 
  05  dtl-nbr-of-serv                           pic 99. 
  05  dtl-serv-date. 
* (y2k)
*       10  dtl-serv-date-yy                    pic 99. 
        10  dtl-serv-date-yy                    pic 9(4).
        10  dtl-serv-date-mm                    pic 99. 
        10  dtl-serv-date-dd                    pic 99. 
  05  dtl-diag-code                             pic x(3). 
 
01  trailer-rec. 
  05  trl-h-count                               pic 9(4). 
  05  trl-r-count                               pic 9(4). 
  05  trl-t-count                               pic 9(4). 
  05  trl-a-count                               pic 9(4). 
  05  trl-b-count                               pic 9(4). 
 
77  audit-file                                  pic x(9) value "ru701". 
77  suspend-dtl-occur                           pic 9(7). 
77  ws-carriage-ctrl                            pic 9(02) value 0. 
77  ctr-lines-printed                           pic 9(03) value 99. 
77  max-lines-per-page                          pic 9(03) value 60. 
77  ws-rpt-page-nbr                             pic 9(03) value 0. 
77  ws-agent-default-reply                      pic x(01) value spaces. 
*!77  ws-doc-nbr                                  pic 9(3)  value 0. 
77  ws-doc-nbr                                  pic x(3)  value spaces.
*77  WS-DEFAULT-CLINIC-NBR                       PIC 9(4)  VALUE 0. 
77  ws-default-clinic-nbr                       pic 9(2)  value 0. 
77  ws-default-batch-location                   pic x(4)  value " ". 
77  ws-default-batch-i-o-ind                    pic x(1)  value " ". 

*2002/04/24 -  MC
77  ws-default-payroll-flag			pic x.
*20002/04/24 - end

77  flag-zero-fee                               pic x. 
77  feedback-iconst-mstr                        pic x(4). 
77  ws-tot-serv                                 pic 999   value 0.
77  ws-special-add-on-cd-entered                pic x. 

* 2005/11/01 - MC
77  ws-e078-premium  				pic x. 
* 2005/11/01 - end

* 2008/04/28 - MC
77  ws-e020          				pic x. 
77  ws-e719          				pic x. 
77  ws-e720          				pic x. 
77  ws-e717          				pic x. 
77  ws-e702          				pic x. 
77  ws-g123          				pic x. 
77  ws-g223          				pic x. 
77  ws-g265          				pic x. 
77  ws-g385          				pic x. 
77  ws-g281          				pic x. 
77  ws-e793          				pic x. 
77  ws-e022-e017-e016				pic x. 
77  ws-z570          				pic x. 
77  ws-z571          				pic x. 
77  ws-z555-z580     				pic x. 
77  ws-z515-z760     				pic x. 
77  ws-g228          				pic x. 
77  ws-g231          				pic x. 
77  ws-g264          				pic x. 
77  ws-g384          				pic x. 
77  ws-g381          				pic x. 
77  ws-r905-s800     				pic x. 
77  ws-annna           				pic x. 
77  ws-gnnna         				pic x. 
77  ws-k991-u997     				pic x. 
* 2008/04/28 - end
77  ws-pricing-nbr-serv                         pic 999. 
77  ws-highest-grp-tot                          pic s9(5)v99. 
77  ws-highest-grp-nbr                          pic 99. 
77  flag-new-sec                                pic x. 
77  flag-z-highest-grp                          pic x. 
* 
*  SUBSCRIPTS 
* 
77  rate-found-ss                               pic 99  comp  value 0. 
77  subs                                        pic 99  comp  value 0. 
77  ss                                          pic 99  comp  value 0. 
77  sub                                         pic 99  comp  value 0. 
77  ss1                                         pic 99  comp  value 0. 
77  ss2                                         pic 99  comp  value 0. 
77  ss-basic-times                              pic 99  comp  value 0. 
77  ss-basic-times-desc-rec                     pic 99  comp  value 0. 
77  ss-from-plus-one                            pic 99  comp  value 0. 
77  ss-const                                    pic 99  comp  value 0. 
77  subs-table-addr                             pic 99  comp  value 0. 
77  i                                           pic 99  comp  value 0. 
77  ss-from                                     pic 99  comp  value 0. 
77  ss-to                                       pic 99  comp  value 0. 
77  ss-sec                                      pic 99  comp  value 0. 
77  ss-grp                                      pic 99  comp  value 0. 
77  ss-grp-tot                                  pic 99  comp  value 0. 
77  ss-clmhdr                                   pic 99  comp  value 0. 
77  ss-tech-prof-suff                           pic 99  comp  value 0. 
77  ss-clmdtl-oma                               pic 99  comp  value 0. 
77  ss-clmdtl-next-avail-dtl                    pic 99  comp  value 0. 
77  ss-clmdtl-new-dtl                           pic 99  comp  value 0. 
77  ss-clmdtl-tech-prof-suff                    pic 99  comp  value 0. 
77  ss-hold-clmdtl-oma                          pic 99  comp  value 0. 
77  ss-price                                    pic 99  comp  value 0. 
77  ss-write-dtl                                pic 99  comp  value 0. 
77  ss-clmdtl-desc                              pic 99  comp  value 0. 
77  ss-conseq-dd                                pic 99  comp  value 0. 
77  ss-ind                                      pic 99  comp  value 0. 
77  ss-plus-one                                 pic 99  comp  value 0. 
77  ss-x                                        pic 99  comp  value 0. 
77  ss-suffix                                   pic 99  comp  value 0. 
*       (SUBSCRIPTS FOR HOLD-OMA-RECORDS TABLE) 
*       (moved to pricing hold.ws copybook)
 
77  ws-hold-wcb-rate                            pic 999v9(5). 
77  ws-reduc-rate98                             pic 99v99. 
77  ws-reduc-rate99                             pic 99v99. 
77  ws-reduc-rate                               pic 99v99. 
77  ws-search-clinic-nbr-1-2                    pic 99  comp  value 0. 
*   ('CURR'ENT AND 'PREV'IOUS USED IN SELECTING THE APPROPRIATE OMA YEAR'S FEES -- 
*    'OMA' AND 'OHIP' TO SELECT THE APPROPRIATE FEE TYPE) 
77  curr                                        pic 9   comp    value 1. 
77  prev                                        pic 9   comp    value 2. 
77  oma                                         pic 9   comp    value 1. 
77  ohip                                        pic 9   comp    value 2. 
77  ss-curr-prev                                pic 99  comp  value 0. 
 
77  space-char                                  pic x(01) value " ".   
77  carriage-return                             pic x(01) value x"0D". 
77  line-feed                                   pic x(01) value x"0A". 
77  ws-hold-temp-1                              pic s9(7)v99. 
77  ws-hold-temp-2                              pic 99. 
77  ws-hold-temp-3                              pic s9(9). 
 
01  bt-clinic-nbr-1-2                           pic 99  value zero. 
01  subs-hosp                                   pic 99  comp  value 0. 
 
01  ws-date-yymmdd. 
* (y2k)
*   05 ws-date-yy                               pic 99. 
    05 ws-date-yy                               pic 9(4).
    05 ws-date-mm                               pic 99. 
    05 ws-date-dd                               pic 99. 
 
01  ws-nbr-10                                   pic x(10). 

* 2005/03/03 - MC
01  ws-birth-date				pic 9(8).
01  ws-sv-date					pic 9(8).
* 2005/03/03 - end 
 
*01  hold-suspend-hdr-rec                        pic x(265). 
01  hold-suspend-hdr-rec                        pic x(278). 
 
*     DATA STORED IN WORKING-STORAGE FOR CONSTANTS MASTER CLINIC REC SINCE 
*     FD AREA IS RE-USED FOR CONSTANTS MASTER PRICING RECS. 
 
01  ws-iconst-mstr-rec-data. 
    05  ws-iconst-clinic-nbr-1-2                pic   99. 
    05  ws-iconst-clinic-nbr                    pic 9(4). 
    05  ws-iconst-clinic-cycle-nbr              pic   99. 
* (y2k)
*   05  ws-iconst-date-period-end               pic 9(6). 
    05  ws-iconst-date-period-end               pic 9(8). 
    05  ws-iconst-clinic-card-colour            pic    x. 
 
01  audit-line. 
    05  filler                                  pic x(10) value spaces. 
    05  audit-title                             pic x(36). 
    05  audit-value                             pic zz,zzz. 
    05  filler                                  pic x(05) value spaces. 
    05  audit-value-2                           pic zz,zzz. 
    05  filler                                  pic x(05) value spaces. 
    05  audit-value-3                           pic zz,zzz. 
    05  filler                                  pic x(05) value spaces. 
    05  audit-value-4                           pic zz,zzz. 
    05  filler                                  pic x(05) value spaces. 
    05  audit-value-5                           pic zzz,zzz.99 blank when zero. 
 
01  status-values. 
  02 status-infos. 
    05  status-unpriced-claims                  pic x(11)  value zero. 
    05  status-priced-claims-file                  pic x(11)  value zero. 
    05  status-iconst-mstr                      pic x(11)  value zero. 
    05  status-doc-mstr                         pic x(11)  value zero. 
    05  status-oma-mstr                         pic x(11)  value zero. 
    05  status-suspend-hdr                      pic x(11)  value zero. 
    05  status-suspend-dtl                      pic x(11)  value zero. 
* 2005/08/17 - MC
    05  status-suspend-desc                     pic x(11)  value zero. 
* 2005/08/17 - end
    05  status-suspend-addr                     pic x(11)  value zero. 
    05  status-diag-mstr                        pic x(11)  value zero. 
    05  status-file                             pic x(11). 
  02 status-cobol. 
    05  status-cobol-unpriced-claims            pic x(02)  value zero. 
    05  status-cobol-priced-claims              pic x(02)  value zero. 
    05  status-cobol-doc-mstr                   pic x(02)  value zero. 
    05  status-cobol-oma-mstr                   pic x(02)  value zero. 
    05  status-cobol-iconst-mstr 		pic x(02)  value zero. 
    05  status-cobol-suspend-hdr                pic x(02)  value zero. 
    05  status-cobol-suspend-dtl                pic x(02)  value zero. 
* 2005/08/17 - MC
    05  status-cobol-suspend-desc               pic x(02)  value zero. 
* 2005/08/17 - end
    05  status-cobol-suspend-addr               pic x(02)  value zero. 
    05  status-cobol-diag-mstr                  pic x(02)  value zero. 
    05  status-report                           pic x(02)  value zero. 
*2000/03/20 - MC - include loc mstr
    05  status-cobol-loc-mstr                   pic x(02)  value zero. 
*2002/04/24 - MC - include error-claims
    05  status-cobol-error-claims               pic x(02)  value zero. 
 
01  feedback-values. 
    05  feedback-doc-mstr                       pic x(04)  value zero. 
    05  feedback-oma-fee-mstr                   pic x(04)  value zero. 
    05  feedback-suspend-hdr                    pic x(04)  value zero. 
    05  feedback-suspend-dtl                    pic x(04)  value zero. 
    05  feedback-suspend-addr                   pic x(04)  value zero. 
    05  feedback-diag-mstr                      pic x(04)  value zero. 

01  flag-adjudication-required                  pic x.
    88 adjudication-desc-required               value "Y".
 
01  ic-flag                                     pic x  value "N". 
    88  ic-entered                              value "Y". 
    88  ic-not-entered                          value "N". 
 
01  flag                                        pic x. 
    88 ok                                       value "Y". 
    88 not-ok                                   value "N". 
 
01  eof-input-file-flag                         pic x   value "N". 
    88 eof-input-file                   value "Y". 
 
01  fatal-error-flag                            pic x   value spaces. 
    88 fatal-error                      value "Y". 
 
01  flag-lock                                   pic x. 
    88 rec-locked                               value "Y". 
    88 rec-not-locked                           value "N". 
 
01  flag-ohip-vs-chart                          pic x. 
    88  qhip                                    value "O". 
    88  chart                                   value "C". 
    88  direct                                  value "D". 
 
01  flag-valid-ohip-or-chart                    pic x. 
    88  valid-ohip                              value "Y". 
    88  valid-chart                             value "Y". 
    88  invalid-ohip                            value "N". 
    88  invalid-chart                           value "N". 
 
01  flag-ohip-mmyy                              pic x. 
    88  valid-mmyy                              value "Y". 
    88  invalid-mmyy                            value "N". 
 
01  flag-err-data                               pic x. 
    88  err-data                                value "N". 
    88  ok-data                                 value "Y". 
 
01  flag-done-clmdtl-recs                       pic x. 
    88  done-clmdtl-recs-yes                    value "Y". 
 
01  flag-eoj                                    pic x. 
    88  eoj-create-new-patient                  value "C". 
    88  eoj                                     value "E". 

01  flag-tech-prof-suffix-rule			pic x.
    88  tech-prof-suff-rule-applied		value "Y".
 
01  flag-sec-reduction-needed                   pic x. 
 
01  flag-report-desc                            pic x. 
    88 report-desc-required                     value "Y". 
 
01  ws-oma-cd. 
    05  ws-oma-cd-1                             pic x. 
    05  ws-oma-cd-2-4                           pic 999. 
 
*mf 01 skip-processing-this-acct-id-flag            pic x. 
01 skip-process-this-acct-id-flag            pic x.
    88 skip-processing-this-acct-id     value "Y". 
    88 skip-hdr-addr-but-write-dtl      value "D". 
 
01  record-type-flags                   pic x. 
    88 b-record                         value "B". 
    88 h-record                         value "H". 
    88 r-record                         value "R". 
    88 t-record                         value "T". 
    88 a-record                         value "A". 
    88 e-record                         value "E". 
 
01 last-record-type-flag                        pic x. 
    88 last-record-is-b                 value "B". 
    88 last-record-is-h                 value "H". 
    88 last-record-is-r                 value "R". 
    88 last-record-is-t                 value "T". 
    88 last-record-is-a                 value "A". 
    88 last-record-is-e                 value "E". 
 
01  counters. 
    05  ctr-read-const-mstr                     pic 9(7). 
    05  ctr-diskout-writes			pic 9(7). 
    05  ctr-suspend-hdr-writes                  pic 9(7). 
    05  ctr-suspend-dtl-writes                  pic 9(7). 
* 2005/08/17 - MC
    05  ctr-suspend-desc-writes                 pic 9(7). 
* 2005/08/17 - end
    05  ctr-suspend-addr-writes                 pic 9(7). 
    05  ctr-recs-read                           pic 9(7). 
    05  ctr-b-recs-read-skipped                 pic 9(7). 
    05  ctr-h-recs-read-skipped                 pic 9(7). 
    05  ctr-r-recs-read-skipped                 pic 9(7). 
    05  ctr-t-recs-read-skipped                 pic 9(7). 
    05  ctr-a-recs-read-skipped                 pic 9(7). 
    05  ctr-e-recs-read-skipped         	pic 9(7). 
    05  ctr-b-recs-read                         pic 9(7). 
    05  ctr-h-recs-read                         pic 9(7). 
    05  ctr-r-recs-read                         pic 9(7). 
    05  ctr-t-recs-read                         pic 9(7). 
    05  ctr-a-recs-read                         pic 9(7). 
    05  ctr-e-recs-read                         pic 9(7). 
    05  ctr-h-recs-skipped                      pic 9(7). 
    05  ctr-r-recs-skipped                      pic 9(7). 
    05  ctr-t-recs-skipped                      pic 9(7). 
    05  ctr-a-recs-skipped                      pic 9(7). 
    05  ctr-tot-b-recs                          pic 9(7). 
    05  ctr-tot-h-recs                          pic 9(7). 
    05  ctr-tot-r-recs                          pic 9(7). 
    05  ctr-tot-t-recs                          pic 9(7). 
    05  ctr-tot-a-recs                          pic 9(7). 
    05  ctr-tot-dollars-read                    pic 9(7)v99. 

*    05  ctr-tot-dollars-claim                   pic 9(7)v99. 
    05  ctr-tot-dollars-oma			pic 9(7)v99. 
    05  ctr-tot-dollars-ohip			pic 9(7)v99. 

    05  ctr-tot-tech-claim			pic 9(7)v99.
    05  ctr-tot-svcs-read                       pic 9(7). 
*** S.B. - start.
    05  ctr-hdr2-rec                            pic 9(02).
    05  ctr-addr-rec                            pic 9(02).
*** S.B. - end.

01  flag-date                                   pic x. 
    88 valid-date                                       value "Y". 
    88 invalid-date                                     value "N". 
 
01  flag-consec                                 pic x. 
    88 valid-consec                                     value "Y". 
    88 invalid-consec                                   value "N". 
 
01  flag-clinic                                 pic x. 
    88 clinic-found                                     value "Y". 
    88 clinic-not-found                                 value "N". 
 
01  flag-hosp-nbr                               pic x. 
    88 valid-hosp-nbr                                   value "Y". 
    88 invalid-hosp-nbr                                 value "N". 
 
01  flag-agent-cd                               pic x. 
    88 valid-agent-cd                                   value "Y". 
    88 invalid-agent-cd                                 value "N". 
 
01  flag-in-out-ind                                     pic x. 
    88 valid-in-out-ind                                 value "Y". 
    88 invalid-in-out-ind                               value "N". 
 
01  flag-doc                                    pic x. 
    88  doc-found                                       value "Y". 
    88  doc-not-found                                   value "N". 
 
01  flag-oma                                    pic x. 
    88  valid-oma-code                                  value "Y". 
    88  invalid-oma-code                                value "N". 
 
01  flag-agent-code                                     pic x. 
    88  valid-agent-cd-code                             value "Y". 
    88  invalid-agent-cd-code                           value "N". 
 
01  flag-refer-phys                             pic x. 
    88  valid-refer-phys                                value "Y". 
    88  invalid-refer-phys                              value "N". 
 
01  flag-location                               pic x. 
    88  valid-location                                  value "Y". 
    88  invalid-location                                value "N". 
 
01  flag-ohip                                   pic x. 
    88  valid-ohip                                      value "Y". 
    88  invalid-ohip                                    value "N". 
 
01  flag-diag-cd                                pic x. 
    88  valid-diag-code                                 value "Y". 
    88  invalid-diag-code                               value "N". 
 
01  detail-written-flag                         pic x. 
    88  detail-written                          value 'Y'. 
    88  detail-not-written                      value 'N'. 
 
01  ws-chk-ind                                  pic x(8). 
 
77  ws-val-total                                pic s9(7). 
77  date-difference-in-days                     pic 9(3). 
77  rem-even                                    pic 9v9(4). 
77  max-nbr-digits                              pic 99 value 7. 
 
77  max-doc-locations                           pic 99 value 30. 

*   (include the pricing algorith's hold variables)
* 2006/02/15 - MC


* WARNING - keep the 'ss-max-nbr-oma-det-rec-allow' value in sync with
*           the definition of 'hold-oma-rec' in 'pricing_variables_hold.ws'

*77  ss-max-nbr-oma-det-rec-allow                pic 99  comp    value  40.
*77  ss-max-nbr-oma-det-rec-allow                pic 99  comp    value  60.
77  ss-max-nbr-oma-det-rec-allow                pic 99  comp    value  70.

* WARNING - keep the 'ss-max-nbr-oma-det-rec-allow' value in sync with
*           the definition of 'hold-oma-rec' in 'pricing_variables_hold.ws'


* 2006/02/15 - end

    copy "pricing_variables_hold.ws". 
 
01  province-flag                              pic x. 
    88  province-found                          value "Y". 
    88  province-not-found                      value "N". 
 
01  prov-table. 
 
    05  province. 
        10  filler                              pic x(2) value "ON". 
        10  filler                              pic x(2) value "AB". 
* 2005/06/23 - MC - change NF to NL
*       10  filler                              pic x(2) value "NF".
        10  filler                              pic x(2) value "NL".
* 2005/06/23 - end
        10  filler                              pic x(2) value "SK". 
        10  filler                              pic x(2) value "MB". 
        10  filler                              pic x(2) value "NT". 
        10  filler                              pic x(2) value "PE". 
*       10  FILLER                              PIC X(2) VALUE "QE". 
        10  filler                              pic x(2) value "YT". 
        10  filler                              pic x(2) value "BC". 
        10  filler                              pic x(2) value "NB". 
        10  filler                              pic x(2) value "NS". 
*       10  FILLER                              PIC X(2) VALUE "OT". 
 
    05  province-r               redefines      province. 
 
        10  prov                 occurs 11 times pic x(2). 
 
copy "def_agents.ws".

copy "default_phone_area_code.ws".
 
copy "sysdatetime.ws".
 
copy "check_digit.ws".
 
copy "check_digit_10.ws".
 
copy "mod_check_digit.ws".
 
copy "mth_desc_max_days.ws".
 
copy "hosp_table.ws".
 
 
01 heading-l1. 
    05  filler                                  pic x(08)       value 
       "RU701". 
    05  filler                                  pic x(10)       value 
       "RUN DATE:". 
 
* (y2k)
*   05  l1-run-date                             pic x(08). 
    05  l1-run-date                             pic x(10). 
*   05  filler                                  pic x(08)       value spaces. 
    05  filler                                  pic x(06)       value spaces. 
    05  filler                                  pic x(66)       value 
       "OHIP Diskette Upload into Suspense - ERROR/WARNING/AUDIT Report". 
    05  filler                                  pic x(06)       value 
        "PAGE:". 
    05  rpt-page-nbr                            pic zzz9. 
 
01 heading-l2. 
    05  filler                                  pic x(08)       value 
	"DOCTOR: ". 
*!    05  h-l2-doctor-nbr                         pic 999. 
    05  h-l2-doctor-nbr                         pic xxx. 
    05  filler                                  pic x(03)       value 
	" / ". 
    05  h-l2-doctor-initials                    pic x(03). 
    05  filler                                  pic x(01)       value 
	" ". 
    05  h-l2-doctor-name                        pic x(24). 
    05  filler                                  pic x(20)       value 
	" CLINIC/SPECIALITY: ". 
    05  h-l2-clinic                             pic x(4). 
    05  filler                                  pic x(03)       value 
	" / ". 
    05  h-l2-speciality                          pic x(3). 
 
copy "f090_const_mstr_rec_1.ws".
01  error-message-vable. 
 
    05  error-messages. 
* #1 
        10  filler. 
            15  err-warn-msg                    pic x(14)  value spaces.
            15  filler                          pic x(08)  value 
                "Batch = ". 
            15  err-msg-pract-nbr               pic x(06). 
            15  filler                          pic x(01)  value "/". 
            15  err-msg-account-id              pic x(08). 
            15  filler                          pic x(95)  value spaces. 
* #2 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(43)  value 
                "**ERROR** - NO SUCH DOCTOR FOUND ON FILE - ". 
            15  err-msg-doc-nbr                 pic x(03). 
            15  filler                          pic x(72)  value spaces. 
* #3 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(61)  value 
                "INVALID LOCATION CODE FOR DOCTOR: BATCH CONTAINED LOCATION - ". 
            15  err-msg-loc-cd                  pic x(04). 
            15  filler                          pic x(53)  value spaces. 
* #4 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(54)  value 
                "INVALID SPECIALITY CODE: BATCH CONTAINED SPECIALITY - ". 
            15  err-msg-batch-spec-cd           pic x(04). 
            15  filler                          pic x(60)  value spaces. 
* #5 
        10 filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(53)  value 
                "                         DOCTOR'S  SPECIALTIES ARE - ". 
            15  err-msg-doc-spec-cd             pic x(04). 
            15  filler                          pic x(03) value " / ". 
            15  err-msg-doc-spec-cd-2           pic x(04). 
            15  filler                          pic x(03) value " / ". 
            15  err-msg-doc-spec-cd-3           pic x(04). 
            15  filler                          pic x(47)  value spaces. 
* #6 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(56)  value 
                "**ERROR** - INVALID CLINIC ID: BATCH CONTAINED CLINIC - ". 
            15  err-msg-clinic-id               pic x(10). 
            15  filler                          pic x(52)  value spaces. 
* #7 
        10  filler                              pic x(132) value 
                "**ERROR** - FIRST RECORD FOUND IN FILE WAS NOT A 'B'ATCH RECORD ". 
* #8 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(40)  value 
                "INVALID OMA CODE - ACCOUNTING NBR = ". 
            15  err-accounting-nbr              pic x(10). 
            15  filler                          pic x(68). 
* #9 
        10  filler                              pic x(132) value 
                "              DUPLICATE ACCOUNT ID FOUND IN SUSPENSE (HEADER) FILE". 
* #10 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(40)  value 
                "INVALID WRITE NEW CLAIMS HDR - 'B' KEY=". 
            15  bkey-clmhdr-err-msg             pic x(20)  value spaces. 
            15  filler                          pic x(58)  value spaces. 
* #11 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(40)  value 
                "INVALID WRITE NEW CLAIMS HDR -'P' KEY = ". 
            15  pkey-clm-err-msg                pic x(20)  value spaces. 
            15  filler                          pic x(58)  value spaces. 
* #12 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(54)  value 
                "INVALID REFERRING PHYSICIAN: BATCH CONTAINED CLINIC - ". 
            15  err-refer-phys-nbr              pic x(6). 
            15  filler                          pic x(58). 
* #13 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(51)  value 
                "INVALID PATIENT OHIP NBR: BATCH CONTAINED CLINIC - ". 
            15  err-ohip-no                     pic x(08). 
            15  filler                          pic x(59). 
* #14 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(51)  value 
                "INVALID DIAG CODE: ". 
            15  err-diag-code                   pic x(03). 
            15  filler                          pic x(64). 
* #15 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(51)  value 
                "INVALID I-O-INDICATOR: ". 
            15  err-i-o-ind                     pic x(01). 
            15  filler                          pic x(66). 
* #16 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(92)  value 
                "NBR OF HEADER1 RECORDS READ IS NOT =  NBR OF HEADER1 RECORDS FROM TRAILER RECORD. ". 
            15  err-ctr-h-count                 pic 99999. 
            15  filler                          pic x(1)  value "/". 
            15  err-trl-h-count                 pic 99999. 
            15  filler                          pic x(15). 
* #17 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(92)  value 
                "NBR OF ITEM RECORDS READ IS NOT =  NBR OF ITEM RECORDS FROM TRAILER RECORD. ". 
            15  err-ctr-t-count                 pic 99999. 
            15  filler                          pic x(1)  value "/". 
            15  err-trl-t-count                 pic 99999. 
            15  filler                          pic x(15). 
* #18 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(92)  value 
                "NBR OF ADDRESS RECORDS IS NOT =  NBR OF ADDRESS RECORDS FROM TRAILER RECORD.  ". 
            15  err-ctr-a-count                 pic 99999. 
            15  filler                          pic x(1)  value "/". 
            15  err-trl-a-count                 pic 99999. 
            15  filler                          pic x(15). 
* #19 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(92)  value 
                "NBR OF BATCH RECORDS READ IS NOT =  NBR OF BATCH RECORDS FROM TRAILER RECORD". 
            15  err-ctr-b-count                 pic 99999. 
            15  filler                          pic x(1)  value "/". 
            15  err-trl-b-count                 pic 99999. 
            15  filler                          pic x(15). 
* #20 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(51)  value 
                "INVALID AGENT CODE:    ". 
            15  err-agent-cd                    pic x(01). 
            15  filler                          pic x(66). 
* #21 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(20)  value 
                "DOCTOR SPECIALITY: ". 
            15  err-21-value-1                  pic x(02). 
            15  filler                          pic x(27)  value 
                "  NOT VALID FOR OHIP CODE: ". 
            15  err-21-value-2                  pic x(04). 
            15  filler                          pic x(33)  value 
                " RANGE: ". 
            15  err-21-value-3                  pic x(02). 
            15  filler                          pic x(06)  value 
                " THRU ". 
            15  err-21-value-4                  pic x(02). 
            15  filler                          pic x(22). 
* #22 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(10) value 
                "OMA CODE: ". 
            15  err-22-oma-cd                   pic x(04). 
            15  filler                          pic x(14) value 
                "  REQUIRES -  ". 
            15  err-22-msg                      pic x(90). 
* #23 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(51)  value 
                "INVALID HOSPITAL NBR: ". 
            15  err-hosp-nbr                    pic x(04). 
            15  filler                          pic x(63). 
* #24 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(45)  value 
                "SERVICE NOT WITHIN 6 MONTHS OF SYSTEM DATE:". 
* (y2k)
*           15  err-24-service-date             pic x(06). 
            15  err-24-service-date             pic x(08). 
*           15  filler                          pic x(67). 
            15  filler                          pic x(65). 
* #25 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(118)  value 
                "DIRECT BILL CLAIM MISSING - MSG / AUTO LOGOUT / FEE COMPLEXITY / ... INFO". 
* #26 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(22)  value 
                "INVALID -ADMIT- DATE: ". 
* (y2k)
*           15  err-admit-date                  pic x(06). 
            15  err-admit-date                  pic x(08). 
*           15  filler                          pic x(90). 
            15  filler                          pic x(88). 
* #27 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(32)  value 
                "INVALID INITIAL SERVICE DATE:". 
* (y2k)
*           15  err-27-service-date             pic x(06). 
            15  err-27-service-date             pic x(08). 
*           15  filler                          pic x(80). 
            15  filler                          pic x(78). 
* #28 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(42)  value 
                "INVALID CONSECUTIVE SERVICES DATES/SVC'S:". 
            15  err-additional-servs            pic x(09). 
            15  filler                          pic x(67). 
* #29 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(25)  value 
                "INVALID HEALTH CARE NBR:". 
            15  err-health-care-nbr             pic x(10). 
            15  filler                          pic x(83). 
* #30 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(18)  value 
                "INVALID PROVINCE:". 
            15  err-province                    pic x(02). 
            15  filler                          pic x(98). 
* #31 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(27)  value 
                "INVALID MANUAL REVIEW: ". 
            15  err-manual-review               pic x. 
            15  filler                          pic x(90). 
* #32 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(54)  value 
                "INVALID DEPT NO:  BATCH CONTAINED DEPT NO - ". 
            15  err-msg-batch-dept-no           pic x(02). 
            15  filler                          pic x(62)  value spaces. 
* #33 
        10 filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(53)  value 
                "                  DOCTOR'S DEPT NO          - ". 
            15  err-msg-doc-dept-no             pic x(02). 
            15  filler                          pic x(63)  value spaces. 
* #34 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(92)  value 
                "NBR OF HEADER2 RECORDS READ IS NOT =  NBR OF HEADER2 RECORDS FROM TRAILER RECORD.  ". 
            15  err-ctr-r-count                 pic 99999. 
            15  filler                          pic x(1)  value "/". 
            15  err-trl-r-count                 pic 99999. 
            15  filler                          pic x(15). 
 
* #35 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(53)  value 
                "INVALID PROVIDER NO:  BATCH CONTAINED PROVIDER NO - ". 
            15  err-msg-batch-prov-nbr          pic x(06). 
            15  filler                          pic x(59)  value spaces. 
* #36 
        10 filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(53)  value 
                "                  DOCTOR'S PROVIDER NO      - ". 
            15  err-msg-doc-prov-nbr            pic x(06). 
            15  filler                          pic x(59)  value spaces. 
* #37 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(22)  value 
                "INVALID BIRTH DATE:". 
* (y2k)
*           15  err-birth-date                  pic x(06). 
            15  err-birth-date                  pic x(08). 
*           15  filler                          pic x(90). 
            15  filler                          pic x(88). 
* #38 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(28)  value 
                "ZERO NUMBER OF SERVICE". 
            15  err-nbr-of-serv                 pic x(4). 
            15  filler                          pic x(86). 
* #39 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(28)  value 
                "ZERO AMOUNT BILLED". 
*mf         15  err-fee-billed                  pic x(12). 
            15  err-fee-billed                  pic 9(12).
            15  filler                          pic x(78). 
* #40 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(48)  value 
**              "INVALID SIZE OF OHIP NBR". 
                "INVALID SIZE OF HEALTH CARE NBR - Province/Nbr: ". 
            15  err-prov                        pic x(2). 
            15  filler                          pic x(3)   value 
                " / ". 
            15  err-ohip-nbr                    pic x(12). 
            15  filler                          pic x(53). 
* #41 @@ USE 
        10  filler                              pic x(132)  value 
                "CONSTANTS MSTR REC 'LOCKED' -- INFORM OPERATIONS OF PROBLEM". 
* #42  @@ USE 
        10  filler                              pic x(132)  value 
                "SERIOUS ERROR #10 - UNABLE TO READ CONSTANT MSTR REC #2 ". 
* #43 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(53)  value 
                "INVALID GROUP NBR: BATCH CONTAINED GROUP NBR - ". 
            15  err-msg-group-nbr               pic x(06). 
            15  filler                          pic x(59)  value spaces. 
* #44 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(15)  value 
                "SERVICE DATE: ". 
* (y2k)
*           15  err-44-service-date             pic x(06). 
            15  err-44-service-date             pic x(08). 
            15  filler                          pic x(27)  value 
                "IS PRIOR TO ADMIT DATE:". 
* (y2k)
*           15  err-44-admit-date               pic x(06). 
            15  err-44-admit-date               pic x(08). 
*           15  filler                          pic x(64). 
            15  filler                          pic x(60). 
* #45 
        10  filler                              pic x(132)  value 
                "SERIOUS ERROR #11 - UNABLE TO READ CONSTANT MSTR REC #1 ". 
* #46 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(27)  value 
                "INVALID RELATIONSHIP: ". 
            15  err-relationship                pic x. 
            15  filler                          pic x(90). 
*** S.B.- start.
* #47
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(23)  value
                "   REFERRING DOCTOR: - ".
                15  err-msg-referring-doc               pic x(06).
            15  filler                                  pic x(37)  value
                " AND PROVIDER DOCTOR ARE THE SAME: - ".
            15  err-msg-provider-doc            pic x(06).
            15  filler                          pic x(46)  value spaces.

* #48
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(22)  value
                "      SERVICE DATE: - ".
            15  err-msg-svr-date                pic x(08).
              15  filler                        pic x(32)  value
                    " IS GREATER THAN SYSTEM DATE: - ".
                15  err-msg-sys-date            pic x(08).
            15  filler                          pic x(48)  value spaces.
* #49
        10  filler.
            15  filler                          pic x(10)  value spaces.
            15  filler                          pic x(18) value
                "OMA CODE I/O IND: ".
            15  err-49-oma-cd                   pic x(04).
            15  filler                          pic x(38) value
                " DOES NOT MATCH CLMHDR-2 REC I/O IND: ".
            15  err-49-hdr-cd                   pic x(04).
            15  filler                          pic x(58).

* #50
        10  filler.
            15  filler                          pic x(12)  value spaces.
            15  filler                          pic x(36)  value
                " MISSING DETAIL RECORDS FOR CLAIM: ".
            15  err-no-detail-claim             pic x(08).
            15  filler                          pic x(76)  value spaces.
* #51
        10  filler.
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(61)  value 
                "INVALID LOCATION CODE: BATCH CONTAINED LOCATION - ". 
            15  err-51-loc-cd                   pic x(04). 
	    15  filler				pic x(53).
* #52 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(35)  value 
                "Incoming fee not = RMA priced fee  ". 
            15  err-52-incoming-fee             pic zzz9.99. 
            15  filler                          pic x(3)  value " / ". 
            15  err-52-ohip-fee                 pic zzz9.99. 
            15  filler                          pic x(66). 

* #53 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(40)  value 
                "Incoming I/O ind not = RMA I/O ind ". 
            15  err-53-incoming-i-o-ind         pic x.        
            15  filler                          pic x(3)  value " / ". 
            15  err-53-i-o-ind                  pic x.
            15  filler                          pic x(73). 
* 2002/06/12 - MC - add error 54
* #54 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(40)  value 
                "Require facility number with premium cd ".
            15  filler                          pic x(3)  value " / ". 
            15  err-54-prem-code                pic x(4).
            15  filler                          pic x(71). 
* 2002/06/12 - end

* 2002/08/21 - MC - add error 55
* #55 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
            15  filler                          pic x(40)  value 
                "Wrong hospital number with premium cd ".
            15  filler                          pic x(3)  value " / ". 
            15  err-55-hosp-code                pic x(4).
            15  filler                          pic x(3)  value " / ". 
            15  err-55-prem-code                pic x(4).
            15  filler                          pic x(64). 
* 2002/06/12 - end
    
* 2003/06/11 - MC - add error 56
* #56 
        10  filler. 
            15  filler                          pic x(14)  value spaces. 
* 2004/01/20 - MC
*            15  filler                          pic x(40)  value
*               "Wrong location code - must end with 112".
            15  filler                          pic x(60)  value
* 2004/09/27 - MC
*                "Wrong location code - must end with 112/153/400/250/422".
* 2007/10/24 - MC - add 055 as well
*               "Wrong location code - must end with 112/153/400/250/422/401".
* 2007/11/22 - MC -add 326 as well - yas add 122 2008/01/03
*                "Wrong locn code - must end with 112/153/400/250/422/401/055".
             "Wrong locn cd- must with 112/153/400/250/422/401/055/326/122".
* 2007/11/22 - end
* 2007/10/24 - end
* 2004/09/27 - end

* 2008/02/19 - MC - add 344 to the list
	    15 filler				pic x(20) value
* 2008/02/28 - MC add 111 & 354
*		"/344      ".
* 2008/03/18 - MC add 333 
*		"/344/111/354        ".
		"/344/111/354/333    ".
* 2008/03/18 - end  
* 2008/02/28 - end
* 2008/02/19 -end

* 2004/01/20 - end
            15  filler                          pic x(3)  value " / ".
            15  err-56-loc-code                 pic x(4).
            15  filler                          pic x(3)  value " / ".
            15  err-56-prem-code                pic x(4).
* 2004/01/20 - MC
*            15  filler                          pic x(64). 
* 2008/02/19 - MC
*            15  filler                          pic x(44).
            15  filler                          pic x(24).
* 2008/02/19 - end

* 2004/01/20 - end

* 2003/06/11 - end

* 2003/10/22 - MC - add error 57
* #57
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(56)  value
                "**ERROR** - INVALID CLINIC NBR FOR THE DOCTOR -         ".
            15  err-msg-doc-clinic              pic 9(2).
            15  filler                          pic x(60)  value spaces.
* 2003/10/22 - end
  
* 2004/04/07 - MC - add error 58
* #58
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(15)  value
                "ADMIT DATE: ".
            15  err-58-admit-date               pic x(08).
            15  filler                          pic x(27)  value
                "  IS PRIOR TO BIRTH DATE:".
            15  err-58-birth-date               pic x(08).
            15  filler                          pic x(60).
* 2004/04/07 - end
  
* 2005/03/03 - MC - add error 59 and 60
* #59
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(17)  value
                "Doc Specialty = ".
            15  err-59-doc-spec                 pic 99.   
            15  filler                          pic x(17)  value
                ", Birth date =  ".
            15  err-59-birth-date               pic x(08).
            15  filler                          pic x(27)  value
                "  and age must be >= 60".
            15  filler                          pic x(47).

* #60
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(17)  value
                "Doc Specialty = ".
            15  err-60-doc-spec                 pic 99.   
            15  filler                          pic x(17)  value
                ", Birth date =  ".
            15  err-60-birth-date               pic x(08).
            15  filler                          pic x(27)  value
                "  and age must be >= 75".
            15  filler                          pic x(47).
* 2005/03/03 - end
  
* 2005/05/04 - MC - add error 61 and 62
* #61
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(17)  value
                "Service Date  = ".
            15  err-61-serv-date                pic x(08).
            15  filler                          pic x(17)  value
                ", Birth date =  ".
            15  err-61-birth-date               pic x(08).
            15  filler                          pic x(68) value 
                "  and service date must be > birth date".

* #62
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(17)  value
                "Location code = ".      
            15  err-62-loc-code                 pic x(4). 
            15  filler                          pic x(17)  value
                ", clinic nbr = ".  
            15  err-62-clinic-nbr               pic 99.      
            15  filler                          pic x(78)  value
                "  and wrong location for clinic 61 - 65".
* 2005/05/04 - end

* 2005/10/31 - MC - add message 63 and 64 and 65

* #63
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "Oma code = E420, check pricing".
* #64
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "doc nbr = 049 and oma code = Z425 - take out manual review".
* #65
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "check for E078 premium". 
* 2005/10/31 - end 


* 2006/12/13 - MC - add message 66 and 67 and 68

* #66
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "Check C122".                           
* #67
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "Check C123". 
* #68
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "Check C124". 
* 2006/12/13 - end 

* 2008/04/23 - add msg 69 to 84
* #69
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "Check number of services for E add-on code".
* #70
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "E020C only allowed with E022C, E017C or E016C".
* #71
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "E719 only allowed with Z570".                     
* #72
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "E720 only allowed with Z571".                     
* #73
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "E717 only allowed with Z555 or Z580".             
* #74
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "E702 only allowed with specific codes".           
* #75
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "G123 only allowed with G228".                     
* #76
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "G223 only allowed with G231".                     
* #77
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "G265 only allowed with G264".                     
* #78
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "G385 only allowed with G384".                     
* #79
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "G281 only allowed with G381".                     
* #80
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "Maximun number of services exceeded".             
* #81
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "E793 only allowed with specific procedures".      
* #82
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "P022 deleted as of 2008/02/01".                   
* #83
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "K120 deleted as of 2008/02/01".                   
* #84
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118) value
                "A007 only allowed for specialty '00'".            
    05  error-messages-r redefines error-messages. 
        10  err-msg                             pic x(132) 
                    occurs 84 times.

01  err-ind                                     pic 99  value zero. 
01  err-msg-comment                             pic x(132). 
01  save-prt-line                               pic x(132). 
 
 
01  e1-error-line. 
 
    05  e1-error-word                           pic x(11)   value 
                        "*** ERROR- ". 
    05  e1-error-msg                            pic x(52). 
    05  e1-error-key                            pic x(17). 



screen section. 
 
01  scr-title. 
    05  blank screen. 
    05  line 03 col 10 value "Price claims/create Priced File/Upload to Suspense".
 
01 scr-current-system-date.
    05  line 05 col 05 value "Current System Date".
    05  line 05 col 70 pic 99999999 using sys-date.

01 scr-claim-source-default-reply. 
    05  line 07 col 05 value "Enter Claim SOURCE - 'W'eb / 'D'iskette / 'P'rice only [ ]".
    05  line 07 col 70 pic x(01) using flag-claim-source auto.

01 scr-update-suspense-reply. 
    05  line 11 col 05 value "Do you want to upload claims to Suspense- [Y]/N ?".
    05  line 11 col 70 pic x(01) using flag-update-suspense auto.

01 scr-create-priced-file-reply. 
    05  line 12 col 05 value "Do you want to create Priced File         [Y]/N ?".
    05  line 12 col 70 pic x(01) using flag-create-priced-file auto.

01 scr-retain-prices-reply.
    05  line 14 col 05 value "Do you want to RETAIN Incoming prices- [Y]/N ?".
    05  line 14 col 70 pic x(01) using flag-retain-prices auto.
 
01 scr-agent-default-reply. 
    05  line 16 col 05 value "Do you want to default 'BLANK' AGENT Codes to 'OHIP' (ie. '0') ?". 
    05  line 16 col 70 pic x(01) using ws-agent-default-reply auto. 
 
01  scr-doc-nbr. 
    05  line 15 col 05 value "Enter the DOCTOR NBR or press 'newline' to default to 0    :". 
*!    05  line 15 col 66 pic 9(3) using ws-doc-nbr auto. 
    05  line 15 col 66 pic x(3) using ws-doc-nbr auto. 
 
01  scr-clinic-nbr. 
    05  line 17 col 05 value "Enter the CLINIC NBR or press 'newline' to default to 22(15):". 
    05  line 17 col 68 pic 9(2) using ws-default-clinic-nbr auto. 

* ('dummy' field added to allow compile of common code shared between
*  this pgm and d001)
01  scr-last-claim-lit.
    05                          line 03 col 65 value 'Nbr of Svc'.

01  scr-in-progress-message. 
    05  line 19 col 20 value "PROGRAM  NEWU701  NOW IN PROGRESS". 
 
01 file-status-display. 
    05  line 24 col 56  "FILE STATUS = ". 
    05  line 24 col 70  pic x(11) from status-file      bell blink. 
* 
01  scr-closing-screen. 
    05  blank screen. 
    05  line 21 col 01  value "PROGRAM NEWU701 ENDING". 
* (y2k - auto fix)
*   05  line 21 col 40  pic 99  from sys-yy.
    05  line 21 col 40  pic 9(4)  from sys-yy. 
    05  line 21 col 44  value "/". 
    05  line 21 col 45  pic 99  from sys-mm. 
    05  line 21 col 47  value "/". 
    05  line 21 col 48  pic 99  from sys-dd. 
    05  line 21 col 52  pic 99  from sys-hrs. 
    05  line 21 col 54  value ":". 
    05  line 21 col 55  pic 99  from sys-min. 
    05  line 23 col 10  value "AUDIT REPORT IS IN FILE - RU701". 
 
procedure division. 
declaratives. 
 
err-input-diskette-file section. 
    use after standard error procedure on unpriced-claims-file. 
err-input-diskette. 
    stop "ERROR IN ACCESSING: dISKETTE INPUT FILE". 
    move status-unpriced-claims         to status-file. 
    display file-status-display. 
*    stop " ". 
    move status-cobol-unpriced-claims   to status-file. 
    display file-status-display. 
    stop run. 
 
err-suspend-hdr-file section. 
    use after standard error procedure on suspend-hdr. 
err-suspend-hdr. 
*   (IF DUPLICATE KEY ERROR, THEN SET FLAG TO SKIP PROCESSING OF THIS HEADER) 
*   (NOTE: 90/01/14 B.E. LOGIC WILL BYPASS WRITING OF HEADER BUT HAS BEEN MODIFIED 
*          SO THAT THE DETAILS FOR THIS HEADER WILL BE PROCESSED AND THEREFORE 
*          WILL BECOME DETAILS FOR THE HEADER ALREADY ON FILE. MESSAGE ON WARNING 
*          REPORT SHOULD ALERT STAFF TO REVIEW CLAIM TO CONFIRM THAT THESE 
*          HEADERS ARE FOR SAME PATIENT.  THE ORIGINAL CLAIM HEADER ON FILE WILL 
*          HAVE IT'S CLAIM STATUS SET TO "CANCEL (IE.'Y') SO THAT IT WON'T 
*          BE PROCESSED UNLESS UNCANCELLED.  IT WILL ALSO APPEAR ON THE CANCELLED 
*          SUSPENDED CLAIMS REPORTS) 
 
    if   status-suspend-hdr       = "7013" 
      or status-cobol-suspend-hdr = "22" 
    then 
        go to err-suspend-hdr-50. 
*   endif 
 
    stop "ERROR IN ACCESSING: SUSPEND-HEADER" 
    move status-suspend-hdr     to status-file 
    display file-status-display 
*    stop " " 
    move status-cobol-suspend-hdr       to status-file 
    display file-status-display 
    stop run. 
 
err-suspend-hdr-50. 
*   (SET FLAG TO INDICATE THAT HEADER IS BEING SKIPPED DUE TO DUPLICATE 
*    KEY BUT THAT DETAILS ARE TO BE WRITTEN TO DISK) 
*mf    move "D"                            to      skip-processing-this-acct-id-flag. 
    move "D"                            to      skip-process-this-acct-id-flag. 
    move suspend-hdr-rec                to      hold-suspend-hdr-rec. 
*   (READ ORIGINAL HDR REC) 
    read suspend-hdr 
        invalid key 
          display  "SERIOUS IMPOSSIBLE ERROR #1 SUSPEND HDR FILE - KEY IS = ",suspend-hdr-id           stop run. 
 
*   (UPDATE ORIGINAL HEADER'S STATUS TO "CANCELLED" 
    move "Y"                            to      clmhdr-status. 
 
*   (REWRITE UPDATED RECORD) 
    rewrite suspend-hdr-rec 
        invalid key 
           display "SERIOUS IMPOSSIBLE ERROR #2 SUSPEND HDR FILE - KEY IS = ",suspend-hdr-id 
           stop run. 
 
*   (RESTORE THE SUSPEND HDR RECORD DATA) 
    move hold-suspend-hdr-rec           to      suspend-hdr-rec. 
 
err-suspend-hdr-99-exit. 
    exit. 
 
 
 
err-suspend-dtl-file section. 
    use after standard error procedure on suspend-dtl. 
err-suspend-dtl. 
    stop "ERROR IN ACCESSING: SUSPEND-DETAIL". 
    move status-suspend-dtl             to status-file. 
    display file-status-display. 
*    stop " ". 
    move status-cobol-suspend-dtl       to status-file. 
    display file-status-display. 
    stop run. 
 
* 2005/08/17 - MC - add suspend-desc 
err-suspend-desc-file section. 
    use after standard error procedure on suspend-desc. 
err-suspend-desc. 
    stop "ERROR IN ACCESSING: SUSPEND-DETAIL". 
    move status-suspend-desc             to status-file. 
    display file-status-display. 
*    stop " ". 
    move status-cobol-suspend-desc       to status-file. 
    display file-status-display. 
    stop run. 
* 2005/08/17 - end

 
err-suspend-addr-file section. 
    use after standard error procedure on suspend-address. 
err-suspend-addr. 
    stop "ERROR IN ACCESSING: SUSPEND-ADDRESS". 
    move status-suspend-addr            to status-file. 
    display file-status-display. 
*    stop " ". 
    move status-cobol-suspend-addr      to status-file. 
    display file-status-display. 
    stop run. 
 
err-doc-mstr-file section. 
    use after standard error procedure on doc-mstr. 
err-doc-mstr. 
    stop "ERROR IN ACCESSING: DOCTOR MASTER". 
    move status-doc-mstr                to status-file. 
    display file-status-display. 
    stop run. 
 
 
err-diagnistics-mstr-file section. 
    use after standard error procedure on diag-mstr. 
err-diagnostics-mstr. 
    stop "ERROR IN ACCESSING: DIAGNOSTIC CODES MASTER". 
    move status-diag-mstr               to status-file. 
    display file-status-display. 
    stop run. 
 
err-constants-mstr-file section. 
    use after standard error procedure on iconst-mstr. 
 
err-constants-mstr. 
*   (IF 'RECORD LOCKED' PRINT WARNING, SET FLAG SO THAT 'READ' WILL LOOP UNTIL RECORD UNLOCKED) 
    if status-iconst-mstr = "7015" 
    then 
*       (ERROR - WRITE REPORT AND SKIP BATCH) 
        move "Y"                        to      fatal-error-flag 
        move 2                          to      ws-carriage-ctrl 
        move 41                         to      err-ind 
	move ws-error-literal           to 	err-warn-msg
        move batch-group-nbr            to      err-msg-clinic-id 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
    else 
        move status-iconst-mstr         to      status-file 
        display  file-status-display 
        display "ERROR IN ACCESSING CONSTANTS MASTER" 
        stop run. 
*   endif. 
 
 
err-report-file section. 
    use after standard error procedure on report-file. 
err-report. 
    stop "ERROR IN WRITING TO AUDIT REPORT: RU701". 
    move status-report                  to status-file. 
    display file-status-display. 
    stop run. 
 
end declaratives. 
 
mainline section. 
 
    perform aa0-initialization          thru aa0-99-exit. 
    perform ab0-processing              thru ab0-99-exit 
            until   eof-input-file 
                 or fatal-error. 
    perform az0-finalization            thru az0-99-exit. 
    stop run. 
 
aa0-initialization. 
 
    display scr-title. 

    accept sys-date             from date. 
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit. 

*   (when testing the 'master claims batch' allow operator to override
*    system date)
    display scr-current-system-date.
    accept  scr-current-system-date.

    move sys-mm                 to   run-mm. 
    move sys-dd                 to   run-dd. 
    move sys-yy                 to   run-yy. 
    move run-date               to   l1-run-date. 
 
    accept sys-time             from time. 
    move sys-hrs                to   run-hrs. 
    move sys-min                to   run-min. 
    move sys-sec                to   run-sec. 
 
*!    move 0			to   ws-doc-nbr. 
    move spaces			to   ws-doc-nbr. 
*   MOVE 2215			TO   WS-DEFAULT-CLINIC-NBR. 
    move 22  			to   ws-default-clinic-nbr. 
 

*   (predisplay all options on screen)
    display scr-claim-source-default-reply.
    display scr-retain-prices-reply.
    display scr-update-suspense-reply.
    display scr-create-priced-file-reply.
    display scr-agent-default-reply.

aa0-05-default-claim-source. 
    display scr-claim-source-default-reply.
    accept  scr-claim-source-default-reply.

    if   web-claim
      or diskette-claim
      or price-only-claim
    then
	next sentence
    else
	go to aa0-05-default-claim-source.
*   endif

aa0-07-retain-prices.
*   (prices are normally overridden, even for diskettes, however some
*    diskettes don't send a "complete" claim under 1 accounting number
*    (eg. PNP allows only 4 details per accounting number) and therefore
*   this program can't reprice the claim. This flag allows the operator
*   to turn on/off the repricing option. Web claim are automatically
*   "repriced")

*   CASE 
    if web-claim
    then
	move "N"			to flag-retain-prices
	go to aa0-09-update-suspense
    else
    if price-only-claim 
    then
	move "N"			to flag-retain-prices
	go to aa0-09-update-suspense.
*   ENDCASE

*   (default for diskettes is to retain prices)
    move "Y"				to flag-retain-prices.
    accept  scr-retain-prices-reply.
    if    retain-incoming-prices
       or override-with-rma-prices
    then
	next sentence
    else
	go to aa0-07-retain-prices.
*   endif
    
aa0-09-update-suspense.
    display scr-retain-prices-reply.

*   CASE
    if web-claim
    then
	move "Y"			to flag-update-suspense
	go to aa0-10-create-priced-file
    else 
    if price-only-claim
    then
	move "N"			to flag-update-suspense
	go to aa0-10-create-priced-file.
*   ENDCASE

*   (default for diskettes is to retain prices)
    move "Y"				to flag-update-suspense.
    accept  scr-update-suspense-reply.
    if    update-suspense
       or dont-update-suspense
    then
	next sentence
    else
	go to aa0-09-update-suspense.
*   endif

aa0-10-create-priced-file.
    display scr-update-suspense-reply.

*   CASE
    if web-claim
    then
	move "Y"			to flag-create-priced-file
	go to aa0-20-default-agent
    else 
    if price-only-claim
    then
	move "Y"			to flag-create-priced-file
	go to aa0-20-default-agent.
*   ENDCASE

*   (default for diskettes is to retain prices)
    move "Y"				to flag-create-priced-file 
    accept  scr-create-priced-file-reply.
    if    create-priced-file
       or dont-create-priced-file
    then
	next sentence
    else
	go to aa0-10-create-priced-file.
*   endif
    

aa0-20-default-agent. 
    display scr-create-priced-file-reply.

*   (00/mar/27 B.E. removed option - no longer required) 
    move "Y"			to  ws-agent-default-reply.
    display scr-agent-default-reply. 
*    accept  scr-agent-default-reply. 
 
    if ws-agent-default-reply = "Y" or "N" 
    then 
	next sentence 
    else 
        go to aa0-20-default-agent. 
*   endif 
 
*   (00/mar/27 B.E. removed option - no longer required) 
    display scr-doc-nbr. 
*    accept  scr-doc-nbr. 

*   (00/mar/27 B.E. removed option - no longer required) 
    display scr-clinic-nbr. 
*    accept  scr-clinic-nbr. 
 
    display scr-in-progress-message. 
 
    move spaces to suspend-hdr-rec 
                   suspend-dtl-rec 
                   suspend-address-rec. 
 
    move zero   to suspend-dtl-occur 
                   ws-temp 
                   counters. 
 
    open input  unpriced-claims-file 
* 2000/03/20 - MC - include locations mstr
                loc-mstr 
                doc-mstr 
                diag-mstr 
                oma-fee-mstr 
                iconst-mstr. 
 
    open i-o    suspend-hdr 
                suspend-dtl 
* 2005/05/09 - add description file
  		suspend-desc
* 2005/05/09 - end
                suspend-address. 
 
*    expunge     report-file 
*                priced-claims-file. 
    open output report-file 
                priced-claims-file. 
 
    move spaces				to	hold-oma-recs. 
    perform aa1-init-hold-oma-rec      thru    aa1-99-exit
		varying i
   		from    1 
   		by      1 
		until   i  > ss-max-nbr-oma-det-rec-allow.
*		until   i  > 40.

*   (OBTAIN CONSTANT'S MSTR RECORD THAT CONTAINS LIST OF VALID CLINIC NBR) 
    move 1                          to      iconst-clinic-nbr-1-2. 
    perform uj1-read-isam-const-mstr thru   uj1-99-exit. 
 
*   (CHECK FOR ERRORS - SHUT DOWN) 
    if fatal-error 
    then 
*       (ERROR - WRITE REPORT AND SKIP BATCH) 
        move "Y"                        to      fatal-error-flag 
        move 2                          to      ws-carriage-ctrl 
        move 45                         to      err-ind 
	move ws-error-literal           to	err-warn-msg
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
        go to aa0-99-exit 
    else 
*	(MOVE CONSTANT'S MSTR VALUES INTO HOLD AREA TO BE USED LATER TO VERIFY CLINICS) 
        move constants-mstr-rec-2       to	constants-mstr-rec-1. 
*   endif 
 
*   (OBTAIN PRICING CONSTANT'S VALUES FROM REC 2 OF CONSTANTS MASTER) 
    move 2                          to      iconst-clinic-nbr-1-2. 
    perform uj1-read-isam-const-mstr thru   uj1-99-exit. 
 
*   (CHECK FOR ERRORS - SHUT DOWN) 
    if fatal-error 
    then 
*       (ERROR - WRITE REPORT AND SKIP BATCH) 
        move "Y"                        to      fatal-error-flag 
        move 2                          to      ws-carriage-ctrl 
        move 42                         to      err-ind 
	move ws-error-literal           to	err-warn-msg
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
        go to aa0-99-exit. 
*   endif 
 
    perform ta0-read-diskette                   thru ta0-99-exit. 
 
*   (FIRST RECORD MUST BE "B"ATCH RECORD) 
    if b-record 
    then 
        add 1                           to      ctr-b-recs-read 
*       MOVE DISKETTE-INPUT-REC-DATA    TO      BATCH-REC 
        perform ea0-proc-rec-type-batch thru    ea0-99-exit 
*       (CHECK FOR ERRORS - SHUT DOWN) 
        if fatal-error 
        then 
           go to aa0-99-exit 
        else 
*           (READ RECORD AFTER 'B' RECORD) 
            perform ta0-read-diskette   thru    ta0-99-exit 
*       endif 
    else 
*       (ERROR - FIRST RECORD NOT "B"ATCH RECORD) 
        move "Y"                        to      fatal-error-flag 
        move 2                          to      ws-carriage-ctrl 
        move 7                          to      err-ind 
	move ws-error-literal		to	err-warn-msg
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*       GO TO AA0-99-EXIT. 
*   endif 
*   (INITIALIZE SUBSCRIPT FOR PRICING HOLD AREA) 
    move 0                              to      ss-clmdtl-oma. 
*   (00/aug/13 B.E. - reset special add-on code flag)
    move "N"				to	ws-special-add-on-cd-entered.	
* 2005/11/01 - MC - reset e078-premiun flag
    move "N"				to 	ws-e078-premium.
* 2005/11/01 - end


* 2008/04/28 - MC - reset flags
    move "N"   to    ws-e020. 
    move "N"   to    ws-e719. 
    move "N"   to    ws-e720. 
    move "N"   to    ws-e717. 
    move "N"   to    ws-e702. 
    move "N"   to    ws-g123. 
    move "N"   to    ws-g223. 
    move "N"   to    ws-g265. 
    move "N"   to    ws-g385. 
    move "N"   to    ws-g281. 
    move "N"   to    ws-e793. 
    move "N"   to    ws-e022-e017-e016. 
    move "N"   to    ws-z570. 
    move "N"   to    ws-z571.
    move "N"   to    ws-z555-z580. 
    move "N"   to    ws-z515-z760. 
    move "N"   to    ws-g228. 
    move "N"   to    ws-g231. 
    move "N"   to    ws-g264. 
    move "N"   to    ws-g384. 
    move "N"   to    ws-g381. 
    move "N"   to    ws-r905-s800. 
    move "N"   to    ws-annna.
    move "N"   to    ws-gnnna.
    move "N"   to    ws-k991-u997. 

* 2008/04/28 - end

 
    move carriage-return		to	diskout-cr. 
    move line-feed      		to	diskout-lf. 

aa0-99-exit. 
    exit. 

aa1-init-hold-oma-rec.

    move zeros		to  hold-sv-nbr-serv(i).
    move zeros		to  hold-sv-date-yy(i).
    move zeros		to  hold-sv-date-mm(i).
    move zeros		to  hold-sv-date-dd(i).
    move zeros		to  hold-icc-grp(i). 
    move zeros		to  hold-fee-incoming(i).  

*   (00/aug/31 B.E.)
    move zeros		to  hold-sv-nbr-serv-incoming(i).

*   (00/aug/10 B.E.)
    move zeros		to  hold-ss-curr-prev(i).

    move zeros		to  hold-fee-oma(i).    
    move zeros		to  hold-fee-ohip(i).    
    move zeros		to  hold-priced-tech(i).  
    move zeros		to  hold-basic-tech(i).    
    move zeros		to  hold-basic-prof(i). 
    move zeros		to  hold-basic-fee(i).   
    move zeroes		to  hold-flag-sec(i).     
    move zeroes		to  hold-flag-grp(i).      
    move zeros		to  hold-diag-cd(i).      
    move zeros		to  hold-line-no(i).       
           
    perform aa2-init-oma-fees 	thru aa2-99-exit
	varying ss1 
	from    1
         by	1
	until   ss1 > 2.
		
    perform aa3-init-sv-nbr  thru aa3-99-exit
	varying ss1 
	from    1
	 by	1
	until   ss1 > 3.
		
aa1-99-exit.
    exit.


aa2-init-oma-fees.

    move zeroes	to  hold-oma-fee-1(i,ss1).   
    move zeroes	to  hold-oma-fee-2(i,ss1).    
    move zeroes	to  hold-oma-fee-anae(i,ss1).  
    move zeroes	to  hold-oma-fee-asst(i,ss1).

aa2-99-exit. 
    exit.

aa3-init-sv-nbr.
 
    move zeroes 	to hold-sv-nbr(i,ss1).

aa3-99-exit.
    exit.




 
ab0-processing. 
 
    if b-record 
    then 
        add 1                                   to      ctr-b-recs-read 
        perform ea0-proc-rec-type-batch         thru    ea0-99-exit 
    else 
    if h-record 
    then 
        add 1                                   to      ctr-h-recs-read 
        perform fa0-proc-rec-type-header1       thru    fa0-99-exit 
    else 
    if r-record 
    then 
        add 1                                   to      ctr-r-recs-read 
        move 1                                  to      ctr-hdr2-rec
        perform ga0-proc-rec-type-header2       thru    ga0-99-exit 
    else 
    if t-record 
    then 
        add 1                                   to      ctr-t-recs-read 
        perform ha0-proc-rec-type-detail        thru    ha0-99-exit 
    else 
    if a-record 
    then 
        add 1                                   to      ctr-a-recs-read 
        move 1                                  to      ctr-addr-rec
        perform ia0-proc-rec-type-address       thru    ia0-99-exit 
    else 
    if e-record 
    then 
        add 1                                   to      ctr-e-recs-read 
        perform ka0-proc-rec-type-trailer       thru    ka0-99-exit. 
*   endif 
 
*   (IF ERROR FOUND PROCESSING THIS RECORD, SKIP PROCESSING ANY DTL/ADDR RECS THAT 
*    BELONG TO SAME ACCOUNT ID: 
*    -- SKIP ALL INTERVEENING DETAIL AND ADDRESS RECORDS UNTIL ANOTHER HEADER (H) 
*    RECORD OR TRAILER (E) RECORD IS FOUND OR END OF INPUT FILE) 
    if skip-processing-this-acct-id 
    then 
        move spaces                             to      unpriced-claims-record 
        perform ta0-read-diskette               thru    ta0-99-exit 
            until  b-record 
*                                           OR "E") 
                 or eof-input-file 
*       MOVE "N"                                TO      SKIP-PROCESSING-THIS-ACCT-ID-FLAG 
*       GO TO AB0-99-EXIT 
    else 
        if not eof-input-file 
             perform ta0-read-diskette               thru    ta0-99-exit. 
*       endif 
*   endif 
 
ab0-99-exit. 
    exit. 
az0-finalization. 
 
   close unpriced-claims-file 
         priced-claims-file 
         suspend-hdr 
         suspend-dtl 
         suspend-address 
* 2005/05/09 - add description file
  	 suspend-desc
* 2005/05/09 - end
         doc-mstr 
*2000/03/20 - MC - include locations mstr
         loc-mstr 
         oma-fee-mstr 
         diag-mstr 
         iconst-mstr 
         report-file. 
 
az0-99-exit. 
    exit. 
 
copy "db0_mod10_check_digit.rtn".
 
copy "db0a_mod10_check_digit_10.rtn".
 
copy "dc0_mod10_check_digit_alt.rtn".


ea0-proc-rec-type-batch. 
 
*   (processing a new BATCH. If there were detail records in hold area 
*    from the previous claim header rec then area process them - ie. price 
*    them and write them out) 
    perform xx0-process-hold-dtls	thru xx0-99-exit. 
 
*   (RE-SET TOTALS FOR THIS BATCH - NOTE THAT THIS ZEROING WILL ALSO 
*    WIPE OUT THE COUNTER OF THE "B"ATCH RECORD READ THAT IS BEING 
*    PROCESSED - THUS SET APPROPRIATE COUNTERS TO 1) 
    move zero                           to      counters. 
    move 1                              to      ctr-b-recs-read 
                                                ctr-recs-read. 
*    MOVE DISKETTE-INPUT-REC-DATA       TO      BATCH-REC. 
    move unpriced-moh-code               to batch-dist-cd. 
    move unpriced-bathdr-batch-nbr       to batch-identifier. 
    move unpriced-bathdr-fac-no          to batch-group-nbr. 
    move unpriced-bathdr-prov-ohip-no    to batch-provider-nbr. 
    move unpriced-bathdr-spec-cd         to batch-speciality. 
    move zero                           to batch-pay-type. 

*2002/04/24 - MC
*2002/05/03 - MC
*    move unpriced-payroll-flag 		to ws-default-payroll-flag.
     if unpriced-bathdr-clinic-1-2 = 85  
     then
	move "B"			to ws-default-payroll-flag
     else
	move "A"			to ws-default-payroll-flag.
*   endif
*2002/05/03 - end
*2002/04/24  -  end
 
    if unpriced-default-batch-loc not = " " 
    then 
       move unpriced-default-batch-loc	to ws-default-batch-location 
    else 
       move spaces                        	to ws-default-batch-location. 
*   endif 
 
    if unpriced-default-batch-i-o-ind not = " " 
    then 
       move unpriced-default-batch-i-o-ind	to ws-default-batch-i-o-ind 
    else 
       move spaces                        	to ws-default-batch-i-o-ind. 
*   endif 
 
    perform ea10-determine-clinic-nbr   thru    ea10-99-exit. 
*   (check if error - shut down) 
    if fatal-error 
    then 
        go to ea0-99-exit. 
*   endif 
 
*   (read docter master by doc nbr) 
*   MOVE BATCH-PROVIDER-NBR             TO      DOC-PRACT-NBR. 
    move unpriced-bathdr-doc-nbr         to      doc-nbr. 
    perform tb0-read-doc                thru    tb0-99-exit. 
    if doc-found 
    then 
        perform ea11-check-doctor-speciality    thru    ea11-99-exit 
        perform ea12-check-dept-no              thru    ea12-99-exit 
        perform ea13-check-provider-nbr         thru    ea13-99-exit 
* 2003/10/22 - MC - check doctor's clinic
        perform ea14-check-doctor-clinic        thru    ea14-99-exit
* 2003/10/22 - end
    else 
*       (error - write report and skip batch) 
        move "Y"                        to      fatal-error-flag 
        move 2                          to      ws-carriage-ctrl 
        move 2                          to      err-ind 
	move ws-error-literal		to	err-warn-msg
        move unpriced-bathdr-doc-nbr     to      err-msg-doc-nbr 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*       GO TO EA0-99-EXIT. 
*   endif 
 
ea0-99-exit. 
    exit. 
 
 
ea10-determine-clinic-nbr. 
 
    move "N"                            to flag-clinic. 
 
    perform ea10a-search-clinic-tbl     thru ea10a-99-exit 
        varying sub 
        from   1 
        by     1 
        until   sub > const-max-nbr-clinics 
             or clinic-found. 
 
*   (diskettes from non-web sites don't all have the clinic in 
*    the submission file - therefore if the clinic is zero 
*    don't give an error but allow the operator to have specified 
*    a clinic) 
    if    clinic-not-found 
* 2003/10/22 - MC - the size has changed from 4 to 2
*      and ws-default-clinic-nbr         = 0000
      and ws-default-clinic-nbr         = 00
* 2003/10/22 - end
    then 
*       (error - clinic on diskette is bad and no override 
*	 default clinic was specified by the operator) 
        move "Y"                        to      fatal-error-flag 
        move 2                          to      ws-carriage-ctrl 
        move 6                          to      err-ind 
	move ws-error-literal		to	err-warn-msg
        move batch-group-nbr            to      err-msg-clinic-id 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
    else 
        if    clinic-not-found 
* 2003/10/22 - MC - the size has changed from 4 to 2
*          and ws-default-clinic-nbr     not = 0000
          and ws-default-clinic-nbr     not = 00
* 2003/10/22 - end
  	then 
*	    (clinic is bad but override default clinic was specified) 
            move ws-default-clinic-nbr	to      unpriced-bathdr-clinic-1-2 
            move ws-default-clinic-nbr	to	bt-clinic-nbr-1-2 
            move ws-default-clinic-nbr	to 	batch-group-nbr. 
*        endif 
*   endif 
 
ea10-99-exit. 
    exit. 
 
 
 
ea10a-search-clinic-tbl. 
*   (97/sep/25 b.e. logic changed for web site file) 
*   IF BATCH-GROUP-NBR           = CONST-CLINIC-NBR-1-2 (SUB) 
    if unpriced-bathdr-clinic-1-2 = const-clinic-nbr-1-2 (sub) 
    then 
         move const-clinic-nbr-1-2 (sub) to bt-clinic-nbr-1-2 
         move const-clinic-nbr     (sub) to batch-group-nbr 
         move 'Y'                        to flag-clinic. 
*   endif 
 
ea10a-99-exit. 
    exit. 
 
 
ea11-check-doctor-speciality. 
 
    if    batch-speciality not = doc-spec-cd 
      and batch-speciality not = doc-spec-cd-2 
      and batch-speciality not = doc-spec-cd-3 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 4                          to      err-ind 
        move batch-speciality           to      err-msg-batch-spec-cd 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 5                          to      err-ind 
        move doc-spec-cd                to      err-msg-doc-spec-cd 
        move doc-spec-cd-2              to      err-msg-doc-spec-cd-2 
        move doc-spec-cd-3              to      err-msg-doc-spec-cd-3 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit. 
*   endif 
 
 
ea11-99-exit. 
    exit. 
 
 
ea12-check-dept-no. 
 
    if    unpriced-bathdr-dept  not = doc-dept 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 32                         to      err-ind 
        move unpriced-bathdr-dept        to      err-msg-batch-dept-no 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 33                         to      err-ind 
        move doc-dept                   to      err-msg-doc-dept-no 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit. 
*   endif 
 
ea12-99-exit. 
    exit. 
 
 
ea13-check-provider-nbr. 
 
    if    unpriced-bathdr-prov-ohip-no   not = doc-pract-nbr 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 35                         to      err-ind 
        move unpriced-bathdr-prov-ohip-no to     err-msg-batch-prov-nbr 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 36                         to      err-ind 
        move doc-pract-nbr              to      err-msg-doc-prov-nbr 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit. 
*   endif 
 
ea13-99-exit. 
    exit. 

* 2003/10/22 - MC - add this new subroutine
ea14-check-doctor-clinic.

    if    bt-clinic-nbr-1-2 not = doc-clinic-nbr
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-2
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-3
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-4
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-5
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-6
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 57                         to      err-ind
        move bt-clinic-nbr-1-2          to      err-msg-doc-clinic
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.
*   endif

ea14-99-exit.
    exit.

* 2003/10/22 - end

 
fa0-proc-rec-type-header1. 
 
*   (processing a new HEADER rec. If there were detail records in hold area 
*    from the previous claim header rec then area process them - ie. price 
*    them and write them out) 
    perform xx0-process-hold-dtls	thru xx0-99-exit. 
 
    move "N"                          to   skip-process-this-acct-id-flag.
 
    perform fb0-build-susp-hdr-rec      thru fb0-99-exit. 
*   (if error found processing this record, skip processing dtl/addr part of record) 
    if skip-processing-this-acct-id 
    then 
        go to fa0-99-exit. 
*   endif 
 
*mf    perform fd0-build-susp-addr-rec-from-hdr1 
    perform fd0-build-susp-addr-rec-hdr1
                                        thru    fd0-99-exit. 
 
*   (moved to just before all details are written out so that total 
*    amount of priced claim can be updated into header) 
*   perform tc0-write-hdr-rec           thru    tc0-99-exit. 
 
    move 0                              to      ctr-hdr2-rec
                                                ctr-addr-rec.
fa0-99-exit. 
    exit. 



fb0-build-susp-hdr-rec. 
 
*  (if 'RMB' claim output header/address records) 
    if   last-record-is-h 
      or detail-written
    then 
        move 'N'                        to   detail-written-flag 
*       (header written out with details in xx0) 
*         perform tc0-write-hdr-rec       thru tc0-99-exit 
        perform tf0-write-addr-rec      thru tf0-99-exit. 
*   endif 
 
*   move diskette-input-rec-data        to      header-rec. 
*   98/04/06 mc - initialize header-rec 
    move spaces				to	header-rec. 
    move zeroes				to	hdr-birth-date
						hdr-birth-date-dd
						hdr-refer-pract-nbr
						hdr-admit-yy
						hdr-admit-mm
						hdr-admit-dd.

*   (incoming claim/accounting nbr moved to hold area so it can 
*    be written back out to the unpriced(diskette-out) files 
 
    move spaces                         to      suspend-hdr-rec. 

    move zeroes				to 	clmhdr-batch-nbr. 
    move unpriced-clmhdr-claim           to      hold-accounting-nbr. 
    move unpriced-clmhdr-claim           to      hdr-accounting-nbr. 
    move doc-nbr                        to      clmhdr-doc-nbr. 
 
    move unpriced-clmhdr-health-nbr      to      hdr-health-care-nbr.
    if unpriced-clmhdr-birth-date = spaces
    then
	move zeroes			to 	hdr-birth-date-long
    else
    	move unpriced-clmhdr-birth-date  to      hdr-birth-date-long.
*   endif

    inspect unpriced-clmhdr-ref-doc-nbr replacing all space-char by zeros.
    if unpriced-clmhdr-ref-doc-nbr = spaces       
    then
	move zeroes			to	hdr-refer-pract-nbr
    else
	move unpriced-clmhdr-ref-doc-nbr to      hdr-refer-pract-nbr. 
    move unpriced-clmhdr-hosp-nbr        to      hdr-hosp-nbr. 
    move unpriced-clmhdr-man-review      to      hdr-manual-review. 
    if unpriced-clmhdr-admit-date = spaces
    then
	move zeroes			to 	hdr-admit-date
    else
    	move unpriced-clmhdr-admit-date  to      hdr-admit-date. 
*   endif
    move unpriced-clmhdr-version-cd      to      hdr-health-care-ver. 
 
    move zeros                          to      clmhdr-zeroed-oma-suff-adj. 
    move "C"                            to      clmhdr-batch-type. 

*   (00/sep/21 B.E. distinguish between "D"iskette and "W"eb claims")
    move flag-claim-source		to	clmhdr-claim-source-cd.
 
    move bt-clinic-nbr-1-2              to      clmhdr-clinic-nbr-1-2. 
 
*   IF BATCH-PROVIDER-NBR NOT = DOC-PRACT-NBR 
*   THEN 
*       MOVE '??????'                   TO      CLMHDR-DOC-NBR-OHIP-ALPHA 
*   ELSE 
        move batch-provider-nbr         to      clmhdr-doc-nbr-ohip. 
*   endif 
 
*   IF BATCH-SPECIALITY NOT = DOC-SPEC-CD 
*   THEN 
*       MOVE '??'                       TO      CLMHDR-DOC-SPEC-CD-ALPHA 
*   ELSE 
        move batch-speciality           to      clmhdr-doc-spec-cd. 
*   endif 
 
*   (REFERRING PHY. SPECIFIED - ENSURE THAT NBR IS VALID) 
 
    if hdr-refer-pract-nbr not = spaces and not = zeros 
    then 
        perform fb02-verify-referring-phys-nbr 
                                        thru    fb02-99-exit 
*       IF INVALID-REFER-PHYS 
*       THEN 
*           MOVE "??????"               TO      CLMHDR-REFER-DOC-NBR-ALPHA 
*       ELSE 
            move hdr-refer-pract-nbr    to      clmhdr-refer-doc-nbr. 
*       endif 
*   endif 
 
*2000/11/27 - MC - if referring doc nbr is blank for clinic 60's, set
*		   referring doc-nbr to be the same as original doc-nbr

    if     hdr-refer-pract-nbr = 0	
      and (    bt-clinic-nbr-1-2 >= 61 
	   and bt-clinic-nbr-1-2 <= 65
	  )
	then  
	    move batch-provider-nbr     to clmhdr-refer-doc-nbr.
*	    endif

*2007/08/16 - MC - if referring doc nbr is blank for clinic 70's, set
*		   referring doc-nbr to be the same as original doc-nbr
    if     hdr-refer-pract-nbr = 0	
      and (    bt-clinic-nbr-1-2 >= 71 
	   and bt-clinic-nbr-1-2 <= 75
	  )
	then  
	    move batch-provider-nbr     to clmhdr-refer-doc-nbr.
*	    endif
* 2007/08/16 - end
 
*   (determine if hospital nbr is required, and if so that the code is valid - 
*    - if valid, replace 4 digit hospital number with 1 character code) 
*       (hospital nbr specified - ensure that nbr is valid and translate to hosp code) 


*2000/03/20 - MC - comment out the following if condition
*    if    hdr-hosp-nbr not = spaces and not = zeros 
*      and not price-only-claim
*    then 
*       perform fb05-verify-hospital    thru    fb05-99-exit 
*       if clmhdr-hosp = "?" 
*       then 
*           perform xb0-print-warning-line 
*                                       thru    xb0-99-exit 
*           move 1                      to      ws-carriage-ctrl 
*           move 23                     to      err-ind 
*           move hdr-hosp-nbr           to      err-hosp-nbr, clmhdr-hosp 
*           perform zb0-build-write-err-rpt-line 
*                                       thru    zb0-99-exit. 
*       endif 
*   endif 
 
*   (if requested by operator, set all blank agent codes to 'OHIP') 
*   98/03/31 mc - also set clmhdr-tape-submit-ind to 'Y' and 
*		  clmhdr-agent-cd = '0' 
    if ws-agent-default-reply = "Y" 
    then 
 	move "Y"			to	clmhdr-tape-submit-ind 
        move "0"                        to      clmhdr-agent-cd 
        move "0"                        to      hdr-agent-cd. 
*   endif 
 
*   MOVE ZEROS                          TO      CLMHDR-ADJ-CD. 
    move spaces                         to      clmhdr-adj-cd. 
 
 
    move zero                           to      clmhdr-status-ohip. 
 
    move spaces                         to      clmhdr-reference. 
 
*   (non-rma-enhanced submissions don't have a location in the header 
*    records.  check the 'HEB' batch header record to see if rma has 
*    input a default value to use for all claims in the batch and 
*    override if required) 

 
    if    (   hdr-loc-code = ws-4-nulls 
           or hdr-loc-code = spaces) 
      and ws-default-batch-location not = spaces 
    then 
	move ws-default-batch-location	to clmhdr-loc. 
*   endif 
 
*   (non-rma-enhanced submissions don't have a patient i/o indicator in the 
*    hdr records.  check the 'HEB' batch header record to see if rma has 
*    input a default value to use for all claims in the batch and 
*    override if required) 
 
    if    (   hdr-i-o-ind = ws-1-null 
           or hdr-i-o-ind = spaces) 
      and ws-default-batch-i-o-ind not = spaces 
    then 
	move ws-default-batch-i-o-ind	to clmhdr-i-o-pat-ind. 
*   endif 
 
 
    if hdr-admit-date not = spaces and not = zeros 
    then 
*       (ADMIT DATE SPECIFIED - ENSURE THAT DATE IS VALID) 
        move hdr-admit-yy               to      ws-date-yy 
        move hdr-admit-mm               to      ws-date-mm 
        move hdr-admit-dd               to      ws-date-dd 
        perform xd0-verify-date thru    xd0-99-exit 
        if     invalid-date 
	   and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 26                     to      err-ind 
            move hdr-admit-date         to      err-admit-date 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*           MOVE "??????"               TO      CLMHDR-DATE-ADMIT 
*       ELSE 
            move hdr-admit-yy           to      clmhdr-date-admit-yy
            move hdr-admit-mm           to      clmhdr-date-admit-mm
            move hdr-admit-dd           to      clmhdr-date-admit-dd. 
*       endif 
*   endif 
 

* 2004/04/07 - MC
    if hdr-admit-date not = spaces and not = zeros
    then
*       (ADMIT DATE SPECIFIED - ENSURE THAT DATE IS greater than birth date)
        if     hdr-admit-date < hdr-birth-date-long
           and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 58                     to      err-ind
            move hdr-admit-date         to      err-58-admit-date
            move hdr-birth-date-long    to      err-58-birth-date
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
            move "????????"             to      clmhdr-date-admit.
*       endif
*   endif
* 2004/04/07 - end

 
    move sys-date                       to      clmhdr-date-sys. 
    move doc-dept                       to      clmhdr-doc-dept. 
    move zero                           to      clmhdr-curr-payment 
*mf                                             clmhdr-manual-and-tape-paymnts 
                                                clmhdr-amt-tech-billed 
                                                clmhdr-amt-tech-paid. 
 
    if hdr-health-care-nbr not = spaces and not = zeros 
    then 
        move hdr-health-care-nbr        to      clmhdr-health-care-nbr 
*       (THE FOLLOWING TWO MOVE STMT ADDED ON 91/04/23 BY M.C. - MOVED TO 
*        NEW LINES NUMBER BY B.L. 91/SEP/05) 
        move hdr-health-care-nbr        to      clmhdr-pat-key-data 
        move "O"                        to      clmhdr-pat-key-type. 
*   endif 
 
    move hdr-health-care-ver            to      clmhdr-health-care-ver. 
 
*   (CHECK THE RELATIONSHIP FIELD) 
*   IF HDR-RELATIONSHIP =  SPACES 
*                        OR 'Y' 
*                        OR 'N' 
*    THEN 
*        MOVE HDR-RELATIONSHIP           TO      CLMHDR-RELATIONSHIP 
*    ELSE 
*        PERFORM XB0-PRINT-WARNING-LINE 
*                                       THRU    XB0-99-EXIT 
*        MOVE 1                          TO      WS-CARRIAGE-CTRL 
*        MOVE 46                         TO      ERR-IND 
*        MOVE HDR-RELATIONSHIP           TO      ERR-RELATIONSHIP 
*        PERFORM ZB0-BUILD-WRITE-ERR-RPT-LINE 
*                                        THRU    ZB0-99-EXIT 
*        MOVE HDR-RELATIONSHIP           TO      CLMHDR-RELATIONSHIP. 
**       MOVE "?"                        TO      CLMHDR-RELATIONSHIP. 
**   endif 
 
*   (CHECK THE MANUAL REVIEW INDICATOR) 
    if  hdr-manual-review =  spaces 
                          or 'Y' 
                          or 'N' 
    then 
        move hdr-manual-review              to      clmhdr-manual-review 
    else 
        if not price-only-claim
	then
	    move ws-warning-literal	    to      err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit 
            move 1                          to      ws-carriage-ctrl 
            move 31                         to      err-ind 
            move hdr-manual-review          to      err-manual-review 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
            move hdr-manual-review          to      clmhdr-manual-review. 
*	endif
*   endif 

*   (00/sep/14 B.E.)
*   (number of description records set to zero here and updated by
*    program that processes the description record upload file)
*    move 0				to clmhdr-nbr-suspend-desc-recs.
 
    move doc-pract-nbr                  to      clmhdr-doc-pract-nbr. 
    move hdr-accounting-nbr             to      clmhdr-accounting-nbr. 
 
fb0-99-exit. 
    exit. 
 
fb0a-search-province. 
 
    if hdr-health-care-prov = prov(sub) 
    then 
        move "Y"                        to province-flag. 
*   endif 
 
fb0a-99-exit. 
    exit. 
 
 
fb02-verify-referring-phys-nbr. 
 
*   MOVE HDR-REFER-PRACT-NBR            TO      WS-CHK-IND. 
*   MOVE "Y"                            TO      FLAG-REFER-PHYS. 
 
    move hdr-refer-pract-nbr            to      ws-chk-nbr. 
*   IF      WS-CHK-NBR     = ZEROES 
        if  ws-chk-nbr-8   = 1 
        or  ws-chk-nbr-8   = 2 
    then 
        perform dc0-mod10-check-digit-for-1-2 thru dc0-99-exit 
    else perform db0-mod10-check-digit  thru    db0-99-exit. 
*   endif 
 
    move flag                           to      flag-refer-phys. 
 
    if    invalid-refer-phys 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 12                         to      err-ind 
        move hdr-refer-pract-nbr        to      err-refer-phys-nbr 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit. 
*   endif 

    if    hdr-refer-pract-nbr = batch-provider-nbr
* 2007/08/16 - MC - include 70's check
*      and (   bt-clinic-nbr-1-2 < 60 
*	   or bt-clinic-nbr-1-2 > 65
      and (   bt-clinic-nbr-1-2 < 60 
	   or bt-clinic-nbr-1-2 > 75
* 2007/08/16 - end
	  )
      and not price-only-claim
    then
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 47                         to      err-ind
*2000/03/20 - MC
*       move unpriced-clmhdr-ref-doc-nbr to      err-msg-referring-doc
*       move unpriced-bathdr-prov-ohip-no to     err-msg-provider-doc
*
        move hdr-refer-pract-nbr        to      err-msg-referring-doc
        move batch-provider-nbr          to     err-msg-provider-doc
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.

*** S.B. - end.

fb02-99-exit. 
    exit. 
 
fb03-verify-diag-code. 
 
    move "Y"                            to      flag-diag-cd. 
*mf    read diag-mstr      suppress data record 
       read diag-mstr
        invalid key 
            if not price-only-claim
	    then
		move ws-error-literal		to	err-warn-msg
	        perform xb0-print-warning-line  thru    xb0-99-exit 
	        move 1                          to      ws-carriage-ctrl 
	        move 14                         to      err-ind 
	        move diag-cd                    to      err-diag-code 
	        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
	        move            'N'             to      flag-diag-cd. 
*	    endif
 
fb03-99-exit. 
    exit. 


fb04-verify-doc-location. 
 
*   (NON-RMA-ENHANCED SUBMISSIONS DON'T HAVE A LOCATION IN THE HEADER 
*    RECORDS.  CHECK THE 'HEB' BATCH HEADER RECORD TO SEE IF RMA HAS 
*    INPUT A DEFAULT VALUE TO USE FOR ALL CLAIMS IN THE BATCH AND 
*    OVERRIDE IF REQUIRED) 
 
    if    Hdr-loc-code = spaces 
      and ws-default-batch-location not = spaces 
      and not price-only-claim
    then 
	move ws-default-batch-location	to hdr-loc-code. 
*   endif 
 
    move 'N'                            to      flag-location. 
    if hdr-loc-code not = spaces 
    then 
        perform fb04a-search-doc-location       thru    fb04a-99-exit 
            varying sub 
            from 1 
            by   1 
            until   sub > max-doc-locations 
                 or valid-location. 
*   endif 
 
    if    invalid-location 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 3                          to      err-ind 
        move hdr-loc-code               to      err-msg-loc-cd 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit. 
*   endif 
 
fb04-99-exit. 
    exit. 
 
 
fb04a-search-doc-location. 
 
    if hdr-loc-code = doc-loc(sub) 
    then 
        move 'Y'                        to flag-location. 
*   endif 
 
fb04a-99-exit. 
    exit. 
 
*2000/03/20 - MC  add the new subroutine fb04b-read-loc-mstr
fb04b-read-loc-mstr. 

    move hdr-loc-code			to loc-nbr.
 
    read loc-mstr
      invalid key 
        if not price-only-claim
	then
	    move zeroes			    to 	loc-hospital-nbr
	    move spaces			    to 	loc-card-colour
	    move ws-error-literal	    to	err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit 
            move 1                          to      ws-carriage-ctrl 
            move 51                         to      err-ind 
            move hdr-loc-code               to      err-51-loc-cd
            perform zb0-build-write-err-rpt-line
					    thru    zb0-99-exit.
*	endif

fb04b-99-exit.
    exit.


 
copy "hospital.dc".
 
copy "hosp_nbr_code_to_nbr.rtn"
     replacing  ==ca11-move-hosp==      by ==fb05-verify-hospital== 
                ==ca11-10-hosp-loop==   by ==fb05-10-hosp-loop== 
                ==ca11-99-exit==        by ==fb05-99-exit== 
                ==clmhdr-hosp==         by ==hdr-hosp-nbr== 
                ==hosp-nbr==            by ==hosp-code== 
                ==hosp-code==           by ==hosp-nbr== 
                ==spaces==              by =="?"== 
                ==l1-hosp==             by ==clmhdr-hosp==. 
copy "verify_agent_code.rtn"
     replacing  ==xx00-verify-agent==   by ==fb06-verify-agent== 
                ==xx00-99-exit==        by ==fb06-99-exit== 
                ==agent-2b-tested==     by ==hdr-agent-cd==. 
fb07-verify-in-out-ind. 
 
*   (NON-RMA-ENHANCED SUBMISSIONS DON'T HAVE A PATIENT I/O INDICATOR IN THE 
*    HDR RECORDS.  CHECK THE 'HEB' BATCH HEADER RECORD TO SEE IF RMA HAS 
*    INPUT A DEFAULT VALUE TO USE FOR ALL CLAIMS IN THE BATCH AND 
*    OVERRIDE IF REQUIRED) 
 
    if    hdr-i-o-ind = spaces 
      and ws-default-batch-i-o-ind not = spaces 
    then 
	move ws-default-batch-i-o-ind	to hdr-i-o-ind. 
*   endif 
 
*   IF HDR-I-O-IND = "1" OR "2" OR SPACES 
    if hdr-i-o-ind = "1" or "2" or "I" or "O" or spaces 
    then 
        move "Y"                        to      flag-in-out-ind 
    else 
        move "N"                        to      flag-in-out-ind. 
*   endif 
 
fb07-99-exit. 
    exit. 
*mf fd0-build-susp-addr-rec-from-hdr1. 
fd0-build-susp-addr-rec-hdr1.
 
    move spaces                 to suspend-address-rec. 
 
*   VALIDATE THE BIRTH DATE 
 
    move hdr-birth-date-long    to addr-birth-date. 
 
    if    hdr-birth-date-long = spaces or zeros 
      and not price-only-claim
    then 
	move ws-warning-literal	to err-warn-msg
        perform xb0-print-warning-line thru xb0-99-exit 
        move 1                  to ws-carriage-ctrl 
        move 37                 to err-ind 
        move hdr-birth-date-long to err-birth-date 
        perform zb0-build-write-err-rpt-line thru zb0-99-exit 
*       MOVE '??????'           TO ADDR-BIRTH-DATE 
    else 
        move addr-birth-yy      to ws-date-yy 
        move addr-birth-mm      to ws-date-mm 
        move addr-birth-dd      to ws-date-dd 
        perform xd0-verify-date thru xd0-99-exit 
        if    invalid-date 
          and not price-only-claim
        then 
	    move ws-error-literal	to err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit 
            move 1                      to ws-carriage-ctrl 
            move 37                     to err-ind 
            move hdr-birth-date-long    to err-birth-date 
            perform zb0-build-write-err-rpt-line thru zb0-99-exit. 
*           MOVE '??????'               TO ADDR-BIRTH-DATE. 
*       endif 
*   endif 
 
    move clmhdr-doc-pract-nbr   to addr-doc-pract-nbr. 
    move clmhdr-accounting-nbr  to addr-accounting-nbr. 
 
fd0-99-exit. 
    exit. 
 
 
ga0-proc-rec-type-header2. 

    if unpriced-clmhdr-claim = 00523321
    then
	next sentence.
*   endif

    move unpriced-clmhdr-pat-surname     to clmhdr-pat-acronym6 
                                           clmhdr-patient-surname. 
 
    move unpriced-clmhdr-given-name      to clmhdr-pat-acronym3 
                                           clmhdr-subscr-initials. 
 
* 2000/jun/09 -BA/BE begin
*  (if either 'confidentiality' or 'manual review' flags have been
*   set then update 'manual review' to  "Y"es in the suspend header rec)
*    move unpriced-confidentiality-flag to    clmhdr-confidential-flag.
    if   unpriced-confidentiality-flag = "Y"
      or hdr-manual-review            = "Y"
    then
	move "Y"			  to    hdr-manual-review
    else
        move ' '			  to	hdr-manual-review.
*   endif
    if   unpriced-confidentiality-flag = "Y"
    then
        move "Y"			  to    clmhdr-confidential-flag
    else
        move ' '			  to 	clmhdr-confidential-flag.
* 2000/jun/09 -BA end

    move unpriced-clmhdr-loc-code        to hdr-loc-code. 
*   (DETERMINE IF VALID LOCATION FOR DOCTOR) 
    perform fb04-verify-doc-location    thru    fb04-99-exit. 
*   IF INVALID-LOCATION 
*   THEN 
*       MOVE "????"                     TO      CLMHDR-LOC 
*   ELSE 
        move hdr-loc-code               to      clmhdr-loc. 
*   endif 


* 2005/05/05 - MC - check certain location code if clinic 61 - 65
*    if  bt-clinic-nbr-1-2 >= 61 and bt-clinic-nbr-1-2  <= 65
    if     (     (bt-clinic-nbr-1-2 >= 61 and bt-clinic-nbr-1-2  <= 65)
* 2007/11/27 - MC - include check for clinic 71 - 75 as well
            or   (bt-clinic-nbr-1-2 >= 71 and bt-clinic-nbr-1-2  <= 75)
	   )
* 2007/11/27 - end
        and  not price-only-claim
    then
	if    hdr-loc-code not = 'M233'		 
	  and hdr-loc-code not = 'M521'		 
	  and hdr-loc-code not = 'M525'		 
	  and hdr-loc-code not = 'M526'		 
	  and hdr-loc-code not = 'M527'		 
	  and hdr-loc-code not = 'M540'		 
	  and hdr-loc-code not = 'M541'		 
	  and hdr-loc-code not = 'M542'		 
	  and hdr-loc-code not = 'M544'		 
	  and hdr-loc-code not = 'M545'		 
	  and hdr-loc-code not = 'M546'		 
	  and hdr-loc-code not = 'M547'		 
	  and hdr-loc-code not = 'M555'		 
	  and hdr-loc-code not = 'M556'	
        then 
	    move ws-warning-literal	    to      err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit 
            move 1                          to      ws-carriage-ctrl 
            move 62                         to      err-ind 
            move bt-clinic-nbr-1-2          to      err-62-clinic-nbr 
            move hdr-loc-code               to      err-62-loc-code   
            move "????"                     to      clmhdr-loc
            perform zb0-build-write-err-rpt-line 
                                        	thru    zb0-99-exit. 
*	endif 
*   endif

* 2005/05/05 - end

*2000/03/20 - MC -get the hosp nbr and i/o ind from f030-locations-mstr
*		  by loc-code
    perform fb04b-read-loc-mstr		thru	fb04b-99-exit.
    move loc-hospital-nbr		to	clmhdr-hosp.
*

*2002/04/24 - substitute hosp with payroll-flag
    move ws-default-payroll-flag	to 	clmhdr-hosp.
*2002/04/24  - end
 
    move unpriced-clmhdr-agent-cd        to      hdr-agent-cd. 
*   (DETERMINE IF VALID AGENT) 
    perform fb06-verify-agent           thru    fb06-99-exit. 
    if    invalid-agent-cd 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 20                         to      err-ind 
        move hdr-agent-cd               to      err-agent-cd 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*       MOVE "?"                        TO      CLMHDR-AGENT-CD 
*   ELSE 
        move hdr-agent-cd               to      clmhdr-agent-cd. 
*   endif 
 
    if     def-agent-ohip 
	or def-agent-ohip-wcb 
    then 
        move zero                       to      clmhdr-date-cash-tape-payment 
    else 
        if not price-only-claim
	then
*	    (PRINT WARNING THAT DIRECT BILL AGENT ENTERED AND ALL DIRECT 
*      	     BILL INFO IS MISSING) 
	    move ws-warning-literal	    to	    err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit 
            move 1                          to      ws-carriage-ctrl 
            move 25                         to      err-ind 
            perform zb0-build-write-err-rpt-line 
                                            thru    zb0-99-exit 
            move "??"                       to      clmhdr-msg-nbr 
            move "?"                        to      clmhdr-reprint-flag 
            move "?"                        to      clmhdr-sub-nbr 
            move "?"                        to      clmhdr-auto-logout 
            move "?"                        to      clmhdr-fee-complex. 
*	endif
*   endif 
 
*   (SET INDICATOR TO ASSUME THAT CLAIM CAN BE SUBMITTED ON TAPE - WHEN 
*    ACTUAL CLAIM IS BUILT THE DETAILS WERE BE CHECKED TO ENSURE THAT 
*    THIS INDICATOR IS SET CORRECLTY) 
    if clmhdr-agent-cd = 0 or 2 
    then 
        move "Y"                        to      clmhdr-tape-submit-ind 
    else 
        move "N"                        to      clmhdr-tape-submit-ind. 
*   endif 

*2001/02/28 - MC- if agent = 6 or 9, set clmhdr-status = 'I'gnore
    if clmhdr-agent-cd = 6 or 9
    then 
	move "I"			to 	clmhdr-status.
*   endif


*2000/03/20 - MC - use loc-card-colour instead
*   move unpriced-clmhdr-i-o-ind         to      hdr-i-o-ind. 
    move loc-card-colour                to      hdr-i-o-ind. 
*
*2000/03/29 - MC - check the incoming i-o ind with loc-card-colour 
    if    unpriced-clmhdr-i-o-ind  not =   hdr-i-o-ind
      and not price-only-claim
    then 
  	move ws-warning-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 53                         to      err-ind 
        move unpriced-clmhdr-i-o-ind     to      err-53-incoming-i-o-ind 
        move hdr-i-o-ind                to      err-53-i-o-ind 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit .
*   endif
*   


    perform fb07-verify-in-out-ind      thru    fb07-99-exit. 
    if    invalid-in-out-ind 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 15                         to      err-ind 
        move hdr-i-o-ind                to      err-i-o-ind 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
*       MOVE "?"                        TO      CLMHDR-I-O-PAT-IND 
        move hdr-i-o-ind                to      clmhdr-i-o-pat-ind 
    else 
*       IF HDR-I-O-IND = 1 - 96/07/30 
        if hdr-i-o-ind = "1" or "I" 
        then 
            move "I"                    to      clmhdr-i-o-pat-ind 
        else 
*           IF HDR-I-O-IND = 2 - 96/07/30 
            if hdr-i-o-ind = "2" or "O" 
            then 
                move "O"                to      clmhdr-i-o-pat-ind 
            else 
*               (IF INDICATOR IS BLANK - CONSIDER AS 'OUT' PATIENT) 
                move "O"                to      clmhdr-i-o-pat-ind. 
*           endif 
*       endif 
*   endif 
 
 
    if unpriced-clmhdr-prov-cd = spaces 
    then 
        move 'ON'                       to      hdr-health-care-prov 
    else 
        move unpriced-clmhdr-prov-cd     to      hdr-health-care-prov. 
*   endif 
 
    move 'N'                            to      province-flag. 
    perform fb0a-search-province        thru    fb0a-99-exit 
            varying sub from 1 by 1 
            until (province-found or sub > 11). 
 
 
    if    province-not-found 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 30                         to      err-ind 
        move hdr-health-care-prov       to      err-province 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*       MOVE "??"                       TO      CLMHDR-HEALTH-CARE-PROV 
*   ELSE 
        move hdr-health-care-prov       to      clmhdr-health-care-prov. 
*   endif 


******************   

* 2001/02/07 - MC - save RMB registration nbr 
    if hdr-health-care-prov not = 'ON'  and
       unpriced-clmhdr-pat-ohip-nbr not = spaces and
       unpriced-clmhdr-pat-ohip-nbr not = zeroes
    then
	move unpriced-clmhdr-pat-ohip-nbr	to hdr-ohip-nbr.
*   endif

******************   
    if hdr-health-care-prov = 'ON' 
    then 
        if    hdr-health-care-nbr = spaces 
          and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 29                     to      err-ind 
            move hdr-health-care-nbr 
                                        to      err-health-care-nbr 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
            move "??????????"           to      clmhdr-health-care-nbr 
        else 
            move hdr-health-care-nbr    to      ws-nbr-10 
            if   (   ws-nbr-10 not numeric 
                  or ws-nbr-10 = zero 
		 )
              and not price-only-claim
            then 
		move ws-error-literal	to	err-warn-msg
                perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
                move 1                  to      ws-carriage-ctrl 
                move 29                 to      err-ind 
                move hdr-health-care-nbr 
                                        to      err-health-care-nbr 
                perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
                move "??????????"       to      clmhdr-health-care-nbr 
            else 
                move hdr-health-care-nbr 
                                        to      ws-check-nbr-10 
                perform db0a-mod10-check-digit-10 thru  db0a-99-exit 
                if    flag = 'N' 
                  and not price-only-claim
                then 
		    move ws-error-literal	to	err-warn-msg
                    perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
                    move 1              to      ws-carriage-ctrl 
                    move 29             to      err-ind 
                    move hdr-health-care-nbr to err-health-care-nbr 
                    perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
                    move "??????????"   to      clmhdr-health-care-nbr 
                else 
*               (DATA IS OK - HAS ALREADY BEEN MOVED INTO CLMHDR FIELDS 
                    next sentence. 
*               endif 
*           endif 
*       endif 
*   endif 
 
*   (DETERMINE IF VALID SIZE OF OHIP NBR FOR OUT OF PROVINCE PATIENT) 
 
* 2005/06/23 - MC - change from NF to NL
* if hdr-health-care-prov = 'NF' 
    if hdr-health-care-prov = 'NL' 
* 2005/06/23 - end
    then 
        if   (    nf-ohip-nbr is not numeric 
              or (nf-ohip-nbr = spaces or zeros) 
	     )
          and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit 
            move 1                      to ws-carriage-ctrl 
            move 40                     to err-ind 
	    move hdr-health-care-prov	to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr 
            perform zb0-build-write-err-rpt-line thru zb0-99-exit 
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE 
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
        else 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
						clmhdr-health-care-nbr
***
*       endif 
    else 
* 2001/02/12 - MC - ohip nbr size has changed
*   if hdr-health-care-prov = 'AB' or 'NS' 
    if hdr-health-care-prov = 'BC' or 'NS' 
    then 
*       if      (ab-ns-11-digits is not numeric) 
*           or  (ab-ns-11-digits =  spaces or zeros) 
*           or  (ab-ns-last-digits not = spaces) 
        if   (    (bc-ns-10-digits is not numeric) 
              or  (bc-ns-10-digits =  spaces or zeros) 
              or  (bc-ns-last-digits not = spaces) 
	     )
          and not price-only-claim
        then 
   	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit 
            move 1                      to ws-carriage-ctrl 
            move 40                     to err-ind 
	    move hdr-health-care-prov	to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr 
            perform zb0-build-write-err-rpt-line thru zb0-99-exit 
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE 
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
        else 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
						clmhdr-health-care-nbr
*       endif 
    else 
*   if hdr-health-care-prov = 'BC' 
    if hdr-health-care-prov = 'PE' 
    then 
*       if      (bc-10-digits is not numeric) 
*           or  (bc-10-digits =  spaces or zeros) 
*           or  (bc-last-digits not = spaces) 
        if   (    (pe-8-digits is not numeric) 
              or  (pe-8-digits =  spaces or zeros) 
              or  (pe-last-digits not = spaces) 
	     )
          and not price-only-claim
        then 
   	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit 
            move 1                      to ws-carriage-ctrl 
            move 40                     to err-ind 
	    move hdr-health-care-prov	to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr 
            perform zb0-build-write-err-rpt-line thru zb0-99-exit 
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE 
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
        else 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
						clmhdr-health-care-nbr
*       endif 
    else 
*   if hdr-health-care-prov = 'NB' or 'PE' or 'SK' or 'YT' 
    if hdr-health-care-prov = 'AB' or 'NB' or 'SK' or 'YT' 
    then 
*       if      (nb-pe-sk-yt-9-digits is not numeric) 
*           or  (nb-pe-sk-yt-9-digits =  spaces or zeros) 
*           or  (nb-pe-sk-yt-last-digits not = spaces) 
        if   (    (ab-nb-sk-yt-9-digits is not numeric) 
              or  (ab-nb-sk-yt-9-digits =  spaces or zeros) 
              or  (ab-nb-sk-yt-last-digits not = spaces) 
	     )
          and not price-only-claim
        then 
   	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit 
            move 1                      to ws-carriage-ctrl 
            move 40                     to err-ind 
	    move hdr-health-care-prov	to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr 
            perform zb0-build-write-err-rpt-line thru zb0-99-exit 
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE 
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
        else 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
						clmhdr-health-care-nbr
*       endif 
    else 
    if hdr-health-care-prov = 'NT' 
    then 
        if   (    (nt-first-digit is not alphabetic) 
              or  (nt-first-digit =  spaces) 
              or  (nt-7-digits is not numeric) 
              or  (nt-7-digits =  spaces or zeros) 
              or  (nt-last-digits not = spaces) 
	     )
          and not price-only-claim
        then 
   	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit 
            move 1                      to ws-carriage-ctrl 
            move 40                     to err-ind 
	    move hdr-health-care-prov	to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr 
            perform zb0-build-write-err-rpt-line thru zb0-99-exit 
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE 
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
        else 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
						clmhdr-health-care-nbr
*       endif 
    else 
    if hdr-health-care-prov = 'MB' 
    then 
* 2005/06/23 - MC - Manitoba should be 9 digits
*        if   (    (mb-6-digits is not numeric)
*             or  (mb-6-digits =  spaces or zeros)
        if   (    (mb-9-digits is not numeric)
              or  (mb-9-digits =  spaces or zeros)
* 2005/06/23 - end
              or  (mb-last-digits not = spaces) 
	     )
          and not price-only-claim
        then 
   	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit 
            move 1                      to ws-carriage-ctrl 
            move 40                     to err-ind 
	    move hdr-health-care-prov	to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr 
            perform zb0-build-write-err-rpt-line thru zb0-99-exit 
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE 
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
        else 
            move "O"                    to      clmhdr-pat-key-type 
            move hdr-ohip-nbr           to      clmhdr-pat-key-data 
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
						clmhdr-health-care-nbr.
*       endif 
*   endif 
 
 
    perform ga1-build-addr-rec-from-hdr2    thru ga1-99-exit. 
 
ga0-99-exit. 
   exit. 
 
 
ga1-build-addr-rec-from-hdr2. 
 
    move unpriced-clmhdr-pat-surname     to      addr-surname. 
    move unpriced-clmhdr-given-name      to      addr-first-name. 
    if   unpriced-clmhdr-sex = "1" 
    then 
         move "M"                       to      addr-sex 
    else 
    if   unpriced-clmhdr-sex = "2" 
    then 
         move "F"                       to      addr-sex 
    else 
         move unpriced-clmhdr-sex        to      addr-sex. 
*   endif 

*   (if phone nbr is only 7 digits long then default to local area code)
    move unpriced-clmhdr-phone-no	to	temp-phone-nbr.
    if    (    temp-phone-nbr-1-3  =  0
           and temp-phone-nbr-4-10 <> 0
	  )
       or (    temp-phone-nbr-1-7  <> 0
           and temp-phone-nbr-8-10 =  0
	  )
    then
*	(default area-code)
	move default-area-code		 to     unpriced-clmhdr-phone-no-1-3
        if temp-phone-nbr-8-10 = 0
	then
	    move temp-phone-nbr-1-7	 to	unpriced-clmhdr-phone-no-4-10
 	else
	    move temp-phone-nbr-4-10	 to	unpriced-clmhdr-phone-no-4-10.
*	endif
*   endif

    move unpriced-clmhdr-phone-no         to      addr-phone-no. 
 
 
ga1-99-exit. 
    exit. 
 
gb1-verify-dtl-diag-cd. 
 
    if hold-diag-cd(ss-write-dtl) =   spaces 
                                   or zeros 
    then 
*       (CHECK IF CODE REQUIRES A DIAGNOSIS CODE) 
        if    hold-oma-rec-ind (ss-write-dtl, ss-diag-ind) = "Y" 
          and hold-oma-suff    (ss-write-dtl)              = "A" or "M" 
          and not price-only-claim
        then 
   	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                          thru    xb0-99-exit 
            move 1                        to      ws-carriage-ctrl 
            move 22                       to      err-ind 
            move hold-oma-cd(ss-write-dtl) to     err-22-oma-cd 
            move "DIAGNOSTIC CODE"        to      err-22-msg 
            perform zb0-build-write-err-rpt-line 
                                          thru    zb0-99-exit 
*           MOVE "???"                    TO      CLMDTL-DIAG-CD-ALPHA 
            move zero                     to      clmdtl-diag-cd 
        else 
*           (NO DIAG. CODE SPECIFIED BUT NONE WAS REQUIRED) 
            move zero                     to      clmdtl-diag-cd 
*       endif 
    else 
*       (DIAG. CODE SPECIFIED - ENSURE THAT CODE IS VALID) 
        move hold-diag-cd(ss-write-dtl) to      diag-cd 
*##     CHCE3DCK ROUTINE TO SEE IF USING HOLD 
        perform fb03-verify-diag-code     thru    fb03-99-exit 
*       IF INVALID-DIAG-CODE 
*       THEN 
*           MOVE "???"                    TO      CLMDTL-DIAG-CD-ALPHA 
*       ELSE 
            move hold-diag-cd(ss-write-dtl) 
                                          to      clmdtl-diag-cd 
*           (### ENSURE THAT CLMHDR STILL AVAILLE AND NOT NEW REC) 
*mf            if clmhdr-diag-cd = spaces or zeros 
            if clmhdr-diag-cd-alpha = spaces or zeros 
            then 
                move hold-diag-cd(ss-write-dtl) 
                                          to      clmhdr-diag-cd. 
*           endif 
*       endif 
*   endif 
 
gb1-99-exit. 
    exit. 
 
*2000/04/28 - B.A. begin
copy "d001_d003_newu701_confidentiality_check.rtn".

ha0-proc-rec-type-detail. 
 
*   (move the 2 service details from the 'unpriced' rec to pricing hold area) 
    add 1                               to                   ss-clmdtl-oma. 
 
    move unpriced-itm1-oma-svc-code      to hold-oma-cd      (ss-clmdtl-oma). 
    move unpriced-itm1-oma-svc-suff      to hold-oma-suff    (ss-clmdtl-oma). 

*  2008/04/29 - MC - transfer oma code edit check to the copybook 'd001_newu701_oma_code_edit.rtn
    perform la4-oma-code-edit   	thru la4-99-exit.
* 2008/04/29 - end

copy "pricing_logic_check_for_special_addon_codes.rtn"
	replacing  ==ws-oma-cd== by ==hold-oma-cd(ss-clmdtl-oma)==.
**   (00/aug/31 B.E. set flag is special addin code found)
**   (set flag if special add on oma codes of e409 or e400
**    or e401 or e410 entered)
*    if hold-oma-cd(ss-clmdtl-oma) =  "E400"
**				   or "E409"
*				   or "E401"
*				   or "E410"
*    then
*        move "Y"                               to ws-special-add-on-cd-entered.
**   endif

*   MOVE TAPEOUT-ITM1-OMA-AMT-BILLED    TO HOLD-FEE-BILLED  (SS-CLMDTL-OMA). 

*   (save incoming $ and #-svcs so that if RMA pricing alters these
*    values they can be recovered if needed)
    move unpriced-itm1-oma-amt-billed    to hold-fee-incoming(ss-clmdtl-oma). 
    move unpriced-itm1-nbr-serv	 	to hold-sv-nbr-serv-incoming
							    (ss-clmdtl-oma).
*
    move unpriced-itm1-override-price    to hold-override-price 
							    (ss-clmdtl-oma). 
    move unpriced-itm1-bilateral         to hold-bilateral   (ss-clmdtl-oma). 
*   (IF PRICE OVERRIDE IS REQUESTED THEN MOVE THE ENTERED FEE INTO FEE-OMA/OHIP) 
*  (NOTE: PRICE OVERRIDE FLAG ASSUMED TO BE SET IF THE INCOMING RECORD 
*         HAS PRICES. THIS HANDLES PC BASED BILLING PACKAGES THAT PRICE 
*         CLAIMS BUT DON'T SET THE PRICE OVERRIDE FLAG. 
*         THIS CODE SHOULD EVENTUALLY BE CHANGED TO USE THE INCOMING 
*         PRICE BUT REPORT IF THE RMA PRICING SOFTWARE CALCULATES 
*         A DIFFERENT PRICE) 

    inspect unpriced-itm1-oma-amt-billed replacing all space-char by zeros. 

*    if unpriced-itm1-oma-amt-billed not = 0 
*    then 
*        move "Y" 		to	unpriced-itm1-override-price. 
**   endif 
 
*    if   unpriced-itm1-override-price = "Y" 

    if unpriced-itm1-oma-amt-billed not = 0 
    then 
        move unpriced-itm1-oma-amt-billed to hold-fee-incoming(ss-clmdtl-oma) 
    else 
	move 0                            to hold-fee-oma     (ss-clmdtl-oma) 
                                             hold-basic-prof  (ss-clmdtl-oma) 
                                             hold-fee-ohip    (ss-clmdtl-oma). 
*   endif 
 
    move unpriced-itm1-nbr-serv          to hold-sv-nbr-serv (ss-clmdtl-oma). 
*   (REPEATING SERVICES NOT ALLOWED IN OHIP SUBMITTAL TAPE SPECIFICATION) 
    move 0                              to hold-sv-nbr      (ss-clmdtl-oma,1) 
                                           hold-sv-nbr      (Ss-clmdtl-oma,2) 
                                           hold-sv-nbr      (ss-clmdtl-oma,3) 
                                           hold-sv-day-num  (ss-clmdtl-oma,1) 
                                           hold-sv-day-num  (ss-clmdtl-oma,2) 
                                           hold-sv-day-num  (ss-clmdtl-oma,3). 
*  (if Override Price or Bilateral flags set, then default the first 
*   repetitive day field as per the way D001 works) 
 
    if unpriced-itm1-override-price = "Y" 
    then 
	move "OP" 			to hold-sv-day      (ss-clmdtl-oma,1) 
    else 
    if unpriced-itm1-bilateral = "Y" 
    then 
	move "BI" 			to hold-sv-day      (ss-clmdtl-oma,1). 
*   ENDCASE 
 
    move unpriced-itm1-svc-date          to hold-sv-date     (ss-clmdtl-oma). 
    move unpriced-itm1-diag-cd           to hold-diag-cd     (ss-clmdtl-oma). 
    move hold-oma-cd (ss-clmdtl-oma)    to fee-oma-cd. 
    perform xc0-check-oma-code          thru xc0-99-exit. 
*   (00/04/28 - B.A. begin)
*   (The check for oma and diag code is to set the confidentiality flag
*    at the detail level)
    perform ga11-check-for-confidentially thru ga11-99-exit.
*   (00/04/28 end)

    perform ha1-move-pricing-to-hold	thru ha1-99-exit. 
 
* ## BELOW FLAG MOVED - WHAT IMPACT ON RESET OF PGM) 
*   MOVE 'Y'                            TO DETAIL-WRITTEN-FLAG. 
 
    if unpriced-itm2-oma-svc-code = spaces 
    then 
*       (MOVE DETAIL REC TO PRICING HOLD AREA) 
	go to ha0-90-after-2nd-detail. 
*   endif 
 
    add 1                               to                   ss-clmdtl-oma. 

    move unpriced-itm2-oma-svc-code      to hold-oma-cd      (ss-clmdtl-oma). 
    move unpriced-itm2-oma-svc-suff      to hold-oma-suff    (ss-clmdtl-oma). 

*  2008/04/29 - MC - transfer oma code edit check to the copybook 'd001_newu701_oma_code_edit.rtn
    perform la4-oma-code-edit   	thru la4-99-exit.
* 2008/04/29 - end


copy "pricing_logic_check_for_special_addon_codes.rtn"
	replacing  ==ws-oma-cd== by ==hold-oma-cd(ss-clmdtl-oma)==.
*   (00/aug/31 B.E. set flag is special addin code found)
*   (set flag if special add on oma codes of e409 or e400
*    or e401 or e410 entered)
*    if hold-oma-cd(ss-clmdtl-oma) =  "E400"
*				   or "E409"
* 				   or "E401"
*				   or "E410"
*    then
*        move "Y"                                to ws-special-add-on-cd-entered.
*   endif

*   MOVE TAPEOUT-ITM2-OMA-AMT-BILLED    TO HOLD-FEE-BILLED  (SS-CLMDTL-OMA). 

*   (save incoming $ and #-svcs so that if RMA pricing alters these
*    values they can be recovered if needed)
    move unpriced-itm2-oma-amt-billed    to hold-fee-incoming(ss-clmdtl-oma). 
    move unpriced-itm2-nbr-serv	 	to hold-sv-nbr-serv-incoming
							    (ss-clmdtl-oma).

    move unpriced-itm2-override-price    to hold-override-price 
							    (ss-clmdtl-oma). 
    move unpriced-itm2-bilateral         to hold-bilateral   (ss-clmdtl-oma). 
 
*    if unpriced-itm2-oma-amt-billed not = 0 
*    then 
*        move "Y" 		to	unpriced-itm2-override-price. 
**   endif 
 
*    if unpriced-itm2-override-price = "Y" 

    if unpriced-itm2-oma-amt-billed not = 0 
    then 
        move unpriced-itm2-oma-amt-billed to hold-fee-incoming(ss-clmdtl-oma) 
    else 
	move 0                            to hold-fee-oma     (ss-clmdtl-oma) 
                                             hold-basic-prof  (ss-clmdtl-oma) 
                                             hold-fee-ohip    (ss-clmdtl-oma). 
*   endif 
 
    move unpriced-itm2-nbr-serv          to hold-sv-nbr-serv (ss-clmdtl-oma). 
    move 0                              to hold-sv-nbr      (ss-clmdtl-oma,1) 
                                           hold-sv-nbr      (ss-clmdtl-oma,2) 
                                           hold-sv-nbr      (ss-clmdtl-oma,3) 
                                           hold-sv-day-num  (ss-clmdtl-oma,1) 
                                           hold-sv-day-num  (ss-clmdtl-oma,2) 
                                           hold-sv-day-num  (ss-clmdtl-oma,3). 
    move unpriced-itm2-svc-date          to hold-sv-date   (ss-clmdtl-oma). 
    move unpriced-itm2-diag-cd           to hold-diag-cd   (ss-clmdtl-oma). 
*  (if Override Price or Bilateral flags set, then default the first 
*   repetitive day field as per the way D001 works) 
 
    if unpriced-itm2-override-price = "Y" 
    then 
	move "OP" 			to hold-sv-day      (ss-clmdtl-oma,1) 
    else 
    if unpriced-itm2-bilateral = "Y" 
    then 
	move "BI" 			to hold-sv-day      (ss-clmdtl-oma,1). 
*   ENDCASE 
 
*   (CALL TO THESE 2 ROUTINES MOVED TO OUTPUT OF SUSPENSE RECORDS) 
*    EXCEPT FOR READ OF OMA-FEE-MSTR SINCE VALUES NEEDED NOW TO 
*    PUT INTO HOLD AREA FOR LATER PRICING CACULATIONS) 
*    PERFORM HB0-BUILD-SUSP-DTL-REC-FROM-DTL THRU HB0-99-EXIT 
*    PERFORM YD0-WRITE-DTL-REC THRU YD0-99-EXIT. 
 
    move hold-oma-cd(ss-clmdtl-oma)     to   fee-oma-cd. 
    perform xc0-check-oma-code          thru xc0-99-exit. 
*   (00/04/28 - B.A. begin)
*   (The check for oma and diag code is to set the confidentiality flag
*    at the detail level)
    perform ga11-check-for-confidentially thru ga11-99-exit.
*   (00/04/28 end)
    perform ha1-move-pricing-to-hold	thru ha1-99-exit. 
 
ha0-90-after-2nd-detail. 
 
ha0-99-exit. 
    exit. 
 
 
 
ha1-move-pricing-to-hold. 
*WC0-MOVE-OMA-DATA-TO-HOLD. (TAKEN FROM D001.CB) 

*   (save the nbr of the incoming detail record so that if the pricing
*    module re-sorts the claim details within the hold area, the program
*    can use the hold-line-no field to re-sort the records back into
*    the original sequence)
    move  ss-clmdtl-oma	     to hold-line-no   	     (ss-clmdtl-oma).
 
*	 (MOVE OMA REC'S DATA TO THE DETAIL ENTRY'S HOLD AREA) 
 
    move fee-tech-ind	     to hold-oma-rec-ind(ss-clmdtl-oma,ss-tech-ind). 
    move fee-diag-ind	     to hold-oma-rec-ind(ss-clmdtl-oma,ss-diag-ind). 
    move fee-phy-ind	     to hold-oma-rec-ind(ss-clmdtl-oma,ss-phy-ind). 
    move fee-hosp-nbr-ind    to hold-oma-rec-ind(ss-clmdtl-oma,ss-hosp-nbr-ind).
    move fee-i-o-ind	     to hold-oma-rec-ind(ss-clmdtl-oma,ss-i-o-ind). 
    move fee-admit-ind	     to hold-oma-rec-ind(ss-clmdtl-oma,ss-admit-ind). 
    move fee-special-m-suffix-ind 
			     to hold-oma-rec-ind(ss-clmdtl-oma,ss-special-m-suffix-ind).                   
 
    move fee-icc-sec	     to hold-icc-sec	(ss-clmdtl-oma). 
    move fee-icc-grp	     to hold-icc-grp    (ss-clmdtl-oma). 
 
*   (move oma rec's fees according to whether service is current or
*    previous fees
*    -- if service date is < constants mstr "CURRENT PRICES EFFECT DATE"
*       then use previous rates)
*   (change to use f040 oma fee code's effective date rather than
*    constants master's date)
*     if hold-sv-date (ss-clmdtl-oma) < const-effective-date (curr)
    if hold-sv-date (ss-clmdtl-oma) < fee-effective-date
    then
        move prev                       to hold-ss-curr-prev(ss-clmdtl-oma)
    else
        move curr                       to hold-ss-curr-prev(ss-clmdtl-oma).
*   endif

    move hold-ss-curr-prev(ss-clmdtl-oma)
                                        to ss-curr-prev. 
    move fee-1    (ss-curr-prev, oma)  to hold-oma-fee-1   (ss-clmdtl-oma, oma).
    move fee-2    (ss-curr-prev, oma)  to hold-oma-fee-2   (ss-clmdtl-oma, oma).
    move fee-anae (ss-curr-prev, oma)  to hold-oma-fee-anae(ss-clmdtl-oma, oma).
    move fee-asst (ss-curr-prev, oma)  to hold-oma-fee-asst(ss-clmdtl-oma, oma).
    move fee-1    (ss-curr-prev,ohip)  to hold-oma-fee-1   (ss-clmdtl-oma,ohip).
    move fee-2    (ss-curr-prev,ohip)  to hold-oma-fee-2   (ss-clmdtl-oma,ohip).
    move fee-anae (ss-curr-prev,ohip)  to hold-oma-fee-anae(ss-clmdtl-oma,ohip).
    move fee-asst (ss-curr-prev,ohip)  to hold-oma-fee-asst(ss-clmdtl-oma,ohip).
    move fee-min  (ss-curr-prev,ohip)  to hold-fee-min     (ss-clmdtl-oma,ohip).
    move fee-max  (ss-curr-prev,ohip)  to hold-fee-max     (ss-clmdtl-oma,ohip).
    move fee-add-on-cd(ss-curr-prev,1) to hold-oma-add-on-cd(ss-clmdtl-oma, 1).
    move fee-add-on-cd(ss-curr-prev,2) to hold-oma-add-on-cd(ss-clmdtl-oma, 2).
    move fee-add-on-cd(ss-curr-prev,3) to hold-oma-add-on-cd(ss-clmdtl-oma, 3).
    move fee-add-on-cd(ss-curr-prev,4) to hold-oma-add-on-cd(ss-clmdtl-oma, 4).
    move fee-add-on-cd(ss-curr-prev,5) to hold-oma-add-on-cd(ss-clmdtl-oma, 5).
    move fee-add-on-cd(ss-curr-prev,6) to hold-oma-add-on-cd(ss-clmdtl-oma, 6).
    move fee-add-on-cd(ss-curr-prev,7) to hold-oma-add-on-cd(ss-clmdtl-oma, 7).
    move fee-add-on-cd(ss-curr-prev,8) to hold-oma-add-on-cd(ss-clmdtl-oma, 8).
    move fee-add-on-cd(ss-curr-prev,9) to hold-oma-add-on-cd(ss-clmdtl-oma, 9).
    move fee-add-on-cd(ss-curr-prev,10) to hold-oma-add-on-cd(ss-clmdtl-oma,10).
    move fee-oma-ind-card-requireds(ss-curr-prev) 
				to hold-oma-ind-card-requireds(ss-clmdtl-oma). 
 
*   (oma fee mstr records for sp add-ons should have data duplicated
*    in fee-1 and fee-2 for 'f'lat or 'p'erc rates. Some do not and
*    therefore require this logic patch)
*   (00/aug/08 B.E.
*    recognize 'add on' codes by "P"ercent/"F"lat designation rather
*    than having to have a specific ICC code)
*   if hold-icc-cd (ss-clmdtl-oma) = 'SP98'
*                                 or 'SP99'
    if fee-add-on-perc-or-flat-ind(ss-curr-prev) =   "P"
                                                  or "F"
    then
        perform ha1a-addon-fee-fix	thru ha1a-99-exit.
*   endif

    if fee-add-on-perc-or-flat-ind(ss-curr-prev) =   "P"
                                                  or "F"
    then
        move fee-add-on-perc-or-flat-ind(ss-curr-prev)
                 to hold-oma-rec-ind (ss-clmdtl-oma,ss-add-on-perc-or-flat-ind)
    else
        move " " to hold-oma-rec-ind (ss-clmdtl-oma,ss-add-on-perc-or-flat-ind).
*   endif

*   (if indicator for flat vs percent not set then use fee > 1.00 as flat
*                                                      and < 1.01 as percent
*   (00/aug/08 B.E. - removed below code - the "F"lat or "P"ercentage
*                     MUST be set in order to identify code as an 'add on',
*                     so no defaulting of flag can now be performed.)
*    else
*        if hold-oma-fee-1 (ss-clmdtl-oma,  oma) > 1.00
*        then
*            move "F"    to hold-oma-rec-ind     (ss-clmdtl-oma, ss-add-on-perc-or-flat-ind )
*        else
*            move "P"    to hold-oma-rec-ind     (ss-clmdtl-oma, ss-add-on-perc-or-flat-ind ).
**       endif
**   endif
 
ha1-99-exit. 
    exit. 
 
ha1a-addon-fee-fix.

*   (format of f040 file fees is: 99.999 allowing only 3 decimals. 2001/apr/23
*    requirement was for 4 decimal positions only for PERCENTAGE based addons.
*    Percentages were originally stored using only the numbers after the
*    decimal place. Conversion run to multiply by 100 and now percentages
*    that were stored as .605 were stored as 60.500 . This means that
*    when pricing claims the Percentage rates must be divided by 100 before
*    moving into pricing hold variables.
    if fee-add-on-perc-or-flat-ind(ss-curr-prev) =   "P"
    then
        compute hold-oma-fee-1 (ss-clmdtl-oma,  oma) =
                hold-oma-fee-1 (ss-clmdtl-oma,  oma) / 100
        compute hold-oma-fee-2 (ss-clmdtl-oma,  oma) =
                hold-oma-fee-2 (ss-clmdtl-oma,  oma) / 100
        compute hold-oma-fee-1 (ss-clmdtl-oma, ohip) =
                hold-oma-fee-1 (ss-clmdtl-oma, ohip) / 100
        compute hold-oma-fee-2 (ss-clmdtl-oma, ohip) =
                hold-oma-fee-2 (ss-clmdtl-oma, ohip) / 100.
*   endif

*	(IF 'OMA' FEE-1  RATE IS ZERO, THEN USE FEE-2 AND VISA VERSA) 
    if        hold-oma-fee-1 (ss-clmdtl-oma,  oma) = 0 
    then 
       move  hold-oma-fee-2 (ss-clmdtl-oma,  oma)	to hold-oma-fee-1(ss-clmdtl-oma,  oma) 
    else 
        if        hold-oma-fee-2 (ss-clmdtl-oma,  oma) = 0 
 	then 
            move  hold-oma-fee-1 (ss-clmdtl-oma,  oma)	to hold-oma-fee-2(ss-clmdtl-oma,  oma) 
        else 
            next sentence. 
*	endif 
*   endif 
 
*	(IF 'OHIP' FEE-1  RATE IS ZERO, THEN USE FEE-2 AND VISA VERSA) 
    if        hold-oma-fee-1 (ss-clmdtl-oma, ohip) = 0 
    then 
        move  hold-oma-fee-2 (ss-clmdtl-oma, ohip)	to hold-oma-fee-1(ss-clmdtl-oma, ohip) 
    else 
        if        hold-oma-fee-2 (ss-clmdtl-oma, ohip) = 0 
        then 
            move  hold-oma-fee-1 (ss-clmdtl-oma, ohip)	to hold-oma-fee-2(ss-clmdtl-oma, ohip) 
    	else 
            next sentence. 
*	endif 
*   endif 
* 
 
ha1a-99-exit. 
    exit. 


hb0-build-susp-dtl-rec-dtl.

*   (THIS ROUTINE CALLED PASSING SS-WRITE-DTL AS SUBSCRIPT OF PRICED HOLD AREA) 
 
    move spaces                         to   suspend-dtl-rec. 

*   (keep BI and OP flags by moving them into consecutives services area)
    move hold-sv-day(ss-write-dtl,1)	to clmdtl-sv-day(1).
    move hold-sv-day(ss-write-dtl,2)	to clmdtl-sv-day(2).
    move hold-sv-day(ss-write-dtl,3)	to clmdtl-sv-day(3).
*   (00/sep/12 B.E. repetitive services were not initialized)
    move 0				to clmdtl-sv-nbr(1)
					   clmdtl-sv-nbr(2)
					   clmdtl-sv-nbr(3).

*   ## CHECK IF CLMHDR-STILL AVAILABLE - MIGHT HAVE BEEN READ INTO BY 
*   ## NEW HAEADER??? 
    move clmhdr-batch-nbr               to   clmdtl-batch-nbr. 
 
    move hold-oma-cd(ss-write-dtl)      to   clmdtl-oma-cd
                                             fee-oma-cd.
    move hold-oma-suff(ss-write-dtl)    to   clmdtl-oma-suff. 
    move 0                              to   clmdtl-adj-nbr. 
    move 0                              to   clmdtl-rev-group-cd. 
    move clmhdr-agent-cd                to   clmdtl-agent-cd. 
    move clmhdr-adj-cd                  to   clmdtl-adj-cd. 

*2001/02/28 - MC - default clmhdr-status into clmdtl-status
*2001/03/30 - BE - if not 'I'gnore status, then if claim details have been
*	           altered due to tech/prof/suffix rule processing,
*		   then update detail/header status to "U"pdated
    if     tech-prof-suff-rule-applied
       and clmhdr-status <> "I"
    then
* 2005/08/17 - MC
*	move "U"  			to   clmdtl-status
	move "U"  			to   clmdtl-status of suspend-dtl-rec
					     clmhdr-status
    else
*	move clmhdr-status		to   clmdtl-status.
	move clmhdr-status		to   clmdtl-status of suspend-dtl-rec.
* 2005/08/17 - end
*   endif

    perform gb1-verify-dtl-diag-cd thru gb1-99-exit. 
 
    if    hold-sv-nbr-serv(ss-write-dtl) = 0 
      and not price-only-claim
    then 
   	move ws-error-literal		to   err-warn-msg
        perform xb0-print-warning-line thru xb0-99-exit 
        move 1                          to   ws-carriage-ctrl 
        move 38                         to   err-ind 
        move hold-sv-nbr-serv(ss-write-dtl) 
                                        to   err-nbr-of-serv 
        perform zb0-build-write-err-rpt-line thru zb0-99-exit 
*       MOVE '??'                       TO   CLMDTL-NBR-SERV-ALPHA 
    else 
*       (91/MAR/13 B.E.) 
*       (SUM NBR SERVICES FOR AUDIT TOTALS) 
*       ADD  DTL-NBR-OF-SERV            TO   CTR-TOT-SVCS-READ 
        add  hold-sv-nbr-serv(ss-write-dtl) 
                                        to   ctr-tot-svcs-read 
*       MOVE DTL-NBR-OF-SERV            TO   CLMDTL-NBR-SERV 
        move hold-sv-nbr-serv(ss-write-dtl) 
                                        to   clmdtl-nbr-serv. 
*   endif 
 
    if    hold-fee-ohip     (ss-write-dtl)  = 0 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line thru xb0-99-exit 
        move 1                          to   ws-carriage-ctrl 
        move 39                         to   err-ind 
*       MOVE DTL-FEE-BILLED             TO   ERR-FEE-BILLED 
        move hold-fee-ohip (ss-write-dtl) 
                                        to   err-fee-billed 
        perform zb0-build-write-err-rpt-line thru zb0-99-exit. 
 
 
*    (2000/03/20 - MC - check the two prices)
*    if  hold-fee-incoming(ss-write-dtl) not = 0  and
*	hold-fee-incoming(ss-write-dtl) not = hold-fee-ohip(ss-write-dtl) 
*    then 
*	move ws-warning-literal		to	err-warn-msg
*        perform xb0-print-warning-line  thru    xb0-99-exit 
*        move 1                          to      ws-carriage-ctrl 
*        move 52                         to      err-ind 
*        move hold-fee-incoming(ss-write-dtl) to err-52-incoming-fee
*        move hold-fee-ohip    (ss-write-dtl) to err-52-ohip-fee
*        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit. 
*   endif 


*   (ya0- pricing logic has determined correction price to use and therefore
*	  this routine can use the hold-fee-ohip)
*	    if  hold-fee-incoming(ss-write-dtl) not = 0 
*	    then
*		move hold-fee-incoming(ss-write-dtl)to clmdtl-fee-oma 
*		                                       clmdtl-fee-ohip 
*	    else

*   (00/sep/08 B.E. - don't automatically use ohip fees for both)
*	     move hold-fee-ohip(ss-write-dtl)      to clmdtl-fee-oma 
*	                                              clmdtl-fee-ohip. 
     move hold-fee-oma (ss-write-dtl)    to clmdtl-fee-oma.
     move hold-fee-ohip(ss-write-dtl)    to clmdtl-fee-ohip.

*   (2000/jun/05 B.E. correct pricing of tech portion of fee)
    move hold-priced-tech(ss-write-dtl)	      to clmdtl-amt-tech-billed

*   (Perform a second read to oma-fee-mstr for each detail
*    before any edit checks.)
    perform xc0-check-oma-code          thru xc0-99-exit.
 
*   (verify speciality against ohip code in header rec) 
    if    (   fee-spec-fr < batch-speciality 
           or fee-spec-fr = batch-speciality) 
      and (   fee-spec-to = batch-speciality 
           or fee-spec-to > batch-speciality) 
    then 
        move batch-speciality           to      clmhdr-doc-spec-cd 
    else 
        if not price-only-claim
	then
	    move ws-error-literal	    to	err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit 
            move 1                          to      ws-carriage-ctrl 
            move 21                         to      err-ind 
            move batch-speciality           to      err-21-value-1 
            move hold-oma-cd(ss-write-dtl)  to      err-21-value-2 
            move fee-spec-fr                to      err-21-value-3 
            move fee-spec-to                to      err-21-value-4 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
            move batch-speciality           to      clmhdr-doc-spec-cd. 
*   endif 
 
*   (DETERMINE IF REFERRING PHY. NBR REQUIRED, AND IF SO THAT THE NBR IS VALID) 
    if hdr-refer-pract-nbr =   spaces 
                            or zeros 
    then 
        if    fee-phy-ind = "Y" 
	  and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 22                     to      err-ind 
            move hold-oma-cd(ss-write-dtl) 
                                        to      err-22-oma-cd 
            move "REFERRING PHYSICIAN"  to      err-22-msg 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*       endif 
 
*   (DETERMINE IF DIAGNOSTIC CODE IS REQUIRED, AND IF SO THAT THE CODE IS VALID) 
    if hold-diag-cd(ss-write-dtl) =   spaces 
                                     or zeros 
    then 
        if    fee-diag-ind = "Y" 
          and hold-oma-suff (ss-write-dtl)  = "A" or "M"
	  and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 22                     to      err-ind 
            move hold-oma-cd(ss-write-dtl) 
                                        to      err-22-oma-cd 
            move "DIAGNOSTIC CODE"      to      err-22-msg 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*       endif 
*   endif 

*    (00/sep/14 B.E. - this edit no longer required)
*    if hdr-hosp-nbr =   spaces 
*                     or zeros 
*    then 
*        if fee-hosp-nbr-ind = "Y" 
*	  and not price-only-claim
*        then 
*	    move ws-error-literal	to	err-warn-msg
*            perform xb0-print-warning-line 
*                                        thru    xb0-99-exit 
*            move 1                      to      ws-carriage-ctrl 
*            move 22                     to      err-ind 
*            move hold-oma-cd(ss-write-dtl) 
*                                        to      err-22-oma-cd 
*            move "HOSPITAL NUMBER"      to      err-22-msg 
*            perform zb0-build-write-err-rpt-line 
*                                        thru    zb0-99-exit. 
**           MOVE "?"                    TO      CLMHDR-HOSP. 
**       endif 
**   endif 
 
*   (DETERMINE IF IN/OUT INDICATOR IS REQUIRED, AND IF SO THAT IT IS VALID) 
    if hdr-i-o-ind =   spaces 
                    or zeros 
    then 
        if   (   fee-i-o-ind = "I"
              or fee-i-o-ind = "O"
              or fee-i-o-ind = "B"
	     )
 	  and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 22                     to      err-ind 
            move hold-oma-cd(ss-write-dtl) 
                                        to      err-22-oma-cd 
            move "IN/OUT PATIENT INDICATOR" 
                                        to      err-22-msg 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
        else next sentence
    else
        if   (   (     hdr-i-o-ind = "I"
                   and fee-i-o-ind <> "I"
                   and fee-i-o-ind <> "B"
	         )
              or (    hdr-i-o-ind = "O"
                  and fee-i-o-ind <> "O"
                  and fee-i-o-ind <> "B"
	         )
	     )
 	  and not price-only-claim
        then
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 49                     to      err-ind
            move fee-i-o-ind            to      err-49-oma-cd
            move hdr-i-o-ind            to      err-49-hdr-cd
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       endif 
*   endif 
 
* 2002/06/12 - MC

    if (hdr-hosp-nbr = spaces or zero) and
* 2002/08/12 - MC
*      (hold-oma-cd(ss-write-dtl) >= 'K994' and hold-oma-cd(ss-write-dtl) <= 'K997')
      (hold-oma-cd(ss-write-dtl) >= 'K990' and hold-oma-cd(ss-write-dtl) <= 'K997')
* 2002/08/12 - end
 	  and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 54                     to      err-ind 
            move hold-oma-cd(ss-write-dtl) 
                                        to      err-54-prem-code
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*    endif

* 2002/06/12 - end

* 2002/08/21 - MC

    if (hdr-hosp-nbr = 'G000' or 'M200' or 'H000' or 'J000') and
      (hold-oma-cd(ss-write-dtl) >= 'K990' and hold-oma-cd(ss-write-dtl) <= 'K997')
 	  and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 55                     to      err-ind 
            move hdr-hosp-nbr		to      err-55-hosp-code
            move hold-oma-cd(ss-write-dtl) 
                                        to      err-55-prem-code
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*    endif

* 2002/08/21 - end

* 2003/06/11 - MC

    if (hdr-loc-nbr not = '112' ) and
* 2004/01/20 - MC
       (hdr-loc-nbr not = '153' ) and
       (hdr-loc-nbr not = '400' ) and
       (hdr-loc-nbr not = '250' ) and
       (hdr-loc-nbr not = '422' ) and
* 2004/01/20 - end
* 2004/09/27 - MC 
       (hdr-loc-nbr not = '401' ) and
* 2004/09/27 - end
* 2007/10/24 - MC
       (hdr-loc-nbr not = '055' ) and
* 2007/10/24 - end
* 2007/11/22 - MC
       (hdr-loc-nbr not = '326' ) and
* 2008/01/03 - Yas
       (hdr-loc-nbr not = '122' ) and
* 2007/11/22 - end

* 2008/02/19 - MC 
       (hdr-loc-nbr not = '344' ) and
* 2008/02/19 - end
* 2008/02/28 - MC 
       (hdr-loc-nbr not = '111' ) and
       (hdr-loc-nbr not = '354' ) and
* 2008/02/28 - end
* 2008/03/18 - MC 
       (hdr-loc-nbr not = '333' ) and
* 2008/03/18 - end
   
      (hold-oma-cd(ss-write-dtl) >= 'K990' and hold-oma-cd(ss-write-dtl) <= 'K997')
 	  and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 56                     to      err-ind 
            move hdr-loc-code		to      err-56-loc-code 
            move hold-oma-cd(ss-write-dtl) 
                                        to      err-56-prem-code
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*    endif

* 2003/06/11 - end


*       
*   (CHECK IF ADMIT DATE IS REQUIRED, AND IF SO VERIFY THAT DATE IS VALID) 
    if hdr-admit-date =   spaces 
                       or zeros 
    then 
        if    fee-admit-ind = "Y" 
 	  and not price-only-claim
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 22                     to      err-ind 
            move hold-oma-cd(ss-write-dtl) 
                                        to      err-22-oma-cd 
            move "ADMIT DATE"           to      err-22-msg 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*       endif 
*   endif 
 
*  (2006/12/13 - MC - Yasemin requested to have the following 3 edit checks 
*	with respect to date-of-admission and service-dates)

   If 	  hold-oma-cd(ss-write-dtl) = 'C122' or 'C123' or 'C124'
      and hold-sv-date(ss-write-dtl) >= hdr-admit-date
      and not price-only-claim
   then 
      move hdr-admit-date 		to ws-date-yymmdd
      compute date-difference-in-days
                    =   (  (hold-sv-date-yy(ss-write-dtl) * 365) 
                	 + (hold-sv-date-mm(ss-write-dtl) *  30) 
                	 +  hold-sv-date-dd(ss-write-dtl) 	
			)
	              - (  (ws-date-yy                    * 365) 
			 + (ws-date-mm                    *  30) 
			 +  ws-date-dd
			)                      
*     CASE
*       (if billing code is C122 and the service date < 1 day or > 1 day from the
*	admit date, then report on ru701 (newu701) with message "Check C122")
      if      hold-oma-cd(ss-write-dtl) = 'C122'
        and  (date-difference-in-days < 1	
           or date-difference-in-days > 1	
	     )
      then
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 66                     	  to      err-ind
          perform zb0-build-write-err-rpt-line
              	                          thru    zb0-99-exit
      else
*        (If billing code is C123 and the service date < 2 days or > 2 days from the
*	  admit date, then report on ru701 (newu701) with message "Check C123")
      if      hold-oma-cd(ss-write-dtl) = 'C123'
        and  (date-difference-in-days < 2	
           or date-difference-in-days > 2	
	     )
      then
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 67                     	  to      err-ind
          perform zb0-build-write-err-rpt-line
              	                          thru    zb0-99-exit
      else
*        (If billing code is C124 and the service date <= 1 day from the admit date,
*         then report on ru701 (newu701) with message "Check C124")
       if     hold-oma-cd(ss-write-dtl) = 'C124'
          and date-difference-in-days <= 1
       then
	   move ws-error-literal	   to	   err-warn-msg
           perform xb0-print-warning-line  thru    xb0-99-exit
           move 1                          to      ws-carriage-ctrl
           move 68                         to      err-ind
           perform zb0-build-write-err-rpt-line
             	                           thru    zb0-99-exit.
*	ENDCASE
* 2006/12/13 - end

*   (VERIFY SERVICE DATE IS VALID) 
    move hold-sv-date-dd(ss-write-dtl) to   ws-date-dd. 
    move hold-sv-date-mm(ss-write-dtl) to   ws-date-mm. 
    move hold-sv-date-yy(ss-write-dtl) to   ws-date-yy. 
    perform xd0-verify-date              thru xd0-99-exit. 
    if    invalid-date 
      and not price-only-claim
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 27                         to      err-ind 
        move hold-sv-date(ss-write-dtl) 
                                        to      err-27-service-date 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
    else 
*       (service is a real date - ensure that it is not greater than the
*        run date.)
        if    hold-sv-date(ss-write-dtl) > sys-date
          and not price-only-claim
        then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 48                         to      err-ind
          move hold-sv-date(ss-write-dtl)
                                          to      err-msg-svr-date
          move sys-date                   to      err-msg-sys-date
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit
          move "????????"                 to      clmdtl-sv-date
        else
*         (service is valid - ensure it is not stale-dated ie. not 
*	   within 6 months of current system date) 
         if   (   (hold-sv-date-yy(ss-write-dtl) * 365) 
                + (hold-sv-date-mm(ss-write-dtl) *  30) 
*                 (+ 6 MONTHS TIMES 30 DAYS = 180) 
                + 190 
                + hold-sv-date-dd(ss-write-dtl) 
                   < (sys-yy * 365) + (SYS-MM * 30) + SYS-DD 
	      )
          and not price-only-claim
* 	        (02/08/21 - MC - Yas requests to bypass the edit check on 
*	         stale date for clinic 80 or 95)
*               (2006/05/16 b.e. - re apply this check for 80/95)
*          and   bt-clinic-nbr-1-2 not = 80
*          and   bt-clinic-nbr-1-2 not = 95
* 2002/05/03 - MC - temporary edit check (ie error if svc date < 20010901)
*	  and hold-sv-date(ss-write-dtl) < 20010901
* 2002/05/03 - end
        then 
	    move ws-error-literal	to	err-warn-msg
            perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
            move 1                      to      ws-carriage-ctrl 
            move 24                     to      err-ind 
            move hold-sv-date(ss-write-dtl) 
                                        to      err-24-service-date 
            perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
            move "????????"             to      clmdtl-sv-date 
        else 
*	    (VERIFY SERVICE DATE IS NOT BEFORE ADMIT DATE IF SPECIFIED) 
	    if    hdr-admit-date  not = spaces 
	      and hold-sv-date(ss-write-dtl) < hdr-admit-date 
              and not price-only-claim
	    then 
	        move ws-error-literal	to	err-warn-msg
                perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
                move 1                  to      ws-carriage-ctrl 
                move 44                 to      err-ind 
                move hold-sv-date(ss-write-dtl) 
                                        to      err-44-service-date 
                move hdr-admit-date     to     err-44-admit-date 
                perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
*2001/03/08 - MC
*               move "????????"         to      clmdtl-sv-date 
                move "????????"         to      clmhdr-date-admit
                move hold-sv-date-dd(ss-write-dtl) to      clmdtl-sv-dd 
                move hold-sv-date-mm(ss-write-dtl) to      clmdtl-sv-mm 
                move hold-sv-date-yy(ss-write-dtl) to      clmdtl-sv-yy 
***
	    else 
*              (INITIAL SERVICE DATE IS VALID AND WITHIN 6 MONTHS OF CURRENT DATE) 
                move hold-sv-date-dd(ss-write-dtl) to      clmdtl-sv-dd 
                move hold-sv-date-mm(ss-write-dtl) to      clmdtl-sv-mm 
                move hold-sv-date-yy(ss-write-dtl) to      clmdtl-sv-yy. 
*           endif 
*       endif 
*   endif 

* 2005/03/03 - MC -add two more edit check 
    if    clmhdr-doc-spec-cd = 7  
*	    (check the patient's age ) 
    then
 	move    hold-sv-date(ss-write-dtl)      to ws-sv-date     
	move    hdr-birth-date-long		to ws-birth-date
 	compute date-difference-in-days = (ws-sv-date - ws-birth-date) / 10000 
	if       (hold-oma-cd(ss-write-dtl) = 'A775' or 'W775' or 'C775')
	      and date-difference-in-days < 75                              
              and not price-only-claim
	    then 
	        move ws-error-literal	to	err-warn-msg
                perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
                move 1                  to      ws-carriage-ctrl 
                move 60                 to      err-ind 
                move clmhdr-doc-spec-cd to      err-60-doc-spec     
                move hdr-birth-date-long to      err-60-birth-date   
                perform zb0-build-write-err-rpt-line 
        else
	if      date-difference-in-days < 60                              
              and not price-only-claim
	    then 
	        move ws-error-literal	to	err-warn-msg
                perform xb0-print-warning-line 
                                        thru    xb0-99-exit 
                move 1                  to      ws-carriage-ctrl 
                move 59                 to      err-ind 
                move clmhdr-doc-spec-cd to      err-59-doc-spec     
                move hdr-birth-date-long to     err-59-birth-date   
                perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit.
*	endif
*   endif

*2005/03/03 - end

* 2005/05/05 - MC
*    service date - ensure that it is greater than the
*    birth  date.)
     if    hold-sv-date(ss-write-dtl) < hdr-birth-date-long
       and not price-only-claim
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 61                         to      err-ind
          move hold-sv-date(ss-write-dtl)
                                          to      err-61-serv-date
          move hdr-birth-date-long        to      err-61-birth-date
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit
          move "????????"                 to      clmdtl-sv-date.
*   endif
* 2005/05/05 - end

* 2005/11/01 - MC -add three  more edit check 
    if    hold-oma-cd (ss-write-dtl) = 'E420'
    then
	move ws-error-literal	to	err-warn-msg
        perform xb0-print-warning-line 
                                thru    xb0-99-exit 
        move 1                  to      ws-carriage-ctrl 
        move 63                 to      err-ind 
        perform zb0-build-write-err-rpt-line 
        			thru    zb0-99-exit.
*   endif


     if    hold-oma-cd (ss-write-dtl) = 'Z425'             
       and clmhdr-doc-nbr = '049'
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 64                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    hold-oma-cd (ss-write-dtl) = 'A073' or 'A074' or 'A071' or 'A078' or 'A133'         
        			     or 'A134' or 'A131' or 'A138' or 'A183' or 'A184'             
        			     or 'A181' or 'A188' or 'A263' or 'A264' or 'A661'             
        			     or 'A283' or 'A284' or 'A313' or 'A310' or 'A311'             
        			     or 'A318' or 'A413' or 'A414' or 'A411' or 'A418'             
        			     or 'A473' or 'A474' or 'A471' or 'A478' or 'A483'             
        			     or 'A484' or 'A481' or 'A488' or 'A603' or 'A604'             
        			     or 'A601' or 'A608' or 'A613' or 'A614' or 'A611'             
        			     or 'A618' or 'A623' or 'A624' or 'A621' or 'A628'             
* 2005/12/14 - include A340, A341, A343, and A348
				     or 'A340' or 'A341' or 'A343' or 'A348'
* 2005/12/14 - end
* 2008/01/17 - include A262 as requested by Yas/Thekla
				     or 'A262'
* 2008/01/17 - end
     then
	  if  (	     (  (hold-diag-cd (ss-write-dtl) =  42 or  43 or  44 or 250 or 286 or 287 or 290
					 or 332 or 340 or 343 or 345 or 402 or 428 or 491
					 or 492 or 493 or 515 or 555 or 556 or 571 or 585
* 2008/01/09 - MC -Thekla requested to include 299, 313, 315, 765 & 902
*					 or 710 or 714 or 720 or 721 or 758 )
					 or 710 or 714 or 720 or 721 or 758 
                                         or 299 or 313 or 315 or 765 or 902)
* 2008/01/09 - end
       	            and ws-e078-premium = 'N')
	      or        (hold-diag-cd (ss-write-dtl) not =  42 and not =  43 and not =  44 and not = 250 
							and not = 286 and not = 287 and not = 290 and not = 332 
							and not = 340 and not = 343 and not = 345 and not = 402 
							and not = 428 and not = 491 and not = 492 and not = 493 
							and not = 515 and not = 555 and not = 556 and not = 571 
							and not = 585 and not = 710 and not = 714 and not = 720 
							and not = 721 and not = 758 
* 2008/01/09 - MC -Thekla requested to include 299, 313, 315, 765 & 902
							and not = 299 and not = 313 and not = 315 and not = 765 
							and not = 902
* 2008/01/09 - end
       	            and ws-e078-premium = 'Y')
		)
	  then
	  	move ws-error-literal		  to	  err-warn-msg
          	perform xb0-print-warning-line  thru    xb0-99-exit
          	move 1                          to      ws-carriage-ctrl
          	move 65                     	  to      err-ind
          	perform zb0-build-write-err-rpt-line
                	                          thru    zb0-99-exit.
*	   endif
*   endif

* 2005/11/01 - end

* 2008/04/23 - MC - more edit checks for error 69 to 84

     if   ( 	(     (   hold-oma-cd (ss-write-dtl) = 'E007'
		       or hold-oma-cd (ss-write-dtl) = 'E505'            
                       or hold-oma-cd (ss-write-dtl) = 'E721' 
	               or hold-oma-cd (ss-write-dtl) = 'E722'            
		       or hold-oma-cd (ss-write-dtl) = 'E757'            
                       or hold-oma-cd (ss-write-dtl) = 'E787' 
	               or hold-oma-cd (ss-write-dtl) = 'E955'            
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 1
                )
            or 
            	(     (   hold-oma-cd (ss-write-dtl) = 'E019'
		       or hold-oma-cd (ss-write-dtl) = 'E010'            
                       or hold-oma-cd (ss-write-dtl) = 'E556' 
	               or hold-oma-cd (ss-write-dtl) = 'E632'            
		       or hold-oma-cd (ss-write-dtl) = 'E622'            
                       or hold-oma-cd (ss-write-dtl) = 'E604' 
	               or hold-oma-cd (ss-write-dtl) = 'E618'            
		       or hold-oma-cd (ss-write-dtl) = 'E546'            
                       or hold-oma-cd (ss-write-dtl) = 'E725' 
	               or hold-oma-cd (ss-write-dtl) = 'E726'            
		       or hold-oma-cd (ss-write-dtl) = 'E731'            
                       or hold-oma-cd (ss-write-dtl) = 'E739' 
	               or hold-oma-cd (ss-write-dtl) = 'E756'            
                       or hold-oma-cd (ss-write-dtl) = 'E956' 
	               or hold-oma-cd (ss-write-dtl) = 'E981'            
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 2
                )
            or 
            	(     (   hold-oma-cd (ss-write-dtl) = 'E018'
		       or hold-oma-cd (ss-write-dtl) = 'E667'            
                       or hold-oma-cd (ss-write-dtl) = 'E627' 
	               or hold-oma-cd (ss-write-dtl) = 'E693'            
		       or hold-oma-cd (ss-write-dtl) = 'E694'            
                       or hold-oma-cd (ss-write-dtl) = 'E733' 
	               or hold-oma-cd (ss-write-dtl) = 'E734'            
		       or hold-oma-cd (ss-write-dtl) = 'E735'            
                       or hold-oma-cd (ss-write-dtl) = 'E736' 
	               or hold-oma-cd (ss-write-dtl) = 'E723'            
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 3
                )
            or 
            	(     (   hold-oma-cd (ss-write-dtl) = 'E009'
		       or hold-oma-cd (ss-write-dtl) = 'E011'            
                       or hold-oma-cd (ss-write-dtl) = 'E022' 
	               or hold-oma-cd (ss-write-dtl) = 'E020'            
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 4
                )
            or 
            	(     (   hold-oma-cd (ss-write-dtl) = 'E014'
		       or hold-oma-cd (ss-write-dtl) = 'E012'            
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 5
                )
            or 
            	(     (   hold-oma-cd (ss-write-dtl) = 'P014'
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 6
                )
            or 
            	(     (   hold-oma-cd (ss-write-dtl) = 'E021'
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 9
                )
            or 
            	(     (   hold-oma-cd (ss-write-dtl) = 'E004'
		       or hold-oma-cd (ss-write-dtl) = 'E017'            
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 10
                )
            or 
            	(     (   hold-oma-cd (ss-write-dtl) = 'E016'
		      )
		 and  hold-oma-suff  (ss-write-dtl) = 'C'
		 and  hold-sv-nbr-serv (ss-write-dtl) not = 20
                )
         ) 
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 69                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
    if    ws-e020 = "Y"                                   
       and ws-e022-e017-e016 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 70                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    ws-e719 = "Y"                                   
       and ws-z570 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 71                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     
     if    ws-e720 = "Y"                                   
       and ws-z571 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 72                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    ws-e717 = "Y"                                   
       and ws-z555-z580 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 73                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    ws-e702 = "Y"                                   
       and ws-z515-z760 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 74                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    ws-g123 = "Y"                                   
       and ws-g228 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 75                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    ws-g223 = "Y"                                   
       and ws-g231 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 76                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    ws-g265 = "Y"                                   
       and ws-g264 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 77                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    ws-g385 = "Y"                                   
       and ws-g384 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 78                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    ws-g281 = "Y"                                   
       and ws-g381 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 79                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if   ( 	(    (hold-oma-cd (ss-write-dtl) = 'G123'  or  hold-oma-cd (ss-write-dtl) = 'E719')            
		 and  hold-sv-nbr-serv (ss-write-dtl) > 4
                )
            or 
            	(    (hold-oma-cd (ss-write-dtl) = 'G265')  
		 and  hold-sv-nbr-serv (ss-write-dtl) > 3
                )
            or 
            	(    (hold-oma-cd (ss-write-dtl) = 'G385'  or  hold-oma-cd (ss-write-dtl) = 'E720')            
		 and  hold-sv-nbr-serv (ss-write-dtl) > 2
                )
            or 
            	(    (hold-oma-cd (ss-write-dtl) = 'E702'  or  hold-oma-cd (ss-write-dtl) = 'E717')            
		 and  hold-sv-nbr-serv (ss-write-dtl) > 1
                )
         ) 
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 80                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif

     if    ws-e793 = "Y"                                   
       and ws-r905-s800 = "N"                
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 81                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    hold-oma-cd (ss-write-dtl) = 'P022'             
       and hold-sv-date (ss-write-dtl) > 20080131
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 82                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    hold-oma-cd (ss-write-dtl) = 'K120'             
       and hold-sv-date (ss-write-dtl) > 20080131
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 83                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
     if    hold-oma-cd (ss-write-dtl) = 'A007'             
       and clmhdr-doc-spec-cd not = 00  
       and hold-sv-date (ss-write-dtl) > 20071231
     then 
	  move ws-error-literal		  to	  err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 84                         to      err-ind
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit.
*   endif
     
* 2008/04/23 - end

* 2005/08/17 - MC
*    move clmhdr-doc-pract-nbr to clmdtl-doc-pract-nbr. 
*    move clmhdr-accounting-nbr to clmdtl-accounting-nbr. 
    move clmhdr-doc-pract-nbr to clmdtl-doc-pract-nbr  of suspend-dtl-rec. 
    move clmhdr-accounting-nbr to clmdtl-accounting-nbr of suspend-dtl-rec. 
* 2005/08/17 - end
 
* 2005/08/17 - MC
*    move clmhdr-doc-pract-nbr to clmdtl-doc-pract-nbr. 
*    move clmhdr-accounting-nbr to clmdtl-accounting-nbr. 
    move clmhdr-doc-pract-nbr to clmdtl-doc-pract-nbr  of suspend-dtl-rec. 
    move clmhdr-accounting-nbr to clmdtl-accounting-nbr of suspend-dtl-rec. 
* 2005/08/17 - end
 
hb0-99-exit. 
    exit. 
 
ia0-proc-rec-type-address. 
 
    move unpriced-pat-addr-1             to addr-address-line-1. 
    move unpriced-pat-addr-2             to addr-address-line-2. 
    move unpriced-pat-addr-3             to addr-address-line-3. 
    move unpriced-pat-addr-post-cd       to addr-postal-code. 
 
 
*   PERFORM YE0-WRITE-ADDR-REC  THRU    YE0-99-EXIT. 
 
 
ia0-99-exit. 
    exit. 
 
ka0-proc-rec-type-trailer. 
 
*   (processing a TRAILER rec)
*   (ensure that all numeric fields are zero filled in trailer rec)
    inspect unpriced-trailer-clmhdr1-cnt  replacing all space-char by zeros.
    inspect unpriced-trailer-clmhdr2-cnt  replacing all space-char by zeros.
    inspect unpriced-trailer-itm-cnt      replacing all space-char by zeros.
    inspect unpriced-trailer-pat-addr-cnt replacing all space-char by zeros.

*    (if there were detail records in hold area from the previous claim
*      header rec then area process them - ie. price them and write them out) 
    perform xx0-process-hold-dtls	thru xx0-99-exit. 
 
    if (last-record-is-h) or (detail-written) 
    then 
        move 'N'                   to   detail-written-flag 
*	(HEADER WRITTEN OUT IN XX0 ROUTINE) 
*       PERFORM TC0-WRITE-HDR-REC  THRU TC0-99-EXIT 
        perform tf0-write-addr-rec thru tf0-99-exit. 
*   endif 
 
*       CHECK IF AUDIT TOTALS MATCH TRAILER REC TOTAL - WARNING MESSAGE 
    move unpriced-trailer-clmhdr1-cnt    to trl-h-count. 
    move unpriced-trailer-clmhdr2-cnt    to trl-r-count. 
    move unpriced-trailer-itm-cnt        to trl-t-count. 
    move unpriced-trailer-pat-addr-cnt   to trl-a-count. 
 
    add ctr-h-recs-read 
        ctr-h-recs-skipped      giving ctr-tot-h-recs. 
 
    add ctr-r-recs-read 
        ctr-r-recs-skipped      giving ctr-tot-r-recs. 
 
    add ctr-t-recs-read 
        ctr-t-recs-read-skipped giving ctr-tot-t-recs. 
 
    add ctr-a-recs-read 
        ctr-a-recs-read-skipped giving ctr-tot-a-recs. 
 
    if trl-h-count not = ctr-tot-h-recs 
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 16                         to      err-ind 
        move ctr-tot-h-recs             to      err-ctr-h-count 
        move trl-h-count                to      err-trl-h-count 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*   endif 
    if trl-r-count not = ctr-tot-r-recs 
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 34                         to      err-ind 
        move ctr-tot-r-recs             to      err-ctr-r-count 
        move trl-r-count                to      err-trl-r-count 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*   endif 
    if trl-t-count not = ctr-tot-t-recs 
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 17                         to      err-ind 
        move ctr-tot-t-recs             to      err-ctr-t-count 
        move trl-t-count                to      err-trl-t-count 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*   endif 
    if trl-a-count not = ctr-tot-a-recs 
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 18                         to      err-ind 
        move ctr-tot-a-recs             to      err-ctr-a-count 
        move trl-a-count                to      err-trl-a-count 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*   endif 
    if    trl-b-count not = zero 
      and trl-b-count not = ctr-b-recs-read 
    then 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 19                         to      err-ind 
        move ctr-b-recs-read            to      err-ctr-b-count 
        move trl-b-count                to      err-trl-b-count 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit. 
*   endif 
 
    perform ka1-print-batch-audit-tots  thru    ka1-99-exit. 
 
*** S.B. - start.
*** Added the following to prevent a missing detail error
*** from appearing on the first batch record after a previous
*** batch that had any detail records in it.
    move 0                              to      ctr-hdr2-rec
                                                ctr-addr-rec.
*** S.B. - end.

ka0-99-exit. 
    exit. 



ka1-print-batch-audit-tots. 
 
*  (PRINT BATCH AUDIT COUNTERS ON NEW PAGE) 
    move 99                                     to ctr-lines-printed. 
    move 2                                      to ws-carriage-ctrl. 
 
    move "********** AUDIT COUNTERS **********" to audit-title. 
    move zero                                   to audit-value 
                                                   audit-value-2 
                                                   audit-value-3. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move 3                                      to ws-carriage-ctrl. 
    move "TOTAL NBR INPUT RECORDS READ= "       to audit-title. 
    move ctr-recs-read                          to audit-value 
                                                   audit-value-2. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move 2                                      to ws-carriage-ctrl. 
    move "NBR OF BATCH   RECORDS READ = "       to audit-title. 
    move ctr-b-recs-read                        to audit-value 
                                                   audit-value-2. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "NBR OF TRAILER RECORDS READ = "       to audit-title. 
    move ctr-e-recs-read                        to audit-value 
                                                   audit-value-2. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "NBR OF HEADER1 RECORDS READ = "       to audit-title. 
    move ctr-h-recs-read                        to audit-value 
                                                   audit-value-3 
                                                   audit-value-4. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "NBR OF HEADER2 RECORDS READ = "       to audit-title. 
    move ctr-r-recs-read                        to audit-value 
                                                   audit-value-3 
                                                   audit-value-4. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "NBR OF DETAIL  RECORDS READ = "       to audit-title. 
    move ctr-t-recs-read                        to audit-value 
                                                   audit-value-3. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "NBR OF DETAIL  RECS SKIPPED = "       to audit-title. 
    move ctr-t-recs-read-skipped                to audit-value 
                                                   audit-value-2. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "NBR OF ADDRESS RECORDS READ = "       to audit-title. 
    move ctr-a-recs-read                        to audit-value 
                                                   audit-value-4. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "TOTAL SVCS HDRS/DETAILS READ= "       to audit-title. 
    move ctr-tot-svcs-read                      to audit-value-5. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "TOTAL $$$  HDRS/DETAILS READ= "       to audit-title. 
    move ctr-tot-dollars-read                   to audit-value-5. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "NBR OF ADDRESS RECS SKIPPED = "       to audit-title. 
    move ctr-a-recs-read-skipped                to audit-value 
                                                   audit-value-2. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move 3                                      to ws-carriage-ctrl. 
    move "NBR OF HEADER  RECORDS WRITTEN = "    to audit-title. 
    move ctr-suspend-hdr-writes                 to audit-value-2 
                                                   audit-value-4. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move 2                                      to ws-carriage-ctrl. 
    move "NBR OF HEADER1 RECORDS SKIPPED = "    to audit-title. 
    move ctr-h-recs-skipped                     to audit-value-2. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move 2                                      to ws-carriage-ctrl. 
    move "NBR OF HEADER2 RECORDS SKIPPED = "    to audit-title. 
    move ctr-r-recs-skipped                     to audit-value-2. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
    move "NBR OF DETAIL  RECORDS WRITTEN = "    to audit-title. 
    move ctr-suspend-dtl-writes                 to audit-value-2 
                                                   audit-value-3. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
* 2005/08/17 - MC
    move "NBR OF DESCRIPTION RECORDS WRITTEN = "    to audit-title. 
    move ctr-suspend-desc-writes                 to audit-value-2 
                                                   audit-value-3. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
* 2005/08/17 - end
 
    move "NBR OF ADDRESS RECORDS WRITTEN = "    to audit-title. 
    move ctr-suspend-addr-writes                to audit-value-4. 
    move audit-line                             to rpt-line. 
    move spaces                                 to audit-line. 
    perform zz0-write-err-rpt-line              thru zz0-99-exit. 
 
*  (FORCE NEW PAGE AFTER TOTALS) 
    move 99                                     to ctr-lines-printed. 
 
ka1-99-exit. 
    exit. 
xb0-print-warning-line. 
 
    move 2                      to      ws-carriage-ctrl. 
    move 1                      to      err-ind. 
    move batch-provider-nbr     to      err-msg-pract-nbr. 
    move hdr-accounting-nbr     to      err-msg-account-id. 
    perform zb0-build-write-err-rpt-line 
                                thru    zb0-99-exit. 
 
xb0-99-exit. 
    exit. 
 
xd0-verify-date. 
 
    move "Y"                            to flag-date. 
 
    if   ws-date-mm < 1 
      or ws-date-mm > 12 
    then 
        move "N"                        to flag-date 
    else 
        if   ws-date-dd < 1 
          or ws-date-dd > max-nbr-days (ws-date-mm) 
        then 
            move "N"                    to flag-date. 
*       endif 
*   endif 
 
xd0-99-exit. 
    exit. 
ta0-read-diskette. 
 
    move unpriced-input-rec-type         to      last-record-type-flag. 
 
    move low-values                     to      unpriced-Claims-record. 
 
    read unpriced-claims-file 
        at end 
            move "Y" to eof-input-file-flag 
            go to ta0-99-exit. 
 
*  (REPLACE ANY NULLS IN RECORD WITH BLANKS) 
    inspect unpriced-claims-record replacing all low-values by spaces. 
 
*  (REPLACE ANY CARRIAGE-RETURNS IN RECORD WITH BLANKS) 
    inspect unpriced-claims-record replacing all carriage-return by spaces. 
 
*   (SET FLAG TO TEST RECORD TYPE) 
    move unpriced-input-rec-type to      record-type-flags. 
 
*   (CHECK WHETHER THIS RECORD WILL BE PROCESSED OR SKIPPED) 
    if    skip-processing-this-acct-id 
      and t-record 
    then 
        add 1                   to      ctr-t-recs-read-skipped 
    else 
        if   (skip-processing-this-acct-id or skip-hdr-addr-but-write-dtl) 
          and a-record 
        then 
            add 1               to      ctr-a-recs-read-skipped 
        else 
            next sentence. 
*       endif 
*   endif 
 
    add 1                       to      ctr-recs-read. 
 
ta0-99-exit. 
    exit. 
 
 
 
 
tb0-read-doc. 
 
    move "Y"                    to flag-doc. 
    read doc-mstr 
        invalid key move "N"    to flag-doc 
                    go to tb0-99-exit. 
 
*   IF WS-DOC-NBR NOT EQUAL TO 0 AND 
*      WS-DOC-NBR NOT EQUAL TO DOC-NBR 
*   THEN 
*       PERFORM YB1-READ-NEXT-DOC   THRU YB1-99-EXIT 
*   ELSE 
*       IF DOC-DATE-FAC-TERM GREATER THAN '000000' 
*       THEN 
*           PERFORM YB1-READ-NEXT-DOC   THRU YB1-99-EXIT. 
*       endif 
*   endif 
 
 
tb0-99-exit. 
    exit. 
 

 
tc0-write-hdr-rec. 

*   (00/oct/02 B.E. - oma/ohip prices summed separately)
*      move ctr-tot-dollars-claim  to clmhdr-tot-claim-ar-oma 
    move ctr-tot-dollars-oma	to clmhdr-tot-claim-ar-oma.
    move ctr-tot-dollars-ohip	to clmhdr-tot-claim-ar-ohip. 

*   (00/jun/05 B.E. added summation into header amt for tech fee)
    move ctr-tot-tech-claim	to clmhdr-amt-tech-billed.

*   2005/08/09 - MC - override clmhdr-tape-submit-ind to blank before
*			writing to suspend hdr. The value should be blank instead of 'Y' or 'N'.

    move space 			to clmhdr-tape-submit-ind.
*   2005/08/09 - end

 
    if update-suspense
    then
        add 1                           to      ctr-suspend-hdr-writes
	write suspend-hdr-rec.
*   endif
 
*   (CHECK FOR ERROR FLAG SET BY DECLARATIVES ON PREVIOUS WRITE STMNT) 
    if skip-processing-this-acct-id or skip-hdr-addr-but-write-dtl 
    then 
*     (NOTE: 90/01/14 B.E. LOGIC WILL ALLOW WRITING OF HEADER TO FAIL BUT FLAG HAS BEEN 
*      SET SO THAT THE DETAIL RECS  FOR THIS HEADER WILL BE PROCESSED AND THEREFORE 
*      WILL BECOME DETAILS FOR THE HEADER ALREADY ON FILE. MESSAGE ON WARNING 
*      REPORT SHOULD ALERT STAFF TO REVIEW CLAIM TO CONFIRM THAT THESE 
*      HEADERS ARE FOR SAME PATIENT) 
 
	move ws-error-literal		to	err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit 
        move 1                          to      ws-carriage-ctrl 
        move 9                          to      err-ind 
        perform zb0-build-write-err-rpt-line 
                                        thru    zb0-99-exit 
        add 1                           to      ctr-h-recs-skipped 
        go to tc0-99-exit. 
*   endif 
 
    move zero                           to      ctr-tot-dollars-oma
						ctr-tot-dollars-ohip
						ctr-tot-tech-claim. 
 
tc0-99-exit. 
    exit. 
 
 
 
td0-write-susp-dtl. 
 
    if update-suspense
    then
	add 1                       to ctr-suspend-dtl-writes
	write suspend-dtl-rec.
*    endif
 
td0-99-exit. 
    exit. 
 
 
 
te0-write-disk-out. 
 
    if create-priced-file
    then
	add 1                       to ctr-diskout-writes
	write diskout-output-rec. 
*   endif
 
te0-99-exit. 
    exit. 
 
 
 
tf0-write-addr-rec. 
 
    if update-suspense
    then
	add 1                      to ctr-suspend-addr-writes
	write suspend-address-rec
        invalid key 
               move "D"            to skip-process-this-acct-id-flag
               go to tf0-99-exit. 
 
tf0-99-exit. 
    exit. 
 
 
tg0-read-oma-fee-mstr. 
 
    move "Y"                    to flag-oma. 
    read oma-fee-mstr 
        invalid key move "N"    to flag-oma. 
 
tg0-99-exit. 
    exit. 
uj1-read-isam-const-mstr. 
 
    move 'N'                            to flag-lock. 
 
    read    iconst-mstr 
        invalid key 
            move "Y"                    to      fatal-error-flag 
            go to uj1-99-exit. 
 
    move "N"                            to      fatal-error-flag 
 
    add  1                              to ctr-read-const-mstr. 
 
uj1-99-exit. 
    exit. 


xc0-check-oma-code. 
 
    perform tg0-read-oma-fee-mstr        thru tg0-99-exit. 
 
    if     not valid-oma-code 
       and not price-only-claim
    then 
        move 2                          to      ws-carriage-ctrl 
        move 8                          to      err-ind 
        move clmhdr-accounting-nbr      to      err-accounting-nbr 
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit 
*       (BLANK OUT OMA FEE RECORD SINCE IT WAS INVALID) 
        move spaces                     to      fee-mstr-rec. 
*   endif 
 
xc0-99-exit.
    exit. 


xx0-process-hold-dtls. 
 
*   (process the detail records in the hold area  - ie. price 
*    them, write them out, and reset counters/subscripts) 
    if batch-provider-nbr = "264978"
    then 
	if hold-accounting-nbr = "00000004"
        then
	    next sentence
	else
	    next sentence
    else
	next sentence.
*   endif
 
    if ss-clmdtl-oma > 0 
    then 
*	(initialize next available dtl subscript)
	move ss-clmdtl-oma 		       to     ss-clmdtl-next-avail-dtl
        move "N"			       to     flag-tech-prof-suffix-rule
        perform zz3-apply-tech-prof-suff-rules thru   zz3-99-exit
		varying ss-tech-prof-suff
   		from    1 
   		by      1 
		until ss-tech-prof-suff > ss-clmdtl-oma 
*       (if new details added, then increase max dtl subscript)
	perform xx1-test-for-new-dtls	thru	xx1-99-exit
	move 1				to	ss-basic-times-desc-rec
	move 0				to	ss-basic-times
        perform ya0-price-claim         thru    ya0-99-exit 

* 2005/08/17 - MC
	perform xx3-write-susp-desc	thru xx3-99-exit
	move spaces			to flag-desc-rec

* 2005/08/17 - end

	perform xx2-write-susp-diskout-dtl      thru    xx2-99-exit
		varying ss-write-dtl 
   		from    1 
   		by      1 
		until ss-write-dtl > ss-clmdtl-oma 
        move 'Y'                        to   detail-written-flag 
*  	(reset subscripts for detail recs) 
	move 0				to   ss-clmdtl-oma 
					     ss-price 
					     ss-write-dtl 
*   	(00/aug/13 B.E. - reset special add-on code flag)
	move "N"			to   ws-special-add-on-cd-entered

* 2005/11/01 - M.C. - reset e078-premium flag)        
	move "N"			to   ws-e078-premium              
* 2005/11/01 - end

* 2008/04/28 - MC - reset flags
        move "N"   to    ws-e020 
        move "N"   to    ws-e719 
        move "N"   to    ws-e720 
        move "N"   to    ws-e717 
        move "N"   to    ws-e702 
        move "N"   to    ws-g123 
        move "N"   to    ws-g223 
        move "N"   to    ws-g265 
        move "N"   to    ws-g385 
        move "N"   to    ws-g281 
        move "N"   to    ws-e793 
        move "N"   to    ws-e022-e017-e016  
        move "N"   to    ws-z570  
        move "N"   to    ws-z571 
        move "N"   to    ws-z555-z580  
        move "N"   to    ws-z515-z760  
        move "N"   to    ws-g228  
        move "N"   to    ws-g231  
        move "N"   to    ws-g264  
        move "N"   to    ws-g384  
        move "N"   to    ws-g381  
        move "N"   to    ws-r905-s800  
        move "N"   to    ws-annna 
        move "N"   to    ws-gnnna 
        move "N"   to    ws-k991-u997  

* 2008/04/28 - end

*       (b.e. - 2000/jun/28 zero out hold area)
        perform aa1-init-hold-oma-rec      thru    aa1-99-exit
		varying i
   		from    1 
   		by      1 
* 2006/02/15 - MC
*		until   i  > 40
		until   i  > ss-max-nbr-oma-det-rec-allow
*	(WRITE OUT HEADER NOW THAT PRICES ARE KNOWN) 
        perform tc0-write-hdr-rec       thru tc0-99-exit 
   else
**      (This is to ensure that each claim has a detail record.  If not,
**       then an error is generated)
        if     ss-clmdtl-oma = 0 			
           and ctr-hdr2-rec = 1
           and ctr-addr-rec = 1
           and not price-only-claim
        then
	   move ws-error-literal		to	err-warn-msg
	   perform xb0-print-warning-line thru xb0-99-exit
	   move 1                          to   ws-carriage-ctrl
	   move 50                         to   err-ind
	   move clmhdr-accounting-nbr      to   err-no-detail-claim
	   perform zb0-build-write-err-rpt-line thru zb0-99-exit.
*	endif
*   endif

xx0-99-exit. 
    exit. 
 
 
xx1-test-for-new-dtls.

*   (if next available detail record number is greater than original
*    max number of details, then new records were created so update
*    new maximum)

    if ss-clmdtl-next-avail-dtl > ss-clmdtl-oma
    then
	move ss-clmdtl-next-avail-dtl 	to	ss-clmdtl-oma.
*   endif

xx1-99-exit.
    exit.
 
xx2-write-susp-diskout-dtl.
*   (write detail rec from data in the priced hold area to the suspend file) 

*   (sum total priced detail into audit total of run
*    using whichever price is to be used)

*   (pricing algorithm may have overriden prices but for total
*   dollars 'read' use the incoming amounts)

    add hold-fee-incoming(ss-write-dtl) to   ctr-tot-dollars-read.

    add hold-fee-ohip(ss-write-dtl)	to   ctr-tot-dollars-ohip.
    add hold-fee-oma (ss-write-dtl)	to   ctr-tot-dollars-oma.

*   (2000/jun/05 B.E. - keep running counter of tech fee to sum into hdr rec)
    add  hold-priced-tech(ss-write-dtl)	to   ctr-tot-tech-claim.

    perform hb0-build-susp-dtl-rec-dtl	thru hb0-99-exit. 
 
    perform td0-write-susp-dtl           thru td0-99-exit. 
 
*   (BUILD DISKOUT DISKETTE RECORD) 
    perform xx2a-build-diskout-rec	 thru xx2a-99-exit. 
    perform te0-write-disk-out           thru te0-99-exit. 
 
xx2-99-exit. 
    exit. 
 
 
xx2a-build-diskout-rec. 
 
    move hold-accounting-nbr                to  diskout-clmhdr-claim. 

*   (2001/oct/03 B.E. added new clinic-nbr to output file)
    move bt-clinic-nbr-1-2		    to  diskout-clmhdr-clinic-nbr.

    move hold-oma-cd	    (ss-write-dtl)  to  diskout-oma-svc-code. 
    move hold-oma-suff      (ss-write-dtl)  to  diskout-oma-svc-suff. 
    move hold-sv-nbr-serv   (ss-write-dtl)  to  diskout-nbr-serv. 
    move hold-sv-date	    (ss-write-dtl)  to  diskout-svc-date. 
    move hold-fee-oma 	    (ss-write-dtl)  to  diskout-oma-amt-billed. 
    move hold-fee-ohip      (ss-write-dtl)  to  diskout-ohip-amt-billed. 
    move hold-priced-tech   (ss-write-dtl)  to  diskout-priced-tech. 
    move hold-basic-tech    (ss-write-dtl)  to  diskout-basic-tech. 
    move hold-basic-prof    (ss-write-dtl)  to  diskout-basic-prof. 
    move hold-basic-fee     (ss-write-dtl)  to  diskout-basic-fee. 
    move carriage-return                    to  diskout-cr. 
 
xx2a-99-exit. 
    exit. 

* 2005/08/17 - MC - if adjudication-desc-entry, create description record
*		    and set manual review to 'Y'
xx3-write-susp-desc.

* 2008/04/29 - MC - initialize line no
    move 0					to clmdtl-line-no of suspend-desc-rec.
* 2008/04/29 - end

    if adjudication-desc-entry
    then
	move 'Y'				to clmhdr-manual-review
	move "G259 BILLED AT 85%"		to clmdtl-suspend-desc of suspend-desc-rec
        move 1					to clmdtl-line-no of suspend-desc-rec
	move clmhdr-doc-pract-nbr		to clmdtl-doc-pract-nbr of suspend-desc-rec
	move clmhdr-accounting-nbr		to clmdtl-accounting-nbr of suspend-desc-rec
        move clmhdr-status			to clmdtl-status of suspend-desc-rec
        if update-suspense
    	then
	    add 1                       	to ctr-suspend-desc-writes
            write suspend-desc-rec.
*	endif
*    endif

* 2008/04/29 - MC  - percentage visit preimium

     if        ws-annna = 'Y'
        and    ws-gnnna = 'Y'
        and    ws-k991-u997 = 'Y'
     then	
	move 'Y'				to clmhdr-manual-review
	move "Pay visit premium"  		to clmdtl-suspend-desc of suspend-desc-rec
        add  1					to clmdtl-line-no of suspend-desc-rec
	move clmhdr-doc-pract-nbr		to clmdtl-doc-pract-nbr of suspend-desc-rec
	move clmhdr-accounting-nbr		to clmdtl-accounting-nbr of suspend-desc-rec
        move clmhdr-status			to clmdtl-status of suspend-desc-rec
        if update-suspense
    	then
	    add 1                       	to ctr-suspend-desc-writes
            write suspend-desc-rec
	    move "based on 'A---A' code"        to clmdtl-suspend-desc of suspend-desc-rec
            add  1				to clmdtl-line-no of suspend-desc-rec
	    move clmhdr-doc-pract-nbr		to clmdtl-doc-pract-nbr of suspend-desc-rec
	    move clmhdr-accounting-nbr		to clmdtl-accounting-nbr of suspend-desc-rec
            move clmhdr-status			to clmdtl-status of suspend-desc-rec
	    add 1                       	to ctr-suspend-desc-writes
            write suspend-desc-rec.
*       endif 
*    endif

* 2008/04/29 - MC
	 
xx3-99-exit.
    exit.

* 2005/08/17 - end

        

copy "pricing_logic.rtn".

xa0-display-details .
*   (this is dummy routine called from pricing copybook logic that
*    is used by d001 to display priced claims on screen. 
*   
*    IF EVER WE NEED TO DUMP PRICED CLAIMS INTO REPORT OR DO OTHER CHECKING
*    THEN HERE IS THE IDEAL AREA TO PLACE THIS CODE
*

xa0-99-exit.
    exit.
za0-common-error.
*   (this is dummy routine called from pricing copybook logic that
*    is used by d001 to display errors
za0-99-exit.
    exit.


zb0-build-write-err-rpt-line. 
 
    move err-msg (err-ind)              to      rpt-line. 
    perform zz0-write-err-rpt-line      thru    zz0-99-exit. 
 
zb0-99-exit. 
    exit. 
 
 
zz0-write-err-rpt-line. 
 
     add ws-carriage-ctrl               to      ctr-lines-printed. 
     if ctr-lines-printed > max-lines-per-page 
     then 
        perform zz1-print-headings      thru    zz1-99-exit 
        move 1                          to      ws-carriage-ctrl. 
*    endif 
 
    write rpt-line      after advancing ws-carriage-ctrl lines. 
 
zz0-99-exit. 
    exit. 
 
 
 
zz1-print-headings. 
 
*   (SAVE LINE THAT WAS TO BE PRINTED, RESTORE AFTER HEADINGS PRINTED) 
    move rpt-line                  to   save-prt-line. 
 
    add 1                          to   ws-rpt-page-nbr. 
    move ws-rpt-page-nbr           to   rpt-page-nbr. 
    write rpt-line from heading-l1 after advancing page. 
 
*   (97/09/25 B.E. - ADD DOCTOR INFO INTO AUDIT REPORT) 
    move doc-nbr		   to h-l2-doctor-nbr. 
    move doc-inits		   to h-l2-doctor-initials. 
    move doc-name		   to h-l2-doctor-name. 
    move batch-group-nbr  	   to h-l2-clinic. 
    move batch-speciality 	   to h-l2-speciality. 
    write rpt-line from heading-l2 after advancing 1 line. 
 
    move spaces                    to   rpt-line 
    write rpt-line                 after advancing 2 lines. 
    move 2                         to   ctr-lines-printed. 
 
    move save-prt-line             to   rpt-line. 
 
zz1-99-exit. 
    exit. 


zz3-apply-tech-prof-suff-rules.

copy "tech_prof_suff_split_part1.rtn"
     replacing  ==ss-clmdtl-oma== by ==ss-tech-prof-suff==.

zz3-99-exit.
    exit.


copy "tech_prof_suff_split_part2.rtn"
     replacing  ==ss-clmdtl-oma== by ==ss-tech-prof-suff==.
 
copy "y2k_default_sysdate_century.rtn". 

copy "pricing_test_min_max_limits.rtn".

copy "d001_newu701_oma_code_edit.rtn".
