* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   1
*                      d004.cbl
* Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Accepted - SHOW-DIR
* Accepted - SOURCEFORMAT"FREE"
* Accepted - SPZERO
* Accepted - TIME
* Accepted - TRUNC
* Accepted - LIST
* Accepted - RESEQ
* End Of Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Options: int(d004.int) verbose nolist endp list(d004.lst)
identification division.
program-id. d004.
author. dyad computer systems inc.
installation. rma.
date-written. 80/01/31.
date-compiled. 20-Mar-17 14:55.
security.
*
*    files      : f001 - batch control file
*               : f002 - claims master
*               : f020 - doctor master
*               : f030 - location master
*               : f040 - oma fee schedule master
*               : f090 - constants master
*
*    program purpose : 'adjustment'/'payment' batch data entry.
*
*
*
*       revision history:
*               oct 23/81 - checks status of batch accessed in 'continue'
*                           mode. if not 'balanced/unblanced' then requires
*                           password to continue. (be)
*
*
*               feb 17/81 - removal of forced agent '7' on 'p/m' type batches. (
*
*
*               feb/82    - no force of agent '7' (be)
*
*
*               mar/81    - service date modifications (see sms14 - nov 24/81)
*                           and update of reference field with reason code (iw)
*
*               sep/83    - added clmhdr-tot-claim-ar-ohip to be updated
*                           for batch of p/c.
*
*               may/84 (a.j.) - accept operator input of tech portion of
*                               payment/adjustment and update related
*                               claims fields
*
*               nov/84 (m.s.) - add "WS-POSTED-OHIP" to
*                               "CLMHDR-CURR-PAYMENT"
*
*               may/87 (s.b.) - coversion from aos to aos/vs.
*                               change field size for
*                               status clause to 2 and
*                               feedback clause to 4.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   2
*                      d004.cbl
*
*               sep/87 (m.s.) - sms 97
*                               default "M" to batctrl-adj-sub-type
*                               and  clmhdr-adj-sub-type for 'b'
*                               adjustment only.

*
*    revised dec/87 (j.l.) - pdr 356
*                          - after error message is displayed, hit
*                            space bar to return to keying field
*
*               jan/88 (m.s.) - pdr 337/343 - sms 105
*                               allow user to override the default
*                               location code when doing revenue
*                               or miscellaneous adjustment.
*
*               nov/88 (m.s.) - sms 99
*                               if batctrl-amt-act  > 99999.99,
*                               then display the error message,
*                               re-enter the claim with the new batch.
*
*               nov/88 (m.s.) - sms 111
*                               if adjust code = 'R', 'M', 'C' or 'A',
*                               set the oma fee to be the same as ohip,
*                               and also bypass the oma fee field, do
*                               not accept any value on that field
*
*               mar/89 (s.f.) - sms 105
*                               allow user to override the default
*                               location code on the detail screen
*                               for "R" adjustments
*
*   revised march/89 : - sms 115 s.f.
*                      - make sure file status is pic xx ,feedback is
*                        pic x(4) and infos status is pic x(11).
*
*
*   revised jan/91   : - sms 137 (b.l)
*                      - change the percentage field for miscellaneous
*                        payment with 2 decimal places
*
*   revised jan/91   : - pdr 472 (m.c.)
*                      - do not allow to override the location from
*                        'MISC' in batch control screen for miscellaneous
*                        payment
*
*   revised jan/91   : - pdr 471 (m.c.)
*                      - for 'M' payment, prompt for doctor number
*                        before pay code, so pay code 0 will be
*                        displayed properly from doctor master, other
*                        pay code is displaying fine from f090.
*
*   revised aug/91   : - pdr 504 (m.c.)
*                      - initialize ws-doc-nbr to zero in the subroutine
*                        of initialization
*                      - reset the occur and feedback in xe0-read-claims
*                        subroutine
*                      - change max locations in doctor from 20 to 30.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   3
*                      d004.cbl
*
*   revised feb/93   : - pdr 560 (m.c.)
*                      - use doc-dept instead of clmhdr-doc-dept-nbr
*                        when user enters adjustment or payment
*
*   revised sep/93   : - pdr 582 (m.c.)
*                      - for miscellaneous payment, do not force user
*                        to reenter the pay code and amount unless they
*                        do want to overwrite
*                      - if user enters 'L' and adj-cd is not 'R', allow
*                        user to enter or change explanation field
*  01/may/07 B.E. - attempted to reconcile code and error/warnings with the
*                   fact that now ohip/rma amounts may differ yet the technical
*                   amount of adjustment can not be different and must be
*                   taken from both. This means that the professional amount
*                   calculation between oma/ohip may be wrong - code now
*                   shows the appropriate calculation based upon the agent
*                   in the same fashion as d003
*  02/sep/26 M.C. - do not allow user to adjust claims that have not gone
*                    to ohip yet (ie. batch status < 3)
*  03/nov/05 b.e. - alpha doctor number
*  05/mar/01 M.C. - for miscellaneous payment, do not allow user to enter pay co
*                   default pay code to be zero
*
*  11/Nov/16 MC1  - for miscellaneous payment, provide warning if doctor is term
*                 - allow user to put '*' to bypass if they still want to use th
*  12/Nov/14 MC2  - alert user if batch actual amount does not match batch estim
*  13/Aug/27 MC3  - alert user if doctor nbr has not assigned the selected clini
*  13/Nov/06 MC4  - display doctor name for miscellaneous payment as well as cas
*  15/Mar/18 MC5  - include f040_dtl.slr/fd and add edit check against f040_dtl
*  15/May/12 MC6  - for miscellaneous payment, provide warning if doctor is term
*                   error if terminated more than 6 months.  Allow user to enter
*                   for doctor terminated more than 6 months
*  17/Mar/20 MC7  - modify $use/f040_dtl.fd to include doc-nbr, include doc-nbr
*                   miscellaneous payment

environment division.
input-output section.
file-control.
*
    copy "f001_batch_control_file.slr".
    select batch-ctrl-file
*       assign index to "f001_batch_control_file"
*       assign data  to "f001_batch_control_file"
        assign to disk "$pb_data/f001_batch_control_file"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual

*       record key   is key-batctrl-file length is 9
        record key   is key-batctrl-file
*tobefixed*     record key   is key-gen-batctrl-file length is 2   S
              status is status-cobol-batctrl-file.
*       infos status is status-batctrl-file.
*       eof-flag     is eof-batctrl-file
*
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   4
*                      d004.cbl                                      )
    copy "f002_claims_mstr.slr".
    select claims-mstr
*tobefixed* brad no unique key for this file !!!!!
*               two record keys
*       assign index to "f002_claims_mstr"
*       assign data  to "f002_claims_mstr"

        assign to disk "$pb_data/f002_claims_mstr"

        organization is indexed
        access mode  is dynamic
*mf     (added lock mode so that files aren't open exclusively)
        lock mode is manual

*       record key   is key-claims-mstr     length is 18
        record key   is key-claims-mstr
          with duplicates

*tobefixed*             with  duplicates occurrence is claims-occur
*mf     record key   is key-gen-claims-mstr length is  2
*mf     alternate record key   is key-gen-claims-mstr
        alternate record key   is clmdtl-p-claims-mstr
           with duplicates

        status       is status-cobol-claims-mstr.
*
    copy "f020_doctor_mstr.slr".
    select doc-mstr
*mf     assign index to "f020_doctor_mstr"
*mf     assign data  to "f020_doctor_mstr"
        assign to disk "$pb_data/f020_doctor_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual

        record key   is doc-nbr of doc-mstr-rec

*mf added two  alternative keys below
        alternate key is doc-name-soundex
         with duplicates
        alternate key is doc-ohip-nbr of doc-mstr
         with duplicates
              status  is status-cobol-doc-mstr.
*       infos status  is status-doc-mstr.
*       eof-flag     is eof-doc-mstr
*
*
    copy "f030_locations_mstr.slr".
    select loc-mstr
*       assign index to "f030_locations_mstr"
*               contiguous
*       assign data  to "f030_locations_mstr"
        assign  to disk "$pb_data/f030_locations_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   5
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f030_)
        record key   is loc-nbr
*       infos status is status-loc-mstr.
        status is status-cobol-loc-mstr.
*
    copy "f040_oma_fee_mstr.slr".
    select oma-fee-mstr
*mf     assign index to "f040_oma_fee_mstr"
*mf     assign data  to "f040_oma_fee_mstr"
        assign to disk "$pb_data/f040_oma_fee_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual
        record key   is fee-oma-cd
*mf     infos status is status-oma-mstr.
*       eof-flag     is eof-oma-mstr
        status is status-cobol-oma-mstr.
*
    copy "f090_constants_mstr.slr".
select iconst-mstr
assign to disk "$pb_data/f090_constants_mstr"
organization is indexed
access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
lock mode is manual
record key   is iconst-clinic-nbr-1-2
*       eof-flag     is eof-iconst-mstr
status is status-cobol-iconst-mstr.
* MC5
    copy "f040_dtl.slr".
    select f040-dtl
        assign to disk "$pb_data/f040_dtl"
        organization is indexed
        access mode  is dynamic
        lock mode is manual
        record key   is oma-dept
        status is status-cobol-f040-dtl.

data division.
file section.
    copy "f001_batch_control_file.fd".
*  98/aug/01 B.E.      - unix conversion - moved external key to internal keyp
*  98/dec/01 D.B.       - y2k
*  99/Jan/21 M.C.       - move 'adj-cd' and 'adj-cd-sub-type' between
*                         'batch-type' and 'last-claim-nbr' fields
*                       - comment out filler
*  99/Apr/23 M.C.       - change key-batctrl-file from numeric to alpha
*  99/May/27 M.C.       - change batctrl-clinic-nbr numeric to alpha
*  99/nov/18 B.E.       - location changed from x999 to x(4).
*  01/nov/06 B.E.       - added batctrl-payroll as redefine of batctrl-hosp
*  03/oct/20 b.e.       - alpha doctor nbr
*  16/Jan/29 MC1        - change amount field from 9(5)v99 to 9(7)v99

fd batch-ctrl-file
*!          block  contains 112 characters
*!          record contains 112 characters.
          block  contains 111 characters
          record contains 111 characters.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   6
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f001_)

01  batctrl-rec.

    05  batctrl-batch-nbr.
        10  batctrl-bat-clinic-nbr-1-2          pic 99.
*!      10  batctrl-bat-doc-nbr                 pic 9(4).
        10  batctrl-bat-doc-nbr                 pic x(3).
        10  batctrl-bat-week-day.
            15  batctrl-bat-week                pic 99.
            15  batctrl-bat-day                 pic 9.
        10  batctrl-bat-week-day-r redefines batctrl-bat-week-day
                                                pic 999.
    05  key-batctrl-file-r redefines batctrl-batch-nbr.
*mc     10  key-batctrl-file                    pic 9(9).
* mc - redefined from numeric to alpha so that programs moving
*      alphabetic fields to this field get left justified results
*      rather than right justified results which the numeric
*      definition gives.  For example,  cobol programs doing
*      'read approximates' move "22" to this field and with the
*      numeric definition get "00000022" to read. By changing
*      to alphabetic field, we get "22     " and the read
*      aproximate works the same with this internal key as
*      before when we had  external key.
*!        10  key-batctrl-file                  pic x(9).
        10  key-batctrl-file                    pic x(8).


    05  batctrl-batch-type                      pic x.
    05  batctrl-adj-cd                          pic x.
    05  batctrl-adj-cd-sub-type                 pic x.
    05  batctrl-last-claim-nbr                  pic 99.
    05  batctrl-clinic-nbr.
*       10  batctrl-clinic-nbr-1-2              pic 99.
*       10  batctrl-clinic-nbr-3-4              pic 99.
        10  batctrl-clinic-nbr-1-2              pic xx.
        10  batctrl-clinic-nbr-3-4              pic xx.
    05  batctrl-doc-nbr-ohip                    pic 9(6).

    05  batctrl-hosp                            pic x.
    05  batctrl-payroll redefines batctrl-hosp  pic x.

    05  batctrl-loc.
        10  batctrl-loc1                        pic x.
* 99/nov/19 B.E.
*       10  batctrl-loc2-4                      pic 999.
        10  batctrl-loc2-4                      pic xxx.
    05  batctrl-agent-cd                        pic 9.
*   05  batctrl-adj-cd                          pic x.
    05  batctrl-i-o-pat-ind                     pic x.
*       ('batctrl-date-batch-entered' formerly called 'batctrl-date-claimed-sys'
    05  batctrl-date-batch-entered              pic x(8).
*       ('filler' formerly called 'batctrl-date-sv')
*   05  filler                                  pic x(6).  - use for y2k
    05  batctrl-date-period-end.
        10 batctrl-date-period-end-yy           pic xxxx.
        10 batctrl-date-period-end-mm           pic xx.
        10 batctrl-date-period-end-dd           pic xx.
    05  batctrl-cycle-nbr                       pic 999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   7
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f001_)
* MC1
*   05  batctrl-amt-est                         pic s9(5)v99.
*   05  batctrl-amt-act                         pic s9(5)v99.
    05  batctrl-amt-est                         pic s9(7)v99.
    05  batctrl-amt-act                         pic s9(7)v99.
* MC1 - end
    05  batctrl-svc-est                         pic 9(4).
    05  batctrl-svc-act                         pic 9(4).
    05  batctrl-ar-yy-mm                        pic x(6).
* MC1
*   05  batctrl-calc-ar-due                     pic s9(5)v99.
*   05  batctrl-calc-tot-rev                    pic s9(5)v99.
*   05  batctrl-manual-pay-tot                  pic s9(5)v99.
    05  batctrl-calc-ar-due                     pic s9(7)v99.
    05  batctrl-calc-tot-rev                    pic s9(7)v99.
    05  batctrl-manual-pay-tot                  pic s9(7)v99.
* MC1 - end
    05  batctrl-batch-status                    pic x.
    05  batctrl-nbr-claims-in-batch             pic 99.
* MC1
*   05  filler                                  pic x(10).
* MC1 - end
*--------------------------------------------------------------------
*       the 'adj-cd' field above and 'adj-cd-sub-type' below should
*       be moved between 'batch-type' and 'last-claim-nbr' fields
*--------------------------------------------------------------------
*   05  batctrl-adj-cd-sub-type                 pic x.
*
    copy "f002_claims_mstr.fd".
* 99/jan/15 B.E  - y2k
* 01/nov/06 B.E. - added clmrec-hdr-payroll as redefine of clmrec-hosp
* 03/aug/21 M.C. - increase the file size by 8 characters
* 03/oct/20 b.e. - alpha doctor nbr
* 04/jun/02 b.e. - added field clmdtl-b-batch-number-numeric

fd  claims-mstr
*            block  contains       224 characters
*            record contains       224 characters .
*!             block  contains       232 characters
*!             record contains       232 characters .
             block  contains       228 characters
             record contains       228 characters .
*       feedback is feedback-claims-mstr.


* insert this warning message from "F000_DUPLICATE_FD_WARNING.FD

*----------------  note -----------------------
*-- any changes to this fd must also be made  --
*-- to the corresponding "..._D001_..." fd    --
*-- and vice versa                            --
*----------------  note -----------------------
01  claims-mstr-rec.

  05  claims-mstr-hdr-rec.

    10  clmrec-hdr-clinic-nbr-1-2               pic 99.
*!    10  filler                                  pic x(09).
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   8
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
    10  filler                                  pic x(08).
    10  clmrec-zeroed-oma-suff-adj              pic x(06).
    10  clmrec-zeroed-area redefines clmrec-zeroed-oma-suff-adj
                                                pic 9(06).
    10  clmrec-hdr-batch-type                   pic x.
    10  filler                                  pic x(15).
    10  clmrec-hdr-diag-cd                      pic 9(3).
    10  clmrec-hdr-loc                          pic x(4).

    10  clmrec-hdr-hosp                         pic x.
    10  clmrec-hdr-payroll redefines clmrec-hdr-hosp pic x.

    10  clmrec-hdr-agent-cd                     pic 9.
    10  filler                                  pic x(2).
    10  clmrec-hdr-i-o-pat-ind                  pic x.
    10  clmrec-hdr-ohip-id-or-chart             pic x(16).
    10  clmrec-hdr-pat-acronym                  pic x(9).
* reference x(11) + date admit 9(8)
    10  filler                                  pic x(19).

    10  clmrec-doc-dept-nbr                     pic 99.

*  (cash payment date 9(8) + curr payment 9(7) + ped 9(8)  + cycle nbr 9(2)
    10  filler                                  pic x(25).

*      (field now refers to clmhdr-date-sys instead of old
*       clmhdr-date-claim, but name remains the same)
    10  clmrec-hdr-date-claim                   pic x(8).
    10  clmrec-hdr-amt-tech-billed              pic s9(4)v99.
    10  clmrec-hdr-amt-tech-paid                pic s9(4)v99.
    10  clmrec-hdr-tot-claim-ar-oma             pic s9(5)v99.
    10  clmrec-hdr-tot-claim-ar-ohip            pic s9(5)v99.
    10  clmrec-hdr-manual-tape-pymnts           pic s9(5)v99.
    10  clmrec-hdr-status-ohip                  pic xx.
*       (review=1,submitdate=8,confidential=1,servdate=8,origbatchid=11)
* 2003/08/21 - MC - 8 chars for 4 new elements (elig-error, elig-status, serv-er
*   10  filler                                  pic x(29).
*!  10  filler                                  pic x(37).
    10  filler                                  pic x(36).
* 2003/08/21 - end

*-------------------
10  k-key-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  clmrec-hdr-b-key-type                        pic x.
    20  clmrec-hdr-b-data.
*!        25  clmrec-hdr-b-batch-num                   pic 9(9).
        25  clmrec-hdr-b-batch-num                   pic x(8).
        25  clmrec-hdr-b-batch-nbr redefines clmrec-hdr-b-batch-num.
            30  clmrec-hdr-b-clinic-nbr-1-2          pic 99.
*!            30  clmrec-hdr-b-doc-nbr                 pic 9(4).
            30  clmrec-hdr-b-doc-nbr                 pic x(3).
            30  clmrec-hdr-b-doc-nbr-r redefines clmrec-hdr-b-doc-nbr.
*!                35  clmrec-hdr-b-doc-nbr-1           pic 9.
*!                35  clmrec-hdr-b-doc-nbr-2-4         pic 999.
                35  clmrec-hdr-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page   9
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*             rather than the old  week-day combination )
            30  clmrec-hdr-b-batch-number.
                35  clmrec-hdr-b-week                pic 99.
                35  clmrec-hdr-b-day                 pic 9.
        25  clmrec-hdr-b-claim-nbr                   pic 99.
        25  clmrec-hdr-b-oma-cd                      pic x999.

        25  clmrec-hdr-b-oma-suff                    pic x.
        25  clmrec-hdr-b-adj-nbr                     pic x.
    20  clmrec-hdr-b-data-r  redefines  clmrec-hdr-b-data.
        25  clmrec-hdr-b-pat-id                      pic x(15).
*!        25  filler                                   pic xx.
        25  filler                                   pic x.

10  k-clmdtl-p-claims-mstr.
    20  clmdtl-p-key-type                        pic x.
    20  clmdtl-p-data.
        25  clmdtl-p-batch-nbr.
            30  clmdtl-p-clinic-nbr-1-2      pic  99.
*!            30  clmdtl-p-doc-nbr             pic 9(4).
            30  clmdtl-p-doc-nbr             pic x(3).
            30  clmdtl-p-week                pic 99.
            30  clmdtl-p-day                 pic 9.
        25  clmdtl-p-claim-nbr               pic 99.
        25  clmdtl-p-oma-cd                  pic x999.
        25  clmdtl-p-oma-suff                pic x.
        25  clmdtl-p-adj-nbr                 pic x.
*-------------------------

01  claims-mstr-dtl-rec.

*!    10  filler                                  pic x(11).
    10  filler                                  pic x(10).
    10  clmrec-dtl-oma-cd                       pic x(4).
    10  filler                                  pic x(5).
    10  clmrec-dtl-agent-cd                     pic  9.
    10  clmrec-dtl-adj-cd                       pic  x.
    10  clmrec-dtl-nbr-serv                     pic 99.
    10  clmrec-dtl-sv-date                      pic x(8).
    10  clmrec-dtl-consec-dates occurs 3 times.
        15  clmrec-dtl-sv-nbr                   pic 9.
        15  filler                              pic xx.
    10  clmrec-dtl-amt-tech-billed              pic s9(4)v99.
    10  clmrec-dtl-fee-oma                      pic s9(5)v99.
    10  clmrec-dtl-fee-ohip                     pic s9(5)v99.
* 2003/08/21 - MC
*   10  filler                                  pic x(127).
*!    10  filler                                  pic x(135).
    10  filler                                  pic x(134).
* 2003/08/21 - end

*mf added below copy to include 'external' key within record.
*mfcopy "f002_key_claims_mstr_mf.ws".
*-------------------
10  key-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  clmdtl-b-key-type                        pic x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  10
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
    20  clmdtl-b-data.
*!        25  clmdtl-b-batch-num                   pic 9(9).
        25  clmdtl-b-batch-num                   pic x(8).
        25  clmdtl-b-batch-nbr redefines clmdtl-b-batch-num.
            30  clmdtl-b-clinic-nbr-1-2          pic 99.
*!            30  clmdtl-b-doc-nbr                 pic 9(4).
            30  clmdtl-b-doc-nbr                 pic x(3).
            30  clmdtl-b-doc-nbr-r redefines clmdtl-b-doc-nbr.
*!                35  clmdtl-b-doc-nbr-1           pic 9.
*!                35  clmdtl-b-doc-nbr-2-4         pic 999.
                35  clmdtl-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  clmdtl-b-batch-number.
                35  clmdtl-b-week                pic 99.
                35  clmdtl-b-day                 pic 9.
            30  clmdtl-b-batch-number-numeric redefines  clmdtl-b-batch-number
                                                pic 9(3).

        25  clmdtl-b-claim-nbr                   pic 99.
        25  clmdtl-b-oma-cd                      pic x999.

        25  clmdtl-b-oma-suff                    pic x.
        25  clmdtl-b-adj-nbr                     pic x.
    20  clmdtl-b-data-r  redefines  clmdtl-b-data.
        25  clmdtl-b-pat-id                      pic x(15).
*!        25  filler                               pic xx.
        25  filler                               pic x.

10  clmdtl-p-claims-mstr.
    20  clmdtl-p-key-type                        pic x.
    20  clmdtl-p-data.
        25  clmdtl-p-batch-nbr.
            30  clmdtl-p-clinic-nbr-1-2      pic  99.
*!            30  clmdtl-p-doc-nbr             pic 9(4).
            30  clmdtl-p-doc-nbr             pic x(3).
            30  clmdtl-p-week                pic 99.
            30  clmdtl-p-day                 pic 9.
        25  clmdtl-p-claim-nbr               pic 99.
        25  clmdtl-p-oma-cd                  pic x999.
        25  clmdtl-p-oma-suff                pic x.
        25  clmdtl-p-adj-nbr                 pic x.
*-------------------------

*
    copy "f020_doctor_mstr.fd".
* sms 137  bml  05-dec-90  increase fields by 2
* sms 139  mc   10-jun-92  add 5 clinic nbr and 2 spec codes in
*                          reserved for nip
*          mc   24-nov-93  include brad's fields of earning subsystem
*          mc   12-feb-94  include doc-ep-pay-code and doc-ep-pay-sub-code
*          db   03-jun-98  Year 2000
*          mc   16-jul-02  add 5 additional batch nbr for each additional
*                          clinic
*          mc   23-sep-02  rename the second occurrence of group-regular-service
*                          to group-over-serviced
*          be   05-nov-03  alpha doctor nbr
*          mc   03-mar-04  reuse filler x(4) for doc-afp-paym-group from filler2
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  11
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f020_)
*          be   06-apr-17  - increase to 800 when $1M payroll figures changed th

fd  doc-mstr
*       block  contains 680 characters
*       record contains 680 characters.
*       block  contains 695 characters
*       record contains 695 characters.
        block  contains 800 characters
        record contains 800 characters.

01 doc-mstr-rec.
*    05  doc-nbr                                        pic 9(3).
    05  doc-nbr                                 pic x(3).
    05  doc-dept                                pic 99.
    05  doc-ohip-nbr                            pic 9(6).
    05  doc-pract-nbr redefines doc-ohip-nbr    pic 9(6).
    05  doc-sin-nbr.
        10  doc-sin-123                         pic 999.
        10  doc-sin-456                         pic 999.
        10  doc-sin-789                         pic 999.
    05  doc-clinic-nbr                          pic 99.
    05  doc-spec-cd                             pic 99.
    05  doc-hosp-nbr                            pic x999.
    05  doc-name                                pic x(24).
    05  doc-name-soundex                        pic x(4).

    05  doc-inits.
        10  doc-init1                           pic x.
        10  doc-init2                           pic x.
        10  doc-init3                           pic x.
    05  doc-address-office.
        10  doc-addr-office-1                   pic x(24).
        10  doc-addr-office-2                   pic x(24).
        10  doc-addr-office-3                   pic x(24).
    05  doc-addr-office-r  redefines  doc-address-office.
        10  doc-addr-office  occurs 3 times     pic x(24).
    05  doc-addr-office-pc.
        10  doc-addr-office-pc-123.
            15  doc-addr-office-pc1             pic a.
            15  doc-addr-office-pc2             pic 9.
            15  doc-addr-office-pc3             pic a.
        10  doc-addr-office-pc-456.
            15  doc-addr-office-pc4             pic 9.
            15  doc-addr-office-pc5             pic a.
            15  doc-addr-office-pc6             pic 9.
    05  doc-address-home.
        10  doc-addr-home-1                     pic x(24).
        10  doc-addr-home-2                     pic x(24).
        10  doc-addr-home-3                     pic x(24).
    05  doc-addr-home-r  redefines doc-address-home.
        10  doc-addr-home  occurs 3 times       pic x(24).
    05  doc-addr-home-pc.
        10  doc-addr-home-pc-123.
            15  doc-addr-home-pc1               pic a.
            15  doc-addr-home-pc2               pic 9.
            15  doc-addr-home-pc3               pic a.
        10  doc-addr-home-pc-456.
            15  doc-addr-home-pc4               pic 9.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  12
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f020_)
            15  doc-addr-home-pc5               pic a.
            15  doc-addr-home-pc6               pic 9.
    05  doc-full-part-ind                       pic x.
    05  doc-class-code redefines doc-full-part-ind pic x.
    05  doc-bank-info.
        10  doc-bank-nbr                        pic 9(4).
        10  doc-bank-branch                     pic 9(5).
        10  doc-bank-acct                       pic x(12).
*   05  doc-tax-info.
*       10  doc-billing-percent                 pic 9v99.
*       10  doc-misc-percent                    pic 9v99.
*       10  doc-tax-percent                     pic 9v99.
*       10  doc-billing-percent                 pic 9v9999.
*       10  doc-misc-percent                    pic 9v9999.
*       10  doc-tax-percent                     pic 9v9999.
*       10  doc-pay-code                        pic x.
    05  doc-fac-dates.
        10  doc-date-fac-start.
* y2k       15  doc-date-fac-start-yy           pic 99.
            15  doc-date-fac-start-yy           pic 9999.
            15  doc-date-fac-start-mm           pic 99.
            15  doc-date-fac-start-dd           pic 99.
        10  doc-date-fac-term.
* y2k       15  doc-date-fac-term-yy            pic 99.
            15  doc-date-fac-term-yy            pic 9999.
            15  doc-date-fac-term-mm            pic 99.
            15  doc-date-fac-term-dd            pic 99.
    05    doc-fac-dates-r redefines doc-fac-dates.
        10  doc-date-fac occurs 2 times.
* y2k       15  doc-date-fac-yy                 pic 99.
            15  doc-date-fac-yy                 pic 9999.
            15  doc-date-fac-mm                 pic 99.
            15  doc-date-fac-dd                 pic 99.
    05  doc-annual-ceiling-info.
*        10  doc-ytdgua                          pic s9(7)v99 comp.
        10  doc-ytdgua                          pic s9(7)v99.
*        10  doc-ytdgub                          pic s9(7)v99 comp.
        10  doc-ytdgub                          pic s9(7)v99.
*        10  doc-ytdguc                          pic s9(7)v99 comp.
        10  doc-ytdguc                          pic s9(7)v99.
*        10  doc-ytdgud                          pic s9(7)v99 comp.
        10  doc-ytdgud                          pic s9(7)v99.
*        10  doc-ytdcea                          pic s9(7)v99 comp.
        10  doc-ytdcea                          pic s9(7)v99.
*        10  doc-ytdcex                          pic s9(7)v99 comp.
        10  doc-ytdcex                          pic s9(7)v99.
*        10  doc-ytdear                          pic s9(7)v99 comp.
        10  doc-ytdear                          pic s9(7)v99.
*        10  doc-ytdinc                          pic s9(7)v99 comp.
        10  doc-ytdinc                          pic s9(7)v99.
*        10  doc-ytdeft                          pic s9(7)v99 comp.
        10  doc-ytdeft                          pic s9(7)v99.
*        10  doc-totinc-g                        pic s9(7)v99 comp.
        10  doc-totinc-g                        pic s9(7)v99.
* y2k
*       10  doc-ep-date-deposit                 pic 9(4) comp.
        10  doc-ep-date-deposit                 pic 9(8).
*        10  doc-totinc                          pic s9(7)v99 comp.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  13
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f020_)
        10  doc-totinc                          pic s9(7)v99.
*        10  doc-ep-ceiexp                       pic s9(7)v99 comp.
        10  doc-ep-ceiexp                       pic s9(7)v99.
*        10  doc-adjcea                          pic s9(7)v99 comp.
        10  doc-adjcea                          pic s9(7)v99.
*        10  doc-adjcex                          pic s9(7)v99 comp.
        10  doc-adjcex                          pic s9(7)v99.
*        10  doc-ceicea                          pic s9(7)v99 comp.
        10  doc-ceicea                          pic s9(7)v99.
*        10  doc-ceicex                          pic s9(7)v99 comp.
        10  doc-ceicex                          pic s9(7)v99.
        10  ceicea-prt-format                   pic x(13).
        10  ceicex-prt-format                   pic x(13).
        10  ytdcea-prt-format                   pic x(13).
        10  ytdcex-prt-format                   pic x(13).
        10  doc-clinic-nbr-2                    pic 99.
        10  doc-clinic-nbr-3                    pic 99.
        10  doc-clinic-nbr-4                    pic 99.
        10  doc-clinic-nbr-5                    pic 99.
        10  doc-clinic-nbr-6                    pic 99.
        10  doc-spec-cd-2                       pic 99.
        10  doc-spec-cd-3                       pic 99.
*        10  doc-ytdinc-g                        pic s9(7)v99 comp.
        10  doc-ytdinc-g                        pic s9(7)v99.
    05  doc-locations.
        10  doc-loc-1                           pic x999.
        10  doc-loc-2                           pic x999.
        10  doc-loc-3                           pic x999.
        10  doc-loc-4                           pic x999.
        10  doc-loc-5                           pic x999.
        10  doc-loc-6                           pic x999.
        10  doc-loc-7                           pic x999.
        10  doc-loc-8                           pic x999.
        10  doc-loc-9                           pic x999.
        10  doc-loc-10                          pic x999.
        10  doc-loc-11                          pic x999.
        10  doc-loc-12                          pic x999.
        10  doc-loc-13                          pic x999.
        10  doc-loc-14                          pic x999.
        10  doc-loc-15                          pic x999.
        10  doc-loc-16                          pic x999.
        10  doc-loc-17                          pic x999.
        10  doc-loc-18                          pic x999.
        10  doc-loc-19                          pic x999.
        10  doc-loc-20                          pic x999.
        10  doc-loc-21                          pic x999.
        10  doc-loc-22                          pic x999.
        10  doc-loc-23                          pic x999.
        10  doc-loc-24                          pic x999.
        10  doc-loc-25                          pic x999.
        10  doc-loc-26                          pic x999.
        10  doc-loc-27                          pic x999.
        10  doc-loc-28                          pic x999.
        10  doc-loc-29                          pic x999.
        10  doc-loc-30                          pic x999.
    05  doc-locations-r  redefines  doc-locations.
        10  doc-loc     occurs 30 times         pic x999.
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  14
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f020_)
    05  doc-rma-expense-percent-misc            pic 9(5)v9(4) comp.
* 2004/03/03 - MC
*   05  filler2                                 pic x(8).
    05  doc-afp-paym-group                      pic x(4).
    05  filler2                                 pic x(4).
* 2004/030/03 - end
    05  doc-ind-pays-gst                        pic x.
    05  doc-nx-avail-batch                      pic 999.
* 2002/07/16 - MC - add 5 more next batch nbr for each clinic
    05  doc-nx-avail-batch-2                    pic 999.
    05  doc-nx-avail-batch-3                    pic 999.
    05  doc-nx-avail-batch-4                    pic 999.
    05  doc-nx-avail-batch-5                    pic 999.
    05  doc-nx-avail-batch-6                    pic 999.
** 2002/07/16 - end
*    05  doc-yrly-ceiling-computed               pic 9(7)v99 comp.
    05  doc-yrly-ceiling-computed               pic 9(7)v99.
*    05  doc-yrly-expense-computed               pic 9(7)v99 comp.
    05  doc-yrly-expense-computed               pic 9(7)v99.
    05  doc-rma-expense-percent-reg             pic 9(5)v9(4) comp.
    05  doc-sub-specialty                       pic x(15).
*    05  doc-payeft                              pic s9(7)v99 comp.
    05  doc-payeft                              pic s9(7)v99.
*    05  doc-ytdded                              pic s9(7)v99 comp.
    05  doc-ytdded                              pic s9(7)v99.
    05  doc-dept-expense-percent-misc           pic 9(5)v9(4) comp.
    05  doc-dept-expense-percent-reg            pic 9(5)v9(4) comp.
    05  doc-ep-ped                              pic s9(9) comp.
    05  doc-ep-pay-code                         pic x.
    05  doc-ep-pay-sub-code                     pic x.
    05  filler3                                 pic x(1).
    05  doc-ind-holdback-active                 pic x(1).
    05  group-regular-service                   pic x(4).
* 2002/09/23 - MC
*    05  group-regular-service                  pic x(4).
    05  group-over-serviced                     pic x(4).
* 2002/09/23 - end
    05  doc-specialties                         pic x(90).

*
    copy "f030_locations_mstr.fd".

* 1999/Apr/01 B.E. - added loc-ministry-loc-code and filler, adjusted rec length
* 1999/apr/27 B.E. - added loc-hospital-code field as contingency field in case
*                    it's needed as the current claim rec hospital field is
*                    only 1 character long and is now too small.
* 2001/Jan/26 A.A  - added loc-payroll-flag and decreased the filler to 14 char.
*                    This field used to HSC ONLY
* 2001/may/03 B.E. - redefined card-colour field to indicate it's real purpose
*                    of specifying in/out patient indicator
*                  - added 'active for entry' field
* 2006/apr/03 M.C. - include service location indicator (SLI)

fd  loc-mstr
*       index block contains 512 characters
*       data  block contains 37 characters
*             block contains 37 characters
*       record      contains 37 characters.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  15
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f030_)
              block contains 60 characters
        record      contains 60 characters.

01 loc-mstr-rec.
    05  loc-nbr                         pic x999.
    05  loc-nbr-r     redefines loc-nbr         pic x(4).

    05  loc-clinic-nbr                  pic 9(4).
    05  loc-hospital-nbr                pic 9(4).
    05  loc-hospital-code               pic x(4).

    05  loc-card-colour                 pic x(1).
    05  loc-in-out-ind redefines loc-card-colour
                                        pic x(1).

    05  loc-name                        pic x(24).
    05  loc-ministry-loc-code           pic 9(4).

    05  loc-payroll-flag                pic x(1).
    05  loc-active-for-entry            pic x(1).
* 2006/04/03 - MC
*   05  filler-reserved-for-nip         pic x(13).
    05  loc-service-location-indicator  pic x(4).
    05  filler-reserved-for-nip         pic x(9).
* 2006/04/03 - end

*
    copy "f040_oma_fee_mstr.fd".
* 98/dec/01 D.B.  - y2k
* 99/apr/28 B.E.  - split page (999) into page-alpha (xx) + page-numeric (999)
* 99/nov/30 B.E.  - correction to 'fee-page' definition in redefines
* 00/jul/31 B.E.  - fees changed from 9(5)v99 to 9(4)v999.
* 00/aug/01 B.E.  - added addition length to record for future expansion
*                 - add fee-active-for-entry y/n (1 byte)
*                 - add fee-min, fee-max (current/previous and oma/ohip)
*                                                        2*2*2*7 = 56 bytes)
*                 - add filler for growth -11 flags + 2  nbrs = 11*28 = 39 bytes
* 00/sep/05 B.E.  - add 'fee-global-addon-cd-exclusion-flag'
*
fd  oma-fee-mstr
*       block       contains 247 characters
*       record      contains 247 characters  .
        block       contains 315 characters
        record      contains 315 characters  .
*       feedback is feedback-oma-fee-mstr.

* insert this warning message from "f000_duplicate_fd_warning.fd
*----------------  note  -----------------------
*-- any changes to this fd must also be made  --
*-- to the corresponding "..._d001_..." fd    --
*-- and visa versa                            --
*----------------  note  -----------------------
01 fee-mstr-rec.
    05  fee-oma-cd.
        10  fee-oma-cd-ltr1                     pic x.
        10  filler                              pic 999.
    05  fee-special-m-suffix-ind                pic x.

* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  16
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f040_)
    05  fee-effective-date.
* y2k   10  fee-date-yy                         pic 99.
        10  fee-date-yy                         pic 9999.
        10  fee-date-mm                         pic 99.
        10  fee-date-dd                         pic 99.
* 00/aug/01 B.E.
    05  fee-active-for-entry                    pic x(1).


    05  fee-desc                                pic x(48).
    05  fee-current-prev-years.
*           (CURRENT rates)
*           (00/aug/01 B.E. - fees changed from 2 to 3 decimals)
        10  fee-curr-a-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-a-fee-2                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-fee-2                    pic s9(4)v999
                                        sign is leading .
*           (00/aug/01 B.E.)
        10  fee-curr-a-min              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-min              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-a-max              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-max              pic s9(4)v999
                                        sign is leading .

        10  fee-curr-a-anae                     pic 99.
        10  fee-curr-h-anae                     pic 99.
        10  fee-curr-a-asst                     pic 99.
        10  fee-curr-h-asst                     pic 99.

        10  fee-curr-add-on-codes.
            15  fee-curr-add-on-cd              pic x999    occurs 10 times.
        10  fee-curr-oma-ind-card-reqs.
            15  fee-curr-oma-ind-card-required  pic x       occurs  3 times.
* 99/apr/28
*       10  fee-curr-page                       pic 999.
        10  fee-curr-page.
            15 fee-curr-page-alpha              pic x(2).
            15 fee-curr-page-numeric            pic 999.

        10  fee-curr-add-on-perc-flat-ind       pic x.

*           (PREVIOUS rates)
*           (00/aug/01 B.E. - fees changed from 2 to 3 decimals)
        10  fee-prev-a-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-fee-2                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-fee-2                    pic s9(4)v999
                                        sign is leading .
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  17
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f040_)
*           (00/aug/01 B.E.)
        10  fee-prev-a-min              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-min              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-max              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-max              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-anae                     pic 99.
        10  fee-prev-h-anae                     pic 99.
        10  fee-prev-a-asst                     pic 99.
        10  fee-prev-h-asst                     pic 99.

        10  fee-prev-add-on-codes.
            15  fee-prev-add-on-cd              pic x999        occurs 10 times.
        10  fee-prev-oma-ind-card-reqs.
            15  fee-prev-oma-ind-card-required  pic x           occurs  3 times.
*       10  fee-prev-page                       pic 999.
        10  fee-prev-page.
            15 fee-prev-page-alpha              pic x(2).
            15 fee-prev-page-numeric            pic 999.
        10  fee-prev-add-on-perc-flat-ind       pic x.
    05  fee-current-prev-year-r redefines fee-current-prev-years.
* ---------------------- n o t e -------------------------
* ----- set up the following subscripts when using this file
* ----- set subscript  'curr' to 1  and  'prev' 2
        10  fee-years occurs 2 times.
* ----- set subscript  'oma' to 1  and  'ohip' to 2

            15  fee-1           occurs 2 times
*                                                       pic s9(5)v99
                                        pic s9(4)v999
                                        sign is leading.
            15  fee-2           occurs 2 times
*                                                       pic s9(5)v99
                                        pic s9(4)v999
                                        sign is leading.
*               (00/aug/01 B.E.)

*                 - fee-min, fee-max used only if "P" percentage based fee
            15  fee-min         occurs 2 times
                                        pic s9(4)v999
                                        sign is leading.
            15  fee-max         occurs 2 times
                                        pic s9(4)v999
                                        sign is leading.

            15  fee-anae        occurs 2 times
                                                pic 99.
            15  fee-asst        occurs 2 times
                                                pic 99.
            15  fee-add-on-codes.
                20  fee-add-on-cd               pic x999        occurs 10 times.
            15  fee-oma-ind-card-requireds.
                20  fee-oma-ind-card-required   pic x           occurs  3 times.
*y2k
*           15  fee-page                        pic 999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  18
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f040_)
            15  fee-page-alpha-numeric.
                20 fee-page-alpha               pic x(2).
                20 fee-page                     pic 9(3).

            15  fee-add-on-perc-or-flat-ind     pic x.

*       internal computer code (icc) -- used to perform price reductions
    05  fee-icc-code.
        10  fee-icc-sec                         pic xx.
        10  fee-icc-cat                         pic  9.
        10  fee-icc-grp                         pic 99.
        10  fee-icc-reduc-ind                   pic  9.
*       (diag ind = 'y' --> batch claim header diag cd must not = zero)
    05  fee-diag-ind                            pic x.
    05  fee-phy-ind                             pic x.
    05  fee-tech-ind                            pic x.
    05  fee-hosp-nbr-ind                        pic x.
    05  fee-i-o-ind                             pic x.
    05  fee-admit-ind                           pic x.
    05  fee-spec-fr                             pic 99.
    05  fee-spec-to                             pic 99.

*          (00/aug/01 B.E. filler for growth)
*           05  filler                                  pic x(39).
*       (00/sep/05 B.E.)
    05  fee-global-addon-cd-exclusion           pic x(01).
    05  filler                                  pic x(38).

*
    copy "f090_constants_mstr.fd".
* 99/Jan/29     MC      - change iconst-clinic-nbr from numeric to character
* 03/nov/05 b.e. - alpha doctor nbr
* 06/nov/08     MC      - include iconst-clinic-pay-batch-nbr

fd  iconst-mstr
*       index block contains   2 characters
              block contains 384 characters
        record      contains 384 characters  .
*       feedback is feedback-iconst-mstr.

01 iconst-mstr-rec.
    05  iconst-clinic-nbr-1-2                   pic   99.
*    05  iconst-clinic-nbr                      pic  9(4).
    05  iconst-clinic-nbr                       pic  x(4).
    05  iconst-clinic-name                      pic x(20).
    05  iconst-clinic-cycle-nbr                 pic   99.
    05  iconst-date-period-end.
* y2k   10  iconst-date-period-end-yy           pic   99.
        10  iconst-date-period-end-yy           pic   9999.
        10  iconst-date-period-end-mm           pic   99.
        10  iconst-date-period-end-dd           pic   99.
    05  iconst-clinic-addr.
        10  iconst-clinic-addr-l1               pic  x(25).
        10  iconst-clinic-addr-l2               pic  x(25).
        10  iconst-clinic-addr-l3               pic  x(25).
    05  iconst-clinic-addr-r redefines iconst-clinic-addr.
        10  iconst-clinic-addr                  pic x(25)   occurs  3  times.
    05  iconst-clinic-card-colour               pic    x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  19
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f090_)
    05  iconst-clinic-over-lim1                 pic 99v99.
    05  iconst-clinic-under-lim2                pic 99v99.
    05  iconst-clinic-under-lim3                pic 99v99.
    05  iconst-clinic-over-lim4                 pic 99v99.

*!    05  iconst-clinic-batch-nbr                 pic 9(6).
    05  iconst-clinic-batch-nbr                 pic x(6).

    05  iconst-reduction-factor                 pic 99v99.
    05  iconst-overpay-factor                   pic 99v99.
* 2006/11/08
*   05  filler                                  pic x(242).
    05  filler                                  pic x(106).
    05  iconst-clinic-pay-batch-nbr             pic x(6).
    05  filler                                  pic x(130).
* 2006/11/08 - end
*
    copy "f090_const_mstr_rec_3.ws".
01  constants-mstr-rec-3.
*
*       the percentage code for rma misc code 0 is stored on the
*       doctor record; misc codes 1 to 9 are stored on this
*       constants master record
*
*  dec 21/90 (b.m.l.) - increase all decimal places by 2 to allow for
*                       the g.s.t.
*
    05  const-rec-3-rec-nbr                             pic 99.
    05  const-percentages-misc-curr.
        10  const-misc-curr occurs 9 times              pic 9v9999.
    05  const-percentages-misc-curr-r redefines const-percentages-misc-curr.
        10  const-misc-1-curr                           pic 9v9999.
        10  const-misc-2-curr                           pic 9v9999.
        10  const-misc-3-curr                           pic 9v9999.
        10  const-misc-4-curr                           pic 9v9999.
        10  const-misc-5-curr                           pic 9v9999.
        10  const-misc-6-curr                           pic 9v9999.
        10  const-misc-7-curr                           pic 9v9999.
        10  const-misc-8-curr                           pic 9v9999.
        10  const-misc-9-curr                           pic 9v9999.
    05  const-percentages-misc-prev.
        10  const-misc-prev occurs 9 times              pic 9v9999.
    05  const-percentages-misc-prev-r redefines const-percentages-misc-prev.
        10  const-misc-1-prev                           pic 9v9999.
        10  const-misc-2-prev                           pic 9v9999.
        10  const-misc-3-prev                           pic 9v9999.
        10  const-misc-4-prev                           pic 9v9999.
        10  const-misc-5-prev                           pic 9v9999.
        10  const-misc-6-prev                           pic 9v9999.
        10  const-misc-7-prev                           pic 9v9999.
        10  const-misc-8-prev                           pic 9v9999.
        10  const-misc-9-prev                           pic 9v9999.
    05  filler                                          pic x(292).

*
* MC5
    copy "f040_dtl.fd".
* 2015/Mar/17  MC- this copybook is used in d004.cbl
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  20
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f040_)
* 2017/Mar/20  MC1 - include doc-nbr

fd  f040-dtl
* MC1
*       block       contains 7   characters
*       record      contains 7   characters.
        block       contains 10  characters
        record      contains 10  characters.

01 f040-dtl-rec.
    05  oma-dept.
        10  oma-cd                              pic x(4).
        10  dept-no                             pic 99.
* MC1
        10  oma-doc-nbr                         pic x(3).
* MC1 - end
    05  data-entry-flag                         pic x.



*
working-storage section.

77  err-ind                                     pic 99      value zero.
77  password-input                              pic x(3).
77  password                                    pic x(3)    value "RMA".
77  password-special-privledges                 pic x(3)    value "GCN".
77  reply                                       pic x.
77  change-reply                                pic x.

77  ws-batctrl-amt-act                          pic s9(6)v99.
77  ws-svc-posted                               pic 99.
77  ws-hold-posted-oma                          pic s9(6)v99.
77  ws-hold-50-perc                             pic s9(6)v99.
77  ws-posted-oma                               pic s9(6)v99.
77  ws-posted-ohip                              pic s9(6)v99.
77  ws-amt-tech                                 pic s9(6)v99.
77  abs-posted-oma                              pic 9(6)v99.
77  abs-posted-ohip                             pic 9(6)v99.
77  abs-amt-tech                                pic 9(6)v99.
77  ws-prof-oma                                 pic s9(6)v99.
77  ws-prof-ohip                                pic s9(6)v99.
77  ws-orig-total-svc                           pic 99.
77  ws-orig-oma                                 pic s9(6)v99.
77  ws-orig-ohip                                pic s9(6)v99.
77  ws-batctrl-amt-diff                         pic s9(5)v99.
77  ws-batctrl-svc-diff                         pic s9(5)v99.
*!77  ws-doc-nbr                                        pic 999.
77  ws-doc-nbr                                  pic xxx.
77  ws-doc-nbr-alpha                            pic xxx.
77  ws-file-err-msg                             pic x(42)  value spaces.
77  ws-flag-ok-to-adjust                        pic x.
77  ws-i-o-pat-ind                              pic x.
77  ws-oma-cd                                   pic x999.
77  ws-loc                                      pic xxxx.
77  ws-misc-code-perc                           pic 999v99.
77  hold-week                                   pic xx.
77  hold-day                                    pic x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  21
*                      d004.cbl                                      )
* (y2k - auto fix)
*77  hold-adjusted-clms-sv-date                 pic x(6).
77  hold-adjusted-clms-sv-date                  pic x(8).
* (y2k - auto fix)
*77  hold-adjusted-clms-de-date                 pic x(6).
77  hold-adjusted-clms-de-date                  pic x(8).
77  temp                                        pic s9(7)v99.
*
77  confirm-space                               pic x   value space.

* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*   note !!!! :  the size of this save area must be enlarged if the record
*                size of 'f001_batch_control_file' is increased
77  ws-save-batctrl-rec                         pic x(112).
* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

77  feedback-oma-fee-mstr                       pic x(4).

77  ws-save-batctrl-key                         pic x(9).
77  ws-save-batctrl-feedback                    pic x(4).

*mf77  ws-save-claims-header                    pic x(149).
77  ws-save-claims-header                       pic x(216).
77  ws-save-claims-feedback                     pic x(4).


01  ws-date.
* (y2k - auto fix)
*   05  ws-yy                                   pic 99.
    05  ws-yy                                   pic 9(4).
    05  ws-mm                                   pic 99.
    05  ws-dd                                   pic 99.

copy "def_agents.ws".
*
*    -----modification history------
*    date      who          what/why
* filename: def_agents.ws
*
* 90/jul/01  b. e.        - original
* 90/sep/10  b. e.        - added "4" to definition of direct bill
* 91/feb/11  m.c.  - sms 138 - use agent 2 for ohip wcb
* 95/oct/03  yas   - pdr 631 - use agent 5 for moh reduction
* 1999/Jun/18 S.B  - Combined Sick Kids and RMA agents.
* 2001/nov/06 B.E. - added agent 3 for ICU (revenue clinic 85) direct bills
* 2013/Jan/29 MC1  - since 2005/12/15 , agent 3 is no longer allowed

01  def-agent-code                              pic x(01).
    88 def-agent-ohip                   value "0".
    88 def-agent-in-pat-diag-billing    value "1".
    88 def-agent-ohip-wcb               value "2".
*    88 def-agent-3-not-used            value "3".
    88 def-agent-icu-direct-bill        value "3".
    88 def-agent-ohip-not-valid         value "4".
    88 def-agent-moh-reduction          value "5".
* 2013/01/29 - MC1
*    88 def-agent-bill-direct           value "6","4","3".
    88 def-agent-bill-direct            value "6","4".
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  22
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/def_a)
    88 def-agent-misc-payments          value "7".
    88 def-agent-alternate-funding      value "8".
    88 def-agent-wcb                    value "9".

    88 def-agent-ifhp-direct            value "x".
    88 def-agent-ontario-direct         value "x".
    88 def-agent-foreign-direct         value "x".
    88 def-agent-reciprocal             value "x".
    88 def-agent-quebec-direct          value "x".


copy "mth_desc_max_days.ws".
*
*       (each position contains:
*               - maximum nbr of days in month
*               - non-abreviated spelling of month
*               - nbr of julian days from jan-01 until last day of month
*       note: table does not take into consideration leap year)
*
01  month-descs-and-max-days-mth.
    05  mth-desc-max-days.
        10  filler                      pic x(14) value '31  JANUARY031'.
        10  filler                      pic x(14) value '29 FEBRUARY059'.
        10  filler                      pic x(14) value '31    MARCH090'.
        10  filler                      pic x(14) value '30    APRIL120'.
        10  filler                      pic x(14) value '31      MAY151'.
        10  filler                      pic x(14) value '30     JUNE181'.
        10  filler                      pic x(14) value '31     JULY212'.
        10  filler                      pic x(14) value '31   AUGUST243'.
        10  filler                      pic x(14) value '30SEPTEMBER273'.
        10  filler                      pic x(14) value '31  OCTOBER304'.
        10  filler                      pic x(14) value '30 NOVEMBER334'.
        10  filler                      pic x(14) value '31 DECEMBER365'.
    05  mth-desc-max-days-r   redefines mth-desc-max-days.
        10  mth-desc-max-days-occur     occurs  12  times.
            15  max-nbr-days            pic 99.
            15  mth-desc                pic x(9).
            15  nbr-julian-days-ytd     pic 9(3).


copy "sysdatetime.ws".
* 98/dec/01 D.B.        - y2k conversion
* 99/jan/13 B.E.        - changed sys-y1/y2 to y1 thru y4
*                       - added 'default-century-...' and century-date variables

01 century-year                                 pic 9(4).
01 century-date                                 pic 9(8).
01 default-century-cc                           pic 9(2) value 19.
01 default-century-cccc                         pic 9(4) value 1900.

01  sys-date.
* y2k    05  sys-date-long                              pic x(6).
    05  sys-date-long                           pic x(8).
    05  sys-date-long-r  redefines  sys-date-long.
* y2k   10  sys-yy                              pic 99.
        10  sys-yy                              pic 9999.
        10  sys-yy-alpha  redefines  sys-yy.
* y2k       15  sys-y1                          pic 9.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  23
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/sysda)
* y2k       15  sys-y2                          pic 9.
            15  sys-y1                          pic 9.
            15  sys-y2                          pic 9.
            15  sys-y3                          pic 9.
            15  sys-y4                          pic 9.
        10  sys-mm                              pic 99.
        10  sys-dd                              pic 99.
* remove after y2k upgrade of dgux
01  sys-date-numeric redefines sys-date         pic 9(8).
01  sys-date-y2kfix  redefines sys-date.
    05 sys-date-left                            pic x(6).
    05 filler                                   pic x(2).
01  sys-date-y2kfixed redefines sys-date.
    05 sys-date-blank                           pic x(2).
    05 sys-date-right                           pic x(6).
01  sys-date-temp                               pic x(8).

01  run-date.
* y2k    05  run-yy                                     pic 99.
    05  run-yy                                  pic 9999.
    05  filler                                  pic x   value "/".
    05  run-mm                                  pic 99.
    05  filler                                  pic x   value "/".
    05  run-dd                                  pic 99.

01  sys-time.
    05  sys-hrs                                 pic 99.
    05  sys-min                                 pic 99.
    05  sys-sec                                 pic 99.
    05  sys-hdr                                 pic 99.

01  run-time.
    05  run-hrs                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-min                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-sec                                 pic 99.

*
*  subscripts
*
77  ss                                          pic 99  comp.
77  ss-clmhdr                                   pic 99  comp.
77  ss-clmdtl-desc                              pic 99  comp.
77  ss-conseq-dd                                pic 99  comp.
77  ss-det-nbr                                  pic 99  comp.
77  ss-ind                                      pic 99  comp.
*

*
*       (maximum values or limits that may have to be changed
*               if record layouts are altered)
*
*77  ss-max-nbr-locs-in-doc-rec                 pic 99  comp    value  20.
77  ss-max-nbr-locs-in-doc-rec                  pic 99  comp    value  30.
77  ss-max-nbr-of-desc-rec-allow                pic 99  comp    value  5.


* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  24
*                      d004.cbl                                      )
*
*  feedback values for all indexed files
*
77  feedback-batctrl-file                       pic x(4).
77  feedback-claims-mstr                        pic x(4).
77  feedback-doc-mstr                           pic x(4).
77  feedback-loc-mstr                           pic x(4).
77  feedback-oma-mstr                           pic x(4).
77  feedback-iconst-mstr                        pic x(4).
*
*  eof flags
*
77  eof-filename-here                           pic x   value "N".
*
*  status file indicators
*
77  status-common                               pic x(2).
77  status-batctrl-file                         pic x(11)       value zero.
77  status-cobol-batctrl-file                   pic xx          value zero.
77  status-claims-mstr                          pic x(11)       value zero.
77  status-cobol-claims-mstr                    pic xx          value zero.
77  status-doc-mstr                             pic x(11)       value zero.
77  status-cobol-doc-mstr                       pic xx          value zero.
77  status-loc-mstr                             pic x(11)       value zero.
77  status-cobol-loc-mstr                       pic xx          value zero.
77  status-oma-mstr                             pic x(11)       value zero.
77  status-cobol-oma-mstr                       pic xx          value zero.
77  status-iconst-mstr                          pic x(11)       value zero.
77  status-cobol-iconst-mstr                    pic xx          value zero.
* MC5
77  status-cobol-f040-dtl                       pic xx          value zero.

*
*  keys (and/or record layouts) for all indexed files
*
*mf copy "f001_key_batctrl_file.ws".

*mf copy "f002_key_claims_mstr.ws".

01  claims-occur                                pic 9(12).

copy "f002_claims_mstr_rec1_2.ws".
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
*  yy/mm/dd  whom          why
*  --------  ----          ---
*
*  84/12/19  i.warsh       broke down the reference field so that
*                          each individual character could be looked at
*                          for direct bills.
*  90/09/27  b.elliott     added redefine for clmhdr-claim-source-cd
*
*  91/02/13  m. chan       clmhdr-tape-submit-ind is related to manual
*                          review flag.  if 'n' means manual review is
*                          on; ohterwise, if 'y' means manual review is
*                          off
*
*  91/04/17  m. chan       clmhdr-tape-submit-ind is related to claim
*                          status - 's'ubmit, 'r'esubmit or 'h'old
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  25
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*  98/01/26  m. chan       moved clmhdr-orig-batch-id after clmhdr-reserve-
*                          for-future
*  98/06/02  d. balmer     y2K date change
*  99/jan/21 B.E.  - added clmhdr-date-sys breakdown of -12 and -38 fields.
*  99/jan/25 B.E.  - added clmhdr-date-admit breakdown of -12 and -38 fields.
*  99/jan/25 B.E.  - added clmhdr-payroll redefine of clmhdr-hosp
*  03/aug/21 M.C.  - add 5 new elements to the files
*  03/nov/05 M.C.  - alpha doc nbr
*  04/jul/07 b.e.  - added  clmdtl-orig-doc-number
*                           clmdtl-orig-batch-number
*                           clmdtl-orig-claim-number
*  04/nov/18 M.C. - correct the redefinition of clmdtl-orig-complete-batch-n-r
*                   by including clmdtl-orig-clinic-number
*  07/jan/16 M.C. - change the definition of clmhdr-week/day from numeric to alp
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

* insert this warning message from "f002_duplicate_fd_warning.fd"

*+++++++++++++++W A R N I N G +++++++++++++++
*                                           *
* any changes to this fd must also be made  *
* to the other 3 in the following list:     *
*                                           *
*        "f002_claims_hdr_rec.ws            *
*        "f002_claims_dtl_rec.ws            *
*        "f002_claims_mstr_rec1_2.ws        *
*        "f002_clm_mstr_p_access.ws         *
*                                           *
*+++++++++++++++W A R N I N G +++++++++++++++

*
*       note 1: key for this file is the claim-id which is prefaced by a
*               1 character type field -- 'p' = patient id (i key)
*                                         'b' = batch nbr
*       note 2: - the claim detail data recs are written with valid oma
*                   codes, the detail description recs use an oma code of 'zzzz'
*                   and adjustment detail records use and 'adj-cd' of "1")

01  claim-header-rec.

    05  clmhdr-claim-id.
*!      10  clmhdr-batch-nbr                    pic 9(9).
        10  clmhdr-batch-nbr                    pic x(8).
        10  clmhdr-batch-nbr-r1 redefines clmhdr-batch-nbr.
            15  clmhdr-clinic-nbr-1-2           pic 99.
*!          15  clmhdr-doc-nbr                  pic 9(4).
            15  clmhdr-doc-nbr                  pic x(3).
*           15  clmhdr-week                     pic 99.
*           15  clmhdr-day                      pic 9.
            15  clmhdr-week                     pic xx.
            15  clmhdr-day                      pic x.
        10  clmhdr-batch-nbr-r2 redefines clmhdr-batch-nbr.
            15  filler                          pic xx.
*!          15  clmhdr-batch-nbr-3-6            pic 9(4).
            15  clmhdr-batch-nbr-3-6            pic x(3).
            15  clmhdr-batch-nbr-7-9            pic 999.
        10  clmhdr-claim-nbr                    pic 9(2).
        10  clmhdr-zeroed-oma-suff-adj.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  26
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
            15  clmhdr-adj-oma-cd               pic x999.
            15  clmhdr-adj-oma-suff             pic x.
            15  clmhdr-adj-adj-nbr              pic 9.
        10  clmhdr-zeroed-area redefines clmhdr-zeroed-oma-suff-adj
                                                pic 9(6).
*       (valid batch types are 'c' 'a' 'p')
    05  clmhdr-batch-type                       pic x.
*       ('clmhdr-card-colour' replaced by 'adjust-sub-type' --
    05  clmhdr-adj-cd-sub-type                  pic x.
    05  clmhdr-adj-cd-sub-type-ss redefines clmhdr-adj-cd-sub-type
                                                pic 9.
    05  clmhdr-claim-source-cd    redefines clmhdr-adj-cd-sub-type
                                                pic x.
    05  clmhdr-doc-nbr-ohip                     pic 9(6).
    05  clmhdr-doc-spec-cd                      pic 99.
    05  clmhdr-refer-doc-nbr                    pic 9(6).
    05  clmhdr-diag-cd                          pic 999.
    05  clmhdr-loc                              pic x999.

    05  clmhdr-hosp                             pic x.
    05  clmhdr-payroll redefines clmhdr-hosp    pic x.

    05  clmhdr-agent-cd                         pic 9.
    05  clmhdr-adj-cd                           pic x.
    05  clmhdr-tape-submit-ind                  pic x.
    05  clmhdr-i-o-pat-ind                      pic x.
    05  clmhdr-pat-ohip-id-or-chart.
        10  clmhdr-pat-key-type                 pic a.
        10  clmhdr-pat-key-data.
            15  clmhdr-pat-key-ohip             pic x(8).
            15  filler                          pic x(7).
    05  clmhdr-pat-acronym.
        10  clmhdr-pat-acronym6                 pic x(6).
        10  clmhdr-pat-acronym3                 pic x(3).
    05  clmhdr-reference.
        10  clmhdr-ref1                         pic x.
        10  clmhdr-ref2                         pic x.
        10  clmhdr-ref3                         pic x.
        10  clmhdr-ref4                         pic x.
        10  clmhdr-ref5                         pic x.
        10  clmhdr-ref6                         pic x.
        10  clmhdr-ref7                         pic x.
        10  clmhdr-ref8                         pic x.
        10  clmhdr-ref9                         pic x.
* y2k
        10  clmhdr-ref10                        pic x.
        10  clmhdr-ref11                        pic x.
    05  clmhdr-reference-r redefines clmhdr-reference.
        10  clmhdr-ref-date1.
* y2k
*           15  clmhdr-ref-date-yy                      pic 9(2).
            15  clmhdr-ref-date-yy              pic 9(4).
            15  clmhdr-ref-date-mm              pic 9(2).
            15  clmhdr-ref-date-dd              pic 9(2).
        10  clmhdr-ref-inits                    pic x(3).
    05  clmhdr-reference-r1 redefines clmhdr-reference-r.
        10  filler                              pic x.
* y2k
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  27
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
*       10  clmhdr-ref-date2                            pic x(6).
        10  clmhdr-ref-date2                    pic x(8).
        10  filler                              pic x(2).
    05  clmhdr-reference-r2 redefines clmhdr-reference-r1.
        10  filler                              pic x(2).
* y2k
*       10  clmhdr-ref-date3                            pic x(6).
        10  clmhdr-ref-date3                    pic x(8).
        10  filler                              pic x(1).
    05  clmhdr-reference-r3 redefines clmhdr-reference-r2.
        10  filler                              pic x(3).
* y2k
*       10  clmhdr-ref-date4                            pic x(6).
        10  clmhdr-ref-date4                    pic x(8).
    05  clmhdr-date-admit.
*           (note - admit-yy must be left alpha-numeric)
* y2k
*       10  clmhdr-date-admit-yy                        pic xx.
        10  clmhdr-date-admit-yy                pic x(4).
        10  clmhdr-date-admit-yy-r redefines
            clmhdr-date-admit-yy.
            15  clmhdr-date-admit-yy-12         pic xx.
            15  clmhdr-date-admit-yy-34         pic xx.
        10  clmhdr-date-admit-mm                pic 99.
        10  clmhdr-date-admit-mm-r redefines clmhdr-date-admit-mm
                                                pic xx.
        10  clmhdr-date-admit-dd                pic 99.
        10  clmhdr-date-admit-dd-r redefines clmhdr-date-admit-dd
                                                pic xx.
    05  clmhdr-date-admit-r redefines clmhdr-date-admit
* y2k                                                pic 9(6).
                                                pic 9(8).
    05  clmhdr-date-admit-r2 redefines clmhdr-date-admit-r.
        10 clmhdr-date-admit-12                 pic 9(2).
        10 clmhdr-date-admit-38                 pic 9(6).
    05  clmhdr-doc-dept                         pic 99.
* y2k    05  clmhdr-date-cash-tape-payment           pic x(6).
    05  clmhdr-date-cash-tape-payment           pic x(8).
    05  clmhdr-date-cash-tape-paymt-r redefines
        clmhdr-date-cash-tape-payment.
        10  clmhdr-date-cash-tape-paymt-12      pic 9(2).
        10  clmhdr-date-cash-tape-paymt-38      pic 9(6).
    05  clmhdr-direct-bills-clm-info  redefines clmhdr-date-cash-tape-payment.
        10  clmhdr-msg-nbr                      pic xx.
        10  clmhdr-reprint-flag                 pic x.
        10  clmhdr-sub-nbr                      pic x.
        10  clmhdr-auto-logout                  pic x.
        10  clmhdr-fee-complex                  pic x.
        10  filler                              pic xx.
    05  clmhdr-curr-payment                     pic s9(5)v99.

    05  clmhdr-date-period-end.
* y2k
*       10  clmhdr-period-end-yy                        pic 99.
        10  clmhdr-period-end-yy                pic 9(4).
        10  clmhdr-period-end-mm                pic 99.
        10  clmhdr-period-end-dd                pic 99.
    05  clmhdr-cycle-nbr                        pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  28
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
* y2k
*   05  clmhdr-date-sys                                 pic x(6).
    05  clmhdr-date-sys                         pic x(8).
    05  clmhdr-date-sys-r redefines clmhdr-date-sys.
        10  clmhdr-date-sys-12                  pic 9(2).
        10  clmhdr-date-sys-38                  pic 9(6).
    05  clmhdr-amt-tech-billed                  pic s9(4)v99.
    05  clmhdr-amt-tech-paid                    pic s9(4)v99.
    05  clmhdr-tot-claim-ar-oma                 pic s9(5)v99.
    05  clmhdr-tot-claim-ar-ohip                pic s9(5)v99.
    05  clmhdr-manual-and-tape-paymnts          pic s9(5)v99.
    05  clmhdr-status-ohip                      pic xx.

    05  clmhdr-manual-review                    pic x.
    05  clmhdr-submit-date.
* y2k
*       10  clmhdr-submit-yy                            pic 99.
        10  clmhdr-submit-yy                    pic 9(4).
        10  clmhdr-submit-mm                    pic 99.
        10  clmhdr-submit-dd                    pic 99.
    05  clmhdr-confidential-flag                pic x.
* y2k
*   05  clmhdr-serv-date                                pic 9(6).
    05  clmhdr-serv-date                        pic 9(8).
*
* (y2k removed)
*           05  clmhdr-reserve-for-future               pic x(6).

* 2003/08/21 - add 4 new items
    05  clmhdr-elig-error                       pic x(3).
    05  clmhdr-elig-status                      pic x.
    05  clmhdr-serv-error                       pic x(3).
    05  clmhdr-serv-status                      pic x.
* 2003/08/21 - end

    05  clmhdr-orig-batch-id.
        10  clmhdr-orig-batch-nbr.
            15  clmhdr-orig-batch-nbr-1-2       pic  99.
*!          15  clmhdr-orig-batch-nbr-3         pic   9.
*!          15  clmhdr-orig-batch-nbr-4-9       pic 9(6).
            15  clmhdr-orig-batch-nbr-4-9       pic x(6).
        10  clmhdr-orig-batch-nbr-next-def      redefines clmhdr-orig-batch-nbr.
            15  filler                          pic  99.
*!          15  filler                          pic   9.
*!          15  clmhdr-orig-batch-nbr-4-6       pic 9(3).
            15  clmhdr-orig-batch-nbr-4-6       pic x(3).
            15  clmhdr-orig-batch-nbr-7-8       pic  99.
            15  clmhdr-orig-batch-nbr-9         pic   9.
        10  clmhdr-orig-claim-nbr               pic  99.
    05  clmhdr-orig-batch-id-r  redefines clmhdr-orig-batch-id.
*!      10  clmhdr-orig-complete-batch-nbr      pic 9(11).
        10  clmhdr-orig-complete-batch-nbr      pic x(10).
*mf moved external keys into data record
*mfcopy "f002_key_claims_mstr_mf.ws" replacing "key-clm-" by "clmhdr-b-".
*-------------------
05  k-clmhdr-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  29
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
    20  k-clmhdr-b-key-type                        pic x.
    20  k-clmhdr-b-data.
*!      25  k-clmhdr-b-batch-num                   pic 9(9).
        25  k-clmhdr-b-batch-num                   pic x(8).
        25  k-clmhdr-b-batch-nbr redefines k-clmhdr-b-batch-num.
            30  k-clmhdr-b-clinic-nbr-1-2          pic 99.
*!          30  k-clmhdr-b-doc-nbr                 pic 9(4).
            30  k-clmhdr-b-doc-nbr                 pic x(3).
            30  k-clmhdr-b-doc-nbr-r redefines k-clmhdr-b-doc-nbr.
*!              35  k-clmhdr-b-doc-nbr-1           pic 9.
*!              35  k-clmhdr-b-doc-nbr-2-4         pic 999.
                35  k-clmhdr-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  k-clmhdr-b-batch-number.
                35  k-clmhdr-b-week                pic 99.
                35  k-clmhdr-b-day                 pic 9.
        25  k-clmhdr-b-claim-nbr                   pic 99.
        25  k-clmhdr-b-oma-cd                      pic x999.
        25  k-clmhdr-b-oma-suff                    pic x.
        25  k-clmhdr-b-adj-nbr                     pic x.
    20  k-clmhdr-b-data-r  redefines  k-clmhdr-b-data.
        25  k-clmhdr-b-pat-id                      pic x(15).
*!      25  filler                                 pic xx.
        25  filler                                 pic x.

*mf10  k-clmhdr-p-claims-mstr.
05  k-clmhdr-p-claims-mstr.
    20  k-clmhdr-p-key-type                        pic x.
    20  k-clmhdr-p-data.
        25  k-clmhdr-p-batch-nbr.
            30  k-clmhdr-p-clinic-nbr-1-2      pic  99.
*!          30  k-clmhdr-p-doc-nbr             pic 9(4).
            30  k-clmhdr-p-doc-nbr             pic x(3).
            30  k-clmhdr-p-week                pic 99.
            30  k-clmhdr-p-day                 pic 9.
        25  k-clmhdr-p-claim-nbr               pic 99.
        25  k-clmhdr-p-oma-cd                  pic x999.
        25  k-clmhdr-p-oma-suff                pic x.
        25  k-clmhdr-p-adj-nbr                 pic x.
*-------------------------

01  claim-detail-rec.

    05  clmdtl-id.
*!      10  clmdtl-batch-nbr                    pic 9(9).
        10  clmdtl-batch-nbr                    pic x(8).
        10  clmdtl-claim-nbr                    pic 9(2).
        10  clmdtl-oma-cd                       pic xxxx.
        10  clmdtl-oma-suff                     pic x.
        10  clmdtl-adj-nbr                      pic 9.

    05  clmdtl-det-rec.
        10  clmdtl-rev-group-cd                 pic xxx.
        10  clmdtl-agent-cd                     pic 9.
        10  clmdtl-adj-cd                       pic x.
        10  clmdtl-nbr-serv                     pic 99.
        10  clmdtl-nbr-serv-r redefines clmdtl-nbr-serv.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  30
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
            15  clmdtl-adjust-reprint           pic x.
            15  filler                          pic x.
        10  clmdtl-sv-date.
* y2k            15  clmdtl-sv-yy                    pic 99.
            15  clmdtl-sv-yy                    pic 9999.
            15  clmdtl-sv-mm                    pic 99.
            15  clmdtl-sv-dd                    pic 99.

        10  clmdtl-consec-dates.
            15  clmdtl-consecutive-sv-date  occurs 3 times
                                                pic 999.
        10  clmdtl-consec-dates-r  redefines  clmdtl-consec-dates.
            15  clmdtl-consecutive-dates    occurs 3 times.
                20  clmdtl-sv-nbr               pic  9.
                20  clmdtl-sv-day               pic xx.

        10  clmdtl-amt-tech-billed              pic s9(4)v99.
        10  clmdtl-fee-oma                      pic s9(5)v99.
        10  clmdtl-fee-ohip                     pic s9(5)v99.
* y2k        10  clmdtl-date-period-end              pic x(6).
        10  clmdtl-date-period-end              pic x(8).
        10  clmdtl-cycle-nbr                    pic 999.

        10  clmdtl-diag-cd                      pic 999.
        10  clmdtl-line-no                      pic 99.
* (y2k)
*       10  clmdtl-reserve-for-future                   pic x(8).
* 2003/08/21 - MC
*      10  clmdtl-reserve-for-future           pic x(4).
       10  clmdtl-resubmit-flag                pic x.
       10  clmdtl-reserve-for-future           pic x(3).
* 2003/08/21 - end

    05  clmdtl-desc-rec redefines clmdtl-det-rec.
        10  clmdtl-desc                         pic x(22).
        10  filler                              pic x(42).
*mf
*   05  clmdtl-filler                                   pic x(88).
* 2003/08/21 - MC
*   05  clmdtl-filler                           pic x(96).
    05  clmdtl-filler                           pic x(104).
* 2003/08/21 - end

    05  clmdtl-orig-batch-id.
*!      10  clmdtl-orig-batch-nbr               pic 9(9).
        10  clmdtl-orig-batch-nbr               pic x(8).
        10  clmdtl-orig-batch-nbr-r redefines clmdtl-orig-batch-nbr.
            15  clmdtl-orig-batch-nbr-1-2       pic 99.
*!          15  clmdtl-orig-batch-nbr-3         pic 9.
*!          15  clmdtl-orig-batch-nbr-4-9       pic 9(6).
            15  clmdtl-orig-batch-nbr-4-9       pic x(6).
        10  clmdtl-orig-claim-nbr-in-batch      pic 99.
    05  clmdtl-orig-batch-id-r  redefines clmdtl-orig-batch-id.
*!      10  clmdtl-orig-complete-batch-nbr      pic 9(11).
        10  clmdtl-orig-complete-batch-nbr      pic 9(10).
        10  clmdtl-orig-complete-batch-n-r redefines clmdtl-orig-complete-batch-
* 2004/11/18 - MC - include clinic nbr
            15  clmdtl-orig-clinic-number       pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  31
*                      d004.cbl (/alpha/rmabill/rmabill101c/use/f002_)
* 2004/11/18 - end
            15  clmdtl-orig-doc-number          pic x(3).
            15  clmdtl-orig-batch-number        pic 9(3).
            15  clmdtl-orig-claim-number        pic 9(2).

*mf moved external keys into data record
*mfcopy "f002_key_claims_mstr_mf.ws" replacing "key-clm-" by "clmdtl-b-".
*-------------------
05  k-clmdtl-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  k-clmdtl-b-key-type                        pic x.
    20  k-clmdtl-b-data.
*!      25  k-clmdtl-b-batch-num                   pic 9(9).
        25  k-clmdtl-b-batch-num                   pic x(8).
        25  k-clmdtl-b-batch-nbr redefines k-clmdtl-b-batch-num.
            30  k-clmdtl-b-clinic-nbr-1-2          pic 99.
*!          30  k-clmdtl-b-doc-nbr                 pic 9(4).
            30  k-clmdtl-b-doc-nbr                 pic x(3).
            30  k-clmdtl-b-doc-nbr-r redefines k-clmdtl-b-doc-nbr.
*!              35  k-clmdtl-b-doc-nbr-1           pic 9.
*!              35  k-clmdtl-b-doc-nbr-2-4         pic 999.
                35  k-clmdtl-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  k-clmdtl-b-batch-number.
                35  k-clmdtl-b-week                pic 99.
                35  k-clmdtl-b-day                 pic 9.
        25  k-clmdtl-b-claim-nbr                   pic 99.
        25  k-clmdtl-b-oma-cd                      pic x999.
        25  k-clmdtl-b-oma-suff                    pic x.
        25  k-clmdtl-b-adj-nbr                     pic x.
    20  k-clmdtl-b-data-r  redefines  k-clmdtl-b-data.
        25  k-clmdtl-b-pat-id                      pic x(15).
*!      25  filler                                 pic xx.
        25  filler                                 pic x.

*mf10  k-clmdtl-p-claims-mstr.
05  k-clmdtl-p-claims-mstr.
    20  k-clmdtl-p-key-type                        pic x.
    20  k-clmdtl-p-data.
        25  k-clmdtl-p-batch-nbr.
            30  k-clmdtl-p-clinic-nbr-1-2      pic  99.
*!          30  k-clmdtl-p-doc-nbr             pic 9(4).
            30  k-clmdtl-p-doc-nbr             pic x(3).
            30  k-clmdtl-p-week                pic 99.
            30  k-clmdtl-p-day                 pic 9.
        25  k-clmdtl-p-claim-nbr               pic 99.
        25  k-clmdtl-p-oma-cd                  pic x999.
        25  k-clmdtl-p-oma-suff                pic x.
        25  k-clmdtl-p-adj-nbr                 pic x.
*-------------------------



01  key-loc-mstr.
    05  key-loc-nbr                             pic x(6).

* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  32
*                      d004.cbl                                      )
01  key-oma-fee-mstr.
    05  key-oma-cd                              pic x(4).

01 const-mstr-rec-nbr                           pic 99.





01  option                                      pic x.
    88  new-batch                               value "1".
    88  old-batch                               value "2".
    88  stop-option                             value "*".

01  flag                                        pic x.
    88 ok                                       value "Y".
    88 not-ok                                   value "N".

    88  invalid-ohip                            value "N".
    88  invalid-chart                           value "N".

01  flag-err-data                               pic x.
    88  err-data                                value "N".
    88  ok-data                                 value "Y".

01  flag-dummy-claim-id                         pic x.
    88  dummy-claim-id-required                 value "Y".

01  flag-eoj                                    pic x.
    88  eoj                                     value "E".

01  flag-dup-key-status                         pic x(4).
    88  duplicate-key                           value "0100".


*   counters for records read/written for all input/output files


01  counters.
    05  ctr-read-batctrl-file                   pic 9(7).
    05  ctr-read-claims-mstr                    pic 9(7).
    05  ctr-read-doc-mstr                       pic 9(7).
    05  ctr-read-loc-mstr                       pic 9(7).
    05  ctr-read-oma-mstr                       pic 9(7).
    05  ctr-read-const-mstr                     pic 9(7).

    05  ctr-writ-batctrl-file                   pic 9(7).
    05  ctr-writ-claims-mstr                    pic 9(7).

    05  ctr-rewrit-batctrl-file                 pic 9(7).
    05  ctr-rewrit-claims-mstr                  pic 9(7).
    05  ctr-rewrit-const-mstr                   pic 9(7).
    05  ctr-del-batctrl-file                    pic 9(7).


01  error-message-table.

    05  error-messages.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  33
*                      d004.cbl                                      )
* msg #1
        10  filler                              pic x(60)   value
                "INVALID REPLY".
        10  filler                              pic x(60)   value
                "NO SUCH ADJUSTMENT BATCH EXISTS IN THE BATCH CONTROL FILE".
        10  filler                              pic x(60)   value
                "INVALID PASSWORD".
        10  filler                              pic x(60)   value
                "FATAL ERROR #1 !! -- LAST CLAIM IN BATCH NOT FOUND".
        10  filler                              pic x(60)   value
                "INVALID DATE".
        10  filler                              pic x(60)   value
                "FATAL ERROR #2 !! - DETAIL REC FOUND BUT NOT HEADER REC".
        10  filler                              pic x(60)   value
                "'M' AND 'R' TRANSACTIONS REQUIRE A VALID DOCTOR NBR".
        10  filler                              pic x(60)   value
                "ZERO CLAIM NBR ALLOWED ONLY FOR TRANSACTION CODE 'M' OR 'R'".
        10  filler                              pic x(60)   value
                "FATAL ERROR #3 !! -- BATCH'S DOCTOR NOT FOUND IN DOC MSTR".
* msg #10
        10  filler                              pic x(60)   value
                "NO SUCH CLAIM NBR ON FILE".
        10  filler                              pic x(60)   value
                "'A'DJUSTMENT BATCH TRANSACTION CODES ARE 'A', 'B', AND 'R'".
        10  filler                              pic x(60)   value
                "'P'AYMENT BATCH TRANSACTION CODES ARE 'C', AND 'M'".
        10  filler                              pic x(60)   value
                "ATTEMPT TO ADJUST CLAIM THAT HASN'T 'GONE TO OHIP' YET".
        10  filler                              pic x(60)   value
                "BATCH TYPE MUST BE 'P'AYMENT , OR 'A'DJUSTMENT".
        10  filler                              pic x(60)   value
                "INVALID WEEK NUMBER IN BATCH ID".
        10  filler                              pic x(60)   value
                "INVALID DAY IN BATCH ID".
        10  filler                              pic x(60)   value
                "NON-ZERO AMOUNT REQUIRED".
        10  filler                              pic x(60)   value
                "FATAL ERROR #4 !! - MAX. OF 99 CLAIMS PER BATCH REACHED".
        10  filler                              pic x(60)   value
                "BATCH ALREADY EXISTS".
* msg #20
        10  filler                              pic x(60)   value
                "INVALID 2 DIGIT CLINIC IDENTIFIER".
        10  filler                              pic x(60)   value
                "SERIOUS ERROR #5 !! - INVALID CLAIMS MSTR INDEX POINTER".
        10  filler                              pic x(60)   value
                "CLAIM AGENT CODE = 'OHIP' -- BUT PATIENT'S OHIP # IS INVALID".
        10  filler                              pic x(60)   value
                "NO CLAIMS ALLOWED - PATIENT OHIP STATUS = 'J2','J8', OR 'K1'".
        10  filler                              pic x(60)       value
                "NO CLAIMS ALLOWED - PATIENT OHIP STATUS = K4,K5,K6,K7, OR K9".
        10  filler                              pic x(60)       value
                "IN/OUT PATIENT INDICATOR MUST BE 'I' OR 'O'".
        10  filler                              pic x(60)       value
                "ZERO PERCENTAGE FOUND FOR MISCELLANEOUS PAY CODE".
        10  filler                              pic x(60)       value
                "SURNAME INPUT NOT = SURNAME OF PATIENT ON FILE".
        10  filler                              pic x(60)       value
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  34
*                      d004.cbl                                      )
                "INVALID OMA CODE".
        10  filler                              pic x(60)       value
                "FATAL ERROR #6 !! - INVALID WRITE CLAIMS HEADER WRITE #1".
* msg #30
        10  filler                              pic x(60)       value
                "FATAL ERROR #7 !! - INVALID WRITE CLAIMS HEADER WRITE #2".
        10  filler                              pic x(60)       value
                "FATAL ERROR #8 !! - INVALID WRITE CLAIMS DETAIL INDX #1".
        10  filler                              pic x(60)       value
                "FATAL ERROR #9 !! -- INVALID WRITE CLAIMS DETAIL INDX #2".
        10  filler                              pic x(60)       value
                "AGENT OF REC TO BE ADJUSTED DIFFERS FROM BATCH BEING ENTERED".
        10  filler                              pic x(60)       value
                "FATAL ERROR #10 !! - ERROR RE-WRITING UPDATED CLAIM HEADER".
        10  filler                              pic x(60)       value
                "FATAL ERROR #11 !! - ERROR IN WRITING TO BATCH CONTROL FILE".
        10  filler                              pic x(60)       value
                "FATAL ERROR #12 ! - ERROR RE-WRITING ADJ. CLAIM'S BACTRL REC".
        10  filler                              pic x(60)       value
                "FATAL ERROR #13 !! - ERROR IN DELETING BATCH CONTROL RECORD".
        10  filler                              pic x(60)       value
                "MAXIMUM OF 99 ENTRIES HAVE BEEN INPUT FOR BATCH - SHUT DOWN".
        10  filler                              pic x(60)       value
                "NEXT CLAIM NBR ALREADY EXISTS !! -- START NEW BATCH NBR".
* msg #40
        10  filler                              pic x(60)   value
                "FATAL ERROR #14!! -- CAN'T READ ADJUSTED CLAIM'S HDR AGAIN".
        10  filler                              pic x(60)       value
                "UNABLE TO ACCESS BATCH -- STATUS IS NOT UNBALANCED/BALANCED".
        10  filler                              pic x(60)       value
                "FATAL ERROR !! - ERROR READING CONSTANTS MSTR RECORD 3".
        10  filler                              pic x(60)       value
                "OMA VALUE SUPPLIED ALTERED BY OVER 50% OF ORIGINAL VALUE".
        10  filler                              pic x(60)       value
                "OMA VALUE CAN NOT BE ZERO".
* msg #45
        10  filler                              pic x(60)       value
                "TECH Portion exceeds both Adjustment/Original $ amount".
        10  filler                              pic x(60)       value
                "Tech Portion exceeds either OMA/OHIP $ amount".
        10  filler                              pic x(60)       value
                "Invalid Technical portion entered".
        10  filler                              pic x(60)       value
                "BATCTRL Amt > 99999.99, Re-enter the adj in a new batch".
* 2011/11/16 - MC1
        10  filler                              pic x(60)       value
* MC6
*               "Doctor has terminated, please verify".
                "Doctor has terminated within 6 months, please verify".
* MC6 - end
* 2011/11/16 - end
* 2012/11/14 - MC2
        10  filler                              pic x(60)       value
                "Estimated batch amount not equal to Actual batch amount".
* 2012/11/14 - end
* 2013/08/27 - MC3
        10  filler                              pic x(60)       value
                "Doctor has not assigned to the selected clinic nbr".
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  35
*                      d004.cbl                                      )
* 2012/11/14 - end
* MC5
        10  filler                              pic x(60)       value
* MC7
*               "Not valid for Miscellaneous Payment for oma/dept  ".
                "Not valid for Miscellaneous Payment for oma/dept/doc  ".
* MC7 - end
* MC5 - end
* MC6
        10  filler                              pic x(60)       value
                "Doctor has terminated > 6 months, please verify".
* MC6 - end
    05  error-messages-r redefines error-messages.
        10  err-msg                             pic x(60)
                        occurs 53 times.

01  err-msg-comment                             pic x(60).

01  e1-error-line.

    05  e1-error-word                           pic x(13)    value
                        "***  ERROR - ".
    05  e1-error-msg                            pic x(119).
screen section.

01  scr-title-batch-control-data.

    05  blank screen.
    05  line 01 col 01 value is "D004A".
    05  line 01 col 25 value is "ADJUSTMENT/PAYMENT BATCH DATA ENTRY".
* (y2k - auto fix)
*   05  line 01 col 73 pic 9(2) using sys-yy.
    05  line 01 col 71 pic 9(4) using sys-yy.
    05  line 01 col 75 value "/".
    05  line 01 col 76 pic 99 using sys-mm.
    05  line 01 col 78 value "/".
    05  line 01 col 79 pic 99 using sys-dd.
*
01  scr-old-or-new-batch-option.

    05  line 03 col 29 value "1 -CREATE NEW BATCH".
    05  line 04 col 29 value "2 -CONTINUE EXISTING BATCH".
    05  line 06 col 36 value "OPTION -".
    05  scr-option      line 06 col 45 pic x to option auto required.
*
01  scr-acpt-batch-type.

    05                          line 07 col 01 value "BATCH TYPE".
    05  scr-batctrl-batch-type  line 07 col 14 pic x using batctrl-batch-type au
*
01  scr-acpt-batch-nbr.

    05                          line 08 col 01 value "BATCH NUMBER".
    05  scr-batctrl-clinic-nbr-1-2
                                line 08 col 14 pic  99  using batctrl-bat-clinic
                                                                           auto.
    05  scr-batctrl-doc-nbr
*!                              line 08 col 17 pic 999  using batctrl-bat-doc-nb
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  36
*                      d004.cbl                                      )
                                line 08 col 17 pic xxx  using batctrl-bat-doc-nb
    05  scr-batctrl-week        line 08 col 21 pic  99  using batctrl-bat-week
    05  scr-batctrl-day         line 08 col 23 pic   9  using batctrl-bat-day

01  scr-val-batch-period-cycle.

    05                  line 08 col 27 value "PERIOD END DATE".
    05  scr-period-ends-yy
* (y2k - auto fix)
*                       line 08 col 45 pic 99 using batctrl-date-period-end-yy
                        line 08 col 43 pic 9(4) using batctrl-date-period-end-yy
                                                auto.
    05                  line 08 col 47 value "/".
    05  scr-period-ends-mm
                        line 08 col 48 pic 99 using batctrl-date-period-end-mm
                                        auto.
    05                  line 08 col 50 value "/".
    05  scr-period-ends-dd
                        line 08 col 51 pic 99 using batctrl-date-period-end-dd
                                        auto.
    05                  line 08 col 60 value "CYCLE NUMBER".
    05  scr-cycle-nbr   line 08 col 73 pic 99 using batctrl-cycle-nbr
                                        auto.
*
01  scr-acpt-mask.

    05                          line 13 col 01 value "CLINIC NUMBER".
    05  scr-batctrl-clinic-nbr  line 13 col 18 pic 9999 using batctrl-clinic-nbr
    05                          line 15 col 01 value "TRANSACTION CODE".
    05  scr-batctrl-adj-cd      line 15 col 18 pic x using batctrl-adj-cd auto.
    05                          line 17 col 01 value "AGENT CODE".
    05  scr-batctrl-agent-cd    line 17 col 18 pic 9 using batctrl-agent-cd auto
    05                          line 19 col 01 value "LOCATION".
    05  scr-batctrl-loc         line 19 col 18 pic x999 using batctrl-loc auto.
*
01  scr-lit-batctrl-data.

    05                  line 11 col 41 value "- BATCH CONTROL INFORMATION -".
    05                  line 13 col 31 value "ESTIMATED $ AMOUNT =".
    05                  line 15 col 31 value "ACTUAL    $ AMOUNT =".
    05                  line 15 col 64 value "OUT BY".
*
01  scr-val-batctrl-data.

    05  scr-amt-est
                        line 13 col 52 pic zz,zz9.99- using batctrl-amt-est.
    05  scr-amt-act
                        line 15 col 52 pic zz,zz9.99- using batctrl-amt-act.
    05  scr-amt-diff
                        line 15 col 71 pic zz,zz9.99- using ws-batctrl-amt-diff.
*
01  scr-acpt-change-verification.

    05                  line 22 col 25 value "CHANGE BATCH CONTROL".
    05                  line 22 col 46 value "INFORMATION (Y/N)".
    05                  line 22 col 65 pic x to change-reply auto.

01  scr-acpt-change-password.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  37
*                      d004.cbl                                      )
    05                  line 22 col 69 value "PASSWORD".
    05                  line 22 col 78 pic xxx to password-input
                                                        auto secure.


01  scr-title-claim-rec-data.

    05  blank screen.
    05  line 01 col 01 value is "D004B".
    05  line 01 col 31 value is "ADJUSTMENT/PAYMENT BATCH DATA ENTRY".
* (y2k - auto fix)
*   05  line 01 col 73 pic 99 using sys-yy.
    05  line 01 col 71 pic 9(4) using sys-yy.
    05  line 01 col 75 value "/".
    05  line 01 col 76 pic 99 using sys-mm.
    05  line 01 col 78 value "/".
    05  line 01 col 79 pic 99 using sys-dd.
*
01  scr-acpt-clmhdr.

    05                    line 03 col 01 value "CLAIM CONTROL -  CLAIM ID :".
    05                    line 03 col 29 pic  99  using clmhdr-orig-batch-nbr-1-
* MC7
*   05                    line 03 col 31 pic 9(6) using clmhdr-orig-batch-nbr-4-
    05                    line 03 col 31 pic x(6) using clmhdr-orig-batch-nbr-4-
* MC7 - end
    05                    line 03 col 39 value "-".
    05                    line 03 col 40 pic 99 using clmhdr-orig-claim-nbr.
    05                    line 05 col 01        value "TRANSACTION CODE :".
    05  scr-adj-cd        line 05 col 19 pic x    using batctrl-adj-cd auto.
    05                    line 05 col 25        value "LOCATION :".
    05  scr-clmhdr-loc    line 05 col 36 pic x999 using clmhdr-loc auto.
    05                    line 05 col 45                value "EXPLANATION".
    05  scr-reference     line 05 col 57 pic x(9) using clmhdr-reference auto.

01  scr-acpt-clmhdr-tit-1.
    05                  line 07 col 08 value "-- B A T C H  N U M B E R --".
    05                  line 07 col 40 value "(ORIGINAL  VALUES  SHOWN  IN  BRAC
    05                  line 08 col 01 value "CLINIC DOC# WEEK DAY CLM# ".
    05                  line 08 col 27 value "OMA  SUFF  DOC#        OHIP AMOUNT
    05                  line 08 col 64 value "OMA AMOUNT".

01  scr-acpt-clmhdr-dtl-1.
    05  scr-hdr-clinic-nbr-1-2  line 10 col 03 pic  99  using clmhdr-clinic-nbr-
    05  scr-hdr-doc-nbr         line 10 col 08 pic xxx  using ws-doc-nbr-alpha a
    05  scr-hdr-week            line 10 col 14 pic  99  using clmhdr-week auto.
    05  scr-hdr-day             line 10 col 19 pic   9  using clmhdr-day  auto.
    05                          line 10 col 21 value "-".
    05  scr-hdr-claim-nbr       line 10 col 23 pic  99  using clmhdr-claim-nbr a
    05  scr-hdr-oma-cd          line 10 col 27 pic x999 using clmhdr-adj-oma-cd
    05  scr-hdr-oma-suff        line 10 col 34 pic x    using clmhdr-adj-oma-suf
*!  05  scr-ws-doc-nbr          line 10 col 38 pic 999  using ws-doc-nbr auto bl
    05  scr-ws-doc-nbr          line 10 col 38 pic xxx  using ws-doc-nbr auto.
    05                          line 10 col 44 value "(".
    05                          line 10 col 45 pic 99       using ws-orig-total-
    05                          line 10 col 47 value ")".
    05                          line 10 col 50 value "(".
    05  scr-orig-ohip           line 10 col 51 pic z(5)9.99- using ws-orig-ohip.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  38
*                      d004.cbl                                      )
    05                          line 10 col 61 value ")".
    05                          line 10 col 64 value "(".
    05  scr-orig-oma            line 10 col 65 pic z(5)9.99- using ws-orig-oma.
    05                          line 10 col 75 value ")".
    05                          line 12 col 31 value "ADJ/PAYMENT ----:".
    05                          line 14 col 31 value "TECHNICAL ------:".
    05                          line 15 col 31 value "PROFESSIONAL ---:".

* 2013/11/06 - MC4
01  scr-disp-doc-name.
    05  scr-doc-name            line 11 col 08 pic x(30)     using doc-name.
* 2013/11/06 - end

01  scr-disp-clmhdr-dtl-2.
    05  scr-ohip-posted         line 12 col 51 pic z(5)9.99- using ws-posted-ohi
    05  scr-oma-posted          line 12 col 65 pic z(5)9.99- using ws-posted-oma

01  scr-disp-clmhdr-dtl-3.
    05  scr-amt-tech            line 14 col 51 pic z(5)9.99- using ws-amt-tech
*    05                                 line 14 col 65 pic z(5)9.99- using ws-am
    05  scr-prof-ohip           line 15 col 51 pic z(5)9.99- using ws-prof-ohip
    05  scr-prof-oma            line 15 col 65 pic z(5)9.99- using ws-prof-oma

01  scr-misc-pay-code-lit.
    05                  line 13 col 09 value "MISCELLANEOUS".
    05                  line 14 col 11 value "PAY CODE".


01  scr-misc-pay-code.
    05                  line 15 col 16 pic 9 using clmhdr-adj-cd-sub-type-ss aut


01  scr-misc-pay-code-perc.
    05                  line 17 col 13 pic zz9.99 using ws-misc-code-perc bell b
    05                  line 17 col 20 value "%".


01  scr-clear-misc-pay-code.

    05                  line 13 col 01 value "                        ".
    05                  line 14 col 01 value "                        ".
    05                  line 16 col 01 value "                        ".
    05                  line 17 col 01 value "                        ".
*
01   scr-confirm        line 23 col 1 pic x using confirm-space auto.
*
01 file-status-display.
    05  line 24 col 01 pic x(42) from ws-file-err-msg.
    05  line 24 col 56  "FILE STATUS = ".
    05  line 24 col 70  pic x(11) using status-common   bell blink.
*
01  err-msg-line.
    05  line 24 col 01  value " ERROR -  "      bell blink.
    05  line 24 col 11  pic x(60)       using err-msg-comment.
*
01  wrn-msg-line.
    05  line 24 col 01  value "WARNING - "      bell blink.
    05  line 24 col 11  pic x(60)       using err-msg-comment.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  39
*                      d004.cbl                                      )

01  confirm.
    05 line 23 col 01  value " ".

01  ring-bell.
    05 line 23 col 01  value " " bell.

01  blank-line-24.
    05  line 24 col 1   blank line.

01  blank-screen.
    05  blank screen.

01  verification-screen.
*  sms 105 allow the location code to be updated for "R" adj.  s.f.
*   05  line 24 col 58  value "ACCEPT (Y/N/M) ".
    05  line 24 col 58  value "ACCEPT (Y/N/M/L) ".
    05  line 24 col 75  pic x   to flag.

01  scr-reject-entry.
    05  line 24 col 50  value "ENTRY IS ".
    05  line 24 col 59  value "REJECTED"        bell blink.

01  scr-closing-screen.
    05  blank screen.
    05  line  7 col 20  value "# OF BATCH CONTROL READS  =".
    05  line  7 col 55  pic 9(7) from ctr-read-batctrl-file.
    05  line  8 col 20  value "# OF CLAIMS MASTER READS  =".
    05  line  8 col 55  pic 9(7) from ctr-read-claims-mstr.
    05  line  9 col 20  value "# OF DOCTOR MSTR   READS  =".
    05  line  9 col 55  pic 9(7) from ctr-read-doc-mstr.
    05  line 10 col 20 value "# OF LOCATION MSTR  READS  =".
    05  line 10 col 55 pic 9(7) from ctr-read-loc-mstr.
    05  line 11 col 20 value "# OF CONSTANTS MSTR READS  =".
    05  line 11 col 55 pic 9(7) from ctr-read-const-mstr.
    05  line 12 col 20  value "# OF BATCH CONTROL WRITES =".
    05  line 12 col 55  pic 9(7) from ctr-writ-batctrl-file.
    05  line 13 col 20  value "# OF CLAIMS MASTER WRITES =".
    05  line 13 col 55  pic 9(7) from ctr-writ-claims-mstr.
    05  line 14 col 20  value "# OF CONST. MSTR RE-WRITES =".
    05  line 14 col 55  pic 9(7) from ctr-rewrit-const-mstr.
    05  line 15 col 20  value "# OF BATCH CONTROL DELETES =".
    05  line 15 col 55  pic 9(7) from ctr-del-batctrl-file.
    05  line 21 col 20  value "PROGRAM D004 ENDING".
* (y2k - auto fix)
*   05  line 21 col 40  pic 99  from sys-yy.
    05  line 21 col 40  pic 9(4)        from sys-yy.
    05  line 21 col 44  value "/".
    05  line 21 col 45  pic 99  from sys-mm.
    05  line 21 col 47  value "/".
    05  line 21 col 46  pic 99  from sys-dd.
    05  line 21 col 52  pic 99  from sys-hrs.
    05  line 21 col 54  value ":".
    05  line 21 col 55  pic 99  from sys-min.
procedure division.
declaratives.

err-batctrl-mstr-file section.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  40
*                      d004.cbl                                      )
    use after standard error procedure on batch-ctrl-file.
err-batctrl-file.
    move status-batctrl-file            to status-common.
    display file-status-display.
    stop "ERROR IN ACCESSING BATCH CONTROL FILE".

err-claims-mstr-file section.
    use after standard error procedure on claims-mstr.
err-claims-mstr.
    move status-claims-mstr             to status-common.
    display file-status-display.
    stop "ERROR IN ACCESSING CLAIMS MASTER".
err-doc-mstr-file section.
    use after standard error procedure on doc-mstr.
err-doc-mstr.
    move status-doc-mstr                to status-common.
    display file-status-display.
    stop "ERROR IN ACCESSING DOCTOR MASTER".

err-locations-mstr-file section.
    use after standard error procedure on loc-mstr.
err-loc-mstr.
    move status-loc-mstr                to status-common.
    display file-status-display.
    stop "ERROR IN ACCESSING LOCATIONS MASTER".

err-oma-fee-mstr-file section.
    use after standard error procedure on oma-fee-mstr.
err-oma-fee-mstr.
    move status-oma-mstr                to status-common.
    display file-status-display.
    stop "ERROR IN ACCESSING OMA FEE MASTER".

err-constants-mstr-file section.
    use after standard error procedure on iconst-mstr.
err-constants-mstr.
    move status-iconst-mstr             to status-common.
    display file-status-display.
    stop "ERROR IN ACCESSING CONSTANTS MASTER".

end declaratives.
main-line section.
mainline.

    accept sys-date                     from date.
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.
    move sys-mm                         to run-mm.
    move sys-dd                         to run-dd.
    move sys-yy                         to run-yy.

    accept sys-time                     from time.
    move sys-hrs                        to run-hrs.
    move sys-min                        to run-min.
    move sys-sec                        to run-sec.


    open i-o    batch-ctrl-file
                claims-mstr.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  41
*                      d004.cbl                                      )
    open input  iconst-mstr
                doc-mstr
                loc-mstr
* MC5
                f040-dtl
* MC5 - end
                oma-fee-mstr.

000-main-line.
    perform aa0-batch-initialization            thru aa0-99-exit.
    if not stop-option
       then
           move spaces                          to   flag-eoj
           perform ab0-processing               thru ab0-99-exit
                until eoj
           perform ac0-totals                   thru ac0-99-exit
           go to 000-main-line.

*   endif
    perform az0-end-of-job              thru az0-99-exit.
*
    stop run.
aa0-batch-initialization.

    move zeros                          to counters
                                           batctrl-rec
                                           ws-doc-nbr
                                           ws-doc-nbr-alpha.
    move spaces                         to batctrl-batch-type
                                           batctrl-hosp
                                           batctrl-adj-cd
                                           batctrl-i-o-pat-ind
                                           claim-header-rec
                                           claim-detail-rec.
    move zeros                  to  clmhdr-claim-id
                                    clmhdr-adj-cd-sub-type-ss
                                    clmhdr-doc-nbr-ohip
                                    clmhdr-doc-spec-cd
                                    clmhdr-refer-doc-nbr
                                    clmhdr-diag-cd
                                    clmhdr-agent-cd
                                    clmhdr-date-admit
                                    clmhdr-doc-dept
                                    clmhdr-curr-payment
                                    clmhdr-date-period-end
                                    clmhdr-cycle-nbr
                                    clmhdr-amt-tech-billed
                                    clmhdr-amt-tech-paid
                                    clmhdr-tot-claim-ar-oma
                                    clmhdr-tot-claim-ar-ohip
                                    clmhdr-manual-and-tape-paymnts
                                    clmhdr-orig-batch-id
                                    clmhdr-submit-date
                                    clmhdr-serv-date.
    move zeros                  to      ws-svc-posted
                                        ws-posted-oma
                                        ws-posted-ohip
                                        ws-orig-total-svc
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  42
*                      d004.cbl                                      )
                                        ws-orig-oma
                                        ws-orig-ohip.
    move zeros                  to  clmdtl-id
                                    clmdtl-agent-cd
                                    clmdtl-nbr-serv
                                    clmdtl-sv-date
                                    clmdtl-consecutive-sv-date(1)
                                    clmdtl-consecutive-sv-date(2)
                                    clmdtl-consecutive-sv-date(3)
                                    clmdtl-amt-tech-billed
                                    clmdtl-fee-oma
                                    clmdtl-fee-ohip
                                    clmdtl-cycle-nbr
                                    clmdtl-diag-cd
                                    clmdtl-line-no
                                    clmdtl-orig-batch-id.

aa0-10-acpt-old-new-batch-opt.

    move spaces                                 to      option.
    display scr-title-batch-control-data.
    display scr-old-or-new-batch-option.
    perform aa1-acpt-old-or-new-batch-opt       thru    aa1-99-exit.

*       (allow operator to shut down)
    if stop-option
    then
        go to aa0-99-exit.
*   (else)
*   endif



    if old-batch
    then
        display scr-acpt-batch-nbr
        accept  scr-acpt-batch-nbr
        perform aa2-read-batctrl-file           thru    aa2-99-exit
        if     not-ok
           or (     batctrl-batch-type not = "P"
                and batctrl-batch-type not = "A")
        then
*           (BATCH NBR NOT FOUND IN CTRL FILE - OR BATCH FOUND WAS NOT A 'P'AYME
            move 2                              to      err-ind
            perform za0-common-error            thru    za0-99-exit
            go to aa0-10-acpt-old-new-batch-opt
        else
*           (CAN'T ACCESS BATCH WHOSE STATUS INDICATES IT HAS 'GONE TO OHIP' --
*           check password for special override privledges -- dyad personnel onl
            move "Y"                     to flag
            perform aa5-verify-batch-status thru aa5-99-exit
            if not-ok
            then
                go to aa0-10-acpt-old-new-batch-opt
            else
*           (allow operator to override old batch ctrl estimates)
                perform xa0-disp-batctrl-data  thru     xa0-99-exit
                move spaces                     to      change-reply
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  43
*                      d004.cbl                                      )
                perform xb0-allow-change-of-estimates
                                                thru xb0-99-exit
                              until  change-reply = "N"
                display scr-title-batch-control-data
*  the following move statement is added by m.s. - sms 99
                move batctrl-amt-act to ws-batctrl-amt-act
*           (display last claim in batch if it exists)
                if batctrl-last-claim-nbr = zero
                then
                    next sentence
                else
                    perform aa3-disp-last-claim-in-batch
                                        thru    aa3-99-exit
*               endif
*           endif
*       endif
    else
*     new-batch (-- prompt for batch header info)
        move 0                                  to      err-ind
        perform aa4-acpt-new-batch-hdr-info     thru    aa4-99-exit
*       (err-ind not = 0 implies error or operator rejected # input, then return
        if err-ind not = 0
        then
            go to aa0-10-acpt-old-new-batch-opt
        else
            perform xb1-input-batctrl-est       thru    xb1-99-exit
            move spaces                         to      change-reply
            perform xb0-allow-change-of-estimates thru  xb0-99-exit
                      until   change-reply = "N"
            move zero                           to      batctrl-last-claim-nbr.
*       endif
*   endif

aa0-99-exit.
    exit.
aa1-acpt-old-or-new-batch-opt.

    accept scr-old-or-new-batch-option.
    if   old-batch
      or new-batch
      or stop-option
    then
        next sentence
    else
        move 1                          to      err-ind
        perform za0-common-error        thru    za0-99-exit
        go to aa1-acpt-old-or-new-batch-opt.
*   endif

aa1-99-exit.
    exit.
aa2-read-batctrl-file.

    move batctrl-batch-nbr                      to      key-batctrl-file.

    read batch-ctrl-file  key is key-batctrl-file
        invalid key
                move "N"                        to      flag
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  44
*                      d004.cbl                                      )
                go to aa2-99-exit.

    move "Y"                                    to      flag.
    add  1                                      to      ctr-read-batctrl-file.

aa2-99-exit.
    exit.
aa3-disp-last-claim-in-batch.

*       (read last claim's header rec)
    move batctrl-batch-nbr              to      clmhdr-batch-nbr.
    move batctrl-last-claim-nbr         to      clmhdr-claim-nbr.
    move zeros                          to      clmhdr-zeroed-oma-suff-adj.

*mf move clmhdr-claim-id                to      key-clm-data.
*mf move "B"                            to      key-clm-key-type.
    move clmhdr-claim-id                to      clmdtl-b-data.
    move "B"                            to      clmdtl-b-key-type.

    perform xc0-read-claims-mstr        thru    xc0-99-exit.
    if not-ok
    then
*       (serious data base error !!! --
*         -- last claim nbr as stored in header rec can't be found)
        move 4                          to      err-ind
        perform za0-common-error        thru    za0-99-exit
        go to az0-end-of-job.
*   (else)
*   endif

*       (move 4 digit numeric doc nbr to 3 char alpha display)
    move clmhdr-doc-nbr                 to      ws-doc-nbr.
    move ws-doc-nbr                     to      ws-doc-nbr-alpha.

*    (obtained claim hdr -- read the claim detail rec
*                        -- then display header and detail)
    perform xd0-read-clmdtl             thru    xd0-99-exit.

    move clmdtl-fee-ohip                to      ws-posted-ohip
                                                ws-orig-ohip.
    move clmdtl-fee-oma                 to      ws-posted-oma
                                                ws-orig-oma.

    display scr-acpt-clmhdr.
    display scr-acpt-clmhdr-tit-1.
    display scr-acpt-clmhdr-dtl-1.
    display confirm.
    stop " ".

aa3-99-exit.
    exit.
aa4-acpt-new-batch-hdr-info.

    display scr-acpt-batch-type.
    perform aa41-acpt-batch-type                thru    aa41-99-exit.
    move zero                                   to      batctrl-batch-nbr.

aa4-10.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  45
*                      d004.cbl                                      )
    display scr-acpt-batch-nbr.
    perform aa42-acpt-orig-batch-nbr            thru    aa42-99-exit.

    perform la0-acpt-verification               thru    la0-99-exit.
    if flag = "M"
    then
        go to aa4-acpt-new-batch-hdr-info
    else
        if flag = "N"
        then
*           (set indicator so mainline will reject batch # input)
            move 99                             to      err-ind
            go to aa4-99-exit
        else
            next sentence.
*       endif
*   endif

    move sys-date                               to      batctrl-date-batch-enter

    perform aa43-obtain-period-and-cycle        thru    aa43-99-exit.
    display scr-val-batch-period-cycle.
    display scr-acpt-mask.

    perform aa48-acpt-adj-cd                    thru    aa48-99-exit.
    perform aa47-acpt-agent-cd                  thru    aa47-99-exit.
    perform aa46-acpt-loc                       thru    aa46-99-exit.

    move zero                                   to      batctrl-calc-ar-due
                                                        batctrl-calc-tot-rev
                                                        batctrl-manual-pay-tot
                                                        batctrl-amt-est
                                                        batctrl-amt-act
                                                        ws-batctrl-amt-act
                                                        batctrl-svc-est
                                                        batctrl-svc-act
                                                        ws-batctrl-amt-diff
                                                        ws-batctrl-svc-diff.

*       (write batctrl rec now so that another operator can't use same batch #)
    perform aa9-write-batctrl-file              thru    aa9-99-exit.
*   (error if duplicate batch #)
    if ok
    then
        move key-batctrl-file                   to      ws-save-batctrl-key
    else
        move 19                                 to      err-ind
        perform za0-common-error                thru    za0-99-exit
        go to aa4-99-exit.
*   endif

    display scr-lit-batctrl-data.
    display scr-val-batctrl-data.
    move zero                                   to      err-ind.

aa4-99-exit.
    exit.
aa41-acpt-batch-type.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  46
*                      d004.cbl                                      )

    accept scr-batctrl-batch-type.

    if batctrl-batch-type =   "P"
                           or "A"
    then
        next sentence
    else
        move 14                         to      err-ind
        perform za0-common-error        thru    za0-99-exit
        go to aa41-acpt-batch-type.
*   endif

aa41-99-exit.
    exit.
aa42-acpt-orig-batch-nbr.

    accept scr-batctrl-clinic-nbr-1-2.

    move batctrl-bat-clinic-nbr-1-2             to      iconst-clinic-nbr-1-2.

*       (access isam constants master file to determine if valid 2 digit
*        clinic idenifier is valid)

    move "Y"                                    to      flag.
    perform xj0-read-const-mstr                 thru    xj0-99-exit.

    if flag = "N"
    then
        move 20                                 to      err-ind
        perform za0-common-error                thru    za0-99-exit
        go to aa42-acpt-orig-batch-nbr.
*   (else)
*   endif

*       (preset claim header clinic nbr from 1st two digits of batch nbr clinic
    move iconst-clinic-nbr                      to      batctrl-clinic-nbr.


    accept  scr-batctrl-doc-nbr.
    display scr-batctrl-doc-nbr.
    accept  scr-batctrl-week.
    accept  scr-batctrl-day.

aa42-99-exit.
    exit.
aa43-obtain-period-and-cycle.

*       (obtain period and cycle of clinic -- note constants master record
*        was obtained in routine 'aa42')

    move iconst-clinic-cycle-nbr                to      batctrl-cycle-nbr.
    move iconst-date-period-end                 to      batctrl-date-period-end.


aa43-99-exit.
    exit.
aa46-acpt-loc.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  47
*                      d004.cbl                                      )

    if     batctrl-adj-cd = "R"
    then
           move "X999"                          to      batctrl-loc
           display scr-batctrl-loc
           accept scr-batctrl-loc
    else
        if batctrl-adj-cd = "M"
        then
            move "MISC"                         to      batctrl-loc
            display scr-batctrl-loc
*           accept scr-batctrl-loc     - pdr 472 m.c. 91/01/14
        else
            move spaces                         to      batctrl-loc.
*       endif
*   endif

    display scr-batctrl-loc.

aa46-99-exit.
    exit.
aa47-acpt-agent-cd.

    accept  scr-batctrl-agent-cd.

aa47-99-exit.
    exit.
aa48-acpt-adj-cd.

*       ('A'JUSTMENT BATCHES ALLOW TRANSACTION CODES OF A,B,R --
*        'P'AYMENT      "      "        "        "   "  C,M    )

    accept scr-batctrl-adj-cd.

    if batctrl-batch-type = "A"
    then
        if batctrl-adj-cd =   "A"
                           or "B"
                           or "R"
        then
            next sentence
        else
            move 11                             to      err-ind
            perform za0-common-error            thru    za0-99-exit
            go to aa48-acpt-adj-cd
*       endif
    else
*     batctrl-batch-type must = "P"
        if batctrl-adj-cd =   "C"
                           or "M"
        then
            next sentence
        else
            move 12                             to      err-ind
            perform za0-common-error            thru    za0-99-exit
            go to aa48-acpt-adj-cd.
*       endif
*   endif
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  48
*                      d004.cbl                                      )

    if   batctrl-adj-cd =   "A"
                         or "B"
                         or "C"
                         or "M"
                         or "R"
    then
        next sentence
    else
        move 6                                  to      err-ind
        perform za0-common-error                thru    za0-99-exit
        go to aa48-acpt-adj-cd.
*   endif

** the following if condition is added on 87/09/23 by m.s. for sms 97.

    if batctrl-batch-type = "A" and batctrl-adj-cd = "B"
    then
        move "M"                        to batctrl-adj-cd-sub-type.
*   endif

aa48-99-exit.
    exit.
aa5-verify-batch-status.

*       (unless operator supplies special password don't allow access
*        to any batch with status 'sent to ohip' or greater)


    if batctrl-batch-status > "1"
    then
        move 41                                 to      err-ind
        perform za0-common-error                thru    za0-99-exit
        display scr-acpt-change-password
        accept  scr-acpt-change-password
        if password-input = password-special-privledges
        then
            move "Y"                            to      flag
        else
            move "N"                            to      flag
*       endif
    else
        next sentence.
*   endif

aa5-99-exit.
    exit.


aa9-write-batctrl-file.

    move batctrl-batch-nbr                      to      key-batctrl-file.

    write  batctrl-rec
*mf                     key is  key-batctrl-file
        invalid key
            move "N"                            to      flag
            go to aa9-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  49
*                      d004.cbl                                      )

    move "Y"                                    to      flag.
    add  1                                      to      ctr-writ-batctrl-file.

aa9-99-exit.
    exit.
ab0-processing.

*       (preset data common between batctrl and clmhdr recs)
    perform ba0-preset-hdr-data-from-ctrl       thru    ba0-99-exit.

*       (maximum number of entries allowed in any batch is 99)

    move 0 to ws-posted-ohip
              ws-posted-oma
              ws-amt-tech
              ws-prof-ohip
              ws-prof-oma.

    if batctrl-adj-cd = 'M'
    then
        move 0                          to clmhdr-adj-cd-sub-type.
*   endif


    if batctrl-last-claim-nbr > 98
    then
        display scr-acpt-clmhdr
        move 38                         to      err-ind
        perform za0-common-error        thru    za0-99-exit
        move "E"                        to      flag-eoj
        go to ab0-99-exit.
*   (else)
*   endif

    add  1
         batctrl-last-claim-nbr         giving  batctrl-last-claim-nbr
                                                clmhdr-orig-claim-nbr.

*       (read claims master for claim-nbr about to be created --
*        if claim already exists then print error and shut down batch)

    move batctrl-batch-nbr              to      clmhdr-batch-nbr.
    move batctrl-last-claim-nbr         to      clmhdr-claim-nbr.
    move zeros                          to      clmhdr-zeroed-oma-suff-adj.
*mf move clmhdr-claim-id                to      key-clm-data.
*mf move "B"                            to      key-clm-key-type.
    move clmhdr-claim-id                to      clmdtl-b-data.
    move "B"                            to      clmdtl-b-key-type.

    perform xe0-read-claims-mstr        thru    xe0-99-exit.
    if  ok
    then
*       (claim # already exists -- shut down batch with message to re-number rem
        perform ab4-subtract-1-from-claim-nbr   thru ab4-99-exit
        perform ab5-ring-bell           thru    ab5-99-exit   5 times
        move 39                         to      err-ind
        perform za0-common-error        thru    za0-99-exit
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  50
*                      d004.cbl                                      )
        move "E"                        to      flag-eoj
        go to ab0-99-exit
    else
        display scr-title-claim-rec-data
        display scr-acpt-clmhdr
        display scr-acpt-clmhdr-tit-1.
*   endif

ab0-10-input-claim.
*       (input claim header information)

    perform ab1-acpt-claim-id                   thru ab1-99-exit.

*   (check for end of job indicator)
    if eoj
    then
        perform ab4-subtract-1-from-claim-nbr   thru ab4-99-exit
        go to ab0-99-exit.
*   (else)
*   endif

*       (if claim id entered find either hdr or dtl rec in claims mstr --
*            -- non-zero doc # indicates that misc 'M' or 'R' adjustment entered
*               flag set to force program to create dummy claim # automatically)
    if clmhdr-doc-nbr not = zero
    then
*mf     move "B"                                to      key-clm-key-type
*mf     move clmhdr-claim-id                    to      key-clm-data
        move "B"                                to      clmdtl-b-key-type
        move clmhdr-claim-id                    to      clmdtl-b-data
        perform xe0-read-claims-mstr            thru    xe0-99-exit
*       (no such claim found)
        if not-ok
        then
            move 10                             to      err-ind
            perform za0-common-error            thru    za0-99-exit
            go to ab0-10-input-claim
        else
*           (if adjust cd = "C" then 'claims-mstr-rec' contains hdr rec - otherw
*           (claim being adjusted must have the same agent as batch being entere
            if   (     batctrl-adj-cd          = "C"
                   and clmrec-hdr-agent-cd not = batctrl-agent-cd )
               or (    batctrl-adj-cd      not = "C"
                   and clmrec-dtl-agent-cd not = batctrl-agent-cd )
            then
                move 33                         to      err-ind
                perform za0-common-error        thru    za0-99-exit
                go to ab0-10-input-claim
            else
*
*                  -- print "AMOUNT" of old claim)
                if batctrl-adj-cd = "C"
                then
                    move clmrec-hdr-tot-claim-ar-ohip   to      ws-orig-ohip
                    move clmrec-hdr-tot-claim-ar-oma    to      ws-orig-oma
*
*                   (save the adjustments claim header rec for future updating i
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  51
*                      d004.cbl                                      )
                    move claims-mstr-hdr-rec            to      ws-save-claims-h
                    move feedback-claims-mstr           to      ws-save-claims-f
                    move key-batctrl-file               to      ws-save-batctrl-
                    display scr-orig-ohip scr-orig-oma
                else
*                   ( display adjusted claims detail rec )
                    move clmrec-dtl-sv-date             to      hold-adjusted-cl
                    move clmrec-dtl-fee-ohip            to      ws-orig-ohip
                    move clmrec-dtl-fee-oma             to      ws-orig-oma
                    display scr-orig-ohip scr-orig-oma
*               endif
*           endif
*       endif
    else
        next sentence.
*   endif


*       (if adjustment type not = 'R' or 'M', then determine if operator
*        is trying to adjust claim for which a batch control record still exists
*        on the batch control file. if such a record is found, then
*        disallow any adjustment to claim.)

    if batctrl-adj-cd =   "M"
                       or "R"
    then
        next sentence
    else
        perform da0-verify-ok-to-modify-claim   thru    da0-99-exit
        if ws-flag-ok-to-adjust = "N"
        then
            go to ab0-10-input-claim
        else
*           (access claim being adjusted's hdr rec to obtain data on doctor's de
*            claim's ohip status, location, patient, service date etc -- )
*            -- if adj = 'C' then claim's hdr rec already in 'claims-mstr-rec' -
*            otherwise the claim's dtl record was read and hdr rec must be read
*             -- note:  key for detail rec already in key area)

            perform fa0-obtain-clmhdr-data              thru    fa0-99-exit.
*       endif
*   endif


*   move zero                           to ws-amt-tech
*                                          ws-prof-ohip
*                                          ws-prof-oma.

*       (accept details into claim hdr and dtl recs)
ab0-50-acpt-details.

    perform ja0-acpt-clmhdr-detail                      thru    ja0-99-exit.
    if err-data
    then
        go to ab0-10-input-claim.
*   (else)
*   endif

* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  52
*                      d004.cbl                                      )
ab0-60-acpt-verification.

    perform la0-acpt-verification               thru    la0-99-exit.

* sms 105 allow update of location on detail screen for "R" adj   s.f.

   if flag = "L" and batctrl-adj-cd = "R"
    then
         accept scr-clmhdr-loc
         go to ab0-60-acpt-verification
    else
        if flag = "L"
        then
            accept scr-reference
            go to ab0-60-acpt-verification
        else


        if flag = "M"
        then
            go to ab0-10-input-claim
        else
            if flag = "N"
            then
                display scr-reject-entry
                display confirm
                stop " "
                display blank-line-24
                subtract 1                              from    batctrl-last-cla
                                                        giving  batctrl-last-cla
                                                        clmhdr-orig-claim-nbr.
    if flag = "Y"
    then
**   the following 'add' and 'if-condition' are added by m.s. - sms 99
        add ws-posted-ohip                      to ws-batctrl-amt-act
        if  ws-batctrl-amt-act > 99999.99
        then
*       (batctrl amt > 99999.99 -- shut down batch with message to
*        re-number remaining claims)
            perform ab4-subtract-1-from-claim-nbr thru ab4-99-exit
            perform ab5-ring-bell       thru    ab5-99-exit   5 times
            move 48                     to      err-ind
            perform za0-common-error    thru    za0-99-exit
            move "E"                    to      flag-eoj
            go to ab0-99-exit
        else
*           (entry accepted -- )
            perform ab3-create-claim-id         thru    ab3-99-exit
*           (write out claim -- head rec followed by detail recs)
            perform ma0-write-clmhdr            thru    ma0-99-exit

*           (preset clmdtl rec data which is common to clmhdr rec data)
            perform ab2-preset-clmdtl-data      thru    ab2-99-exit

            perform na0-write-clmdtl            thru    na0-99-exit

*           (if trans not = 'M' or 'R' then update claim hdr or dtl that is bein
            perform pa0-update-adjusted-claim   thru    pa0-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  53
*                      d004.cbl                                      )
*       endif
*   endif


ab0-99-exit.
    exit.


ab1-acpt-claim-id.

    move "N"                                    to flag-dummy-claim-id.

    move zeros                                  to clmhdr-week
                                                   clmhdr-day
                                                   clmhdr-claim-nbr.

    display scr-acpt-clmhdr-dtl-1.

    accept scr-hdr-doc-nbr.

*       (allow operator to signal end of input)
    if ws-doc-nbr-alpha = "***"
    then
        move "E"                                to flag-eoj
        go to ab1-99-exit
    else
        next sentence.
*   endif

*!  (alpha doctor number now allowed)
*!*     (op allowed to enter "***" to stop data entry - otherwise entry must be
*!    if ws-doc-nbr-alpha  not numeric
*!    then
*!      move 1                                  to err-ind
*!      perform za0-common-error                thru za0-99-exit
*!      go to ab1-acpt-claim-id.

    move ws-doc-nbr-alpha                       to clmhdr-doc-nbr.

    if clmhdr-doc-nbr not = zero
    then
        accept scr-hdr-week
        accept scr-hdr-day
        accept scr-hdr-claim-nbr
*       (payments adjust claim header only - don't need oma cd and suff)

        if batctrl-adj-cd = "C"
        then
            go to ab1-99-exit
        else
            move "XXXX"                         to clmhdr-adj-oma-cd
            move "A"                            to clmhdr-adj-oma-suff
            display scr-hdr-oma-cd
            display scr-hdr-oma-suff
            accept scr-hdr-oma-cd
            accept scr-hdr-oma-suff
            go to ab1-99-exit
*       endif
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  54
*                      d004.cbl                                      )
    else
        next sentence.
*   endif

*       (allow zero batch-id only if transaction code is 'M' or 'R'--
*                - if 'M' or 'R' then set oma code = "MISC"
*                      -- but allow operator to over ride this value)
ab1-50.
    if     clmhdr-doc-nbr = zero
      and (batctrl-adj-cd = "M" or "R")
    then
        move "Y"                                to flag-dummy-claim-id

        move "MISC"                             to clmhdr-adj-oma-cd
        move space                              to clmhdr-adj-oma-suff
        display scr-hdr-oma-cd
        display scr-hdr-oma-suff
        if batctrl-adj-cd = "M" or "R"
        then
            accept scr-hdr-oma-cd
*           (if 'MISC' oma code is over written then verify oma code)
            if clmhdr-adj-oma-cd not = "MISC"
            then
                move clmhdr-adj-oma-cd          to fee-oma-cd
                perform xh0-read-oma-fee-mstr   thru xh0-99-exit
                if not-ok
                then
                    move 28                     to err-ind
                    perform za0-common-error    thru za0-99-exit
                    move spaces                 to clmhdr-adj-oma-cd
                    go to ab1-50
                else
                    next sentence
*               endif
            else
                next sentence
*           endif
        else
            next sentence
*       endif
    else
        move 8                                  to err-ind
        perform za0-common-error                thru za0-99-exit
        go to ab1-acpt-claim-id.
*   endif

* MC5
    if batctrl-adj-cd = 'M'
    then
        move clmhdr-adj-oma-cd          to fee-oma-cd
                perform xh0-read-oma-fee-mstr   thru xh0-99-exit
                if not-ok
                then
                    move 28                     to err-ind
                    perform za0-common-error    thru za0-99-exit
                    move spaces                 to clmhdr-adj-oma-cd
                    go to ab1-50
                else
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  55
*                      d004.cbl                                      )
                    next sentence
    display scr-clear-misc-pay-code.

    if batctrl-adj-cd = "M"
    then
        perform ab6-acpt-misc-pay-code          thru ab6-99-exit.
*   (else)
*   endif

ab1-99-exit.
    exit.
ab2-preset-clmdtl-data.

*       (preset clmdtl rec data which is common to clmhdr rec data)

    move clmhdr-batch-nbr               to      clmdtl-batch-nbr.
    move clmhdr-claim-nbr               to      clmdtl-claim-nbr.
    move clmhdr-agent-cd                to      clmdtl-agent-cd.
    move clmhdr-adj-cd                  to      clmdtl-adj-cd.

    move ws-svc-posted                  to      clmdtl-nbr-serv.

    if clmhdr-adj-cd =   "A"
                      or "B"
    then
        move hold-adjusted-clms-sv-date to      clmdtl-sv-date
    else
        if clmhdr-adj-cd = "C"
        then
            move hold-adjusted-clms-de-date
                                        to      clmdtl-sv-date
        else
*           ( must be "R" or "M" )
            move sys-yy                 to      clmdtl-sv-yy
            move sys-mm                 to      clmdtl-sv-mm
            move sys-dd                 to      clmdtl-sv-dd.
*       endif
*   endif

    move zeroes                         to      clmdtl-consecutive-dates (1)
                                                clmdtl-consecutive-dates (2)
                                                clmdtl-consecutive-dates (3).

    move ws-posted-oma                  to      clmdtl-fee-oma.
*   move ws-posted-ohip                 to      clmdtl-fee-ohip.
    move clmhdr-date-period-end         to      clmdtl-date-period-end.
    move clmhdr-cycle-nbr               to      clmdtl-cycle-nbr.
    move clmhdr-orig-batch-id           to      clmdtl-orig-batch-id.

ab2-99-exit.
    exit.
ab3-create-claim-id.

*       (test if a dummy claim id has to be built and build if necessary
*           according to transaction type (adj-cd) )
    if dummy-claim-id-required
    then
        next sentence
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  56
*                      d004.cbl                                      )
    else
        go to ab3-99-exit.
*   endif

    move ws-doc-nbr                     to      clmhdr-batch-nbr-3-6.
    move batctrl-bat-doc-nbr            to      clmhdr-batch-nbr-7-9.
    move 01                             to      clmhdr-claim-nbr.
    go to ab3-99-exit.

*--------------------  code no longer used  ----------------
*   (build dummy claim id that will not duplicate existing key)
    move ws-doc-nbr                     to clmhdr-batch-nbr-3-6.
    if batctrl-adj-cd = "M"
    then
        move "156"                      to clmhdr-batch-nbr-7-9
    else
        move "999"                      to clmhdr-batch-nbr-7-9.

*       (find a claim # within batch not already used)
    move 1                              to clmhdr-claim-nbr.
*mf move "B"                            to key-clm-key-type.
*mf move clmhdr-claim-id                to key-clm-data.
    move "B"                            to clmdtl-b-key-type.
    move clmhdr-claim-id                to clmdtl-b-data.

ab3-10-claim-nbr-loop.

    read    claims-mstr
*mf                      retain position suppress data record
        key is  key-claims-mstr
        invalid key
*           (available claim id found -- display it on screen)
*mf         move key-clm-claim-nbr      to clmhdr-claim-nbr
            move clmdtl-b-data          to clmhdr-claim-nbr
            display scr-acpt-clmhdr-dtl-1
            display confirm
            stop " "
            go to ab3-99-exit.

ab3-20-try-again.
*   (err - this claim # already used)
*mf if key-clm-claim-nbr  = 99
    if clmdtl-b-claim-nbr = 99
    then
*       (fatal err - more than 99 claims within this batch nbr not allowed)
        move 18                 to err-ind
        perform za0-common-error thru za0-99-exit
        go to az0-end-of-job
    else
*       (loop to try next possible claim nbr)
*mf     add  1                  to key-clm-claim-nbr
        add  1                  to clmdtl-b-claim-nbr
        go to ab3-10-claim-nbr-loop.
*   endif
*--------------------  code no longer used  ----------------

ab3-99-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  57
*                      d004.cbl                                      )
ab4-subtract-1-from-claim-nbr.

    subtract 1                          from    batctrl-last-claim-nbr
                                        giving  batctrl-last-claim-nbr
                                                clmhdr-orig-claim-nbr.
ab4-99-exit.
    exit.





ab5-ring-bell.

    display ring-bell.

ab5-99-exit.
    exit.
ab6-acpt-misc-pay-code.

*  pdr 471 - the following accept on doc nbr is only applied to 'M'isc
*            payment, so in case pay code 0 is entered, the percentage
*            from doctor master will be displayed on the screen.

    accept scr-ws-doc-nbr.

    if ws-doc-nbr not = zero
    then
*       (doc # must exist on doc mstr)
        move ws-doc-nbr                 to doc-nbr
        perform xf0-read-doc-mstr       thru xf0-99-exit.

* 2013/11/06 - MC4
    display scr-doc-name.
* 2013/11/06 - end

* 2013/08/27 - MC3 -  Provide error if entered doctor nbr has not assigned the s
     If       ok
          and (     batctrl-bat-clinic-nbr-1-2 not = doc-clinic-nbr
               and  batctrl-bat-clinic-nbr-1-2 not = doc-clinic-nbr-2
               and  batctrl-bat-clinic-nbr-1-2 not = doc-clinic-nbr-3
               and  batctrl-bat-clinic-nbr-1-2 not = doc-clinic-nbr-4
               and  batctrl-bat-clinic-nbr-1-2 not = doc-clinic-nbr-5
               and  batctrl-bat-clinic-nbr-1-2 not = doc-clinic-nbr-6
              )
     then
        move "N"                        to flag-err-data
        move 51                         to err-ind
        perform za0-common-error        thru za0-99-exit
        go to ab6-acpt-misc-pay-code.
*   endif
* 2013/08/27 - end


* 2011/11/16 - MC1 -  Provide warning if doctor is terminated for Miscellaneous
     If       ok
          and doc-date-fac-term not = zeroes
          and doc-date-fac-term not = spaces
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  58
*                      d004.cbl                                      )
          and doc-date-fac-term < sys-date
     then
          move "N"                      to flag-err-data
* MC6
          move doc-date-fac-term                to ws-date

*         (warning if doctor termination date is
*          within 6 months of current system date;
*          otherwise, it is error)
         if   (   (ws-yy  * 365) + (ws-mm  * 30) + ws-dd )
                > (sys-yy * 365) + (sys-mm * 30) + sys-dd - 180
         then
* MC6 - end
             move 49                    to err-ind
             perform za1-common-warning thru za1-99-exit
             if confirm-space = '!'
             then
                 go to ab6-acpt-misc-pay-code
* MC6
             else
                 next sentence
*            endif
         else
             move 53                    to err-ind
             perform za0-common-error   thru za0-99-exit
             if confirm-space = '*'
             then
                display scr-acpt-change-password
                accept  scr-acpt-change-password
                if password-input  =  password  or  password-special-privledges
                then
                    go to ab6-99-exit
                else
                    go to ab6-acpt-misc-pay-code
*               endif
             else
                    go to ab6-acpt-misc-pay-code.
*            endif
*       endif
* MC6 - end
*   endif
* 2011/11/16 - end

*    (error -- doc # = 0 or not found on doc mstr)
    if ws-doc-nbr = zero or not-ok
    then
        move "N"                        to flag-err-data
        move 7                          to err-ind
        perform za0-common-error        thru za0-99-exit
        go to ab6-acpt-misc-pay-code.
*   endif

* MC5 - check against f040-dtl for Miscellaneous payment  only
    move clmhdr-adj-oma-cd              to oma-cd.
    move doc-dept                       to dept-no.
* MC7
    move ws-doc-nbr                     to oma-doc-nbr.
* MC7 - end
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  59
*                      d004.cbl                                      )
    perform xi0-read-oma-dtl            thru xi0-99-exit.
    if ok and data-entry-flag not = 'V'
    then
        move "N"                        to flag-err-data
        move 52                         to err-ind
        perform za0-common-error        thru za0-99-exit
        go to ab6-acpt-misc-pay-code.
*   endif

* MC5 - end


*   move zero                           to clmhdr-adj-cd-sub-type.
    display scr-misc-pay-code-lit.
    display scr-misc-pay-code.

* 2005/03/01 - MC - do not allow user to enter pay code
*    accept scr-misc-pay-code.
* 2005/03/01 - -end

    if clmhdr-adj-cd-sub-type not = zero
    then
        perform ab61-access-const-mstr-rec-3
                                        thru ab61-99-exit
        if const-misc-curr(clmhdr-adj-cd-sub-type-ss) = zero
        then
            move 26                     to err-ind
            perform za0-common-error    thru za0-99-exit
            go to ab6-acpt-misc-pay-code
        else
            multiply const-misc-curr(clmhdr-adj-cd-sub-type-ss)
                                        by 100
                                        giving ws-misc-code-perc
            display scr-misc-pay-code-perc
            move clmhdr-adj-cd-sub-type to batctrl-adj-cd-sub-type
*       endif
    else
*       next sentence.
*   pdr 471 - display misc tax from doctor master for pay code 0
*       multiply doc-misc-percent by 100 giving ws-misc-code-perc
        move 0 to ws-misc-code-perc
        display scr-misc-pay-code-perc.
*   endif

ab6-99-exit.
    exit.



ab61-access-const-mstr-rec-3.

    move 3                              to const-rec-3-rec-nbr.

    read iconst-mstr
        invalid key
            move 42                     to err-ind
            perform za0-common-error    thru za0-99-exit
            go to az0-end-of-job.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  60
*                      d004.cbl                                      )

ab61-99-exit.
    exit.
ac0-totals.

*       (if no claims were input then delete batctrl rec --
*               -- otherwise allow update of 'HASH' totals and re-write updated
    if batctrl-last-claim-nbr < 1
    then
        move ws-save-batctrl-key        to key-batctrl-file
        perform az1-delete-batctrl-rec  thru az1-99-exit
        if  ok
        then
            go to ac0-99-exit
        else
            move 37                     to err-ind
            perform za0-common-error    thru za0-99-exit
            go to ac0-99-exit
*       endif
    else
*       (update 'total nbr of claims in the batch' using nbr of 'last claim in b
        move batctrl-last-claim-nbr     to batctrl-nbr-claims-in-batch.
*   endif


ac0-50.

    perform xa0-disp-batctrl-data         thru xa0-99-exit

* 2012/11/14 - MC2 - check amount est & act
    if batctrl-amt-est not = batctrl-amt-act
    then
        move 50                         to err-ind
        perform za1-common-warning      thru za1-99-exit.
*       go to ac0-50.
*   endif
* 2012/11/14 -end

    move "Y"                              to change-reply.

    perform xb0-allow-change-of-estimates thru xb0-99-exit
                        until    change-reply = "N".

*       (set batch status according to 'estimate' vs 'actual' hash totals)
    if batctrl-amt-est = batctrl-amt-act
    then
*       (balanced)
        move '1'                        to batctrl-batch-status
    else
*       (unbalanced)
        move '0'                        to batctrl-batch-status.
*   endif

    move batctrl-batch-nbr              to key-batctrl-file.
    perform az2-rewrite-batctrl-rec     thru az2-99-exit.
    if not-ok
    then
        move 35                         to err-ind
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  61
*                      d004.cbl                                      )
        perform za0-common-error        thru za0-99-exit
    else
        next sentence.
*   endif

    accept  sys-time                    from time.
    display scr-closing-screen.
    display confirm.


ac0-99-exit.
   exit.

az0-end-of-job.

az0-10.
    display blank-screen.

    close       batch-ctrl-file
                claims-mstr
                iconst-mstr
                doc-mstr
                loc-mstr
* MC5
                f040-dtl
* MC5 - end
                oma-fee-mstr.

    call program "$obj/menu".
    stop run.

az0-99-exit.
    exit.

az1-delete-batctrl-rec.

    move "Y"                            to flag.

*mf delete    batch-ctrl-file  record physical  key is key-batctrl-file
    delete    batch-ctrl-file
        invalid key
            move "N"                    to flag.

    add 1                               to ctr-del-batctrl-file.

az1-99-exit.
    exit.



az2-rewrite-batctrl-rec.

    rewrite    batctrl-rec
*mf             key is key-batctrl-file
        invalid key
            move "N"                    to flag
            go to az2-99-exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  62
*                      d004.cbl                                      )
    move "Y"                            to flag.
    add  1                              to ctr-rewrit-batctrl-file.

az2-99-exit.
    exit.
ba0-preset-hdr-data-from-ctrl.

    move spaces                         to claim-detail-rec.
    move zeros                          to clmdtl-id
                                           clmdtl-agent-cd
                                           clmdtl-nbr-serv
                                           clmdtl-sv-date
                                           clmdtl-consecutive-sv-date(1)
                                           clmdtl-consecutive-sv-date(2)
                                           clmdtl-consecutive-sv-date(3)
                                           clmdtl-amt-tech-billed
                                           clmdtl-fee-oma
                                           clmdtl-fee-ohip
                                           clmdtl-cycle-nbr
                                           clmdtl-diag-cd
                                           clmdtl-line-no
                                           clmdtl-orig-batch-id.
    move clmhdr-week                    to hold-week.
    move clmhdr-day                     to hold-day.
    move zeros                          to claim-header-rec
                                           ws-svc-posted
                                           ws-posted-oma
                                           ws-posted-ohip
                                           ws-orig-total-svc
                                           ws-orig-oma
                                           ws-orig-ohip.

    move spaces                         to clmhdr-reference.
    move hold-week                      to clmhdr-week.
    move hold-day                       to clmhdr-day.
    move batctrl-batch-nbr              to clmhdr-orig-batch-nbr.
    move zero                           to clmhdr-zeroed-oma-suff-adj.
    move batctrl-batch-type             to clmhdr-batch-type.
    move batctrl-bat-clinic-nbr-1-2     to clmhdr-clinic-nbr-1-2.
    move batctrl-loc                    to clmhdr-loc.
    move batctrl-agent-cd               to clmhdr-agent-cd.
    move batctrl-adj-cd                 to clmhdr-adj-cd.
    move batctrl-date-period-end        to clmhdr-date-period-end.
    move batctrl-cycle-nbr              to clmhdr-cycle-nbr.

*   the following move statement is added on 87/09/23 by m.s for sms 97.

    move batctrl-adj-cd-sub-type        to clmhdr-adj-cd-sub-type.


ba0-99-exit.
    exit.


da0-verify-ok-to-modify-claim.

*       (can't adjust if batch's status indicates it hasn't been 'sent to ohip'

* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  63
*                      d004.cbl                                      )
*       (place present batch's 'batctrl rec', 'feedback', and 'key' in save area
    move batctrl-rec                            to ws-save-batctrl-rec.
    move feedback-batctrl-file                  to ws-save-batctrl-feedback.
    move key-batctrl-file                       to ws-save-batctrl-key.

*       (attempt read of batctrl rec of claim being adjusted)
    move clmhdr-batch-nbr                       to key-batctrl-file.

    read  batch-ctrl-file       key is key-batctrl-file
        invalid key
*           (batctl rec not found - ok to adjust claim)
            move "Y"                                    to ws-flag-ok-to-adjust
            go to da0-90-reset-batctrl.

*       (batctrl rec found but if status indicates the batch has been processed
*        to the 'sent to ohip' stage or further then claim can be adjusted)
* 2002/09/26 - MC
*    if batctrl-batch-status < 2
    if batctrl-batch-status < 3
* 2002/09/26 - end
    then
*       (error -- can't adjust claim)
        move 13                         to err-ind
        perform za0-common-error        thru za0-99-exit
        move "N"                        to ws-flag-ok-to-adjust
     else
        move "Y"                        to ws-flag-ok-to-adjust.
*   endif

da0-90-reset-batctrl.
*       (restore present batch's 'batctrl rec' and 'feedback' from save area)
    move ws-save-batctrl-rec                    to batctrl-rec.
    move ws-save-batctrl-feedback               to feedback-batctrl-file.
    move ws-save-batctrl-key                    to key-batctrl-file.


da0-99-exit.
    exit.


fa0-obtain-clmhdr-data.

*mf move zeroes                         to key-clm-oma-cd
*mf                                        key-clm-oma-suff
*mf                                        key-clm-adj-nbr.
    move zeroes                         to clmdtl-b-oma-cd
                                           clmdtl-b-oma-suff
                                           clmdtl-b-adj-nbr.
    if batctrl-adj-cd not = "C"
    then
        perform xe0-read-claims-mstr    thru xe0-99-exit
        if not-ok
        then
            move 6                      to err-ind
            perform za0-common-error    thru za0-99-exit
            go to az0-end-of-job
        else
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  64
*                      d004.cbl                                      )
*           save claim header and feedback for future updating
*           of the original header in 'pa0'
*
            move feedback-claims-mstr   to ws-save-claims-feedback
            move claims-mstr-hdr-rec    to ws-save-claims-header
*       endif
    else
        move clmrec-hdr-date-claim      to hold-adjusted-clms-de-date.
*   endif


*       (preset claim hdr with values from claim being paid/adjusted)
    if clmhdr-loc =    zeros
                    or spaces
    then
        move clmrec-hdr-loc             to      clmhdr-loc.
*   (else)
*   endif

    move clmrec-hdr-diag-cd             to      clmhdr-diag-cd.
    move clmrec-hdr-hosp                to      clmhdr-hosp.
    move clmrec-hdr-i-o-pat-ind         to      clmhdr-i-o-pat-ind.
*mf move clmrec-hdr-pat-ohip-id-or-chart to     clmhdr-pat-ohip-id-or-chart.
*mf (bug - commented line contained 'b' key - not 'p' key data.
*          added next 2 lines to fix problem.)
*   move clmrec-hdr-b-pat-id            to      clmhdr-pat-ohip-id-or-chart.
    move clmdtl-p-claims-mstr           to      clmhdr-pat-ohip-id-or-chart.
    move "I"                            to      clmhdr-pat-key-type.

    move clmrec-hdr-pat-acronym         to      clmhdr-pat-acronym.
*   move clmrec-doc-dept-nbr            to      clmhdr-doc-dept.

*   access to doc-mstr, use the doc-dept instead of clmhdr-doc-dept
*   of the original claim header record. 93/02/25 by m.c.

    move clmhdr-doc-nbr                 to doc-nbr.
    perform xf0-read-doc-mstr thru xf0-99-exit.
    if not-ok
    then
        move "N"                        to flag-err-data
        move 7                          to err-ind
        perform za0-common-error thru za0-99-exit
        move clmrec-doc-dept-nbr        to clmhdr-doc-dept
    else
* 2013/11/06 - MC4
        display scr-doc-name
* 2013/11/06 - end
        move doc-dept                   to clmhdr-doc-dept.
*   endif



    if clmrec-hdr-status-ohip = '00'
    then
        move spaces                     to      clmhdr-reference
    else
        move clmrec-hdr-status-ohip     to      clmhdr-reference.
*   endif
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  65
*                      d004.cbl                                      )

    display scr-reference.

fa0-99-exit.
    exit.
ja0-acpt-clmhdr-detail.

*       (accept details into clm hdr and dtl recs)

    move "Y"                            to flag-err-data.

    display scr-clmhdr-loc.

*       (if claim # entered = 0 ,ie. claim id doc # = 0, then doc # required inp
*          -- else preset using claim id's doc #)
    if clmhdr-doc-nbr not = zero
    then
        move clmhdr-doc-nbr             to ws-doc-nbr
        display scr-ws-doc-nbr
        go to ja0-20-input-amt.
*   (else)
*   endif

*       (transactions 'M' and 'R' allow blank claim id's -- a dummy claim id mus
*           using doc #)
*
*  pdr 471 - the following accept on doc nbr is only applied to 'R'
*            adjustment because 'M' payment is prompted in ab6 subroutine.
*

    if batctrl-adj-cd = 'M'
    then
        go to ja0-20-input-amt.
*   endif

    accept scr-ws-doc-nbr.
    if ws-doc-nbr not = zero
    then
*       (doc # must exist on doc mstr)
        move ws-doc-nbr                 to doc-nbr
        perform xf0-read-doc-mstr       thru xf0-99-exit
        if ok
        then
* 2013/11/06 - MC4
            display scr-doc-name
* 2013/11/06 - end
            go to ja0-20-input-amt.
*       (else)
*       endif
*   (else)
*   endif

*    (error -- doc # = 0 or not found on doc mstr)
    move "N"                            to flag-err-data.
    move 7                              to err-ind.
    perform za0-common-error            thru za0-99-exit.
    go to ja0-99-exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  66
*                      d004.cbl                                      )


ja0-20-input-amt.

    display scr-ohip-posted.
    accept  scr-ohip-posted.

    if ws-posted-ohip = zero
    then
        move 17                         to err-ind
        perform za0-common-error        thru za0-99-exit
        go to ja0-20-input-amt.
*   (else)
*   endif

*       (default 'C' type 'P'ayment is positive data entry but value is to be
*        negative on file so sign is reversed)
    if    batctrl-batch-type = "P"
      and batctrl-adj-cd     = "C"
    then
        subtract ws-posted-ohip         from    zero
                                        giving  ws-posted-ohip
        display scr-ohip-posted.
*   (else)
*   endif

*       (update clmdtl fields according to transaction type and agent code)
    move ws-posted-ohip                 to clmdtl-fee-ohip.

*       (if agent is not 'ohip' then oma-amt = ohip-amt  -- otherwise
*        -- use a straight 70% unless adjust code = 'B' in which case
*           use the % that the ohip-amt is of the oma-amt on the claim being adj

*  if the adjust code = 'R', 'M', 'C', or 'A', set the oma fee to be
*  the same as ohip fee - sms 111 by m.s.

    if      batctrl-agent-cd  not = 0
        or (batctrl-adj-cd = 'R' or 'M' or 'C' or 'A')
    then
        move ws-posted-ohip             to ws-posted-oma
*                                          clmdtl-fee-oma
    else
        if batctrl-adj-cd = "B"
        then
            perform ja1-calc-fee-oma-for-adj-b
                                        thru ja1-99-exit
        else
*           (use a straight 70%)
            multiply ws-posted-ohip     by 100  giving ws-posted-oma
            divide ws-posted-oma        by  70  giving ws-posted-oma
                                                       clmdtl-fee-oma.
*       endif
*   endif

ja0-90-display-oma.

    display scr-oma-posted.
    move ws-posted-oma                  to ws-hold-posted-oma.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  67
*                      d004.cbl                                      )

*  if the adjust code = 'R', 'M', 'C' or 'A', bypass the oma fee
*  field - sms  111 by m.s.

    if  batctrl-adj-cd = 'R' or 'M' or 'C' or 'A'
    then
        go to ja0-95-acpt-tech-portion.
*   endif

*       ( operator allowed to correct calculated value to make up
*         for "SLIGHT" rounding errors.  note: the operator is not
*         allowed to change the value more than 50% and not = zero )

    accept scr-oma-posted.

    if ws-posted-oma = zero
    then
        move 44                         to err-ind
        perform za0-common-error        thru za0-99-exit
        move ws-hold-posted-oma         to ws-posted-oma
        go to ja0-90-display-oma
    else
*       ( if the original oma amount was zero then bypass the 50% check
*         as any change will be greater than 50%.  ths user must however
*         enter a valid amount as zero will not be allowed through. )
        if ws-hold-posted-oma = zero
        then
            next sentence
        else
            perform ja2-check-for-50-perc
                                        thru ja2-99-exit
            if ws-hold-50-perc < temp
            then
                move 43                 to err-ind
                perform za0-common-error
                                        thru za0-99-exit
                move ws-hold-posted-oma to ws-posted-oma
                go to ja0-90-display-oma
            else
                next sentence.
*           endif
*       endif
*   endif

    move ws-posted-oma                  to clmdtl-fee-oma.

ja0-95-acpt-tech-portion.

    display scr-amt-tech.
    accept  scr-amt-tech.

*       (default 'C' type 'P'ayment is positive data entry but value is to be
*        negative on file so sign is reversed)
    if    batctrl-batch-type = "P"
      and batctrl-adj-cd     = "C"
    then
        subtract ws-amt-tech            from    zero
                                        giving  ws-amt-tech
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  68
*                      d004.cbl                                      )
        display scr-amt-tech.
*   (else)
*   endif

    if   (    ws-posted-ohip > zero
          and ws-amt-tech    < zero
         )
      or (    ws-posted-ohip < zero
          and ws-amt-tech    > zero
         )
    then
        move 47                                 to err-ind
        perform za0-common-error                thru za0-99-exit
        go to ja0-95-acpt-tech-portion.
*   endif

    move ws-posted-ohip                 to abs-posted-ohip
    move ws-posted-oma                  to abs-posted-oma
    move ws-amt-tech                    to abs-amt-tech.

    if    abs-posted-ohip >= abs-posted-oma
      and abs-amt-tech    >  abs-posted-ohip
    then
        move 45                         to err-ind
        perform za0-common-error        thru za0-99-exit
        go to ja0-95-acpt-tech-portion
    else
        if    abs-posted-ohip < abs-posted-oma
          and abs-amt-tech    > abs-posted-oma
        then
            move 45                             to err-ind
            perform za0-common-error            thru za0-99-exit
            go to ja0-95-acpt-tech-portion
        else
            if   abs-amt-tech >   abs-posted-ohip
                               or abs-posted-oma
            then
                move 46                         to err-ind
                perform za1-common-warning      thru za1-99-exit.
*           endif
*       endif
*   endif

    subtract ws-amt-tech from ws-posted-ohip giving ws-prof-ohip.
    subtract ws-amt-tech from ws-posted-oma  giving ws-prof-oma.

*   (display professional calculations based upon whether this claim
*    uses oma or ohip prices)
*      display scr-disp-clmhdr-dtl-3.
    move batctrl-agent-cd                       to def-agent-code.
    if def-agent-ohip
    then
        display scr-prof-ohip
    else
        display scr-prof-oma.
*   endif

    move ws-amt-tech                    to clmdtl-amt-tech-billed.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  69
*                      d004.cbl                                      )
*       (allow input of location if location is zero)
    if clmhdr-loc = "0000"
    then
        accept scr-clmhdr-loc.
*   (else)
*   endif

    accept scr-reference.

ja0-99-exit.
    exit.
ja1-calc-fee-oma-for-adj-b.

*       for transaction type 'b', calculate oma-fee from ohip-amt entered (ws-po
*           by calculating the percent of ohip-fee vs oma-fee on the claim
*           that is being adjusted.  set oma-amt (ws-posted-oma) to be this perc

    divide ws-orig-oma                  by ws-orig-ohip
                                        giving clmdtl-fee-oma.

    multiply clmdtl-fee-oma             by     ws-posted-ohip
                                        giving clmdtl-fee-oma
                                               ws-posted-oma.

ja1-99-exit.
    exit.
ja2-check-for-50-perc.

    subtract ws-posted-oma              from ws-hold-posted-oma
                                        giving  temp.

    if temp < zero
    then
        multiply temp                   by -1
                                        giving temp.
*   (else)
*   endif

    divide 2                            into ws-hold-posted-oma
                                        giving ws-hold-50-perc.

    if ws-hold-50-perc < zero
    then
        multiply ws-hold-50-perc        by -1
                                        giving ws-hold-50-perc.
*   (else)
*   endif

ja2-99-exit.
    exit.
la0-acpt-verification.

    display verification-screen.
    accept  verification-screen.

    if flag =   "Y"
             or "N"
             or "M"
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  70
*                      d004.cbl                                      )
             or "L"
* sms 105 allow location code to be updated for "R" adjustments  s.f.
    then
        next sentence
    else
        move 1                          to err-ind
        perform za0-common-error        thru za0-99-exit
        go to la0-acpt-verification.

la0-99-exit.
    exit.


ma0-write-clmhdr.

*       (move oma cd, suff, and adj nbr from hdr rec to dtl)
    move clmhdr-adj-oma-cd              to clmdtl-oma-cd.
    move clmhdr-adj-oma-suff            to clmdtl-oma-suff.

    move zeroes                         to clmhdr-zeroed-oma-suff-adj.
    move sys-date                       to clmhdr-date-sys
                                           clmhdr-date-cash-tape-payment.
*   (m and r transactions do not adjust existing claims - thus default indicator
*    - also since these adjustments don't adjust existing claims, use accessed
*       doctor rec to obtain doctor dept nbr)

    if batctrl-adj-cd =    "M"
                        or "R"
    then
        move "O"                        to clmhdr-i-o-pat-ind
*       (save adjusted doctor's dept nbr)
        move doc-dept                   to clmhdr-doc-dept.
*   (else)
*   endif

*---  clmhdr-adj-cd-sub-type  -----

    move "N"                            to clmhdr-tape-submit-ind.
    move zeroes                         to clmhdr-status-ohip.

*       (since dummy claim prepared for 'M' and 'R' adjustments there is no pati
    if     batctrl-adj-cd = "M"
    then
        move     spaces                 to clmhdr-pat-ohip-id-or-chart
                                           clmhdr-pat-acronym
    else
        if batctrl-adj-cd = "R"
        then
            move spaces                 to clmhdr-pat-ohip-id-or-chart
                                           clmhdr-pat-acronym
        else
            next sentence.
*       endif
*   endif

    add ws-posted-ohip                  to batctrl-amt-act.

    if batctrl-adj-cd = "A"
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  71
*                      d004.cbl                                      )
    then
        add ws-posted-oma               to clmhdr-tot-claim-ar-oma
        add ws-posted-ohip              to clmhdr-tot-claim-ar-ohip
                                           batctrl-calc-ar-due
        add ws-amt-tech                 to clmhdr-amt-tech-billed
    else
        if batctrl-adj-cd = "B"
        then
            add ws-posted-ohip          to batctrl-calc-ar-due
                                           batctrl-calc-tot-rev
                                           clmhdr-tot-claim-ar-ohip
            add ws-posted-oma           to clmhdr-tot-claim-ar-oma
            add ws-amt-tech             to clmhdr-amt-tech-billed
        else
            if batctrl-adj-cd = "C"
            then
                add ws-posted-ohip      to clmhdr-manual-and-tape-paymnts
                                           batctrl-manual-pay-tot
                add ws-amt-tech          to clmhdr-amt-tech-paid
            else
                if batctrl-adj-cd = "M"
                then
                    add ws-posted-ohip  to clmhdr-manual-and-tape-paymnts
*                                          clmhdr-tot-claim-ar-ohip
                                           batctrl-manual-pay-tot
                                           batctrl-calc-tot-rev
                    add ws-amt-tech     to clmhdr-amt-tech-paid
                else
                    if batctrl-adj-cd = "R"
                    then
                        add ws-posted-ohip      to batctrl-calc-tot-rev
                                                   clmhdr-tot-claim-ar-ohip
                        add ws-posted-oma       to clmhdr-tot-claim-ar-oma
                        add ws-amt-tech         to   clmhdr-amt-tech-billed
                    else
*                       (note -- no default for adj-cd)
                        next sentence.
*                   endif
*               endif
*           endif
*       endif
*   endif

*       (write the 'originating-batch-nbr' index --
*         -- so that claim header will appear in input batch's claims)

*mf move "B"                            to key-clm-key-type.
*mf move clmhdr-orig-batch-id           to key-clm-data.
    move "B"                            to clmdtl-b-key-type.
*mff                                       clmrec-hdr-b-key-type
*mff                                       k-clmdtl-b-key-type.
    move clmhdr-orig-batch-id           to clmdtl-b-data
*mff                                       clmrec-hdr-b-data
*mff                                       k-clmdtl-b-data.
*mf move zeros                          to key-clm-oma-cd
*mf                                        key-clm-oma-suff
*mf                                        key-clm-adj-nbr.
    move zeros                          to clmdtl-b-oma-cd
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  72
*                      d004.cbl                                      )
                                           clmdtl-b-oma-suff
                                           clmdtl-b-adj-nbr.
*mff                                       k-clmdtl-b-oma-cd
*mff                                       k-clmdtl-b-oma-suff
*mff                                       k-clmdtl-b-adj-nbr.

*mf (conversion technique - keys are already setup in FD area but data is to be
*mf  written from rec in WS area. Therefore move keys into WS rec)
    move key-claims-mstr                to k-clmhdr-claims-mstr.
*mf (adjustment record's don't need "P"atient key
    move "Z"                            to      clmdtl-p-key-type
                                             of claims-mstr-rec.
    move clmdtl-p-claims-mstr           to k-clmhdr-p-claims-mstr.
    write claims-mstr-rec  from  claim-header-rec
*mf                                             key is key-claims-mstr
        invalid key
            move 29                     to err-ind
            perform za0-common-error    thru za0-99-exit
            go to az0-end-of-job.

    add  1                              to ctr-writ-claims-mstr.

ma0-99-exit.
    exit.


na0-write-clmdtl.
*       (set adjustment # to non-zero value so that this adjustment rec can be
*         distinguished from an original claim rec)
    move 1                              to clmdtl-adj-nbr.

*       (write data record and the index so that the detail record will appear i
*          the sequence of the input batch's claim records)

*mf move "B"                            to key-clm-key-type.
*mf move clmdtl-orig-batch-id           to key-clm-data.
    move "B"                            to clmdtl-b-key-type
                                           clmrec-hdr-b-key-type
                                           k-clmdtl-b-key-type.
    move clmhdr-orig-batch-id           to clmdtl-b-data
                                           clmrec-hdr-b-data
                                           k-clmdtl-b-data.

*       (if entry didn't require oma code then use "ADJUS" for adjustment batch
*        or "PAID" for payment batch)
    if clmdtl-oma-cd =   spaces
                      or zeros
    then
        if clmhdr-batch-type = "A"
        then
            move 'ADJU'                 to clmdtl-oma-cd
            move 'S'                    to clmdtl-oma-suff
        else
            if clmhdr-batch-type = "P"
            then
                move "PAID"             to clmdtl-oma-cd
                move spaces             to clmdtl-oma-suff
            else
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  73
*                      d004.cbl                                      )
                next sentence
*           endif
*       endif
    else
        next sentence.
*   endif

*mf move clmdtl-oma-cd                  to key-clm-oma-cd.
*mf move clmdtl-oma-suff                to key-clm-oma-suff.
*mf move zero                           to key-clm-adj-nbr.
*mf brad debug below lines - needed ???
    move clmdtl-oma-cd                  to clmdtl-b-oma-cd.
    move clmdtl-oma-suff                to clmdtl-b-oma-suff.
    move zero                           to clmdtl-b-adj-nbr.

*mf (conversion technique - keys are already setup in FD area but data is to be
*mf  written from rec in WS area. Therefore move keys into WS rec)
    move key-claims-mstr                to k-clmdtl-claims-mstr
                                                of claim-detail-rec.
*mf (adjustment record's don't need "P"atient key
    move "Z"                            to      clmdtl-p-key-type
                                             of claims-mstr-rec.
    move clmdtl-p-claims-mstr           to k-clmdtl-p-claims-mstr
                                                of claim-detail-rec.
    write claims-mstr-rec  from  claim-detail-rec
*mf                                             key is key-claims-mstr
        invalid key
            move 30                     to err-ind
            perform za0-common-error    thru za0-99-exit
            go to az0-end-of-job.
    add 1                               to ctr-writ-claims-mstr.

*   (all transactions except 'M' and 'R' adjust existing claims and as
*   such must the detail recs must  appear in the claim being adjusted
*   as well as the adjustment claim.  DG cobol used a 2nd write inverted
*   to create the appropriate 2nd key for the detail rec however in
*   MF cobol the only way to get a 2nd "B" key is to do an 2nd write.
*   Therefore the write invert is changed to a simple write with the
*   "B" key setup for the adjusted claim and the "P" or
*    alternative key is set to "Z" so that it is in a sequence position
*   that all other programs will ignore.)

    if batctrl-adj-cd =   "M"
                       or "R"
    then
           go to na0-99-exit.
*   (else)
*   endif

*mf move clmdtl-id                      to      key-clm-data.
    move clmdtl-id                      to      clmdtl-b-data.
    move "B"                            to      clmdtl-b-key-type.
    move "Z"                            to      clmdtl-p-key-type
                                             of claims-mstr-rec.

*mf write  inverted  claims-mstr-rec    key is key-claims-mstr
    write            claims-mstr-rec
        invalid key
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  74
*                      d004.cbl                                      )
            move 31                     to err-ind
            perform za0-common-error    thru za0-99-exit
            go to az0-end-of-job.
 add 1                          to ctr-writ-claims-mstr.

na0-99-exit.
    exit.


pa0-update-adjusted-claim.

*       ('M' and 'R' do not adjust an existing claim so no processing needed)
    if batctrl-adj-cd =   "M"
                       or "R"
    then
        go to pa0-99-exit.
*   (else)
*   endif

*mf  (brad - is the below actually working ???)
*   (read in ab0 and store in claim's header rec save area)
    move ws-save-claims-header                  to claim-header-rec.
    move ws-save-claims-feedback                to feedback-claims-mstr.

*   (re-read updated header rec)
*mf move "B"                                    to key-clm-key-type.
*mf move clmhdr-claim-id                        to key-clm-data.
    move "B"                                    to clmdtl-b-key-type.
    move clmhdr-claim-id                        to clmdtl-b-data.

    move 0                                      to claims-occur.
    move zeros                                  to feedback-claims-mstr.

    perform xc0-read-claims-mstr                thru xc0-99-exit.

    if flag = "N"
    then
        move 40                                 to err-ind
        perform za0-common-error                thru za0-99-exit
        go to az0-end-of-job.
*   (else)
*   endif


*       (update header of claim being adjusted)
    if batctrl-adj-cd = "A"
    then
        add ws-posted-oma                       to clmhdr-tot-claim-ar-oma
        add ws-posted-ohip                      to clmhdr-tot-claim-ar-ohip
        add ws-amt-tech                         to clmhdr-amt-tech-billed
    else
        if batctrl-adj-cd = "B"
        then
            add ws-posted-oma                   to clmhdr-tot-claim-ar-oma
            add ws-posted-ohip                  to clmhdr-tot-claim-ar-ohip
            add ws-amt-tech                     to clmhdr-amt-tech-billed
        else
            if batctrl-adj-cd = "C"
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  75
*                      d004.cbl                                      )
            then
                add ws-posted-ohip              to clmhdr-manual-and-tape-paymnt
                add ws-posted-ohip              to clmhdr-curr-payment
                add ws-amt-tech                 to clmhdr-amt-tech-paid
            else
                next sentence.
*           endif
*       endif
*   endif

*mf (added move statment since 'rewrite' stmnt  with 'from' optino
*mf  kept getting invalid key)
    move claim-header-rec               to      claims-mstr-rec.
    rewrite  claims-mstr-rec
*mf       get invalid key with 'from claim-header-rec' on 'rewrite'
*mf                     key is key-claims-mstr
        invalid key
            move 34                             to err-ind
            perform za0-common-error            thru za0-99-exit
            go to az0-end-of-job.


pa0-99-exit.
    exit.
xa0-disp-batctrl-data.

    display scr-title-batch-control-data.

    display scr-acpt-batch-nbr.
    display scr-acpt-batch-type.
    display scr-val-batch-period-cycle.
    display scr-acpt-mask.
    display scr-lit-batctrl-data.

    subtract batctrl-amt-act                    from      batctrl-amt-est
                                                giving ws-batctrl-amt-diff.
    display scr-val-batctrl-data.

xa0-99-exit.
    exit.
xb0-allow-change-of-estimates.

    display scr-acpt-change-verification.
    accept  scr-acpt-change-verification.

    if change-reply = "Y"
    then
        display scr-acpt-change-password
        accept  scr-acpt-change-password
        if password-input  =  password  or  password-special-privledges
        then
            perform xb1-input-batctrl-est       thru xb1-99-exit
            go to xb0-allow-change-of-estimates
        else
            move 3                              to err-ind
            perform za0-common-error            thru za0-99-exit
            go to xb0-allow-change-of-estimates.
*       endif
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  76
*                      d004.cbl                                      )
*    (else)
*    endif


xb0-99-exit.
    exit.



xb1-input-batctrl-est.

*     (input estimate of total fee amounts in batch)

    accept  scr-amt-est.
*       (default for 'C' type 'P'ayment is positive data entry but value is to
*        be negative on file so sign is reversed)
    if    batctrl-batch-type = "P"
      and batctrl-adj-cd     = "C"
    then
        subtract batctrl-amt-est                from    zero
                                                giving  batctrl-amt-est
        display scr-amt-est.
*   (else)
*    endif

*       (if special password is entered then allow updating of the
*        the batch control rec's actual values -- this is to be done
*        only by dyad staff to correct the batctrl rec when it
*        differs from the actual value of records in the batch. this
*        would happen if the adjustment program crashed or if the system
*        went down while the adjustment program was running (d004).
*        this discrepancy would be shown in reports r002a or r002b)

    if password-input = password-special-privledges
    then
        accept scr-amt-act.
*   (else)
*   endif

    subtract batctrl-amt-act                    from      batctrl-amt-est
                                                giving ws-batctrl-amt-diff.
    display scr-amt-diff.


xb1-99-exit.
    exit.
xc0-read-claims-mstr.

    read claims-mstr    into claim-header-rec     key is key-claims-mstr
        invalid key
                move "N"                to      flag
                go to xc0-99-exit.

    move "Y"                            to      flag.
    add  1                              to      ctr-read-claims-mstr.

xc0-99-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  77
*                      d004.cbl                                      )


xd0-read-clmdtl.

    read    claims-mstr    next   into claim-detail-rec
*mf     invalid key
        at end
            move "N"                            to flag
            go xd0-99-exit.

    move "Y"                                    to flag.
    add 1                                       to ctr-read-claims-mstr.

xd0-99-exit.
    exit.
xe0-read-claims-mstr.

    move zero                   to claims-occur.
    move spaces                 to feedback-claims-mstr.

    read claims-mstr            key is key-claims-mstr
        invalid key
            move "N"                    to flag
            go to xe0-99-exit.

    move "Y"                            to flag.
    add  1                              to ctr-read-claims-mstr.

xe0-99-exit.
    exit.
xf0-read-doc-mstr.

    read  doc-mstr
        invalid key
                move "N"                to flag
                go to xf0-99-exit.

    move "Y"                            to flag.
    add  1                              to ctr-read-doc-mstr.

xf0-99-exit.
    exit.
xh0-read-oma-fee-mstr.

    read  oma-fee-mstr
*mf     suppress data record
        invalid key
                move "N"                to flag
                go to xh0-99-exit.

    move "Y"                            to flag.
    add  1                              to ctr-read-oma-mstr.

xh0-99-exit.
    exit.

* MC5
xi0-read-oma-dtl.
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  78
*                      d004.cbl                                      )

   read  f040-dtl
       invalid key
                move 'N'                to flag
                go to xi0-99-exit.

   move 'Y'                             to flag.

xi0-99-exit.
   exit.
* MC5 - end

xj0-read-const-mstr.

    read    iconst-mstr
        invalid key
            move "N"                    to flag
            go to xj0-99-exit.

    move "Y"                            to flag.
    add  1                              to ctr-read-const-mstr.


xj0-99-exit.
    exit.



za0-common-error.

    move err-msg (err-ind)              to      err-msg-comment.
    display err-msg-line.

    accept scr-confirm.

*   display confirm.
*   stop " ".
    display blank-line-24.

za0-99-exit.
    exit.

za1-common-warning.

    move err-msg (err-ind)              to      err-msg-comment.
    display wrn-msg-line.
* 2011/11/16 - MC1
    move spaces                         to      confirm-space.
* 2011/11/16 - end
    accept scr-confirm.
* 2011/11/16 - MC1
    if confirm-space  = '!' or '*'
    then
        next sentence
    else
        go to za1-common-warning.
*   endif
*   2011//11/16 - end
* Micro Focus COBOL for UNIX         V4.0 revision 005 20-Mar-17 14:55 Page  79
*                      d004.cbl                                      )

*   display confirm.
*   stop " ".
    display blank-line-24.

za1-99-exit.
    exit.


    copy "y2k_default_sysdate_century.rtn".
y2k-default-sysdate.

    move sys-date-left                  to sys-date-temp.
    move sys-date-temp                  to sys-date-right.
    move zeros                          to sys-date-blank.
* 1999/dec/30 B.E.
*   add 19000000                        to sys-date-numeric.
    add 20000000                        to sys-date-numeric.

y2k-default-sysdate-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 Compiler
* Copyright (C) 1984-1995 Micro Focus Ltd.     URN 2XUPG/GB0/00000F
*                                              REF GNB-030056000AA
*
* Total Messages:     0
* Data:       12928     Code:       13911
