* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   1
*                      u035cnoupd.cbl
* Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Accepted - SHOW-DIR
* Accepted - SOURCEFORMAT"FREE"
* Accepted - SPZERO
* Accepted - TIME
* Accepted - TRUNC
* Accepted - RESEQ
* Accepted - SEQCHK
* End Of Directives File: /usr/opt/mfcobol4.0/cobol.dir
identification division.
program-id. u035cnoupd.
author. dyad computer systems inc.
installation. rma.
date-written. 85/11.
date-compiled. 18-May-06 15:42.
security.
*
*    files      : f002    - claims master
*               :         - u035_sort_work_file
*               : f010    - patient master
*               : f020    - doctor master
*               : f040    - oma fee mstr
*               : f094    - msg sub mstr
*               : ru035   - print file
*
*
*    program purpose : to print the direct billing invoices
*                       this pgm is the third in a series of 3 pgms.
*                       it uses the sorted work file that is output
*                       by u035b to print the direct billing invoices.

*
*    date       programmer          modification
*    ----       ----------          ------------
*
*    84/12/19   i.warsh             activity cs25 to use the
*                                   reference field date for direct
*                                   bills.
*
*    85/01      i.warsh             removed the subscriber last stmnt
*                                   field being updated, now using only
*                                   the clmhdr reference field. cs25
*
*    85/04      i.warsh             added code for the ikey
*
*    85/11      m. so               pdr 285
*                                   use the sort work file that is
*                                   output by u035b as the sorted
*                                   claim shadow file for input.
*
*    87/05      s. blair          - conversion from aos to aos/vs.
*                                   change field size for
*                                   status clause to 2 and
*                                   feedback clause to 4.
*
*    89/02      s. fader          - sms 113
*                                 - add agent to sort and print agent
*                                   control totals at break
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   2
*                      u035cnoupd.cbl
*
*    89/03      m. chan           - pdr 303
*                                   modify 'BC1-DETAIL-LOOP' subroutine
*                                   do not include the 'CLMDTL-ADJUST-REPRINT'
*                                   as part of condition for payment or
*                                   adjustment
*
*   revised march/89 : - sms 115 s.f.
*                      - make sure file status is pic xx ,feedback is
*                        pic x(4) and infos status is pic x(11).
*
*   revised oct/91:    - pdr 530 m.c.
*                      - do not create statement for agent 4 and clmhdr
*                        reprint flag = 'N' regardless of 30 days
*
*   revised aug/93:    - pdr 567 m.c.
*                      - print country as part of the address
*
* 1999/jan/31 B.E.      - y2k
* 2003/dec/11 M.C.      - alpha doc nbr

environment division.
input-output section.
file-control.

    select clm-shdw-work-mstr
        assign to "u035_sort_work_mstr"
        organization is sequential
        file  status is status-cobol-clm-shadow-mstr.

*
    copy "f002_claims_mstr.slr".
    select claims-mstr
*tobefixed* brad no unique key for this file !!!!!
*               two record keys
*       assign index to "f002_claims_mstr"
*       assign data  to "f002_claims_mstr"

        assign to disk "$pb_data/f002_claims_mstr"

        organization is indexed
        access mode  is dynamic
*mf     (added lock mode so that files aren't open exclusively)
        lock mode is manual

*       record key   is key-claims-mstr     length is 18
        record key   is key-claims-mstr
          with duplicates

*tobefixed*             with  duplicates occurrence is claims-occur
*mf     record key   is key-gen-claims-mstr length is  2
*mf     alternate record key   is key-gen-claims-mstr
        alternate record key   is clmdtl-p-claims-mstr
           with duplicates

        status       is status-cobol-claims-mstr.
*
    copy "f010_new_patient_mstr.slr".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   3
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
*   (2002/jun/26 B.E. added chart nbrs 2-5)

    select pat-mstr
        assign to disk "$pb_data/f010_pat_mstr"
        organization is indexed
        access mode  is dynamic
        lock mode is manual

        record    key is key-pat-mstr    of pat-mstr
        alternate key is pat-health-nbr  of pat-mstr with duplicates
        alternate key is pat-acronym     of pat-mstr with duplicates
        alternate key is pat-ohip-mmyy   of pat-mstr with duplicates
        alternate key is pat-chart-nbr   of pat-mstr with duplicates
        alternate key is pat-chart-nbr-2 of pat-mstr with duplicates
        alternate key is pat-chart-nbr-3 of pat-mstr with duplicates
        alternate key is pat-chart-nbr-4 of pat-mstr with duplicates
        alternate key is pat-chart-nbr-5 of pat-mstr with duplicates
        alternate key is pat-full-name   of pat-mstr with duplicates

        status       is status-cobol-pat-mstr.
*
*
    copy "f020_doctor_mstr.slr".
    select doc-mstr
*mf     assign index to "f020_doctor_mstr"
*mf     assign data  to "f020_doctor_mstr"
        assign to disk "$pb_data/f020_doctor_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual

        record key   is doc-nbr of doc-mstr-rec

*mf added two  alternative keys below
        alternate key is doc-name-soundex
         with duplicates
        alternate key is doc-ohip-nbr of doc-mstr
         with duplicates
              status  is status-cobol-doc-mstr.
*       infos status  is status-doc-mstr.
*       eof-flag     is eof-doc-mstr
*
*
    copy "f040_oma_fee_mstr.slr".
    select oma-fee-mstr
*mf     assign index to "f040_oma_fee_mstr"
*mf     assign data  to "f040_oma_fee_mstr"
        assign to disk "$pb_data/f040_oma_fee_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual
        record key   is fee-oma-cd
*mf     infos status is status-oma-mstr.
*       eof-flag     is eof-oma-mstr
        status is status-cobol-oma-mstr.
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   4
*                      u035cnoupd.cbl                                )
    copy "f094_msg_sub_mstr.slr".
    select msg-sub-mstr
*mf     assign index    to "f094_msg_sub_mstr"
*mf     assign data     to "f094_msg_sub_mstr"
        assign to disk "$pb_data/f094_msg_sub_mstr"
        organization    is indexed
        access mode     is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual
        record key      is msg-sub-key
              status    is status-cobol-msg-sub-mstr.
*mf     infos status    is status-infos-msg-sub-mstr.
*
    select print-file
        assign to printer print-file-name
        file status is status-prt-file.

data division.
file section.

    copy "f002_claims_mstr.fd".
* 99/jan/15 B.E  - y2k
* 01/nov/06 B.E. - added clmrec-hdr-payroll as redefine of clmrec-hosp
* 03/aug/21 M.C. - increase the file size by 8 characters
* 03/oct/20 b.e. - alpha doctor nbr
* 04/jun/02 b.e. - added field clmdtl-b-batch-number-numeric

fd  claims-mstr
*            block  contains       224 characters
*            record contains       224 characters .
*!             block  contains       232 characters
*!             record contains       232 characters .
             block  contains       228 characters
             record contains       228 characters .
*       feedback is feedback-claims-mstr.


* insert this warning message from "F000_DUPLICATE_FD_WARNING.FD

*----------------  note -----------------------
*-- any changes to this fd must also be made  --
*-- to the corresponding "..._D001_..." fd    --
*-- and vice versa                            --
*----------------  note -----------------------
01  claims-mstr-rec.

  05  claims-mstr-hdr-rec.

    10  clmrec-hdr-clinic-nbr-1-2               pic 99.
*!    10  filler                                  pic x(09).
    10  filler                                  pic x(08).
    10  clmrec-zeroed-oma-suff-adj              pic x(06).
    10  clmrec-zeroed-area redefines clmrec-zeroed-oma-suff-adj
                                                pic 9(06).
    10  clmrec-hdr-batch-type                   pic x.
    10  filler                                  pic x(15).
    10  clmrec-hdr-diag-cd                      pic 9(3).
    10  clmrec-hdr-loc                          pic x(4).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   5
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)

    10  clmrec-hdr-hosp                         pic x.
    10  clmrec-hdr-payroll redefines clmrec-hdr-hosp pic x.

    10  clmrec-hdr-agent-cd                     pic 9.
    10  filler                                  pic x(2).
    10  clmrec-hdr-i-o-pat-ind                  pic x.
    10  clmrec-hdr-ohip-id-or-chart             pic x(16).
    10  clmrec-hdr-pat-acronym                  pic x(9).
* reference x(11) + date admit 9(8)
    10  filler                                  pic x(19).

    10  clmrec-doc-dept-nbr                     pic 99.

*  (cash payment date 9(8) + curr payment 9(7) + ped 9(8)  + cycle nbr 9(2)
    10  filler                                  pic x(25).

*      (field now refers to clmhdr-date-sys instead of old
*       clmhdr-date-claim, but name remains the same)
    10  clmrec-hdr-date-claim                   pic x(8).
    10  clmrec-hdr-amt-tech-billed              pic s9(4)v99.
    10  clmrec-hdr-amt-tech-paid                pic s9(4)v99.
    10  clmrec-hdr-tot-claim-ar-oma             pic s9(5)v99.
    10  clmrec-hdr-tot-claim-ar-ohip            pic s9(5)v99.
    10  clmrec-hdr-manual-tape-pymnts           pic s9(5)v99.
    10  clmrec-hdr-status-ohip                  pic xx.
*       (review=1,submitdate=8,confidential=1,servdate=8,origbatchid=11)
* 2003/08/21 - MC - 8 chars for 4 new elements (elig-error, elig-status, serv-er
*   10  filler                                  pic x(29).
*!  10  filler                                  pic x(37).
    10  filler                                  pic x(36).
* 2003/08/21 - end

*-------------------
10  k-key-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  clmrec-hdr-b-key-type                        pic x.
    20  clmrec-hdr-b-data.
*!        25  clmrec-hdr-b-batch-num                   pic 9(9).
        25  clmrec-hdr-b-batch-num                   pic x(8).
        25  clmrec-hdr-b-batch-nbr redefines clmrec-hdr-b-batch-num.
            30  clmrec-hdr-b-clinic-nbr-1-2          pic 99.
*!            30  clmrec-hdr-b-doc-nbr                 pic 9(4).
            30  clmrec-hdr-b-doc-nbr                 pic x(3).
            30  clmrec-hdr-b-doc-nbr-r redefines clmrec-hdr-b-doc-nbr.
*!                35  clmrec-hdr-b-doc-nbr-1           pic 9.
*!                35  clmrec-hdr-b-doc-nbr-2-4         pic 999.
                35  clmrec-hdr-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  clmrec-hdr-b-batch-number.
                35  clmrec-hdr-b-week                pic 99.
                35  clmrec-hdr-b-day                 pic 9.
        25  clmrec-hdr-b-claim-nbr                   pic 99.
        25  clmrec-hdr-b-oma-cd                      pic x999.

        25  clmrec-hdr-b-oma-suff                    pic x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   6
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        25  clmrec-hdr-b-adj-nbr                     pic x.
    20  clmrec-hdr-b-data-r  redefines  clmrec-hdr-b-data.
        25  clmrec-hdr-b-pat-id                      pic x(15).
*!        25  filler                                   pic xx.
        25  filler                                   pic x.

10  k-clmdtl-p-claims-mstr.
    20  clmdtl-p-key-type                        pic x.
    20  clmdtl-p-data.
        25  clmdtl-p-batch-nbr.
            30  clmdtl-p-clinic-nbr-1-2      pic  99.
*!            30  clmdtl-p-doc-nbr             pic 9(4).
            30  clmdtl-p-doc-nbr             pic x(3).
            30  clmdtl-p-week                pic 99.
            30  clmdtl-p-day                 pic 9.
        25  clmdtl-p-claim-nbr               pic 99.
        25  clmdtl-p-oma-cd                  pic x999.
        25  clmdtl-p-oma-suff                pic x.
        25  clmdtl-p-adj-nbr                 pic x.
*-------------------------

01  claims-mstr-dtl-rec.

*!    10  filler                                  pic x(11).
    10  filler                                  pic x(10).
    10  clmrec-dtl-oma-cd                       pic x(4).
    10  filler                                  pic x(5).
    10  clmrec-dtl-agent-cd                     pic  9.
    10  clmrec-dtl-adj-cd                       pic  x.
    10  clmrec-dtl-nbr-serv                     pic 99.
    10  clmrec-dtl-sv-date                      pic x(8).
    10  clmrec-dtl-consec-dates occurs 3 times.
        15  clmrec-dtl-sv-nbr                   pic 9.
        15  filler                              pic xx.
    10  clmrec-dtl-amt-tech-billed              pic s9(4)v99.
    10  clmrec-dtl-fee-oma                      pic s9(5)v99.
    10  clmrec-dtl-fee-ohip                     pic s9(5)v99.
* 2003/08/21 - MC
*   10  filler                                  pic x(127).
*!    10  filler                                  pic x(135).
    10  filler                                  pic x(134).
* 2003/08/21 - end

*mf added below copy to include 'external' key within record.
*mfcopy "f002_key_claims_mstr_mf.ws".
*-------------------
10  key-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  clmdtl-b-key-type                        pic x.
    20  clmdtl-b-data.
*!        25  clmdtl-b-batch-num                   pic 9(9).
        25  clmdtl-b-batch-num                   pic x(8).
        25  clmdtl-b-batch-nbr redefines clmdtl-b-batch-num.
            30  clmdtl-b-clinic-nbr-1-2          pic 99.
*!            30  clmdtl-b-doc-nbr                 pic 9(4).
            30  clmdtl-b-doc-nbr                 pic x(3).
            30  clmdtl-b-doc-nbr-r redefines clmdtl-b-doc-nbr.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   7
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
*!                35  clmdtl-b-doc-nbr-1           pic 9.
*!                35  clmdtl-b-doc-nbr-2-4         pic 999.
                35  clmdtl-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  clmdtl-b-batch-number.
                35  clmdtl-b-week                pic 99.
                35  clmdtl-b-day                 pic 9.
            30  clmdtl-b-batch-number-numeric redefines  clmdtl-b-batch-number
                                                pic 9(3).

        25  clmdtl-b-claim-nbr                   pic 99.
        25  clmdtl-b-oma-cd                      pic x999.

        25  clmdtl-b-oma-suff                    pic x.
        25  clmdtl-b-adj-nbr                     pic x.
    20  clmdtl-b-data-r  redefines  clmdtl-b-data.
        25  clmdtl-b-pat-id                      pic x(15).
*!        25  filler                               pic xx.
        25  filler                               pic x.

10  clmdtl-p-claims-mstr.
    20  clmdtl-p-key-type                        pic x.
    20  clmdtl-p-data.
        25  clmdtl-p-batch-nbr.
            30  clmdtl-p-clinic-nbr-1-2      pic  99.
*!            30  clmdtl-p-doc-nbr             pic 9(4).
            30  clmdtl-p-doc-nbr             pic x(3).
            30  clmdtl-p-week                pic 99.
            30  clmdtl-p-day                 pic 9.
        25  clmdtl-p-claim-nbr               pic 99.
        25  clmdtl-p-oma-cd                  pic x999.
        25  clmdtl-p-oma-suff                pic x.
        25  clmdtl-p-adj-nbr                 pic x.
*-------------------------

*
fd  clm-shdw-work-mstr
*!    block contains 58 characters.
    block contains 57 characters.

01  wf-shadow-sort-key.
    05  wf-shadow-agent                 pic 9.
    05  wf-shadow-rec.
        10  wf-shadow-key.
            15  wf-shadow-clinic                pic 99.
            15  wf-shadow-subdivision           pic x.
            15  wf-shadow-pat-surname   pic x(15).
            15  wf-shadow-pat-giv-name  pic x(12).
            15  wf-shadow-patient.
                20  wf-shadow-pat-key-type      pic a.
                20  wf-shadow-pat-key-data.
                    25  wf-shadow-pat-key-ohip  pic x(08).
                    25  filler                  pic x(07).
*!          15  wf-shadow-batch-nbr             pic 9(09).
            15  wf-shadow-batch-nbr             pic x(08).
            15  wf-shadow-claim-nbr             pic 9(02).

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   8
*                      u035cnoupd.cbl                                )
    copy "f010_patient_mstr.fd".
* file:  f010_patient_mstr.fd
* modification history
* --------------------
* 98/dec/01 D.B.        -y2k
* 99/jan/01 B.E.        - switch expiry date from mmyy to yymm
* 99/Jan/21 M.C.        - change pat-reserve-for-future from 21 to 1, andd
*                         pat-last-mod-by, change size from 330 to 315
* 99/mar/16 B.E.        - added pat-health-nbr-unvalidated,
*                         pat-version-cd-unvalidated, and
*                         pat-ohip-validiation-status for additional 13 bytes
*                         plus increase given name from 12 to 17 and surname
*                         from 15 to 25 characters for an addition 15 bytes for
*                         a total increase in sisze 13+15 = 28 bytes.
* 2000/mar/24 B.E.      - redefined pat-version-cd into 1 and 2 characters.
* 2002/may/10 B.E.      - phone-nbr from 7 to 20
*                       - added 4 addition hospital chart nbrs:
*                               pat-chart-nbr   = MUMC
*                               pat-chart-nbr-2 = CHEDOKE
*                               pat-chart-nbr-3 = HENDERSON
*                               pat-chart-nbr-4 = GENERAL
*                               pat-chart-nbr-5 = ST JOES
*                       - changed subscr-addr, subscr-addr-unvalidated and
*                         pat-old-addr elements to:
*                               addr1/2/3 from 21 to 30
*                        - change country from x(20) to x(1)
*                        - added an 'address' prov-cd x(2) as compared to the
*                          health insurance card prov-cd
* 2002/sep/13 B.E.      - postal code from 6 to 10
* 2003/apr/09 M.C.      - substitute pat-reserve-for-future with pat-obec-status
* 2003/nov/24 M.C.      - change pat-last-doc-nbr-seen from 9(6) to x(3)
*
* Note: The following files must be kept in sync:
*               f010_patient_mstr.fd
*               f010_patient_mstr_new.fd
*               f010_patient_mstr.ws


fd  pat-mstr
*          record      contains 343 characters .
*       record      contains 379 characters [+10(addr3) +4(pc) -19(country)]
*       record      contains 394 characters .  [ - 3(last doc seen)]
        record      contains 391 characters .
*       feedback is feedback-pat-mstr.

01 pat-mstr-rec.

    05  pat-acronym.
        10  pat-acronym-first6          pic x(6).
        10  pat-acronym-last3           pic xxx.

    05  pat-ohip-mmyy.
        10  pat-ohip-out-prov.
            15  pat-ohip-nbr            pic 9(8).
            15  pat-mm                  pic 99.
            15  pat-yy                  pic 99.
        10  filler                      pic x(3).
    05  pat-ohip-mmyy-r  redefines pat-ohip-mmyy.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page   9
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        10  pat-direct-alpha.
            15  pat-alpha1              pic x.
            15  pat-alpha2-3            pic xx.
        10  pat-direct-yy               pic xx.
        10  pat-direct-mm               pic xx.
        10  pat-direct-dd               pic xx.
        10  pat-direct-filler           pic x(6).

*       (MUMC)
    05  pat-chart-nbr.
*        10  pat-chart-m                        pic x.
*        10  pat-chart-yy               pic xx.
*        10  pat-chart-mm               pic xx.
*        10  pat-chart-4-5              pic x(5).
*        10  filler                     pic x(5).
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(9).

*       (CHEDOKE)
    05  pat-chart-nbr-2.
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(9).

*       (HENDERSON)
    05  pat-chart-nbr-3.
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(9).
*       (GENERAL)
    05  pat-chart-nbr-4.
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(9).
*       (ST JOES)
    05  pat-chart-nbr-5.
        10  pat-chart-1st-char          pic x.
        10  pat-chart-remainder         pic x(10).

    05  pat-full-name.
*          05  pat-surname                              pic x(15).
        10  pat-surname                 pic x(25).
        10  pat-surname-r  redefines  pat-surname.
            15  pat-surname-first6      pic x(6).
* MC        15  pat-surname-last14      pic x(14).
            15  pat-surname-last19      pic x(19).
        10  pat-surname-rr  redefines  pat-surname.
            15  pat-surname-first3      pic x(3).
            15  pat-surname-last22      pic x(22).

*           05  pat-given-name                  pic x(12).
        10  pat-given-name              pic x(17).
        10  pat-given-name-r  redefines  pat-given-name.
            15  pat-given-name-first3   pic xxx.
            15  pat-given-name-last14   pic x(14).
        10  pat-given-name-rr redefines pat-given-name-r.
            15  pat-given-name-first1   pic x.
            15  filler                  pic x(16).

    05  pat-init.
        10  pat-init1                   pic x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  10
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        10  pat-init2                   pic x.
        10  pat-init3                   pic x.
    05  pat-location-field.
        10  pat-location-field-1-3      pic x(3).
        10  filler                      pic x(1).
* 2003/11/24 - MC
*    05  pat-last-doc-nbr-seen          pic 9(6).
    05  pat-last-doc-nbr-seen           pic x(3).
* 2003/11/24 - end

    05  pat-birth-date                  pic 9(8).
    05  pat-birth-date-r  redefines  pat-birth-date.
        10  pat-birth-date-yy           pic 9999.
        10  pat-birth-date-mm           pic 99.
        10  pat-birth-date-dd           pic 99.
    05  pat-date-last-maint             pic 9(8).
    05  pat-date-last-maint-r redefines pat-date-last-maint.
        10  pat-date-last-maint-yy      pic 9999.
        10  pat-date-last-maint-mm      pic 99.
        10  pat-date-last-maint-dd      pic 99.
    05  pat-date-last-visit             pic 9(8).
    05  pat-date-last-visit-r redefines pat-date-last-visit.
        10  pat-date-last-visit-yy      pic 9999.
        10  pat-date-last-visit-mm      pic 99.
        10  pat-date-last-visit-dd      pic 99.
    05  pat-date-last-admit             pic 9(8).
    05  pat-date-last-admit-r redefines pat-date-last-admit.
        10  pat-date-last-admit-yy      pic 9999.
        10  pat-date-last-admit-mm      pic 99.
        10  pat-date-last-admit-dd      pic 99.
     05  pat-phone-nbr.
        10  pat-phone-nbr-first3        pic 999.
        10  pat-phone-nbr-last4         pic 9(4).
        10  pat-phone-nbr-remainder     pic x(13).

    05  pat-total-nbr-visits            pic 9(5).
    05  pat-total-nbr-claims            pic 9(5).
    05  pat-sex                         pic x.
    05  pat-in-out                      pic x.
    05  pat-nbr-outstanding-claims      pic 9(4).
    05  key-pat-mstr.
        10  pat-i-key                   pic x.
        10  pat-con-nbr                 pic 99.
        10  pat-i-nbr                   pic 9(12).
        10  filler                      pic x.
    05  pat-health-nbr                  pic 9(10).
    05  pat-version-cd.
        10  pat-version-cd-1            pic x.
        10  pat-version-cd-2            pic x.
    05  pat-health-65-ind               pic x.
    05  pat-expiry-date.
        10  pat-expiry-yy               pic 99.
        10  pat-expiry-mm               pic 99.
    05  pat-prov-cd                     pic xx.

*          05  subscr-addr1                     pic x(21).
    05  subscr-addr1                    pic x(30).
*          05  subscr-addr2                     pic x(21).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  11
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
    05  subscr-addr2                    pic x(30).
*          05  subscr-addr3                     pic x(21).
    05  subscr-addr3                    pic x(30).

    05  subscr-prov-cd                  pic xx.

* 2002/sep/13 B.E.
*    05  subscr-postal-cd               pic x(6).
    05  subscr-postal-cd                pic x(10).
    05  subscr-postal-cd-r  redefines  subscr-postal-cd.
        10  subscr-post-code1.
            15  subscr-post-cd1         pic x.
            15  subscr-post-cd2         pic 9.
            15  subscr-post-cd3         pic x.
        10  subscr-post-code2.
            15  subscr-post-cd4         pic 9.
            15  subscr-post-cd5         pic x.
            15  subscr-post-cd6         pic 9.
        10  filler                      pic x(4).

    05  subscr-msg-data.
        10  subscr-msg-nbr              pic xx.
        10  subscr-date-msg-nbr-eff-to          pic 9(8).
        10  subscr-date-msg-nbr-eff-to-r
              redefines subscr-date-msg-nbr-eff-to.
            15  subscr-date-msg-nbr-eff-to-yy   pic 9999.
            15  subscr-date-msg-nbr-eff-to-mm   pic 99.
            15  subscr-date-msg-nbr-eff-to-dd   pic 99.
        10  subscr-date-msg-nbr-eff-to-r1
              redefines subscr-date-msg-nbr-eff-to-r
                                                pic x(8).
        10  subscr-date-last-statement          pic 9(8).
        10  subscr-date-last-statement-r
              redefines subscr-date-last-statement.
            15  subscr-date-last-statement-yy           pic 9999.
            15  subscr-date-last-statement-mm           pic 99.
            15  subscr-date-last-statement-dd           pic 99.
    05  subscr-auto-update                              pic x.
    05  pat-last-mod-by                                 pic x(5).
    05  pat-date-last-elig-mailing                      pic 9(8).
    05  pat-date-last-elig-maint                        pic 9(8).
    05  pat-last-birth-date                             pic 9(8).
    05  pat-last-version-cd                             pic x(2).
    05  pat-mess-code                                   pic x(3).
***    05  pat-country                                     pic x(20).
    05  pat-country                                     pic x(1).
    05  pat-no-of-letter-sent                           pic 99.
    05  pat-dialysis                                    pic x(1).

***    05  pat-health-nbr-unvalidated                      pic 9(10).
***    05  pat-version-cd-unvalidated                      pic xx.
    05  pat-ohip-validiation-status                     pic x.

* 2003/04/09 - MC
*    05  pat-reserve-for-future                         pic x(1).
    05  pat-obec-status                                 pic x(1).
* 2004/04/09 - end
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  12
*                      u035cnoupd.cbl                                )
    copy "f020_doctor_mstr.fd".
* sms 137  bml  05-dec-90  increase fields by 2
* sms 139  mc   10-jun-92  add 5 clinic nbr and 2 spec codes in
*                          reserved for nip
*          mc   24-nov-93  include brad's fields of earning subsystem
*          mc   12-feb-94  include doc-ep-pay-code and doc-ep-pay-sub-code
*          db   03-jun-98  Year 2000
*          mc   16-jul-02  add 5 additional batch nbr for each additional
*                          clinic
*          mc   23-sep-02  rename the second occurrence of group-regular-service
*                          to group-over-serviced
*          be   05-nov-03  alpha doctor nbr
*          mc   03-mar-04  reuse filler x(4) for doc-afp-paym-group from filler2
*          be   06-apr-17  - increase to 800 when $1M payroll figures changed th

fd  doc-mstr
*       block  contains 680 characters
*       record contains 680 characters.
*       block  contains 695 characters
*       record contains 695 characters.
        block  contains 800 characters
        record contains 800 characters.

01 doc-mstr-rec.
*    05  doc-nbr                                        pic 9(3).
    05  doc-nbr                                 pic x(3).
    05  doc-dept                                pic 99.
    05  doc-ohip-nbr                            pic 9(6).
    05  doc-pract-nbr redefines doc-ohip-nbr    pic 9(6).
    05  doc-sin-nbr.
        10  doc-sin-123                         pic 999.
        10  doc-sin-456                         pic 999.
        10  doc-sin-789                         pic 999.
    05  doc-clinic-nbr                          pic 99.
    05  doc-spec-cd                             pic 99.
    05  doc-hosp-nbr                            pic x999.
    05  doc-name                                pic x(24).
    05  doc-name-soundex                        pic x(4).

    05  doc-inits.
        10  doc-init1                           pic x.
        10  doc-init2                           pic x.
        10  doc-init3                           pic x.
    05  doc-address-office.
        10  doc-addr-office-1                   pic x(24).
        10  doc-addr-office-2                   pic x(24).
        10  doc-addr-office-3                   pic x(24).
    05  doc-addr-office-r  redefines  doc-address-office.
        10  doc-addr-office  occurs 3 times     pic x(24).
    05  doc-addr-office-pc.
        10  doc-addr-office-pc-123.
            15  doc-addr-office-pc1             pic a.
            15  doc-addr-office-pc2             pic 9.
            15  doc-addr-office-pc3             pic a.
        10  doc-addr-office-pc-456.
            15  doc-addr-office-pc4             pic 9.
            15  doc-addr-office-pc5             pic a.
            15  doc-addr-office-pc6             pic 9.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  13
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
    05  doc-address-home.
        10  doc-addr-home-1                     pic x(24).
        10  doc-addr-home-2                     pic x(24).
        10  doc-addr-home-3                     pic x(24).
    05  doc-addr-home-r  redefines doc-address-home.
        10  doc-addr-home  occurs 3 times       pic x(24).
    05  doc-addr-home-pc.
        10  doc-addr-home-pc-123.
            15  doc-addr-home-pc1               pic a.
            15  doc-addr-home-pc2               pic 9.
            15  doc-addr-home-pc3               pic a.
        10  doc-addr-home-pc-456.
            15  doc-addr-home-pc4               pic 9.
            15  doc-addr-home-pc5               pic a.
            15  doc-addr-home-pc6               pic 9.
    05  doc-full-part-ind                       pic x.
    05  doc-class-code redefines doc-full-part-ind pic x.
    05  doc-bank-info.
        10  doc-bank-nbr                        pic 9(4).
        10  doc-bank-branch                     pic 9(5).
        10  doc-bank-acct                       pic x(12).
*   05  doc-tax-info.
*       10  doc-billing-percent                 pic 9v99.
*       10  doc-misc-percent                    pic 9v99.
*       10  doc-tax-percent                     pic 9v99.
*       10  doc-billing-percent                 pic 9v9999.
*       10  doc-misc-percent                    pic 9v9999.
*       10  doc-tax-percent                     pic 9v9999.
*       10  doc-pay-code                        pic x.
    05  doc-fac-dates.
        10  doc-date-fac-start.
* y2k       15  doc-date-fac-start-yy           pic 99.
            15  doc-date-fac-start-yy           pic 9999.
            15  doc-date-fac-start-mm           pic 99.
            15  doc-date-fac-start-dd           pic 99.
        10  doc-date-fac-term.
* y2k       15  doc-date-fac-term-yy            pic 99.
            15  doc-date-fac-term-yy            pic 9999.
            15  doc-date-fac-term-mm            pic 99.
            15  doc-date-fac-term-dd            pic 99.
    05    doc-fac-dates-r redefines doc-fac-dates.
        10  doc-date-fac occurs 2 times.
* y2k       15  doc-date-fac-yy                 pic 99.
            15  doc-date-fac-yy                 pic 9999.
            15  doc-date-fac-mm                 pic 99.
            15  doc-date-fac-dd                 pic 99.
    05  doc-annual-ceiling-info.
*        10  doc-ytdgua                          pic s9(7)v99 comp.
        10  doc-ytdgua                          pic s9(7)v99.
*        10  doc-ytdgub                          pic s9(7)v99 comp.
        10  doc-ytdgub                          pic s9(7)v99.
*        10  doc-ytdguc                          pic s9(7)v99 comp.
        10  doc-ytdguc                          pic s9(7)v99.
*        10  doc-ytdgud                          pic s9(7)v99 comp.
        10  doc-ytdgud                          pic s9(7)v99.
*        10  doc-ytdcea                          pic s9(7)v99 comp.
        10  doc-ytdcea                          pic s9(7)v99.
*        10  doc-ytdcex                          pic s9(7)v99 comp.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  14
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        10  doc-ytdcex                          pic s9(7)v99.
*        10  doc-ytdear                          pic s9(7)v99 comp.
        10  doc-ytdear                          pic s9(7)v99.
*        10  doc-ytdinc                          pic s9(7)v99 comp.
        10  doc-ytdinc                          pic s9(7)v99.
*        10  doc-ytdeft                          pic s9(7)v99 comp.
        10  doc-ytdeft                          pic s9(7)v99.
*        10  doc-totinc-g                        pic s9(7)v99 comp.
        10  doc-totinc-g                        pic s9(7)v99.
* y2k
*       10  doc-ep-date-deposit                 pic 9(4) comp.
        10  doc-ep-date-deposit                 pic 9(8).
*        10  doc-totinc                          pic s9(7)v99 comp.
        10  doc-totinc                          pic s9(7)v99.
*        10  doc-ep-ceiexp                       pic s9(7)v99 comp.
        10  doc-ep-ceiexp                       pic s9(7)v99.
*        10  doc-adjcea                          pic s9(7)v99 comp.
        10  doc-adjcea                          pic s9(7)v99.
*        10  doc-adjcex                          pic s9(7)v99 comp.
        10  doc-adjcex                          pic s9(7)v99.
*        10  doc-ceicea                          pic s9(7)v99 comp.
        10  doc-ceicea                          pic s9(7)v99.
*        10  doc-ceicex                          pic s9(7)v99 comp.
        10  doc-ceicex                          pic s9(7)v99.
        10  ceicea-prt-format                   pic x(13).
        10  ceicex-prt-format                   pic x(13).
        10  ytdcea-prt-format                   pic x(13).
        10  ytdcex-prt-format                   pic x(13).
        10  doc-clinic-nbr-2                    pic 99.
        10  doc-clinic-nbr-3                    pic 99.
        10  doc-clinic-nbr-4                    pic 99.
        10  doc-clinic-nbr-5                    pic 99.
        10  doc-clinic-nbr-6                    pic 99.
        10  doc-spec-cd-2                       pic 99.
        10  doc-spec-cd-3                       pic 99.
*        10  doc-ytdinc-g                        pic s9(7)v99 comp.
        10  doc-ytdinc-g                        pic s9(7)v99.
    05  doc-locations.
        10  doc-loc-1                           pic x999.
        10  doc-loc-2                           pic x999.
        10  doc-loc-3                           pic x999.
        10  doc-loc-4                           pic x999.
        10  doc-loc-5                           pic x999.
        10  doc-loc-6                           pic x999.
        10  doc-loc-7                           pic x999.
        10  doc-loc-8                           pic x999.
        10  doc-loc-9                           pic x999.
        10  doc-loc-10                          pic x999.
        10  doc-loc-11                          pic x999.
        10  doc-loc-12                          pic x999.
        10  doc-loc-13                          pic x999.
        10  doc-loc-14                          pic x999.
        10  doc-loc-15                          pic x999.
        10  doc-loc-16                          pic x999.
        10  doc-loc-17                          pic x999.
        10  doc-loc-18                          pic x999.
        10  doc-loc-19                          pic x999.
        10  doc-loc-20                          pic x999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  15
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        10  doc-loc-21                          pic x999.
        10  doc-loc-22                          pic x999.
        10  doc-loc-23                          pic x999.
        10  doc-loc-24                          pic x999.
        10  doc-loc-25                          pic x999.
        10  doc-loc-26                          pic x999.
        10  doc-loc-27                          pic x999.
        10  doc-loc-28                          pic x999.
        10  doc-loc-29                          pic x999.
        10  doc-loc-30                          pic x999.
    05  doc-locations-r  redefines  doc-locations.
        10  doc-loc     occurs 30 times         pic x999.
*
    05  doc-rma-expense-percent-misc            pic 9(5)v9(4) comp.
* 2004/03/03 - MC
*   05  filler2                                 pic x(8).
    05  doc-afp-paym-group                      pic x(4).
    05  filler2                                 pic x(4).
* 2004/030/03 - end
    05  doc-ind-pays-gst                        pic x.
    05  doc-nx-avail-batch                      pic 999.
* 2002/07/16 - MC - add 5 more next batch nbr for each clinic
    05  doc-nx-avail-batch-2                    pic 999.
    05  doc-nx-avail-batch-3                    pic 999.
    05  doc-nx-avail-batch-4                    pic 999.
    05  doc-nx-avail-batch-5                    pic 999.
    05  doc-nx-avail-batch-6                    pic 999.
** 2002/07/16 - end
*    05  doc-yrly-ceiling-computed               pic 9(7)v99 comp.
    05  doc-yrly-ceiling-computed               pic 9(7)v99.
*    05  doc-yrly-expense-computed               pic 9(7)v99 comp.
    05  doc-yrly-expense-computed               pic 9(7)v99.
    05  doc-rma-expense-percent-reg             pic 9(5)v9(4) comp.
    05  doc-sub-specialty                       pic x(15).
*    05  doc-payeft                              pic s9(7)v99 comp.
    05  doc-payeft                              pic s9(7)v99.
*    05  doc-ytdded                              pic s9(7)v99 comp.
    05  doc-ytdded                              pic s9(7)v99.
    05  doc-dept-expense-percent-misc           pic 9(5)v9(4) comp.
    05  doc-dept-expense-percent-reg            pic 9(5)v9(4) comp.
    05  doc-ep-ped                              pic s9(9) comp.
    05  doc-ep-pay-code                         pic x.
    05  doc-ep-pay-sub-code                     pic x.
    05  filler3                                 pic x(1).
    05  doc-ind-holdback-active                 pic x(1).
    05  group-regular-service                   pic x(4).
* 2002/09/23 - MC
*    05  group-regular-service                  pic x(4).
    05  group-over-serviced                     pic x(4).
* 2002/09/23 - end
    05  doc-specialties                         pic x(90).

*
    copy "f040_oma_fee_mstr.fd".
* 98/dec/01 D.B.  - y2k
* 99/apr/28 B.E.  - split page (999) into page-alpha (xx) + page-numeric (999)
* 99/nov/30 B.E.  - correction to 'fee-page' definition in redefines
* 00/jul/31 B.E.  - fees changed from 9(5)v99 to 9(4)v999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  16
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
* 00/aug/01 B.E.  - added addition length to record for future expansion
*                 - add fee-active-for-entry y/n (1 byte)
*                 - add fee-min, fee-max (current/previous and oma/ohip)
*                                                        2*2*2*7 = 56 bytes)
*                 - add filler for growth -11 flags + 2  nbrs = 11*28 = 39 bytes
* 00/sep/05 B.E.  - add 'fee-global-addon-cd-exclusion-flag'
*
fd  oma-fee-mstr
*       block       contains 247 characters
*       record      contains 247 characters  .
        block       contains 315 characters
        record      contains 315 characters  .
*       feedback is feedback-oma-fee-mstr.

* insert this warning message from "f000_duplicate_fd_warning.fd
*----------------  note  -----------------------
*-- any changes to this fd must also be made  --
*-- to the corresponding "..._d001_..." fd    --
*-- and visa versa                            --
*----------------  note  -----------------------
01 fee-mstr-rec.
    05  fee-oma-cd.
        10  fee-oma-cd-ltr1                     pic x.
        10  filler                              pic 999.
    05  fee-special-m-suffix-ind                pic x.

    05  fee-effective-date.
* y2k   10  fee-date-yy                         pic 99.
        10  fee-date-yy                         pic 9999.
        10  fee-date-mm                         pic 99.
        10  fee-date-dd                         pic 99.
* 00/aug/01 B.E.
    05  fee-active-for-entry                    pic x(1).


    05  fee-desc                                pic x(48).
    05  fee-current-prev-years.
*           (CURRENT rates)
*           (00/aug/01 B.E. - fees changed from 2 to 3 decimals)
        10  fee-curr-a-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-a-fee-2                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-fee-2                    pic s9(4)v999
                                        sign is leading .
*           (00/aug/01 B.E.)
        10  fee-curr-a-min              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-min              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-a-max              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-max              pic s9(4)v999
                                        sign is leading .

        10  fee-curr-a-anae                     pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  17
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        10  fee-curr-h-anae                     pic 99.
        10  fee-curr-a-asst                     pic 99.
        10  fee-curr-h-asst                     pic 99.

        10  fee-curr-add-on-codes.
            15  fee-curr-add-on-cd              pic x999    occurs 10 times.
        10  fee-curr-oma-ind-card-reqs.
            15  fee-curr-oma-ind-card-required  pic x       occurs  3 times.
* 99/apr/28
*       10  fee-curr-page                       pic 999.
        10  fee-curr-page.
            15 fee-curr-page-alpha              pic x(2).
            15 fee-curr-page-numeric            pic 999.

        10  fee-curr-add-on-perc-flat-ind       pic x.

*           (PREVIOUS rates)
*           (00/aug/01 B.E. - fees changed from 2 to 3 decimals)
        10  fee-prev-a-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-fee-2                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-fee-2                    pic s9(4)v999
                                        sign is leading .
*           (00/aug/01 B.E.)
        10  fee-prev-a-min              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-min              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-max              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-max              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-anae                     pic 99.
        10  fee-prev-h-anae                     pic 99.
        10  fee-prev-a-asst                     pic 99.
        10  fee-prev-h-asst                     pic 99.

        10  fee-prev-add-on-codes.
            15  fee-prev-add-on-cd              pic x999        occurs 10 times.
        10  fee-prev-oma-ind-card-reqs.
            15  fee-prev-oma-ind-card-required  pic x           occurs  3 times.
*       10  fee-prev-page                       pic 999.
        10  fee-prev-page.
            15 fee-prev-page-alpha              pic x(2).
            15 fee-prev-page-numeric            pic 999.
        10  fee-prev-add-on-perc-flat-ind       pic x.
    05  fee-current-prev-year-r redefines fee-current-prev-years.
* ---------------------- n o t e -------------------------
* ----- set up the following subscripts when using this file
* ----- set subscript  'curr' to 1  and  'prev' 2
        10  fee-years occurs 2 times.
* ----- set subscript  'oma' to 1  and  'ohip' to 2

            15  fee-1           occurs 2 times
*                                                       pic s9(5)v99
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  18
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
                                        pic s9(4)v999
                                        sign is leading.
            15  fee-2           occurs 2 times
*                                                       pic s9(5)v99
                                        pic s9(4)v999
                                        sign is leading.
*               (00/aug/01 B.E.)

*                 - fee-min, fee-max used only if "P" percentage based fee
            15  fee-min         occurs 2 times
                                        pic s9(4)v999
                                        sign is leading.
            15  fee-max         occurs 2 times
                                        pic s9(4)v999
                                        sign is leading.

            15  fee-anae        occurs 2 times
                                                pic 99.
            15  fee-asst        occurs 2 times
                                                pic 99.
            15  fee-add-on-codes.
                20  fee-add-on-cd               pic x999        occurs 10 times.
            15  fee-oma-ind-card-requireds.
                20  fee-oma-ind-card-required   pic x           occurs  3 times.
*y2k
*           15  fee-page                        pic 999.
            15  fee-page-alpha-numeric.
                20 fee-page-alpha               pic x(2).
                20 fee-page                     pic 9(3).

            15  fee-add-on-perc-or-flat-ind     pic x.

*       internal computer code (icc) -- used to perform price reductions
    05  fee-icc-code.
        10  fee-icc-sec                         pic xx.
        10  fee-icc-cat                         pic  9.
        10  fee-icc-grp                         pic 99.
        10  fee-icc-reduc-ind                   pic  9.
*       (diag ind = 'y' --> batch claim header diag cd must not = zero)
    05  fee-diag-ind                            pic x.
    05  fee-phy-ind                             pic x.
    05  fee-tech-ind                            pic x.
    05  fee-hosp-nbr-ind                        pic x.
    05  fee-i-o-ind                             pic x.
    05  fee-admit-ind                           pic x.
    05  fee-spec-fr                             pic 99.
    05  fee-spec-to                             pic 99.

*          (00/aug/01 B.E. filler for growth)
*           05  filler                                  pic x(39).
*       (00/sep/05 B.E.)
    05  fee-global-addon-cd-exclusion           pic x(01).
    05  filler                                  pic x(38).

*
    copy "f094_msg_sub_mstr.fd".

fd  msg-sub-mstr
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  19
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
*       index block contains   3 characters
*       data  block contains 193 characters
              block contains 193 characters
        record      contains 193 characters   .
*       feedback    is feedback-msg-sub-mstr.

01 msg-sub-mstr-rec.
    05  msg-sub-key.
        10  msg-sub-key-1                       pic x.
        10  msg-sub-key-23.
            15  msg-sub-key-2                   pic x.
            15  msg-sub-key-3                   pic x.
*    message records     require "M" in msg-sub-key-1
*    subdivision records require "S" in msg-sub-key-1 an
*                                " " in msg-sub-key-2
    05  msg-rec.
        10  msg-reprint-flag                    pic x.
        10  msg-auto-logout                     pic x.
        10  msg-dtl1                            pic x(47).
        10  msg-dtl2                            pic x(47).
        10  msg-dtl3                            pic x(47).
        10  msg-dtl4                            pic x(47).
    05  sub-rec redefines msg-rec.
        10  sub-name                            pic x(25).
        10  sub-fee-complex                     pic x.
        10  sub-auto-logout                     pic x.
        10  filler                              pic x(163).
fd  print-file
    record contains 132 characters.

01  prt-line                                    pic x(132).
*
working-storage section.

*
*  file related working storage
*

77  pat-occur                                   pic 9999.
77  hold-feedback-clmhdr                        pic x(4).
77  hold-key-claims-mstr                        pic x(18).
77  feedback-pat-mstr                           pic x(4).
77  feedback-claims-mstr                        pic x(4).
77  feedback-claims-mstr-p-access               pic x(4).
77  feedback-oma-fee-mstr                       pic x(4).
77  claims-pat-access-occur                     pic 9(12).
77  claims-occur                                pic 9(12).
77  ws-pat-subscr-key                           pic x(15).
77  hold-pat-given-name                         pic x(12).
77  hold-pat-surname                            pic x(15).

01  temp-long-date.
    02 filler pic 9(2).
    02 temp-long-date-yymmdd pic 9(6).

01  hold-pat-ohip-mmyy-r                        pic x(15).
01  hold-subscr-info.
    05  hold-subscr-addr1                       pic x(21).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  20
*                      u035cnoupd.cbl                                )
    05  hold-subscr-addr2                       pic x(21).
    05  hold-subscr-addr3                       pic x(21).
    05  hold-subscr-postal-cd                   pic x(6).
    05  hold-subscr-postal-cd-r  redefines  hold-subscr-postal-cd.
        10  hold-subscr-post-code1.
            15  hold-subscr-post-cd1            pic x.
            15  hold-subscr-post-cd2            pic 9.
            15  hold-subscr-post-cd3            pic x.
        10  hold-subscr-post-code2.
            15  hold-subscr-post-cd4            pic 9.
            15  hold-subscr-post-cd5            pic x.
            15  hold-subscr-post-cd6            pic 9.
    05  hold-country                            pic x(20).
    05  hold-subscr-msg-nbr                     pic xx.
* (y2k)
*   05  hold-subscr-date-msg-nbr-eff                    pic 9(6).
    05  hold-subscr-date-msg-nbr-eff            pic 9(8).

*  eof flags

77  eof-claims-mstr                             pic x   value "N".
77  eof-claims-mstr-pat-access                  pic x   value "N".
77  eof-patient-mstr                            pic x   value "N".
77  eof-doctor-mstr                             pic x   value "N".
77  eof-claims-dtl                              pic x   value "N".

*       two print files are created for the printing of two invoice
*       types using same format:
*               1)      ru035ca - for clinics 22 and 60
*               2)      ru035cb - for clinics 43

77  prt-file-name-a                     pic x(07)       value "ru035ca".
77  prt-file-name-b                     pic x(07)       value "ru035cb".

01  print-file-name.
    05  prt-file-name                   pic x(07)       value spaces.


*mf    copy "F002_KEY_CLAIMS_MSTR.WS".
*
    copy "f002_claims_mstr_rec1_2.ws".
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
*  yy/mm/dd  whom          why
*  --------  ----          ---
*
*  84/12/19  i.warsh       broke down the reference field so that
*                          each individual character could be looked at
*                          for direct bills.
*  90/09/27  b.elliott     added redefine for clmhdr-claim-source-cd
*
*  91/02/13  m. chan       clmhdr-tape-submit-ind is related to manual
*                          review flag.  if 'n' means manual review is
*                          on; ohterwise, if 'y' means manual review is
*                          off
*
*  91/04/17  m. chan       clmhdr-tape-submit-ind is related to claim
*                          status - 's'ubmit, 'r'esubmit or 'h'old
*  98/01/26  m. chan       moved clmhdr-orig-batch-id after clmhdr-reserve-
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  21
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
*                          for-future
*  98/06/02  d. balmer     y2K date change
*  99/jan/21 B.E.  - added clmhdr-date-sys breakdown of -12 and -38 fields.
*  99/jan/25 B.E.  - added clmhdr-date-admit breakdown of -12 and -38 fields.
*  99/jan/25 B.E.  - added clmhdr-payroll redefine of clmhdr-hosp
*  03/aug/21 M.C.  - add 5 new elements to the files
*  03/nov/05 M.C.  - alpha doc nbr
*  04/jul/07 b.e.  - added  clmdtl-orig-doc-number
*                           clmdtl-orig-batch-number
*                           clmdtl-orig-claim-number
*  04/nov/18 M.C. - correct the redefinition of clmdtl-orig-complete-batch-n-r
*                   by including clmdtl-orig-clinic-number
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

* insert this warning message from "f002_duplicate_fd_warning.fd"

*+++++++++++++++W A R N I N G +++++++++++++++
*                                           *
* any changes to this fd must also be made  *
* to the other 3 in the following list:     *
*                                           *
*        "f002_claims_hdr_rec.ws            *
*        "f002_claims_dtl_rec.ws            *
*        "f002_claims_mstr_rec1_2.ws        *
*        "f002_clm_mstr_p_access.ws         *
*                                           *
*+++++++++++++++W A R N I N G +++++++++++++++

*
*       note 1: key for this file is the claim-id which is prefaced by a
*               1 character type field -- 'p' = patient id (i key)
*                                         'b' = batch nbr
*       note 2: - the claim detail data recs are written with valid oma
*                   codes, the detail description recs use an oma code of 'zzzz'
*                   and adjustment detail records use and 'adj-cd' of "1")

01  claim-header-rec.

    05  clmhdr-claim-id.
*!      10  clmhdr-batch-nbr                    pic 9(9).
        10  clmhdr-batch-nbr                    pic x(8).
        10  clmhdr-batch-nbr-r1 redefines clmhdr-batch-nbr.
            15  clmhdr-clinic-nbr-1-2           pic 99.
*!          15  clmhdr-doc-nbr                  pic 9(4).
            15  clmhdr-doc-nbr                  pic x(3).
            15  clmhdr-week                     pic 99.
            15  clmhdr-day                      pic 9.
        10  clmhdr-batch-nbr-r2 redefines clmhdr-batch-nbr.
            15  filler                          pic xx.
*!          15  clmhdr-batch-nbr-3-6            pic 9(4).
            15  clmhdr-batch-nbr-3-6            pic x(3).
            15  clmhdr-batch-nbr-7-9            pic 999.
        10  clmhdr-claim-nbr                    pic 9(2).
        10  clmhdr-zeroed-oma-suff-adj.
            15  clmhdr-adj-oma-cd               pic x999.
            15  clmhdr-adj-oma-suff             pic x.
            15  clmhdr-adj-adj-nbr              pic 9.
        10  clmhdr-zeroed-area redefines clmhdr-zeroed-oma-suff-adj
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  22
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
                                                pic 9(6).
*       (valid batch types are 'c' 'a' 'p')
    05  clmhdr-batch-type                       pic x.
*       ('clmhdr-card-colour' replaced by 'adjust-sub-type' --
    05  clmhdr-adj-cd-sub-type                  pic x.
    05  clmhdr-adj-cd-sub-type-ss redefines clmhdr-adj-cd-sub-type
                                                pic 9.
    05  clmhdr-claim-source-cd    redefines clmhdr-adj-cd-sub-type
                                                pic x.
    05  clmhdr-doc-nbr-ohip                     pic 9(6).
    05  clmhdr-doc-spec-cd                      pic 99.
    05  clmhdr-refer-doc-nbr                    pic 9(6).
    05  clmhdr-diag-cd                          pic 999.
    05  clmhdr-loc                              pic x999.

    05  clmhdr-hosp                             pic x.
    05  clmhdr-payroll redefines clmhdr-hosp    pic x.

    05  clmhdr-agent-cd                         pic 9.
    05  clmhdr-adj-cd                           pic x.
    05  clmhdr-tape-submit-ind                  pic x.
    05  clmhdr-i-o-pat-ind                      pic x.
    05  clmhdr-pat-ohip-id-or-chart.
        10  clmhdr-pat-key-type                 pic a.
        10  clmhdr-pat-key-data.
            15  clmhdr-pat-key-ohip             pic x(8).
            15  filler                          pic x(7).
    05  clmhdr-pat-acronym.
        10  clmhdr-pat-acronym6                 pic x(6).
        10  clmhdr-pat-acronym3                 pic x(3).
    05  clmhdr-reference.
        10  clmhdr-ref1                         pic x.
        10  clmhdr-ref2                         pic x.
        10  clmhdr-ref3                         pic x.
        10  clmhdr-ref4                         pic x.
        10  clmhdr-ref5                         pic x.
        10  clmhdr-ref6                         pic x.
        10  clmhdr-ref7                         pic x.
        10  clmhdr-ref8                         pic x.
        10  clmhdr-ref9                         pic x.
* y2k
        10  clmhdr-ref10                        pic x.
        10  clmhdr-ref11                        pic x.
    05  clmhdr-reference-r redefines clmhdr-reference.
        10  clmhdr-ref-date1.
* y2k
*           15  clmhdr-ref-date-yy                      pic 9(2).
            15  clmhdr-ref-date-yy              pic 9(4).
            15  clmhdr-ref-date-mm              pic 9(2).
            15  clmhdr-ref-date-dd              pic 9(2).
        10  clmhdr-ref-inits                    pic x(3).
    05  clmhdr-reference-r1 redefines clmhdr-reference-r.
        10  filler                              pic x.
* y2k
*       10  clmhdr-ref-date2                            pic x(6).
        10  clmhdr-ref-date2                    pic x(8).
        10  filler                              pic x(2).
    05  clmhdr-reference-r2 redefines clmhdr-reference-r1.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  23
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        10  filler                              pic x(2).
* y2k
*       10  clmhdr-ref-date3                            pic x(6).
        10  clmhdr-ref-date3                    pic x(8).
        10  filler                              pic x(1).
    05  clmhdr-reference-r3 redefines clmhdr-reference-r2.
        10  filler                              pic x(3).
* y2k
*       10  clmhdr-ref-date4                            pic x(6).
        10  clmhdr-ref-date4                    pic x(8).
    05  clmhdr-date-admit.
*           (note - admit-yy must be left alpha-numeric)
* y2k
*       10  clmhdr-date-admit-yy                        pic xx.
        10  clmhdr-date-admit-yy                pic x(4).
        10  clmhdr-date-admit-yy-r redefines
            clmhdr-date-admit-yy.
            15  clmhdr-date-admit-yy-12         pic xx.
            15  clmhdr-date-admit-yy-34         pic xx.
        10  clmhdr-date-admit-mm                pic 99.
        10  clmhdr-date-admit-mm-r redefines clmhdr-date-admit-mm
                                                pic xx.
        10  clmhdr-date-admit-dd                pic 99.
        10  clmhdr-date-admit-dd-r redefines clmhdr-date-admit-dd
                                                pic xx.
    05  clmhdr-date-admit-r redefines clmhdr-date-admit
* y2k                                                pic 9(6).
                                                pic 9(8).
    05  clmhdr-date-admit-r2 redefines clmhdr-date-admit-r.
        10 clmhdr-date-admit-12                 pic 9(2).
        10 clmhdr-date-admit-38                 pic 9(6).
    05  clmhdr-doc-dept                         pic 99.
* y2k    05  clmhdr-date-cash-tape-payment           pic x(6).
    05  clmhdr-date-cash-tape-payment           pic x(8).
    05  clmhdr-date-cash-tape-paymt-r redefines
        clmhdr-date-cash-tape-payment.
        10  clmhdr-date-cash-tape-paymt-12      pic 9(2).
        10  clmhdr-date-cash-tape-paymt-38      pic 9(6).
    05  clmhdr-direct-bills-clm-info  redefines clmhdr-date-cash-tape-payment.
        10  clmhdr-msg-nbr                      pic xx.
        10  clmhdr-reprint-flag                 pic x.
        10  clmhdr-sub-nbr                      pic x.
        10  clmhdr-auto-logout                  pic x.
        10  clmhdr-fee-complex                  pic x.
        10  filler                              pic xx.
    05  clmhdr-curr-payment                     pic s9(5)v99.

    05  clmhdr-date-period-end.
* y2k
*       10  clmhdr-period-end-yy                        pic 99.
        10  clmhdr-period-end-yy                pic 9(4).
        10  clmhdr-period-end-mm                pic 99.
        10  clmhdr-period-end-dd                pic 99.
    05  clmhdr-cycle-nbr                        pic 99.
* y2k
*   05  clmhdr-date-sys                                 pic x(6).
    05  clmhdr-date-sys                         pic x(8).
    05  clmhdr-date-sys-r redefines clmhdr-date-sys.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  24
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        10  clmhdr-date-sys-12                  pic 9(2).
        10  clmhdr-date-sys-38                  pic 9(6).
    05  clmhdr-amt-tech-billed                  pic s9(4)v99.
    05  clmhdr-amt-tech-paid                    pic s9(4)v99.
    05  clmhdr-tot-claim-ar-oma                 pic s9(5)v99.
    05  clmhdr-tot-claim-ar-ohip                pic s9(5)v99.
    05  clmhdr-manual-and-tape-paymnts          pic s9(5)v99.
    05  clmhdr-status-ohip                      pic xx.

    05  clmhdr-manual-review                    pic x.
    05  clmhdr-submit-date.
* y2k
*       10  clmhdr-submit-yy                            pic 99.
        10  clmhdr-submit-yy                    pic 9(4).
        10  clmhdr-submit-mm                    pic 99.
        10  clmhdr-submit-dd                    pic 99.
    05  clmhdr-confidential-flag                pic x.
* y2k
*   05  clmhdr-serv-date                                pic 9(6).
    05  clmhdr-serv-date                        pic 9(8).
*
* (y2k removed)
*           05  clmhdr-reserve-for-future               pic x(6).

* 2003/08/21 - add 4 new items
    05  clmhdr-elig-error                       pic x(3).
    05  clmhdr-elig-status                      pic x.
    05  clmhdr-serv-error                       pic x(3).
    05  clmhdr-serv-status                      pic x.
* 2003/08/21 - end

    05  clmhdr-orig-batch-id.
        10  clmhdr-orig-batch-nbr.
            15  clmhdr-orig-batch-nbr-1-2       pic  99.
*!          15  clmhdr-orig-batch-nbr-3         pic   9.
*!          15  clmhdr-orig-batch-nbr-4-9       pic 9(6).
            15  clmhdr-orig-batch-nbr-4-9       pic x(6).
        10  clmhdr-orig-batch-nbr-next-def      redefines clmhdr-orig-batch-nbr.
            15  filler                          pic  99.
*!          15  filler                          pic   9.
*!          15  clmhdr-orig-batch-nbr-4-6       pic 9(3).
            15  clmhdr-orig-batch-nbr-4-6       pic x(3).
            15  clmhdr-orig-batch-nbr-7-8       pic  99.
            15  clmhdr-orig-batch-nbr-9         pic   9.
        10  clmhdr-orig-claim-nbr               pic  99.
    05  clmhdr-orig-batch-id-r  redefines clmhdr-orig-batch-id.
*!      10  clmhdr-orig-complete-batch-nbr      pic 9(11).
        10  clmhdr-orig-complete-batch-nbr      pic x(10).
*mf moved external keys into data record
*mfcopy "f002_key_claims_mstr_mf.ws" replacing "key-clm-" by "clmhdr-b-".
*-------------------
05  k-clmhdr-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  k-clmhdr-b-key-type                        pic x.
    20  k-clmhdr-b-data.
*!      25  k-clmhdr-b-batch-num                   pic 9(9).
        25  k-clmhdr-b-batch-num                   pic x(8).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  25
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        25  k-clmhdr-b-batch-nbr redefines k-clmhdr-b-batch-num.
            30  k-clmhdr-b-clinic-nbr-1-2          pic 99.
*!          30  k-clmhdr-b-doc-nbr                 pic 9(4).
            30  k-clmhdr-b-doc-nbr                 pic x(3).
            30  k-clmhdr-b-doc-nbr-r redefines k-clmhdr-b-doc-nbr.
*!              35  k-clmhdr-b-doc-nbr-1           pic 9.
*!              35  k-clmhdr-b-doc-nbr-2-4         pic 999.
                35  k-clmhdr-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  k-clmhdr-b-batch-number.
                35  k-clmhdr-b-week                pic 99.
                35  k-clmhdr-b-day                 pic 9.
        25  k-clmhdr-b-claim-nbr                   pic 99.
        25  k-clmhdr-b-oma-cd                      pic x999.
        25  k-clmhdr-b-oma-suff                    pic x.
        25  k-clmhdr-b-adj-nbr                     pic x.
    20  k-clmhdr-b-data-r  redefines  k-clmhdr-b-data.
        25  k-clmhdr-b-pat-id                      pic x(15).
*!      25  filler                                 pic xx.
        25  filler                                 pic x.

*mf10  k-clmhdr-p-claims-mstr.
05  k-clmhdr-p-claims-mstr.
    20  k-clmhdr-p-key-type                        pic x.
    20  k-clmhdr-p-data.
        25  k-clmhdr-p-batch-nbr.
            30  k-clmhdr-p-clinic-nbr-1-2      pic  99.
*!          30  k-clmhdr-p-doc-nbr             pic 9(4).
            30  k-clmhdr-p-doc-nbr             pic x(3).
            30  k-clmhdr-p-week                pic 99.
            30  k-clmhdr-p-day                 pic 9.
        25  k-clmhdr-p-claim-nbr               pic 99.
        25  k-clmhdr-p-oma-cd                  pic x999.
        25  k-clmhdr-p-oma-suff                pic x.
        25  k-clmhdr-p-adj-nbr                 pic x.
*-------------------------

01  claim-detail-rec.

    05  clmdtl-id.
*!      10  clmdtl-batch-nbr                    pic 9(9).
        10  clmdtl-batch-nbr                    pic x(8).
        10  clmdtl-claim-nbr                    pic 9(2).
        10  clmdtl-oma-cd                       pic xxxx.
        10  clmdtl-oma-suff                     pic x.
        10  clmdtl-adj-nbr                      pic 9.

    05  clmdtl-det-rec.
        10  clmdtl-rev-group-cd                 pic xxx.
        10  clmdtl-agent-cd                     pic 9.
        10  clmdtl-adj-cd                       pic x.
        10  clmdtl-nbr-serv                     pic 99.
        10  clmdtl-nbr-serv-r redefines clmdtl-nbr-serv.
            15  clmdtl-adjust-reprint           pic x.
            15  filler                          pic x.
        10  clmdtl-sv-date.
* y2k            15  clmdtl-sv-yy                    pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  26
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
            15  clmdtl-sv-yy                    pic 9999.
            15  clmdtl-sv-mm                    pic 99.
            15  clmdtl-sv-dd                    pic 99.

        10  clmdtl-consec-dates.
            15  clmdtl-consecutive-sv-date  occurs 3 times
                                                pic 999.
        10  clmdtl-consec-dates-r  redefines  clmdtl-consec-dates.
            15  clmdtl-consecutive-dates    occurs 3 times.
                20  clmdtl-sv-nbr               pic  9.
                20  clmdtl-sv-day               pic xx.

        10  clmdtl-amt-tech-billed              pic s9(4)v99.
        10  clmdtl-fee-oma                      pic s9(5)v99.
        10  clmdtl-fee-ohip                     pic s9(5)v99.
* y2k        10  clmdtl-date-period-end              pic x(6).
        10  clmdtl-date-period-end              pic x(8).
        10  clmdtl-cycle-nbr                    pic 999.

        10  clmdtl-diag-cd                      pic 999.
        10  clmdtl-line-no                      pic 99.
* (y2k)
*       10  clmdtl-reserve-for-future                   pic x(8).
* 2003/08/21 - MC
*      10  clmdtl-reserve-for-future           pic x(4).
       10  clmdtl-resubmit-flag                pic x.
       10  clmdtl-reserve-for-future           pic x(3).
* 2003/08/21 - end

    05  clmdtl-desc-rec redefines clmdtl-det-rec.
        10  clmdtl-desc                         pic x(22).
        10  filler                              pic x(42).
*mf
*   05  clmdtl-filler                                   pic x(88).
* 2003/08/21 - MC
*   05  clmdtl-filler                           pic x(96).
    05  clmdtl-filler                           pic x(104).
* 2003/08/21 - end

    05  clmdtl-orig-batch-id.
*!      10  clmdtl-orig-batch-nbr               pic 9(9).
        10  clmdtl-orig-batch-nbr               pic x(8).
        10  clmdtl-orig-batch-nbr-r redefines clmdtl-orig-batch-nbr.
            15  clmdtl-orig-batch-nbr-1-2       pic 99.
*!          15  clmdtl-orig-batch-nbr-3         pic 9.
*!          15  clmdtl-orig-batch-nbr-4-9       pic 9(6).
            15  clmdtl-orig-batch-nbr-4-9       pic x(6).
        10  clmdtl-orig-claim-nbr-in-batch      pic 99.
    05  clmdtl-orig-batch-id-r  redefines clmdtl-orig-batch-id.
*!      10  clmdtl-orig-complete-batch-nbr      pic 9(11).
        10  clmdtl-orig-complete-batch-nbr      pic 9(10).
        10  clmdtl-orig-complete-batch-n-r redefines clmdtl-orig-complete-batch-
* 2004/11/18 - MC - include clinic nbr
            15  clmdtl-orig-clinic-number       pic 99.
* 2004/11/18 - end
            15  clmdtl-orig-doc-number          pic x(3).
            15  clmdtl-orig-batch-number        pic 9(3).
            15  clmdtl-orig-claim-number        pic 9(2).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  27
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)

*mf moved external keys into data record
*mfcopy "f002_key_claims_mstr_mf.ws" replacing "key-clm-" by "clmdtl-b-".
*-------------------
05  k-clmdtl-claims-mstr.
*        key type: 'b' = batch id
*                  'p' = patient id (i key)
    20  k-clmdtl-b-key-type                        pic x.
    20  k-clmdtl-b-data.
*!      25  k-clmdtl-b-batch-num                   pic 9(9).
        25  k-clmdtl-b-batch-num                   pic x(8).
        25  k-clmdtl-b-batch-nbr redefines k-clmdtl-b-batch-num.
            30  k-clmdtl-b-clinic-nbr-1-2          pic 99.
*!          30  k-clmdtl-b-doc-nbr                 pic 9(4).
            30  k-clmdtl-b-doc-nbr                 pic x(3).
            30  k-clmdtl-b-doc-nbr-r redefines k-clmdtl-b-doc-nbr.
*!              35  k-clmdtl-b-doc-nbr-1           pic 9.
*!              35  k-clmdtl-b-doc-nbr-2-4         pic 999.
                35  k-clmdtl-b-doc-nbr-2-4         pic xxx.
*           ( added so that the new batch number can be accessed
*             rather than the old  week-day combination )
            30  k-clmdtl-b-batch-number.
                35  k-clmdtl-b-week                pic 99.
                35  k-clmdtl-b-day                 pic 9.
        25  k-clmdtl-b-claim-nbr                   pic 99.
        25  k-clmdtl-b-oma-cd                      pic x999.
        25  k-clmdtl-b-oma-suff                    pic x.
        25  k-clmdtl-b-adj-nbr                     pic x.
    20  k-clmdtl-b-data-r  redefines  k-clmdtl-b-data.
        25  k-clmdtl-b-pat-id                      pic x(15).
*!      25  filler                                 pic xx.
        25  filler                                 pic x.

*mf10  k-clmdtl-p-claims-mstr.
05  k-clmdtl-p-claims-mstr.
    20  k-clmdtl-p-key-type                        pic x.
    20  k-clmdtl-p-data.
        25  k-clmdtl-p-batch-nbr.
            30  k-clmdtl-p-clinic-nbr-1-2      pic  99.
*!          30  k-clmdtl-p-doc-nbr             pic 9(4).
            30  k-clmdtl-p-doc-nbr             pic x(3).
            30  k-clmdtl-p-week                pic 99.
            30  k-clmdtl-p-day                 pic 9.
        25  k-clmdtl-p-claim-nbr               pic 99.
        25  k-clmdtl-p-oma-cd                  pic x999.
        25  k-clmdtl-p-oma-suff                pic x.
        25  k-clmdtl-p-adj-nbr                 pic x.
*-------------------------


01  key-claims-mstr-pat-access.
    05  key-clm-pat-access-type                 pic a.
    05  key-clm-pat-access-data.
        10  key-clm-pat-access-pat-id           pic x(15).
        10  filler                              pic xx.

01  key-gen-claims-mstr-pat-access.
    05  key-gen-clm-pat-access                  pic a.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  28
*                      u035cnoupd.cbl                                )
    05  key-gen-clm-pat-access-data             pic x(17).

*  status file indicators

01 status-indicators.
*mf    05  common-status-file                   pic x(11).
    05  common-status-file                      pic x(2).
*mf    05  status-pat-mstr                      pic x(11) value zero.
*mf    05  status-doc-mstr                      pic x(11) value zero.
    05  status-cobol-doc-mstr                   pic x(2) value zero.
*mf    05  status-claims-mstr                   pic x(11) value zero.
    05  status-prt-file                         pic xx    value zero.
    05  status-cobol-claims-mstr                pic xx    value zero.
    05  status-cobol-pat-mstr                   pic xx    value zero.
    05  status-claims-mstr-pat-access           pic x(11) value zero.
*mf    05  status-oma-mstr                      pic x(11) value zero.
    05  status-cobol-oma-mstr                   pic x(2) value zero.

    copy "f002_claim_shadow.fw".
77  status-cobol-clm-shadow-mstr                        pic x(02).
*mf 77  status-infos-clm-shadow-mstr                    pic x(04).
77  feedback-clm-shadow-mstr                            pic x(04).
77  claims-mstr-shadow-occur                            pic 9(16).
01  flag-eof-clm-shadow-mstr                            pic x.
    88  eof-clm-shadow-mstr                             value "Y".
    88  not-eof-clm-shadow-mstr                         value "N".
01  ctr-clm-shadow-mstr                                 pic 9(7).

    copy "f094_msg_sub_mstr.fw".
77  status-cobol-msg-sub-mstr                   pic x(02).
77  status-infos-msg-sub-mstr                   pic x(04).
77  feedback-msg-sub-mstr                       pic x(04).
01  flag-eof-msg-sub-mstr                       pic x.
    88  eof-msg-sub-mstr                                value "Y".
    88  not-eof-msg-sub-mstr                            value "N".
01  msg-indexer                                 pic x   value "M".
01  sub-indexer                                 pic x   value "S".


01 save-subscr-id                               pic x(15)       value spaces.

01 save-shadow-key.
    10  save-shadow-agent               pic 9.
    10  save-shadow-clinic              pic 99.
    10  save-shadow-subdivision         pic x.
    10  save-shadow-pat-surname         pic x(15).
    10  save-shadow-pat-giv-name        pic x(12).
    10  save-shadow-patient             pic x(16).
*!  10  save-shadow-batch-nbr           pic x(09).
    10  save-shadow-batch-nbr           pic x(08).
    10  save-shadow-claim-nbr           pic x(02).

* (y2k)
* 77  ws-oldest-stmnt-prt-dt              pic 9(6).
77  ws-oldest-stmnt-prt-dt              pic 9(8).
* (y2k)
*77  ws-hold-clmref-date                        pic 9(6).
77  ws-hold-clmref-date                 pic 9(8).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  29
*                      u035cnoupd.cbl                                )
*
*    screen related working storage
*

77  ws-reply                                    pic x  value "P".
77  err-ind                                     pic 99.
77  ws-age-days                                 pic 99 value 30.

*
*       miscellaneous flags
*

01  process-flag                                pic x.
    88  first-process                           value 'Y'.

01  flag-curr-activity                          pic x.
    88  curr-activity                           value 'Y'.
    88  no-curr-activity                        value 'N'.

01  flag-new-claim-payment                      pic x.
    88  new-claim-payment                       value 'Y'.
    88  no-new-claim-payment                    value 'N'.

01  flag-end-of-claim-details                   pic x.
    88  end-of-claim-details                    value 'Y'.
    88  not-end-of-claim-details                value 'N'.

01  flag-invoice-to-print                       pic x.
    88  invoice-to-print                        value 'Y'.
    88  invoice-not-to-print                    value 'N'.

01  flag-claim-bal-due                          pic x.
    88  claim-has-bal-due                       value 'Y'.
    88  claim-has-no-bal-due                    value 'N'.

01  flag-claim-to-invoice                       pic x.
    88  claim-to-invoice                        value 'Y'.
    88  claim-not-to-invoice                    value 'N'.

01  flag-oma-rec                                pic x.
    88  oma-rec-found                           value "Y".
    88  oma-rec-not-found                       value "N".

01  flag-more-claims-to-come                    pic x.
    88  more-claims-to-come                     value 'Y'.
    88  no-more-claims-to-come                  value 'N'.

01  flag-invoice-overflow                       pic x.
    88  invoice-overflow                        value 'Y'.
    88  no-invoice-overflow                     value 'N'.

*
*       constants and literals
*

77  ws-premium                                  pic x(08)
        value "PREMIUM".

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  30
*                      u035cnoupd.cbl                                )
77  ws-bal-fwd-lit                              pic x(47)
        value "                              BALANCE FORWARD :".
77  ws-payment-lit                              pic x(47)
        value "PAYMENT - THANK YOU                            ".
77  ws-adjustment-lit                           pic x(47)
        value "ADJUSTMENT                                     ".
77  ws-pay-reversal-lit                         pic x(47)
        value "PAYMENT REVERSAL - EXPLANATION ENCLOSED        ".


77  ws-cntrl-hdr-lit                            pic x(15)
        value "CONTROL TOTALS:".
77  ws-cntrl-agent-lit                          pic x(15)
        value "AGENT --------:".
77  ws-cntrl-clinic-lit                         pic x(15)
        value "CLINIC -------:".
77  ws-cntrl-subdiv-lit                         pic x(15)
        value "SUBDIVISION --:".
77  ws-cntrl-grand-lit                          pic x(15)
        value "GRAND --------:".

01  month-lits.
    05  filler          pic x(03)       value "JAN".
    05  filler          pic x(03)       value "FEB".
    05  filler          pic x(03)       value "MAR".
    05  filler          pic x(03)       value "APR".
    05  filler          pic x(03)       value "MAY".
    05  filler          pic x(03)       value "JUN".
    05  filler          pic x(03)       value "JUL".
    05  filler          pic x(03)       value "AUG".
    05  filler          pic x(03)       value "SEP".
    05  filler          pic x(03)       value "OCT".
    05  filler          pic x(03)       value "NOV".
    05  filler          pic x(03)       value "DEC".

01  months redefines month-lits.
    05  mth             occurs 12 times pic x(03).

77  not-to-invoice-msg-nbr                      pic xx  value '99'.
77  ws-lines-per-page                           pic 99  value 21.

77  ss-subdiv                                   pic  9  value 1.
77  ss-clinic                                   pic  9  value 2.
77  ss-agent                                    pic  9  value 3.
77  ss-grand                                    pic  9  value 4.

*
*       misc working storage
*

77  ws-space                                    pic x  value spaces.
77  ws-spaces                                   pic xx value spaces.
77  ws-desc                                     pic x(47).
01  ws-redefine                                 pic s9(05)v99.
01  ws-redefined redefines ws-redefine          pic s9(07).
77  ws-balance-due                              pic 9(5)v99.
77  ws-bal-fwd                                  pic s9(5)v99.
77  ws-claim-bal-due                            pic s9(5)v99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  31
*                      u035cnoupd.cbl                                )
77  ws-tot-adj                                  pic s9(5)v99.
77  ws-tot-pay                                  pic s9(5)v99.
77  ws-prev-balance                             pic s9(5)v99.
77  ws-curr-charges                             pic s9(5)v99.
77  ws-cur                                      pic s9(5)v99.
77  ws-30                                       pic s9(5)v99.
77  ws-60                                       pic s9(5)v99.
77  ws-90                                       pic s9(5)v99.
77  ws-120                                      pic s9(5)v99.

77  ws-remainder                                pic s9(04).
77  ws-quotient                                 pic s9(04).

77  ws-page-cntr                                pic 9(03).
77  ws-line-cntr                                pic 9(02).
77  ws-nbr-lines                                pic 9(03).
77  ws-nbr-desc                                 pic 9(01).
77  ws-nbr-pages                                pic 9(03).
77  ws-detail-lines                             pic 9(3)v99.
77  ws-lines-left                               pic 99.
77  ws-skip                                     pic 99.
77  ws-msg-lines                                pic 99.
77  ws-msg-nbr                                  pic xx.
01  ws-msg-dtls.
    05  ws-msg1                                 pic x(47).
    05  ws-msg2                                 pic x(47).
    05  ws-msg3                                 pic x(47).
    05  ws-msg4                                 pic x(47).

*       break control totals

01  break-control-table.
    05  bc-totals occurs 4 times.
        10  bc-bal-due          pic 9(06)v99.
        10  bc-invoices         pic 9(04).
        10  bc-claims           pic 9(05).

77  inv-bal-due                 pic 9(06)v99.
77  inv-claims                  pic 9(05).

01  ws-surname                          pic x(15).
01  ws-surname-r redefines ws-surname.
    05  ws-surname-char occurs 15 times pic x.

01  ws-full-name                        pic x(21).
01  ws-full-name-r redefines ws-full-name.
    05  ws-full-name-char occurs 21 times pic x(01).

01  summary-table.
    05  summary-table-items occurs 99 times.
        10  summary-print.
* (y2k)
*           15  sum-sv-date                                     pic 9(6).
            15  sum-sv-date                             pic 9(8).
            15  sum-batch-nbr.
                20  filler                              pic x(03).
                20  sum-btch-nbr                        pic x(06).
            15  sum-claim-nbr                           pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  32
*                      u035cnoupd.cbl                                )
            15  sum-bal-due                             pic s9(5)v99.
        10  summary-control.
            15  sum-reprint                             pic x.

*   reprint indicator status -  (n)ot to reprint
*                               (p)artial reprint (ie. payments & adjustments)
*                               (y)es reprint

77  ws-summary-items                            pic 99.

*
*       subscripts
*

77  ss-a                                        pic 9(03).
77  ss-b                                        pic 9(03).
77  ss-c                                        pic 9(02).
77  ss-d                                        pic 9(02).


77  ss-break-type                               pic 9.
77  ss-to                                       pic 9.
*
*       print lines
*

01 prt-name.
    05  filler                          pic x(10)       value spaces.
    05  p-name                          pic x(28).
    05  filler                          pic x(94)       value spaces.

01 prt-addr1.
    05  filler                          pic x(10)       value spaces.
    05  p-addr1                         pic x(21).
    05  filler                          pic x(101)      value spaces.

01 prt-addr2.
    05  filler                          pic x(10)       value spaces.
    05  p-addr2                         pic x(21).
    05  filler                          pic x(101)      value spaces.

01 prt-addr3.
    05  filler                          pic x(10)       value spaces.
    05  p-addr3                         pic x(21).
    05  filler                          pic x(101)      value spaces.

01 prt-country.
    05  filler                          pic x(10)       value spaces.
    05  p-country                       pic x(30).
    05  filler                          pic x(92)       value spaces.

01 prt-hdr.
    05  filler                          pic x(10)       value spaces.
    05 p-postal-cd.
        10  p-code1                     pic x(03).
        10  filler                      pic x(01).
        10  p-code2                     pic x(03).
    05 p-postal-usa redefines p-postal-cd.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  33
*                      u035cnoupd.cbl                                )
        10  p-code-usa                  pic x(05).
        10  filler                      pic x(02).
    05  filler                          pic x(51)       value spaces.
    05  p-dtl-id                        pic x(12).
    05  filler                          pic x(03)       value spaces.
* (y2k)
    05  p-inv-yy                                pic 9(02).
    05  p-inv-yy-r redefines p-inv-yy.
        10 p-inv-yy-1 pic 9(1).
        10 p-inv-yy-2 pic 9(1).
**  05  p-inv-yy                        pic 9(04).
    05  filler                          pic x(01)       value spaces.
    05  p-inv-mmm                       pic x(03).
    05  filler                          pic x(01)       value spaces.
    05  p-inv-dd                        pic 9(02).
    05  filler                          pic x(01)       value spaces.
    05  p-page                          pic z(02).
    05  filler                          pic x(02)       value spaces.
    05  p-pages                         pic z(02).
    05  filler                          pic x(03)       value spaces.
* (y2k)
   05  p-inv-date                               pic 9(06).
   05  p-inv-date-r redefines p-inv-date.
        10 p-inv-date-y1 pic 9(1).
        10 p-inv-date-y2 pic 9(1).
        10 p-inv-date-mm pic 9(2).
        10 p-inv-date-dd pic 9(2).
*** 05  p-inv-date                      pic 9(08).
    05  filler                          pic x(03)       value spaces.
    05  p-sum-id                        pic x(12).
    05  filler                          pic x(09)       value spaces.

01  prt-dtl.
    05  filler                          pic x(01)       value spaces.
* (y2k)
*   05  p-dtl-srv-date                          pic 9(06) blank when zero.
*   05  p-dtl-srv-date                  pic 9(08)       blank when zero.
    05  p-dtl-srv-date                  pic 9(06)       blank when zero.
    05  p-nbr-srv                       pic z(02)       blank when zero.
    05  filler                          pic x(01)       value spaces.
    05  p-dtl-btch-nbr                  pic x(06).
    05  p-dtl-clm-nbr                   pic x(02).
    05  filler                          pic x(01)       value spaces.
    05  p-ohip-cd                       pic x(04).
    05  p-ohip-suff                     pic x(01).
    05  filler                          pic x(01)       value spaces.
    05  p-doc                           pic x(09).
    05  filler                          pic x(01)       value spaces.
    05  p-loc                           pic x(01).
    05  filler                          pic x(01)       value spaces.
    05  p-desc.
        10  p-desc-l                    pic x(23).
        10  p-desc-r                    pic x(24).
    05  filler                          pic x(01)       value spaces.
    05  p-dtl-charge                    pic z(07)       blank when zero.
    05  filler                          pic x(01)       value spaces.
    05  p-credits                       pic z(07)       blank when zero.
    05  filler                          pic x(02)       value spaces.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  34
*                      u035cnoupd.cbl                                )
    05  p-summary.
* (y2k)
        10  p-sum-srv-date              pic 9(06)       blank when zero.
***     10  p-sum-srv-date              pic 9(08)       blank when zero.
        10  filler                      pic x(01)       value spaces.
        10  p-sum-btch-nbr              pic x(06).
        10  p-sum-clm-nbr               pic x(02).
        10  filler                      pic x(01)       value spaces.
        10  p-sum-charge                pic z(05).99.
        10  filler                      pic x(06)       value spaces.

01  prt-tot1.
    05  filler                          pic x(46)       value spaces.
    05  p-prev-bal                      pic z(05).99.
    05  filler                          pic x(01)       value spaces.
    05  p-curr-char                     pic z(05).99.
    05  filler                          pic x(01)       value spaces.
    05  p-payments                      pic z(05).99.
    05  filler                          pic x(01)       value spaces.
    05  p-adjustments                   pic z(05).99-.
    05  filler                          pic x(05)       value spaces.
    05  p-dtl-bal-due                   pic z(05).99.
    05  filler                          pic x(11)       value spaces.
    05  p-sum-bal-due                   pic z(05).99.
    05  filler                          pic x(18)       value spaces.

01  prt-tot2.
    05  filler                          pic x(37)       value spaces.
    05  p-curr                          pic z(05).99.
    05  filler                          pic x(01)       value spaces.
    05  p-30                            pic z(05).99.
    05  filler                          pic x(01)       value spaces.
    05  p-60                            pic z(05).99.
    05  filler                          pic x(01)       value spaces.
    05  p-90                            pic z(05).99.
    05  filler                          pic x(01)       value spaces.
    05  p-120                           pic z(05).99.
    05  filler                          pic x(51)       value spaces.

01  prt-blanks.
    05  filler                          pic x(132)      value spaces.

01  prt-cntrl-hdr.
    05  filler                          pic x(40)       value spaces.
    05  p-cntrl-lit                     pic x(15).
    05  filler                          pic x(01)       value spaces.
    05  p-cntrl-id                      pic x(02).
    05  filler                          pic x(74)       value spaces.

01  prt-cntrl-col.
    05  filler                          pic x(40)       value spaces.
    05  filler                          pic x(40)
        value "BALANCE DUE       CLAIMS        INVOICES".
    05  filler                          pic x(52)       value spaces.

01  prt-cntrl-dtl.
    05  filler                          pic x(40)       value spaces.
    05  p-bal-due                       pic z(06).99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  35
*                      u035cnoupd.cbl                                )
    05  filler                          pic x(09)       value spaces.
    05  p-nbr-claims                    pic zzzz9.
    05  filler                          pic x(11)       value spaces.
    05  p-nbr-invoices                  pic zzz9.
    05  filler                          pic x(54)       value spaces.

01  error-message-table.

    05  error-messages.
        10  filler                              pic x(60)   value
                " ".

    05  error-messages-r redefines error-messages.
        10  err-msg                             pic x(60)
                        occurs 01 times.

01  err-msg-comment                             pic x(60).

01  e1-error-line.

    05  e1-error-word                           pic x(13)    value
                        "***  ERROR - ".
    05  e1-error-msg                            pic x(119).

    copy "sysdatetime.ws".
* 98/dec/01 D.B.        - y2k conversion
* 99/jan/13 B.E.        - changed sys-y1/y2 to y1 thru y4
*                       - added 'default-century-...' and century-date variables

01 century-year                                 pic 9(4).
01 century-date                                 pic 9(8).
01 default-century-cc                           pic 9(2) value 19.
01 default-century-cccc                         pic 9(4) value 1900.

01  sys-date.
* y2k    05  sys-date-long                              pic x(6).
    05  sys-date-long                           pic x(8).
    05  sys-date-long-r  redefines  sys-date-long.
* y2k   10  sys-yy                              pic 99.
        10  sys-yy                              pic 9999.
        10  sys-yy-alpha  redefines  sys-yy.
* y2k       15  sys-y1                          pic 9.
* y2k       15  sys-y2                          pic 9.
            15  sys-y1                          pic 9.
            15  sys-y2                          pic 9.
            15  sys-y3                          pic 9.
            15  sys-y4                          pic 9.
        10  sys-mm                              pic 99.
        10  sys-dd                              pic 99.
* remove after y2k upgrade of dgux
01  sys-date-numeric redefines sys-date         pic 9(8).
01  sys-date-y2kfix  redefines sys-date.
    05 sys-date-left                            pic x(6).
    05 filler                                   pic x(2).
01  sys-date-y2kfixed redefines sys-date.
    05 sys-date-blank                           pic x(2).
    05 sys-date-right                           pic x(6).
01  sys-date-temp                               pic x(8).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  36
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)

01  run-date.
* y2k    05  run-yy                                     pic 99.
    05  run-yy                                  pic 9999.
    05  filler                                  pic x   value "/".
    05  run-mm                                  pic 99.
    05  filler                                  pic x   value "/".
    05  run-dd                                  pic 99.

01  sys-time.
    05  sys-hrs                                 pic 99.
    05  sys-min                                 pic 99.
    05  sys-sec                                 pic 99.
    05  sys-hdr                                 pic 99.

01  run-time.
    05  run-hrs                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-min                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-sec                                 pic 99.

01  age-date.
* (y2k)
*   05  age-yy                                  pic 99.
    05  age-yy                                  pic 9(4).
    05  age-mm                                  pic 99.
    05  age-dd                                  pic 99.

01  claim-date.
* (y2k)
*   05  claim-yy                                pic 99.
    05  claim-yy                                pic 9(4).
    05  claim-mm                                pic 99.
    05  claim-dd                                pic 99.

* (y2k)
*01  claim-days                                 pic 9(7)v99.
01  claim-days                                  pic 9(9)v99.
*01  run-days                                   pic 9(7)v99.
01  run-days                                    pic 9(9)v99.

copy "mth_desc_max_days.ws".
*
*       (each position contains:
*               - maximum nbr of days in month
*               - non-abreviated spelling of month
*               - nbr of julian days from jan-01 until last day of month
*       note: table does not take into consideration leap year)
*
01  month-descs-and-max-days-mth.
    05  mth-desc-max-days.
        10  filler                      pic x(14) value '31  JANUARY031'.
        10  filler                      pic x(14) value '29 FEBRUARY059'.
        10  filler                      pic x(14) value '31    MARCH090'.
        10  filler                      pic x(14) value '30    APRIL120'.
        10  filler                      pic x(14) value '31      MAY151'.
        10  filler                      pic x(14) value '30     JUNE181'.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  37
*                      u035cnoupd.cbl (/alpha/rmabill/rmabill101c/use)
        10  filler                      pic x(14) value '31     JULY212'.
        10  filler                      pic x(14) value '31   AUGUST243'.
        10  filler                      pic x(14) value '30SEPTEMBER273'.
        10  filler                      pic x(14) value '31  OCTOBER304'.
        10  filler                      pic x(14) value '30 NOVEMBER334'.
        10  filler                      pic x(14) value '31 DECEMBER365'.
    05  mth-desc-max-days-r   redefines mth-desc-max-days.
        10  mth-desc-max-days-occur     occurs  12  times.
            15  max-nbr-days            pic 99.
            15  mth-desc                pic x(9).
            15  nbr-julian-days-ytd     pic 9(3).


screen section.

01  scr-title.
    05  blank screen.
    05  line 07 col 29 value "DIRECT BILLS INVOICING".
    05  line 10 col 22 value "ENTER DAYS AGED FOR RE-INVOICING: ".
    05  line 10 col 56 pic z9 using ws-age-days auto.
    05  line 12 col 23 value "C)HANGE DAYS, P)ROCEED OR E)XIT:".
    05  line 12 col 56 pic x  using ws-reply.

01 file-status-display.
    05  line 24 col 56  "FILE STATUS = ".
*mf 05  line 24 col 70  pic x(11) from common-status-file       bell blink.
    05  line 24 col 70  pic x(2) from common-status-file        bell blink.
*
01  err-msg-line.
    05  line 24 col 01  value " ERROR -  "      bell blink.
    05  line 24 col 11  pic x(60)       from err-msg-comment.


01  confirm.
    05 line 23 col 01  value " ".

01  blank-line-24.
    05  line 24 col 1   blank line.

01  blank-screen.
    05  blank screen.


01  program-in-progress.
    05  line 16 col 28 value "PROGRAM U035C IN PROGRESS".

01  scr-closing-screen.
    05  line 21 col 20  value "PROGRAM U035C ENDING".
* (y2k - auto fix)
*   05  line 21 col 40  pic 99  from sys-yy.
    05  line 21 col 40  pic 9(4)        from sys-yy.
    05  line 21 col 44  value "/".
    05  line 21 col 45  pic 99  from sys-mm.
    05  line 21 col 47  value "/".
    05  line 21 col 48  pic 99  from sys-dd.
    05  line 21 col 52  pic 99  from sys-hrs.
    05  line 21 col 54  value ":".
    05  line 21 col 55  pic 99  from sys-min.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  38
*                      u035cnoupd.cbl                                )
    05  line 23 col 20  value "PRINT REPORTS ARE IN FILES RU035CA & RU035CB".

procedure division.
declaratives.

err-claims-mstr-file section.
    use after standard error procedure on claims-mstr.

err-claims-mstr.
*mf move status-claims-mstr             to      common-status-file.
    move status-cobol-claims-mstr       to      common-status-file.
    stop "ERROR IN ACCESSING CLAIMS MASTER".
    stop run.

err-pat-mstr-file section.
    use after standard error procedure on pat-mstr.
err-pat-mstr.
*mf move status-pat-mstr                to      common-status-file.
    move status-cobol-pat-mstr          to      common-status-file.
    stop "ERROR IN ACCESSING PATIENT MASTER".

err-doc-mstr-file section.
    use after standard error procedure on doc-mstr.
err-doc-mstr.
*mf move status-doc-mstr                to common-status-file.
    move status-cobol-doc-mstr          to common-status-file.
    stop "ERROR IN ACCESSING DOCTOR MASTER".

err-oma-fee-mstr-file section.
    use after standard error procedure on oma-fee-mstr.
err-oma-fee-mstr.
*mf move status-oma-mstr                to common-status-file.
    move status-cobol-oma-mstr          to common-status-file.
    stop "ERROR IN ACCESSING OMA FEE MASTER".

err-msg-sub-mstr-file section.
    use after standard error procedure on msg-sub-mstr.
err-msg-sub-mstr.
    move status-cobol-msg-sub-mstr              to common-status-file.
    stop "ERROR IN ACCESSING MSG SUB MASTER".

end declaratives.

main-line section.
mainline.

    perform aa0-initialization          thru aa0-99-exit.
    perform ab0-processing              thru ab0-99-exit
        until eof-clm-shadow-mstr.
    perform az0-end-of-job              thru az0-99-exit.
*
    stop run.
aa0-initialization.

    accept sys-date                     from date.
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.
    move sys-mm                         to run-mm.
    move sys-dd                         to run-dd.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  39
*                      u035cnoupd.cbl                                )
    move sys-yy                         to run-yy.

    multiply run-yy by 365              giving run-days.
    add nbr-julian-days-ytd(run-mm)     to run-days.
    compute run-days = run-days -
                       ( max-nbr-days(run-mm) - run-dd ).

    accept sys-time                     from time.
    move sys-hrs                        to run-hrs.
    move sys-min                        to run-min.
    move sys-sec                        to run-sec.

*   display scr-title.

aa0-input.

*   accept scr-title.

move 'P'                                 to ws-reply

    if ws-reply = 'P'
    then
        next sentence
    else
        if ws-reply = 'E'
        then
            stop run
        else
            go to aa0-input.
*   endif

*   calculate date used for re-invoicing inactive unpaid bills

* (y2k)
    move sys-date               to age-date.
    perform aa1-calc-age-date   thru aa1-99-exit
                                until ws-age-days = zero.

    open        input   clm-shdw-work-mstr
                        pat-mstr
                        doc-mstr
                        oma-fee-mstr
                        msg-sub-mstr.
    open        i-o     claims-mstr.

    move prt-file-name-b                to print-file-name.
*    expunge print-file.
    move prt-file-name-a                to print-file-name.
*    expunge print-file.
    open output print-file.

    move zero                           to break-control-table
                                           doc-nbr.
    move 'N'                            to flag-eof-clm-shadow-mstr.
    move 'Y'                            to process-flag.

    perform ga0-get-next-claim          thru ga0-99-exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  40
*                      u035cnoupd.cbl                                )
    if not-eof-clm-shadow-mstr
    then
        perform ca0-init-subscr         thru ca0-99-exit.
*    endif

aa0-99-exit.
    exit.
aa1-calc-age-date.

    if ws-age-days not < age-dd
    then
        subtract age-dd                 from ws-age-days
        perform aa11-reduc-mm           thru aa11-99-exit
        if age-mm = 9 or 4 or 6 or 11
        then
            move 30                     to age-dd
        else
            if age-mm = 2
            then
                move 28                 to age-dd
            else
                move 31                 to age-dd
    else
        subtract ws-age-days            from age-dd
        move zero                       to ws-age-days.
*   endif

aa1-99-exit.

    exit.

aa11-reduc-mm.

    if age-mm = 1
    then
        move 12                         to age-mm
        subtract 1                      from age-yy
    else
        subtract 1                      from age-mm.
*   endif

aa11-99-exit.

    exit.

az0-end-of-job.

    perform gc0-patient-processing      thru gc0-99-exit.
    perform ba0-print-invoice           thru ba0-99-exit.
    perform da0-subdiv-break            thru da0-99-exit.
    perform ea0-clinic-break.
    perform ha0-agent-break             thru ha0-99-exit.

    move ss-grand                       to ss-break-type.
    perform xb0-print-controls          thru xb0-99-exit.

    close claims-mstr
          clm-shdw-work-mstr
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  41
*                      u035cnoupd.cbl                                )
          pat-mstr
          doc-mstr
          oma-fee-mstr
          msg-sub-mstr
          print-file.

    stop run.

az0-99-exit.
    exit.

ab0-processing.

*       read current claim to process

*mf    move 'B'                         to key-clm-key-type.
*mf    move zero                        to key-clm-data.
*mf    move wf-shadow-batch-nbr         to key-clm-batch-num.
*mf    move wf-shadow-claim-nbr         to key-clm-claim-nbr.
    move 'B'                            to clmdtl-b-key-type.
    move zero                           to clmdtl-b-data.
    move wf-shadow-batch-nbr            to clmdtl-b-batch-num.
    move wf-shadow-claim-nbr            to clmdtl-b-claim-nbr.

    perform ya0-read-claim-header               thru ya0-99-exit.

*       calculate claims balance due

    add clmhdr-tot-claim-ar-oma,clmhdr-manual-and-tape-paymnts
        giving ws-claim-bal-due.

    if ws-claim-bal-due > .64
    then
        move 'Y'                                to flag-claim-bal-due
    else
        move 'N'                                to flag-claim-bal-due.
*   endif

*       process control breaks

    if wf-shadow-agent not = save-shadow-agent
    then
        perform ba0-print-invoice               thru ba0-99-exit
        perform da0-subdiv-break                thru da0-99-exit
        perform ea0-clinic-break                thru ea0-99-exit
        perform ha0-agent-break                 thru ha0-99-exit
        perform ca0-init-subscr                 thru ca0-99-exit
    else
        if wf-shadow-clinic not = save-shadow-clinic
        then
            perform ba0-print-invoice           thru ba0-99-exit
            perform da0-subdiv-break            thru da0-99-exit
            perform ea0-clinic-break            thru ea0-99-exit
            perform ca0-init-subscr             thru ca0-99-exit
        else
            if wf-shadow-subdivision not = save-shadow-subdivision
            then
                perform ba0-print-invoice       thru ba0-99-exit
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  42
*                      u035cnoupd.cbl                                )
                perform da0-subdiv-break        thru da0-99-exit
                perform ca0-init-subscr         thru ca0-99-exit
            else
                if wf-shadow-patient not = save-shadow-patient
                   or invoice-overflow
                then
                    perform ba0-print-invoice   thru ba0-99-exit
                   perform ca0-init-subscr      thru ca0-99-exit.
*   endif

    perform fa0-process-claim                   thru fa0-99-exit.

    perform ga0-get-next-claim                  thru ga0-99-exit.

ab0-99-exit.

    exit.
ba0-print-invoice.

*       don'T PRINT INVOICES IF THERE WERE NO CURRENT CLAIMS
*       with balance due or aged

    if invoice-not-to-print
    then
        go to ba0-99-exit.
*   endif

    subtract 1                                  from ss-a.
    add 1                               to bc-invoices(ss-subdiv).

*       calculate nbr pages required to print invoice

    if ss-a > ws-detail-lines
    then
        move ss-a                               to ws-nbr-lines
    else
        move ws-detail-lines                    to ws-nbr-lines.
*   endif

    divide ws-nbr-lines by ws-lines-per-page
        giving ws-nbr-pages remainder ws-remainder.

    if ws-remainder not = zero
    then
        add ws-nbr-pages, 1                     giving ws-nbr-pages.
*   endif

    move ws-nbr-pages                   to p-pages.

*       calculations

    add ws-prev-balance,
        ws-curr-charges                 giving ws-balance-due.

    compute ws-bal-fwd = ws-balance-due - ws-curr-charges
                         - ws-tot-pay - ws-tot-adj.

*       print heading lines
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  43
*                      u035cnoupd.cbl                                )

    move zero                           to ws-page-cntr.

    perform bb0-inv-header              thru bb0-99-exit.

*
*       the following pointers will be used to track the printing
*       of the left (detail) and right (summary) sides of the
*       invoice from the summary table.
*
*       ss-a    - left
*       ss-b    - right
*

    move ss-a                           to ws-summary-items.
    move 1                              to ss-a
                                           ss-b.

    perform bc0-print-detail            thru bc0-99-exit
        until ss-a > ws-summary-items.

*       print subscr message

    move spaces                         to prt-dtl.
    if ws-msg1 not = spaces
    then
        move ws-msg1                    to p-desc
        perform bd0-summary-and-print   thru bd0-99-exit.
*   endif
    if ws-msg2 not = spaces
    then
        move ws-msg2                    to p-desc
        perform bd0-summary-and-print   thru bd0-99-exit.
*   endif
    if ws-msg3 not = spaces
    then
        move ws-msg3                    to p-desc
        perform bd0-summary-and-print   thru bd0-99-exit.
*   endif
    if ws-msg4 not = spaces
    then
        move ws-msg4                    to p-desc
        perform bd0-summary-and-print   thru bd0-99-exit.
*   endif

*       print any remaining right side summary lines

    move spaces                         to prt-dtl.

    perform bd0-summary-and-print       thru bd0-99-exit
        until ss-b > ws-summary-items.

*       print total lines

    add ws-line-cntr,2                  giving ws-line-cntr.

    move ws-bal-fwd                     to p-prev-bal.
    move ws-curr-charges                to p-curr-char.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  44
*                      u035cnoupd.cbl                                )
    move ws-tot-pay                     to p-payments.
    move ws-tot-adj                     to p-adjustments.

    move ws-balance-due                 to p-dtl-bal-due
                                           p-sum-bal-due.

    write prt-line from prt-tot1 after advancing ws-line-cntr.

    move ws-cur                         to p-curr.
    move ws-30                          to p-30.
    move ws-60                          to p-60.
    move ws-90                          to p-90.
    move ws-120                         to p-120.

    write prt-line from prt-tot2 after 2.

    add inv-claims                      to bc-claims(ss-subdiv).
    add inv-bal-due                     to bc-bal-due(ss-subdiv).

ba0-99-exit.

    exit.

bb0-inv-header.

    move 7                              to ws-skip.

    if p-addr1 = spaces
    then
        add 1                           to ws-skip.
*   endif
    if p-addr2 = spaces
    then
        add 1                           to ws-skip.
*   endif
    if p-addr3 = spaces
    then
        add 1                           to ws-skip.
*   endif

    write prt-line from prt-blanks after page.
    write prt-line from prt-name after ws-skip lines.
    if p-addr1 not = spaces
    then
        write prt-line from prt-addr1.
*   endif
    if p-addr2 not = spaces
    then
        write prt-line from prt-addr2.
*   endif
    if p-addr3 not = spaces
    then
        write prt-line from prt-addr3.
*   endif

    add 1                       to ws-page-cntr.
    move ws-page-cntr           to p-page.
    write prt-line from prt-hdr.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  45
*                      u035cnoupd.cbl                                )

    write prt-line from prt-country.

*       print balance forward on top of first page

    if ws-page-cntr not = 1
    then
        write prt-line from prt-blanks after 2
        move 21                         to ws-line-cntr
    else
        move 19                         to ws-line-cntr
        if ws-bal-fwd = zero
        then
*           write prt-line from prt-blanks after 4
            write prt-line from prt-blanks after 3
        else
            move spaces                 to prt-dtl
            move ws-bal-fwd-lit         to p-desc
            move ws-bal-fwd             to ws-redefine
            move ws-redefined           to p-dtl-charge
*           write prt-line from prt-dtl after 3
            write prt-line from prt-dtl after 2
            write prt-line from prt-blanks.
*   endif

bb0-99-exit.

    exit.

bc0-print-detail.

*mf    move 'B'                         to key-clm-key-type.
*mf    move zero                        to key-clm-data.
*mf    move sum-batch-nbr(ss-a)         to key-clm-batch-num.
*mf    move sum-claim-nbr(ss-a)         to key-clm-claim-nbr
    move 'B'                            to clmdtl-b-key-type.
    move zero                           to clmdtl-b-data.
    move sum-batch-nbr(ss-a)            to clmdtl-b-batch-num.
    move sum-claim-nbr(ss-a)            to clmdtl-b-claim-nbr

    perform ya0-read-claim-header       thru ya0-99-exit.

*       update claim header

    if (clmhdr-reprint-flag = 'Y') or
       (clmhdr-auto-logout  = 'Y') or
       (new-claim-payment)
    then
       perform fe0-claim-header-update  thru fe0-99-exit.
*   endif

*       skip claims not to reprint in detail
    if sum-reprint(ss-a) = 'N'
    then
        go to bc0-90-exit.
*   endif

    move 'N'                            to flag-end-of-claim-details
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  46
*                      u035cnoupd.cbl                                )
                                           flag-new-claim-payment.

    move zero                           to ws-nbr-desc.

    perform ya1-read-claim-detail-next  thru ya1-99-exit.

*       print claim details

    perform bc1-detail-loop             thru bc1-99-exit
        until end-of-claim-details.

*       print odd desc record

    if sum-reprint(ss-a) = 'Y'
    then
        divide ws-nbr-desc by 2 giving ws-quotient remainder ws-remainder
        if ws-remainder not = zero
        then
            perform bd0-summary-and-print       thru bd0-99-exit.
*   endif

*       print claim message

    if clmhdr-msg-nbr not = zero
       and sum-reprint(ss-a) = 'Y'
    then
        perform bc2-print-clm-msg       thru bc2-99-exit.
*   endif

bc0-90-exit.

    add 1                               to ss-a.

bc0-99-exit.

    exit.

bc1-detail-loop.

*       print according to record type

*       if payment or adjustment and claim detail record has never
*       been printed yet.

    if ( clmdtl-adj-cd = 'A' or 'B' or 'C' )
*       and ( clmdtl-adjust-reprint not = 'Y' ) - 89/03/10 by m.c
        and clmdtl-oma-cd not = 'ZZZZ'
    then
        perform bc10-payment-adjustment thru bc10-99-exit
    else

*       if clmjdr-report-flag = "Y" then sum-reprint (ss-a) will also be
*       set to "Y", these flags are set in 'FCO' subroutine

        if sum-reprint(ss-a) = 'Y'
        then
            if clmdtl-oma-cd = 'ZZZZ'
            then
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  47
*                      u035cnoupd.cbl                                )
                perform bc11-description        thru bc11-99-exit
            else
                perform bc12-detail             thru bc12-99-exit.
*           endif
*       endif
*   endif

    perform ya1-read-claim-detail-next          thru ya1-99-exit.

bc1-99-exit.

    exit.

bc10-payment-adjustment.

    move spaces                         to prt-dtl.
    perform be0-build-common            thru be0-99-exit.
*** move clmhdr-date-sys                to p-dtl-srv-date.
    move clmhdr-date-sys to temp-long-date.
    move temp-long-date-yymmdd          to p-dtl-srv-date.



    if clmdtl-adj-cd = 'C' and clmdtl-fee-oma < zero
    then
        move ws-payment-lit             to p-desc
        move clmdtl-fee-oma             to ws-redefine
        move ws-redefined               to p-credits
        move 'Y'                        to flag-new-claim-payment
    else
        if clmdtl-adj-cd = 'C'
        then
            move ws-pay-reversal-lit    to p-desc
            move clmdtl-fee-oma         to ws-redefine
            move ws-redefined           to p-dtl-charge
            move 'Y'                    to flag-new-claim-payment
        else
            move ws-adjustment-lit      to p-desc
            if clmdtl-fee-oma  < zero
            then
                move clmdtl-fee-oma     to ws-redefine
                move ws-redefined       to p-credits
            else
                move clmdtl-fee-oma     to ws-redefine
                move ws-redefined               to p-dtl-charge.
*   endif

    perform bd0-summary-and-print       thru bd0-99-exit.

*       flag payment and adjustments that have been printed in detail

    if clmdtl-adjust-reprint not = 'Y'
    then
        move 'Y'                        to clmdtl-adjust-reprint
        perform ya3-rewrite-clmdtl      thru ya3-99-exit.
*   endif


* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  48
*                      u035cnoupd.cbl                                )
bc10-99-exit.

    exit.

bc11-description.

*       print two desc per detail line

    add 1                               to ws-nbr-desc.
    divide ws-nbr-desc by 2 giving ws-quotient remainder ws-remainder.

    if ws-remainder = 0
    then
        move clmdtl-desc                to  p-desc-r
        perform bd0-summary-and-print thru bd0-99-exit
    else
        move spaces                     to prt-dtl
        move clmdtl-desc                to p-desc-l.
*   endif

bc11-99-exit.

    exit.

bc12-detail.

    move spaces                         to prt-dtl.
    perform be0-build-common            thru be0-99-exit.

    move clmdtl-oma-cd                  to fee-oma-cd.
    perform yf0-read-oma-fee-mstr       thru yf0-99-exit.

*       full desc or ( generic based on oma icc code )

    if clmhdr-fee-complex = 'H'
    then
        move fee-desc                   to p-desc
    else
        perform bc120-icc-desc          thru bc120-99-exit.
*   endif

    move clmdtl-fee-oma                 to ws-redefine.
    move ws-redefined                   to p-dtl-charge.

    perform bd0-summary-and-print       thru bd0-99-exit.

bc12-99-exit.

    exit.

bc120-icc-desc.

*       the following hard coded low level descriptions should not
*       exceed 39 characters to allow room for appending the
*       literal " PREMIUM"  to add on code occurences

    move clmdtl-oma-cd                  to fee-oma-cd.
    perform yf0-read-oma-fee-mstr       thru yf0-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  49
*                      u035cnoupd.cbl                                )

    if oma-rec-not-found
    then
        move spaces                     to p-desc
    else
        if (fee-icc-sec = 'NM'
                       or 'PF'
                       or 'DR'
                       or 'DU')
        or ((clmdtl-oma-suff = 'A')
             and (fee-icc-sec = 'CP' or 'DT'))
        then
            move 'PROCEDURE'            to p-desc
        else
            if (clmdtl-oma-suff = 'C')
            and (fee-icc-sec = 'CP'
                            or 'DT'
                            or 'SP')
            then
                move 'ANAESTHESIA'      to p-desc
            else
                if (clmdtl-oma-suff = 'B')
                and (fee-icc-sec = 'SP')
                then
                    move 'ASSISTING'            to p-desc
                else
                    if (fee-icc-code = 'SP0440')
                    and (clmdtl-oma-suff = 'A')
                    then
                        move 'OBSTETRICS'       to p-desc
                    else
                        if (fee-icc-sec = 'SP')
                        and (clmdtl-oma-suff = 'A')
                        then
                            move 'SURGICAL PROCEDURE'   to p-desc
                        else
                            if fee-icc-sec = 'LM'
                            then
                                move 'LAB WORK'         to p-desc
                            else
                                if fee-icc-sec = 'CV'
                                then
                                    move 'VISITS'       to p-desc
                                else
                                    move spaces         to p-desc.
*   endif

*       modify descriptions for add on codes

*       (this code cannot be implemented until d001 has been modified
*       to allow add on codes based on icc group in the pricing
*       procedure, it must be tested before going into production,
*       the temporary fix for low level descriptions should be
*       removed)

*    if (fee-icc-grp = '99'  or
*        fee-icc-grp = '98') and
*       (p-desc not = spaces)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  50
*                      u035cnoupd.cbl                                )
*    then
*       perform bf0-premium-desc                thru bf0-99-exit.
*   endif

*       temporary fix for low level descriptions

    if fee-oma-cd = "H110" or "H106"
    then
        move "OFF HOUR VISIT PREMIUM"           to p-desc.
*   endif

bc120-99-exit.

    exit.

bc2-print-clm-msg.

    move spaces                         to prt-dtl.

    move msg-indexer                    to msg-sub-key-1.
    move clmhdr-msg-nbr                 to msg-sub-key-23.

    perform yg0-read-msg-sub-mstr       thru yg0-99-exit.

    if msg-dtl1 not = spaces
    then
        move msg-dtl1                   to p-desc
        perform bd0-summary-and-print   thru bd0-99-exit.
*   endif
    if msg-dtl2 not = spaces
    then
        move msg-dtl2                   to p-desc
        perform bd0-summary-and-print   thru bd0-99-exit.
*   endif
    if msg-dtl3 not = spaces
    then
        move msg-dtl3                   to p-desc
        perform bd0-summary-and-print   thru bd0-99-exit.
*   endif
    if msg-dtl4 not = spaces
    then
        move msg-dtl4                   to p-desc
        perform bd0-summary-and-print   thru bd0-99-exit.
*   endif

bc2-99-exit.

    exit.

bd0-summary-and-print.

*       set up summary side if items still to be printed
*       skipping partial reprints

    if ss-b not > ws-summary-items
    then
        if sum-reprint(ss-b) not = 'P'
        then
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  51
*                      u035cnoupd.cbl                                )

*           move sum-sv-date(ss-b)              to p-sum-srv-date
            move sum-sv-date(ss-b)              to temp-long-date
            move temp-long-date-yymmdd          to p-sum-srv-date

            move sum-btch-nbr(ss-b)             to p-sum-btch-nbr
            move sum-claim-nbr(ss-b)            to p-sum-clm-nbr
            move sum-bal-due(ss-b)              to p-sum-charge
            add 1                               to ss-b
        else
            add 1                               to ss-b
            go to bd0-summary-and-print
    else
        move spaces                             to p-summary.
*   endif

    write prt-line from prt-dtl.
    subtract 1 from ws-line-cntr.
    if ws-line-cntr = 0
    then
        perform bb0-inv-header          thru bb0-99-exit.
*   endif

bd0-99-exit.

   exit.

be0-build-common.

*** move clmdtl-sv-date                 to p-dtl-srv-date.
    move clmdtl-sv-date  to temp-long-date.
    move temp-long-date-yymmdd          to p-dtl-srv-date.

    if clmdtl-adj-cd = 'A' or 'B' or 'C'
    then
        next sentence
    else
        move clmdtl-nbr-serv            to p-nbr-srv.
*   endif

    move sum-btch-nbr(ss-a)             to p-dtl-btch-nbr.
    move sum-claim-nbr(ss-a)            to p-dtl-clm-nbr.
    move clmdtl-oma-cd                  to p-ohip-cd.
    move clmdtl-oma-suff                to p-ohip-suff.

    if clmhdr-doc-nbr not = doc-nbr
    then
        move clmhdr-doc-nbr             to doc-nbr
        perform ye0-read-doc-mstr       thru ye0-99-exit.
*   endif

    move doc-name                       to p-doc.
    move clmhdr-hosp                    to p-loc.

be0-99-exit.

    exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  52
*                      u035cnoupd.cbl                                )

bf0-premium-desc.

    move spaces                         to ws-desc.

    string p-desc       delimited by ws-spaces,
           ws-space     delimited by size,
           ws-premium   delimited by size
           into ws-desc.

    move ws-desc                        to p-desc.

bf0-99-exit.

    exit.
ca0-init-subscr.

   move spaces                          to summary-table.

   move zeros                           to ws-prev-balance
                                           ws-curr-charges
                                           inv-claims
                                           inv-bal-due
                                           ws-cur
                                           ws-30
                                           ws-60
                                           ws-90
                                           ws-120
                                           ws-tot-adj
                                           ws-tot-pay.

    move 'N'                            to flag-invoice-to-print
                                           flag-curr-activity
                                           flag-invoice-overflow.
* (y2k)
*    move 999999                                to ws-oldest-stmnt-prt-dt.
    move 99999999                       to ws-oldest-stmnt-prt-dt.

    move 1                              to ss-a.
    move 2                              to ws-detail-lines.

    move wf-shadow-sort-key             to save-shadow-key.

*       restore claim header read before break

*mf    move 'B'                         to key-clm-key-type.
*mf    move zero                        to key-clm-data.
*mf    move wf-shadow-batch-nbr         to key-clm-batch-nbr.
*mf    move wf-shadow-claim-nbr         to key-clm-claim-nbr.
    move 'B'                            to clmdtl-b-key-type.
    move zero                           to clmdtl-b-data.
    move wf-shadow-batch-nbr            to clmdtl-b-batch-nbr.
    move wf-shadow-claim-nbr            to clmdtl-b-claim-nbr.

    perform ya0-read-claim-header       thru ya0-99-exit.

ca0-99-exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  53
*                      u035cnoupd.cbl                                )
    exit.

da0-subdiv-break.

    move ss-subdiv                      to ss-break-type.
    move ss-clinic                      to ss-to.

    perform xb0-print-controls          thru xb0-99-exit.
    perform xc0-bump-and-zero           thru xc0-99-exit.

da0-99-exit.

    exit.

ea0-clinic-break.

    move ss-clinic                      to ss-break-type.
*   move ss-grand                       to ss-to.
    move ss-agent                       to ss-to.

    perform xb0-print-controls          thru xb0-99-exit.
    perform xc0-bump-and-zero           thru xc0-99-exit.

    if wf-shadow-clinic = 43
    then
        close print-file
        move prt-file-name-b            to print-file-name
        open output print-file
    else
        if save-shadow-clinic = 43
        then
            close print-file
            move prt-file-name-a        to print-file-name
            open extend print-file.
*   endif

ea0-90-exit.

*    move clm-shadow-clinic             to iconst-clinic-nbr-1-2.
*    perform yh0-read-const-mstr        thru yh0-99-exit.

ea0-99-exit.

    exit.
ha0-agent-break.

    move ss-agent                       to ss-break-type.
    move ss-grand                       to ss-to.

    perform xb0-print-controls          thru xb0-99-exit.
    perform xc0-bump-and-zero           thru xc0-99-exit.

ha0-99-exit.

    exit.

fa0-process-claim.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  54
*                      u035cnoupd.cbl                                )
    if claim-has-bal-due
    then
        perform fa1-check-clmref-date   thru fa1-99-exit

        if ws-hold-clmref-date < ws-oldest-stmnt-prt-dt
        then
            move ws-hold-clmref-date    to ws-oldest-stmnt-prt-dt.
*       (else)
*       endif
*   (else)
*   endif

    move 'N'                            to flag-end-of-claim-details.

    move zeros                          to sum-sv-date(ss-a).
    move 'N'                            to sum-reprint(ss-a).

    perform ya1-read-claim-detail-next  thru ya1-99-exit.

    perform fb0-process-claim-details   thru fb0-99-exit
        until end-of-claim-details.

*       round up detail lines for odd descriptions

    divide ws-detail-lines by 1 giving ws-quotient remainder ws-remainder.
    if ws-remainder not = zero
    then
        add .5                                  to ws-detail-lines.
*   endif

    if claim-has-bal-due
    then
        perform fc0-invoice-housekeeping        thru fc0-99-exit
    else
        if sum-reprint(ss-a) = 'P'
        then
            perform fc0-90-build-summary        thru fc0-99-exit.
*   endif

fa0-99-exit.
    exit.



fa1-check-clmref-date.

    if clmhdr-ref-date1 is numeric
    then
        move clmhdr-ref-date1           to ws-hold-clmref-date
    else
        if    clmhdr-ref2 is numeric
          and clmhdr-ref3 is numeric
          and clmhdr-ref4 is numeric
          and clmhdr-ref5 is numeric
          and clmhdr-ref6 is numeric
          and clmhdr-ref7 is numeric
        then
            move clmhdr-ref-date2       to ws-hold-clmref-date
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  55
*                      u035cnoupd.cbl                                )
        else
            if    clmhdr-ref3 is numeric
              and clmhdr-ref4 is numeric
              and clmhdr-ref5 is numeric
              and clmhdr-ref6 is numeric
              and clmhdr-ref7 is numeric
              and clmhdr-ref8 is numeric
            then
                move clmhdr-ref-date3   to ws-hold-clmref-date
            else
                if    clmhdr-ref4 is numeric
                  and clmhdr-ref5 is numeric
                  and clmhdr-ref6 is numeric
                  and clmhdr-ref7 is numeric
                  and clmhdr-ref8 is numeric
                  and clmhdr-ref9 is numeric
                then
                    move clmhdr-ref-date4 to ws-hold-clmref-date
                else
* (y2k)
*                   move 999999         to ws-hold-clmref-date.
                    move 99999999       to ws-hold-clmref-date.
*               endif
*           endif
*       endif
*   endif

fa1-99-exit.
    exit.



fb0-process-claim-details.

*       obtain service date from first detail record

    if sum-sv-date(ss-a) = zeros
    then
        move clmdtl-sv-date             to sum-sv-date(ss-a).
*   endif

    if     ( clmdtl-adj-cd = 'A' or 'B' )
*      and ( clmdtl-adjust-reprint not = 'Y' )
       and ( clmdtl-adjust-reprint     = 'N' )
       and ( clmdtl-oma-cd not = 'ZZZZ' )
    then
*       adjustment
        move 'P'                        to sum-reprint(ss-a)
        add clmdtl-fee-oma              to ws-tot-adj
        add 1                           to ws-detail-lines
    else
        if     ( clmdtl-adj-cd = 'C' )
*          and ( clmdtl-adjust-reprint not = 'Y' )
           and ( clmdtl-adjust-reprint     = 'N' )
           and ( clmdtl-oma-cd not = 'ZZZZ' )
        then
*           payment
            move 'P'                    to sum-reprint(ss-a)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  56
*                      u035cnoupd.cbl                                )
            add clmdtl-fee-oma          to ws-tot-pay
            add 1                       to ws-detail-lines
        else
            if clmhdr-reprint-flag = 'Y'
               and claim-has-bal-due
            then
                if clmdtl-oma-cd = 'ZZZZ'
                then
*                   description
                    add .5              to ws-detail-lines
                else
*                   detail
                    add 1               to ws-detail-lines.
*   endif

    perform ya1-read-claim-detail-next  thru ya1-99-exit.

fb0-99-exit.

    exit.

fc0-invoice-housekeeping.

*    age balance due and accumulate

    move clmhdr-date-sys                        to claim-date.

    multiply claim-yy by 365                    giving claim-days.
    add nbr-julian-days-ytd(claim-mm)           to claim-days.
    compute claim-days = claim-days -
                         ( max-nbr-days(claim-mm) - claim-dd ).

    compute claim-days = ( run-days - claim-days ) / 30.

    if claim-days not > 1
    then
        add ws-claim-bal-due                    to ws-cur
    else
        if claim-days not > 2
        then
            add ws-claim-bal-due                to ws-30
        else
            if claim-days not > 3
            then
                add ws-claim-bal-due            to ws-60
            else
                if claim-days not > 4
                then
                    add ws-claim-bal-due        to ws-90
                else
                    add ws-claim-bal-due        to ws-120.
*   endif

    move 'Y'                                    to flag-invoice-to-print.

    if clmhdr-reprint-flag = 'N'
    then
        add ws-claim-bal-due                    to ws-prev-balance
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  57
*                      u035cnoupd.cbl                                )
    else
        add ws-claim-bal-due                    to ws-curr-charges
        move 'Y'                                to sum-reprint(ss-a)
                                                   flag-curr-activity
        if clmhdr-msg-nbr not = zero
        then
            move clmhdr-msg-nbr                 to ws-msg-nbr
            perform xa0-count-msg-lines         thru xa0-99-exit.
*   endif

    add 1                                       to inv-claims.
    add ws-claim-bal-due                        to inv-bal-due.

fc0-90-build-summary.

*       build summary table - increment pointer

    move clmhdr-batch-nbr                       to sum-batch-nbr(ss-a).
    move clmhdr-claim-nbr                       to sum-claim-nbr(ss-a).
    move ws-claim-bal-due                       to sum-bal-due(ss-a).

    if ss-a = 99
    then
        move 'Y'                                to flag-invoice-overflow
    else
        add 1                                   to ss-a.

fc0-99-exit.

    exit.

fe0-claim-header-update.

    if clmhdr-auto-logout = 'Y'
    then
        move sys-date                           to clmhdr-reference.
*   endif

    if clmhdr-reprint-flag = 'Y'
    then
        move 'N'                                to clmhdr-reprint-flag.
*   endif

    if new-claim-payment
    then
        move zero                               to clmhdr-curr-payment.
*   endif

    perform ya2-rewrite-clmhdr                  thru ya2-99-exit.

fe0-99-exit.

    exit.
ga0-get-next-claim.

*       work through shadow master until a subscriber for
*       which an invoice may be printed is found

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  58
*                      u035cnoupd.cbl                                )
    move 'N'                            to flag-claim-to-invoice.

    perform yb0-read-claim-shadow-next  thru yb0-99-exit.

    perform gb0-check-and-read          thru gb0-99-exit
        until eof-clm-shadow-mstr or claim-to-invoice.

ga0-99-exit.

    exit.

gb0-check-and-read.

    if ws-pat-subscr-key  not = save-subscr-id
    then
        perform gc0-patient-processing          thru gc0-99-exit
        if subscr-msg-nbr = not-to-invoice-msg-nbr and
           subscr-date-msg-nbr-eff-to > sys-date
        then
            perform yb0-read-claim-shadow-next  thru yb0-99-exit
        else
            move ws-pat-subscr-key      to save-subscr-id
            move 'Y'                    to flag-claim-to-invoice
*       endif
    else
        move 'Y'                        to flag-claim-to-invoice.
*   endif

gb0-99-exit.

    exit.

gc0-patient-processing.

    if invoice-not-to-print
    then
        go to gc0-99-exit.
*   endif

    if clmhdr-agent-cd = 4 and clmhdr-reprint-flag = 'N'
    then
        move 'N'                        to flag-invoice-to-print
        go to gc0-99-exit.
*   endif

*       only print invoices if there is new detail or the date of last
*       statement is <= the calculated aged date
*       or if there is no claim reference date

    if   curr-activity
      or ws-hold-clmref-date not > age-date
* (y2k)
*     or ws-hold-clmref-date     = 999999
      or ws-hold-clmref-date     = 99999999
    then
        next sentence
    else
        move 'N'                                to flag-invoice-to-print
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  59
*                      u035cnoupd.cbl                                )
        go to gc0-99-exit.
*   endif

    move spaces                                 to ws-msg-dtls.
    if hold-subscr-msg-nbr not = zero
        and hold-subscr-date-msg-nbr-eff > sys-date
    then
        move hold-subscr-msg-nbr                to ws-msg-nbr
        perform xa0-count-msg-lines             thru xa0-99-exit
        move msg-dtl1                           to ws-msg1
        move msg-dtl2                           to ws-msg2
        move msg-dtl3                           to ws-msg3
        move msg-dtl4                           to ws-msg4.
*   endif

    move spaces                                 to p-name.

    string hold-pat-given-name  delimited by spaces,
           ws-space             delimited by size,
           hold-pat-surname     delimited by spaces
           into p-name.

    move hold-subscr-addr1                      to p-addr1.
    move hold-subscr-addr2                      to p-addr2.
    move hold-subscr-addr3                      to p-addr3.
    move hold-country                           to p-country.

    move spaces                                 to p-postal-cd.

    if spaces = hold-subscr-post-cd1 or
                hold-subscr-post-cd3 or
                hold-subscr-post-cd5
    then
        next sentence
    else
        if hold-subscr-postal-cd is numeric
        then
            move hold-subscr-postal-cd          to p-code-usa
        else
            move hold-subscr-post-code1         to p-code1
            move hold-subscr-post-code2         to p-code2.
*   endif

    move hold-pat-ohip-mmyy-r                   to p-dtl-id
                                                   p-sum-id.
* kludge
*** move sys-yy                                 to p-inv-yy.
    move sys-y3                                 to p-inv-yy-1.
    move sys-y4                                 to p-inv-yy-2.

    move mth(sys-mm)                            to p-inv-mmm.
    move sys-dd                                 to p-inv-dd.
* kludge
*** move sys-date                               to p-inv-date.
    move sys-y3 to p-inv-date-y1.
    move sys-y4 to p-inv-date-y2.
    move sys-mm to p-inv-date-mm.
    move sys-dd to p-inv-date-dd.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  60
*                      u035cnoupd.cbl                                )

gc0-99-exit.
    exit.
ya0-read-claim-header.

    move zero                           to feedback-claims-mstr
                                           claims-occur.
    read claims-mstr into claim-header-rec key is key-claims-mstr
        invalid key
        display "claim header" key-claims-mstr
        display "pat id"       key-pat-mstr
        stop " ".

    move feedback-claims-mstr           to hold-feedback-clmhdr.
    move key-claims-mstr                to hold-key-claims-mstr.

ya0-99-exit.

    exit.

ya1-read-claim-detail-next.

    move zero                           to claims-occur
                                           feedback-claims-mstr.

    read claims-mstr next
        into claim-detail-rec
*mf         invalid key
            at end
                move 'Y'                to flag-end-of-claim-details
                go to ya1-99-exit.

*mf    retrieve claims-mstr key
*mf     fix position into key-claims-mstr.

*mf    if key-clm-key-type not = 'B'
    if k-clmdtl-b-key-type not = 'B'
    then
        move 'Y'                        to flag-end-of-claim-details
        go to ya1-99-exit.
*   endif

    if (( clmdtl-batch-nbr      = clmhdr-batch-nbr  and
          clmdtl-claim-nbr      = clmhdr-claim-nbr )
          or
        ( clmdtl-batch-nbr      = clmhdr-orig-batch-nbr  and
          clmdtl-claim-nbr      = clmhdr-orig-claim-nbr ))
          and
        ( clmdtl-oma-cd     not = '0000' )
    then
        next sentence
    else
        move 'Y'                        to flag-end-of-claim-details.
*   endif

ya1-99-exit.

    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  61
*                      u035cnoupd.cbl                                )

ya2-rewrite-clmhdr.

    move hold-feedback-clmhdr           to feedback-claims-mstr.
    move hold-key-claims-mstr           to key-claims-mstr.
    move zero                           to claims-occur.

* brad - update ????
*****     rewrite claims-mstr-rec from claim-header-rec.

ya2-99-exit.

    exit.

ya3-rewrite-clmdtl.

* brad - update ???
***  rewrite claims-mstr-dtl-rec from claim-detail-rec.

ya3-99-exit.

    exit.

yb0-read-claim-shadow-next.

*   move zero                           to claims-mstr-shadow-occur.

    read clm-shdw-work-mstr next
        at end
                move pat-given-name     to hold-pat-given-name
                move pat-surname        to hold-pat-surname
                move 'Y'                to flag-eof-clm-shadow-mstr
                go to yb0-99-exit.

    move  wf-shadow-patient             to key-pat-mstr.
    perform yc0-read-patient            thru yc0-99-exit.

**  move key-pat-mstr                   to ws-pat-subscr-key.
    if  pat-ohip-mmyy-r is not = spaces
    then
        move pat-ohip-mmyy-r            to ws-pat-subscr-key
    else
        move pat-chart-nbr              to ws-pat-subscr-key.
*   endif

yb0-99-exit.

    exit.

yc0-read-patient.

    move pat-given-name                 to hold-pat-given-name.
    move pat-surname                    to hold-pat-surname.
    move pat-ohip-mmyy-r                to hold-pat-ohip-mmyy-r.
    move subscr-msg-nbr                 to hold-subscr-msg-nbr.
    move subscr-date-msg-nbr-eff-to     to hold-subscr-date-msg-nbr-eff.
    move subscr-addr1                   to hold-subscr-addr1.
    move subscr-addr2                   to hold-subscr-addr2.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  62
*                      u035cnoupd.cbl                                )
    move subscr-addr3                   to hold-subscr-addr3.
    move subscr-postal-cd               to hold-subscr-postal-cd.
    move pat-country                    to hold-country.

    read pat-mstr
        invalid key
            move spaces                         to pat-given-name
                                                   pat-surname.

yc0-99-exit.

    exit.


ye0-read-doc-mstr.

    read doc-mstr
        invalid key
            move spaces                 to doc-name
*!          move zeros                  to doc-nbr.
            move spaces                 to doc-nbr.

ye0-99-exit.

    exit.

yf0-read-oma-fee-mstr.

    read oma-fee-mstr
        invalid key
            move 'N'                    to flag-oma-rec
            go to yf0-99-exit.

    move 'Y'                            to flag-oma-rec.

yf0-99-exit.

    exit.

yg0-read-msg-sub-mstr.

    read msg-sub-mstr
        invalid key
            move spaces                         to msg-dtl1
                                                   msg-dtl2
                                                   msg-dtl3
                                                   msg-dtl4.

yg0-99-exit.

    exit.

*yh0-read-const-mstr.

*    read iconst-mstr.

*yh0-99-exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  63
*                      u035cnoupd.cbl                                )
*   exit.

xa0-count-msg-lines.

    move msg-indexer                            to msg-sub-key-1.
    move ws-msg-nbr                             to msg-sub-key-23.

    perform yg0-read-msg-sub-mstr               thru yg0-99-exit.

    if msg-dtl4 not = spaces
    then
        move 4                                  to ws-msg-lines
    else
        if msg-dtl3 not = spaces
        then
            move 3                              to ws-msg-lines
        else
            if msg-dtl2 not = spaces
            then
                move 2                          to ws-msg-lines
            else
                if msg-dtl1 not = spaces
                then
                    move 1                      to ws-msg-lines
                else
                    move zero                   to ws-msg-lines.
*   endif

*       count extra lines for skip if not room on current page for msg

    divide ws-detail-lines by ws-lines-per-page
        giving ws-quotient remainder ws-remainder.

    subtract ws-remainder from ws-lines-per-page
        giving ws-lines-left.

    if ws-lines-left < ws-msg-lines
    then
        add ws-lines-left to ws-detail-lines.
*   endif

    add ws-msg-lines to ws-detail-lines.

xa0-99-exit.

    exit.

xb0-print-controls.

    if bc-bal-due(ss-break-type)  = zero and
       bc-claims(ss-break-type)   = zero and
       bc-invoices(ss-break-type) = zero
    then
        go to xb0-99-exit.
*   endif

    move spaces                         to p-cntrl-id.
    move ws-cntrl-hdr-lit               to p-cntrl-lit
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  64
*                      u035cnoupd.cbl                                )

    write prt-line      from prt-blanks         after page.
    write prt-line      from prt-cntrl-hdr      after 17.

    if ss-break-type = ss-grand
    then
        move ws-cntrl-grand-lit         to p-cntrl-lit
        move spaces                     to p-cntrl-id
        write prt-line  from prt-cntrl-hdr      after 3
    else
        move ws-cntrl-agent-lit         to p-cntrl-lit
        move save-shadow-agent          to p-cntrl-id
        write prt-line  from prt-cntrl-hdr      after 3
        if ss-break-type = ss-clinic
        then
            move ws-cntrl-clinic-lit    to p-cntrl-lit
            move save-shadow-clinic     to p-cntrl-id
            write prt-line      from prt-cntrl-hdr      after 3
        else
            if ss-break-type = ss-subdiv
            then
                move ws-cntrl-clinic-lit        to p-cntrl-lit
                move save-shadow-clinic to p-cntrl-id
                write prt-line  from prt-cntrl-hdr      after 3
                move ws-cntrl-subdiv-lit        to p-cntrl-lit
                move save-shadow-subdivision    to p-cntrl-id
                write prt-line  from prt-cntrl-hdr.
*   endif

    write prt-line      from prt-cntrl-col      after 2.

    move bc-bal-due(ss-break-type)      to p-bal-due.
    move bc-claims(ss-break-type)       to p-nbr-claims.
    move bc-invoices(ss-break-type)     to p-nbr-invoices.

    write prt-line      from prt-cntrl-dtl      after 2.

xb0-99-exit.

    exit.

xc0-bump-and-zero.


    add bc-bal-due(ss-break-type)       to bc-bal-due(ss-to).
    add bc-invoices(ss-break-type)      to bc-invoices(ss-to).
    add bc-claims(ss-break-type)        to bc-claims(ss-to).

    move zero                           to bc-bal-due(ss-break-type)
                                           bc-invoices(ss-break-type)
                                           bc-claims(ss-break-type).

xc0-99-exit.

    exit.
za0-common-error.

    move err-msg(err-ind)                       to err-msg-comment.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:42 Page  65
*                      u035cnoupd.cbl                                )
    stop " ".

za0-99-exit.

    exit.



    copy "y2k_default_sysdate_century.rtn".
y2k-default-sysdate.

    move sys-date-left                  to sys-date-temp.
    move sys-date-temp                  to sys-date-right.
    move zeros                          to sys-date-blank.
* 1999/dec/30 B.E.
*   add 19000000                        to sys-date-numeric.
    add 20000000                        to sys-date-numeric.

y2k-default-sysdate-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 Compiler
* Copyright (C) 1984-1995 Micro Focus Ltd.     URN 2XUPG/GB0/00000F
*                                              REF GNB-030056000AA
*
* Total Messages:     0
* Data:       11972     Code:       10027
