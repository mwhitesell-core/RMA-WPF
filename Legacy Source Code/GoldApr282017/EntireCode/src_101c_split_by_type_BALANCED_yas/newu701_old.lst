* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   1
*                      newu701.cbl
* Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Accepted - SHOW-DIR
* Accepted - SOURCEFORMAT"FREE"
* Accepted - SPZERO
* Accepted - TIME
* Accepted - TRUNC
* Accepted - RESEQ
* Accepted - SEQCHK
* End Of Directives File: /usr/opt/mfcobol4.0/cobol.dir
identification division.
program-id.    newu701.
author.        dyad technologies.
installation.  rma.
date-written.  90/06/15.
date-compiled. 23-Jun-05 15:26.
security.
*
*
*  REMARKS:   - OHIP DISKETTE UPLOAD INTO SUSPENSE FILES
*             - CREATE SUSPENSE HEADER, DETAIL, AND ADDRESS RECORDS
*               FROM THE DISKETTES. VALIDATE EACH FIELD.
*
*
*  REV 91/04/23 (M.C.)  - SMS  138
*                       - SET 'CLMHDR-PAT-KEY-DATA' TO HEALTH-NBR IF
*                         PRESENT;OTHERWISE, USE OHIP NBR.
*
*  REV 91/09/11 (B.M.L.) - CHANGED PROGRAM TO IGNORE BLANK OR ZERO OHIP
*                          EDIT CHECKS NOW WORK ON HEALTH INSTEAD.
*
*  REV 91/09/18 (M.C.)  - INVALID DIGIT ON BATCH-SPECIALITY BECAUSE
*                         MOVE '???' TO NUMERIC FIELD, CORRECTION MADE
*                         ON PAGE 26 (FB0-BUILD-SUSP-HDR-REC)
*
*  REV 92/09/25 (M.C.)  - PDR 558
*                       - SELECT ONLY THE ACTIVE DOCTOR, AND IF THE
*                         DOCTOR HAS MORE THAN 1 ACTIVE NUMBER, USER
*                         SHOULD ENTER THE NUMBER THEY WANT
*
*  REV 93/06/16 (A.G.K.) - MODIFY THE INPUT FILE DEFINITION FOR THE NEW
*                          OHIP LAYOUT
*
*  REV 93/07/13 (M.C.)  - SMS 142
*                       - MODIFY THE INPUT FILE TO THE SAME AS CURRENT
*                         OHIP LAYOUT (79 CHARS)
*                       - MODIFY THE NECESSARY CHANGES TO THE FILES
*                       - EXTEND 12 CHARS IN F002-SUSPEND-ADDRESS FILE
*
*  REV 93/11/16 (M.C.)  - PDR 591
*                       - MODIFY THE VALIDATION ON REFERRING DOC NBR
*
*  REV 96/07/30 (M.C.)  - PDR 649
*                       - INCLUDE 'I' AND 'O' AS PART OF HDR-I-O-IND
*                         WHEN EDITING
*###  CHECK OUT SETTING OF DETAIL-WRITTEN
*###  CHECK THAT FEE- VARIABLES ARE IN THE HOLD AREA
*  REV 97/09/10 (B.E.)  - EDIT SERVICE DATE NOT LESS THAN ADMIT DATE
*                         ENSURE THAT IF 'OP'/'MR' (OVERRIDE PRICE) IS SPECIFIED
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   2
*                      newu701.cbl
*                        OR INCOMING FEES ARE ALREADY PRICED THEN SKIP
*                        RMA PRICING (INCLUDING ADD ONS)
*  REV 97/10/01 (B.E.)  - ADD ABILITY TO PROCESS MULTIPLE CLINICS WITHIN
*                         A SINGLE BATCH.
*  REV 97/11/01 (B.E.)  - ADD USER SELECTION PARAMETER TO ALLOW
*                         DEFAULTING OF CLINIC NBR IF NOT SPECIFIED
*                         WITHIN THE BATCH
*
*  REV 97/11/11 (B.E.)  - CLINIC DEFAULT WAS 2215 WHICH THEN OVERRODE
*                         WHAT WAS IN BATCH. CHANGE LOGIC TO USE USER
*                         SELECTION CLINIC NBR ONLY IF INCOMING BATCH'S
*                         CLINIC NBR IS ZERO OR BLANK.
*  REV 97/11/14 (B.E.)  - PROGRAM LOGIC TAKEN FROM D001 ALLOWED ONLY 8
*                         DETAIL RECORDS. 'OCCURS' CHANGED FROM 8 TO 40.
*                         TO ALLOW WEB INPUT OF UP TO 40 LINES
*                         (ARBRITRARY DECISION TO THIS NUMBER)
*       97/12/10 (B.E.) - BUG FIXED. LENGTH OF HOLD-OMA-REC CHANGED AND
*                         ASSOCIATED SORT-REC NOT INCREASED TO LARGE
*                         ENOUGH VALUE - CHANGED TO LENGTH OF 250.
*
*       98/03/18 (B.E.) - ADDED DEFAULTING OF BATCH LOCATION AND I/O INDIATOR
*                         SO THAT RMA OPERATORS CAN INPUT THESE FILES
*                         INTO THE 'HEB' RECORD IF PROCESSING A NON-
*                         RMA-ALTERED SUBMISSION DISKETTE.

*       98/03/31 (M.C.) - SOME DOCTOR DISKETTES DO NOT HAVE 'HER' RECORD
*                         (HEADER 2), IF OPERATOR WANTS TO DEFAULT TO
*                         AGENT 0 AND TAPE-SUBMIT-IND = 'Y', SET IN
*                         HEADER 1 SUBROUTINE.  FOR OTHER DISKETTES
*                         THAT HAVE HEADER 2 RECORD, SET AGENT AND
*                         TAPE-SUBMIT-IND FROM HEADER 2 RECORD.
*
*       98/04/06 (M.C.) - MOVE SPACES TO HEADER-REC IN FB0 SUBROUTINE
*                       - FIX MINOR PROBLEM (2 DIGITS TO CLINIC NBR)
*                       - CHANGE PGM NAME U701 TO NEWU701 IN SCREEN
*                         SECTION
*       1999/mar/2 B.E. - added logic at 2nd test section of code to only requir
*                         diagnosic code if oma-suffix is "A" or "M"
*     1999/May/06 S.B.  - Marked by 'S.B.' (brought from 102)
*                       - Put in check against the Referring physician
*                       being the same sas the Billing doctor.
*                       - Put in check for missing Referring physician.
*                       - Added a check to insure that Service dates are
*                       after Run dates.
*                       - Added a check to make sure that the correct
*                       specialty for the doctor is used.
*                       - Added a check to make sure that each claim
*                       has a detail record.
*                       - Changed the err-msg to occur 50 times to
*                       reflect the new error messages possible.
*                       - Changed the claim value being put out on
*                       error 50 from unpriced-clmhdr-claim to
*                       clmhdr-accounting-nbr to show the correct
*                       claim for the error.
*                       - Added a reset for the ctr-hdr2-rec and
*                       ctr-addr-rec counters to prevent a missing
*                       detail error from appearing on the first
*                       batch record after a previous batch that
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   3
*                      newu701.cbl
*                       had any detail records in it.
* 2000/feb/08 B.A. - added 'confidentiality flag' field to tape in file in
*                    anticipation of this value being passed from Web site
*                  - code to process this field to be added later
* 2000/feb/29 B.A. - added logic to only allow a 'Y' or ' ' in the confid
*                    flag field
* 2000/mar/02 B.E. - pricing algorithm (ye0) used hard coded '7' for original
*                    restriction of 8 detail lines.  Changed code to have
*                    maximun allowed detail lines (40) set into variable
*                    "ss-max-nbr-oma-det-rec-allow" and use this
*                    variable in pricing algorthim.
* 2000/mar/13 B.E. - if incoming patient's phone number is only 7 digits long
*                    then default the area code stored in copy book code.
*
* 2000/mar/20 M.C. - open f030-location-mstr, retrieve hospital nbr and i/o ind
*                    from locations mstr by loc-code.
*                    If the original doctor ohip nbr is the same as referring
*                    doctor ohip nbr, print error.
*                    If diskette price is different than the way rma prices,
*                    print error
* 2000/mar/29 M.C. - If the incoming I/O ind is different than RMA i/o ind,
*                    print error
* 2000/apr/05 M.C. - If the input file comes with amount and the oma code
*                    suffix is either 'B' or 'C' (ie anesthesia), do not change
*                    nbr of svc (ie basic + time), but do for web
* 2000/apr/10 M.C. - Change the pricing algorithm correctly for add on codes
*                    (ie suffix = 'B' or 'C')
*                    suffix is either 'B' or 'C' (ie anesthesia), do not change
* 2000/apr/14 M.C. - Yas requested this verion not to check price difference
* 2000/apr/28 B.A. - Added additional checks for confidential flag at dtl level
* 2000/jun/05 B.E. - correct pricing of tech portion of fee
* 2000/jun/30 B.E. - keep BI and OP flags by moving them into consecutives
*                    services area
* 2000/jul/31 B.E. - when determining current vs previous rates use the
*                    effective date in the oma code's f040 record rather
*                    than effective date in constants master
* 2000/aug/03 B.E. - pricing modified to take into consideration that
*                    oma fees now 9(4).999 rather than 9(5).99
* 00/sep/08 B.E. - modified to keep original sequence details when writing
*                  claim details to suspend dtl file
* 00/sep/10 B.E. - rtn yz0-reset-verify-prices that resets prices to incoming
*                  values moved from this pgm into ya0- copybook so that
*                  that calcuation of 'tech' amounts can be made on
*                  new priced amounts or the incoming amounts depending
*                  upon whether they are reset or not
*                - set clmhdr-nbr-suspend-desc-recs to zero
* 00/sep/14 B.E. - comment out error message is hospital number is missing.
*                  Since the location code is now used to derive the hospital
*                  number it is no longer a problem of the incoming
*                  hospital number is missing/wrong
* 00/oct/02 B.E. - ctr-tot-dollars-claim was used to sum OHIP detail amts
*                  and update header's oma/ohip $ amounts. Pgm changed to
*                  reprice diskette uploads and save 'rma' prices in oma
*                  amt and diskette's original price in ohip amt. Therefore
*                  setup 2 separate ctr-tot.. fields to keep oma / ohip
*                  running claim totals to update header
*                - renamed 'override' flag as 'retain incoming' price
*                  flag to make it easier to distinguish between OP override
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   4
*                      newu701.cbl
*                  price logic
* 00/oct/26 B.E. - allow operator to override the current system date. This
*                  options is only used in test when running the "master
*                  test claims batch" which are "old" dates that will
*                  be greater than 6 months from the real system date
*                  and will thus give errors (state dates). We want the
*                  'master test claims" to price the same time after time
*                  so allow operator to set system back (this date is
*                  usually set based upon the current pricing old/new
*                  date of 2000/04/01)
*                - if any dates wrong move 8 "?" rather than 6 to date field
*
* 00/nov/27 M.C. - for clinic 61-65 only, if referring doc nbr is same as orig
*                  doc nbr, do not print error 47; if referring doc nbr is blank
*                  set the same as orig doc nbr.  Yas requested the changes.
* 01/feb/06 B.E. - change to pricing routine to price loc G420 / oma code
*                  G259 at 85%
* 01/feb/07 M.C. - save RMB ohip nbr if exists
* 01/feb/12 M.C. - when edit RMB registration nbr, the size has changed;
*                  please refer to MOH technical specification book.
* 01/feb/28 M.C. - if agent cd = 6 or 9, set clmhdr-status and clmdtl-status
*                  equal to 'I'gnore
* 01/mar/08 M.C. - if service date is greater than the admit date, instead of
*                  putting ????/??/?? in the service date field, put ????/??/??
*                  in the admit date
* 01/mar/27 B.E. - tech/prof rules of DU/PF icc codes changed to
*                  substitute "B" or "C" suffix for "A" if tech/prof
*                  only pricing, or to split into two separate lines
*                  if tech and prof fees involved.
* 01/apr/23 B.E. - 'fee' amount for PERCENTAGE addon's now divided by 100 as
*                  read in from f040 into hold variables that allow a
*                  4 decimal percentage
* 01/sep/28 B.E. - added create-error-file (an 88 flag) that controls the output
*                  of files and the errors that are generated. If the program
*                  is run 'print only' then the defaults are set to NOT upload
*                  the claims into the SUSPENSE files but to write them to
*                  the output 'priced' file. Also ALL errors are surpressed
*                  so that although the edits are performed the error message
*                  is bypassed and the claim is priced regardless. Subsequent
*                  changes should allow the program to be called and ONLY edit
*                  applied. The output file would then be a collection of
*                  errors.
* 01/oct/03 B.E. - added clinic-nbr to diskout (priced) file
* 02/mar/25 B.E. - added PAYROLL-FLAG to HEB record (unpriced-bathdr-rec)
* 02/apr/23 M.C. - move  PAYROLL-FLAG to clmhdr-hosp, according to Brad, they
*                  are no longer used the hospital code
* 02/may/03 M.C. - temporary edit check against staled svc date (< 20010901)
*                - Yas want to set payroll-flag to 'B' if incoming clinic from H
*                  otherwise set to 'A'
* 02/may/27 M.C. - reinstate the staled svc date check
* 02/jun/12 M.C. - if billing special premiums K994 to K997 and facility number
*                  error needs facility number
* 02/aug/12 M.C. - if billing special premiums K990 to K997 and facility number
*                  error needs facility number
* 02/aug/21 M.C. - if clinic = 80 or 95, bypass the edit check against svc date
* 03/jun/11 M.C. - if billing special premiums K990 to K997 and location code do
*                  error wrong location needs to end with 112
* 03/oct/22 M.C. - error if clinic nbr is not valid for the doctor
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   5
*                      newu701.cbl
* 03/dec/08 M.C. - alpha doc nbr
* 04/jan/20 M.C. - add location code 153 or 400 or 250 or 422 when checking OMA
*                  with location code 112
* 04/apr/07 M.C. - error if admit date is prior to birth date
* 04/sep/27 M.C. - add location code 401 when checking OMA cd K990 to K997
*                  with location code 112
* 05/mar/03 M.C. - error if doctor specialty = 07 and patient age < 60
*                  or doctor specialty = 07 and oma codes = A775 or W775 or C775
*                  and patient age < 75
* 05/may/04 M.C. - edit check to make sure birth date < service date
*                - if clinic 61 to 65, must be certain location code; otherwise
* 05/may/09 M.C. - If location = G420 and oma code = G259 and R761, add manual r
*                  "REFER TO ADJUDICATION" on description record
*                  add open/close of f002-suspend-desc file
* 05/jun/23 M.C. - manitoba should have 9 digits instead of 6
*                  change province from NF to NL

environment division.
input-output section.
file-control.

copy "f002_suspend_hdr.slr".
* file: "f002_suspend_hdr.slr".

select suspend-hdr
    assign to disk   "f002_suspend_hdr"
    organization is indexed
    access mode  is dynamic
        lock mode is manual
*
    status       is status-cobol-suspend-hdr
    record key   is suspend-hdr-id.



copy "f002_suspend_dtl.slr".
* file "f002_suspend_dtl.slr".

select suspend-dtl
    assign to disk "f002_suspend_dtl"
    organization is indexed
    access mode  is dynamic
        lock mode is manual
*
    status       is status-cobol-suspend-dtl
    record key   is suspend-dtl-id of suspend-dtl with duplicates.


copy "f002_suspend_address.slr".
* file: f002_suspend_address.slr

select suspend-address
    assign to disk "f002_suspend_address"
    organization is indexed
    access mode  is dynamic
        lock mode is manual
*
    status       is status-cobol-suspend-addr
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   6
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
    record key   is suspend-addr-id.

* 2005/05/09 - add description file
*copy "f002_suspend_desc.slr".
* 2005/05/09 - end


*COPY "F020_DOCTOR_MSTR_OHIP.SLR".
copy "f020_doctor_mstr.slr".
    select doc-mstr
*mf     assign index to "f020_doctor_mstr"
*mf     assign data  to "f020_doctor_mstr"
        assign to disk "$pb_data/f020_doctor_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual

        record key   is doc-nbr of doc-mstr-rec

*mf added two  alternative keys below
        alternate key is doc-name-soundex
         with duplicates
        alternate key is doc-ohip-nbr of doc-mstr
         with duplicates
              status  is status-cobol-doc-mstr.
*       infos status  is status-doc-mstr.
*       eof-flag     is eof-doc-mstr
*

*2000/03/20 - MC - include locations mstr
copy "f030_locations_mstr.slr".
    select loc-mstr
*       assign index to "f030_locations_mstr"
*               contiguous
*       assign data  to "f030_locations_mstr"
        assign  to disk "$pb_data/f030_locations_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual
        record key   is loc-nbr
*       infos status is status-loc-mstr.
        status is status-cobol-loc-mstr.

copy "f040_oma_fee_mstr.slr".
    select oma-fee-mstr
*mf     assign index to "f040_oma_fee_mstr"
*mf     assign data  to "f040_oma_fee_mstr"
        assign to disk "$pb_data/f040_oma_fee_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual
        record key   is fee-oma-cd
*mf     infos status is status-oma-mstr.
*       eof-flag     is eof-oma-mstr
        status is status-cobol-oma-mstr.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   7
*                      newu701.cbl                                   )

copy "f090_constants_mstr.slr".
select iconst-mstr
assign to disk "$pb_data/f090_constants_mstr"
organization is indexed
access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
lock mode is manual
record key   is iconst-clinic-nbr-1-2
*       eof-flag     is eof-iconst-mstr
status is status-cobol-iconst-mstr.

copy "f091_diagnostic_codes.slr".
    select diag-mstr
*mf     assign index to "f091_diag_codes_mstr"
*mf     assign data  to "f091_diag_codes_mstr"
        assign to disk "$pb_data/f091_diag_codes_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual

        record key   is diag-cd
              status is status-cobol-diag-mstr.
*mf     infos status is status-diag-mstr.
*       eof-flag     is eof-diag-mstr
*


select unpriced-claims-file
    assign to       "submit_disk_susp.in"
    organization is sequential
    access mode  is sequential
    status       is status-cobol-unpriced-claims.

select priced-claims-file
    assign to       "submit_disk_susp.out"
    organization is sequential
    access mode  is sequential
    status       is status-cobol-priced-claims.

*2002/04/22 - MC - comment out
*select error-claims-file
*    assign to       "submit_disk_susp.err"
*    organization is sequential
*    access mode  is sequential
*    status       is status-cobol-error-claims.
*2002/04/22 - end


select report-file
    assign to        printer audit-file
    Status       is  status-report.


data division.
file section.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   8
*                      newu701.cbl                                   )
*COPY "F002_SUBMIT_DISKETTE_COMMON.FD".

* MODIFICATION HISTORY
*  97/JUN/21 B.E.       -ADDED OP_OVERRIDE_PRICE_IND
*                        AND   BI_BILATERAL_IND
*  97/SEP/25 B.E.       -ADDED CLINIC-NBR-1-2
*  98/MAR/18 B.E.       -ADDED TAPEOUT-DEFAULT-BATCH-LOCATION. IF PROCESSING
*                        AN 'UNALTERED' OHIP SUBMISSION DISKETTE
*                        THEN NO RMA LOCATION HAS BEEN INCLUDED
*                        ON EACH DETAIL RECORD. ALLOW RMA OPERATOR
*                        TO EDIT DISKETTE FILE AND MANUALLY ADD
*                        LOCATION TO 'HEB' BATCH HEADER RECORD.
*2002/mar/25 B.E.       - added PAYROLL-FLAG to HEB record (unpriced-bathdr-rec)
*
fd  unpriced-claims-file
*mf    recording mode is data-sensitive
    data records are unpriced-claims-record.

01  unpriced-claims-record.
    05  unpriced-trans-id                        pic xx.
    05  unpriced-input-rec-type                  pic x.
    05  unpriced-bathdr-rec.
* (y2k additional field)
        10  unpriced-release-id                  pic x(3).

        10  unpriced-moh-code                    pic x.
        10  unpriced-bathdr-batch-nbr.
* (y2k)
*           15  unpriced-bathdr-batch-nbr-date   pic 9(6).
            15  unpriced-bathdr-batch-nbr-date   pic 9(8).
            15  unpriced-bathdr-batch-nbr-seq    pic 9(4).
        10  unpriced-bathdr-opr-nbr              pic x(6).
        10  unpriced-bathdr-fac-no               pic x(4).
        10  unpriced-bathdr-prov-ohip-no         pic 9(6).
        10  unpriced-bathdr-spec-cd              pic 9(2).
*       10  FILLER                              PIC X(40).
* (y2k)
*       10  filler                              pic x(35).
*       10  filler                              pic x(30).
*       (2002/mar/25 added payroll flag - "A" regular 22 payroll
*                                       - "B" ICU payroll)
        10  filler                              pic x(29).
        10  unpriced-payroll-flag               pic x(1).
        10  unpriced-default-batch-i-o-ind      pic x(1).
        10  unpriced-default-batch-loc          pic x(4).
        10  unpriced-bathdr-clinic-1-2          pic 99.
        10  unpriced-bathdr-dept                pic 99.
*!        10  unpriced-bathdr-doc-nbr             pic 9(3).
        10  unpriced-bathdr-doc-nbr             pic x(3).

    05  unpriced-clmhdr1-rec redefines unpriced-bathdr-rec.

        10  unpriced-clmhdr-health-nbr           pic x(10).
        10  unpriced-clmhdr-version-cd           pic x(2).
        10  unpriced-clmhdr-birth-date.
* (y2k)
*           15  unpriced-clmhdr-birth-date-yy    pic 99.
            15  unpriced-clmhdr-birth-date-yy    pic 9(4).
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page   9
*                      newu701.cbl                                   )
            15  unpriced-clmhdr-birth-date-mm    pic 99.
            15  unpriced-clmhdr-birth-date-dd    pic 99.
        10  unpriced-clmhdr-claim.
*!            15  unpriced-clmhdr-doc-nbr          pic 9(3).
            15  unpriced-clmhdr-doc-nbr          pic x(3).
            15  unpriced-clmhdr-wk               pic xx.
            15  unpriced-clmhdr-day              pic x.
            15  unpriced-clmhdr-claim-nbr        pic xx.
        10  unpriced-clmhdr-pay-pgm              pic x(3).
        10  unpriced-clmhdr-payee                pic x.
        10  unpriced-clmhdr-ref-doc-nbr          pic 9(6).
        10  unpriced-clmhdr-hosp-nbr             pic x(4).
        10  unpriced-clmhdr-admit-date.
* (y2k)
*           15  unpriced-clmhdr-admit-date-yy    pic xx.
            15  unpriced-clmhdr-admit-date-yy    pic x(4).
            15  unpriced-clmhdr-admit-date-mm    pic xx.
            15  unpriced-clmhdr-admit-date-dd    pic xx.
        10  unpriced-clmhdr-ref-lab-no           pic 9(4).
        10  unpriced-clmhdr-man-review           pic x.
* (y2k additional field)
        10  unpriced-moh-location-code          pic 9(4).
        10  unpriced-reserved-for-ooc           pic x(11).
*       10  filler                              pic x(25).
        10  filler                              pic x(06).

*       (FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT
*        HAD 81 BYTES IN IT)
*mf        10  filler                              pic x(40).

    05  unpriced-clmhdr2-rec redefines unpriced-bathdr-rec.

        10  unpriced-clmhdr-pat-ohip-nbr         pic x(12).
        10  unpriced-clmhdr-pat-surname          pic x(9).
        10  unpriced-clmhdr-given-name           pic x(5).
        10  unpriced-clmhdr-sex                  pic 9.
        10  unpriced-clmhdr-prov-cd              pic x(2).

* *1999/dec/30 B.E. added new field in anticipation of this value
*                   being passed from Web site)
*       10  filler                              pic x(31).
        10  filler                              pic x(30).
        10  unpriced-confidentiality-flag        pic x(1).

        10  unpriced-clmhdr-loc-code             pic x(4).
        10  unpriced-clmhdr-agent-cd             pic x.
        10  unpriced-clmhdr-i-o-ind              pic x.

* (2000/mar/15 B.E. - added redefine of phone nbr field)
        10  unpriced-clmhdr-phone-no.
            15 unpriced-clmhdr-phone-no-1-7     pic x(07).
            15 unpriced-clmhdr-phone-no-8-10    pic x(03).
        10  unpriced-clmhdr-phone-no-r redefines unpriced-clmhdr-phone-no.
            15 unpriced-clmhdr-phone-no-1-3     pic x(03).
            15 unpriced-clmhdr-phone-no-4-10    pic x(07).


*       (FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  10
*                      newu701.cbl                                   )
*        HAD 81 BYTES IN IT)
*mf        10  filler                              pic x(40).


    05  unpriced-item-rec redefines unpriced-bathdr-rec.

        10  unpriced-itm1-oma-svc-cd.
            15  unpriced-itm1-oma-svc-code       pic x(4).
            15  unpriced-itm1-oma-svc-suff       pic x.
        10  filler                              pic x(2).
        10  unpriced-itm1-oma-amt-billed         pic 9(4)v99.
        10  unpriced-itm1-nbr-serv               pic 99.
        10  unpriced-itm1-svc-date.
* (y2k)
*           15  unpriced-itm1-svc-date-yy        pic 99.
            15  unpriced-itm1-svc-date-yy        pic 9(4).
            15  unpriced-itm1-svc-date-mm        pic 99.
            15  unpriced-itm1-svc-date-dd        pic 99.
        10  unpriced-itm1-diag-cd                pic x(3).
        10  filler-diag                         pic x(1).
*++ W A R N I N G +++++++ W A R N I N G ++++++++ W A R N I N G +++++
* (y2k)
*
*    (this following reserved field should be 10 digits but
*     we have used 2 bytes for price override and bilateral so the
*     space is not there to reserve the full 10 bytes. Thus the 9
*     byte filler is used which may lead to future problems. If this
*     occ field is eventually used, then the record length will have
*     to be increased and two separate definitions/pgms will
*     be needed to process 'normal' format diskettes vs the 'rma web' diskette
*       10  unpriced-reserved-for-ooc           pic x(10).
        10  unpriced-reserved-for-ooc           pic x(09).
*++ W A R N I N G +++++++ W A R N I N G ++++++++ W A R N I N G +++++
*       10  FILLER                              PIC X(13).
*       10  filler                              pic x(11).
        10  unpriced-itm1-override-price         pic x(1).
        10  unpriced-itm1-bilateral              pic x(1).

        10  unpriced-itm2-oma-svc-cd.
            15  unpriced-itm2-oma-svc-code       pic x(4).
            15  unpriced-itm2-oma-svc-suff       pic x.
        10  filler                              pic x(2).
        10  unpriced-itm2-oma-amt-billed         pic 9(4)v99.
        10  unpriced-itm2-nbr-serv               pic 99.
        10  unpriced-itm2-svc-date.
* (y2k)
*           15  unpriced-itm2-svc-date-yy        pic 99.
            15  unpriced-itm2-svc-date-yy        pic 9(4).
            15  unpriced-itm2-svc-date-mm        pic 99.
            15  unpriced-itm2-svc-date-dd        pic 99.
        10  unpriced-itm2-diag-cd                pic x(4).
*++ W A R N I N G +++++++ W A R N I N G ++++++++ W A R N I N G +++++
*
*    (this following reserved field should be 10 digits but
*     we have used 2 bytes for price override and bilateral so the
*     space is not there to reserve the full 10 bytes. Thus the 9
*     byte filler is used which may lead to future problems. If this
*     occ field is eventually used, then the record length will have
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  11
*                      newu701.cbl                                   )
*     to be increased and two separate definitions/pgms will
*     be needed to process 'normal' format diskettes vs the 'rma web' diskette
*       10  unpriced-reserved-for-ooc           pic x(10).
        10  unpriced-reserved-for-ooc           pic x(09).
*++ W A R N I N G +++++++ W A R N I N G ++++++++ W A R N I N G +++++
*       10  FILLER                              PIC X(13).
*       10  filler                              pic x(11).
        10  unpriced-itm2-override-price         pic x(1).
        10  unpriced-itm2-bilateral              pic x(1).
*       (FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT
*        HAD 81 BYTES IN IT)
*mf        10  filler                              pic x(40).

    05  unpriced-pat-addr-rec redefines unpriced-bathdr-rec.

        10  unpriced-pat-addr-1                  pic x(25).
        10  unpriced-pat-addr-2                  pic x(25).
        10  unpriced-pat-addr-3                  pic x(18).
        10  unpriced-pat-addr-post-cd.
            15  unpriced-pat-addr-post-cd1       pic x.
            15  unpriced-pat-addr-post-cd2       pic 9.
            15  unpriced-pat-addr-post-cd3       pic x.
            15  unpriced-pat-addr-post-cd4       pic 9.
            15  unpriced-pat-addr-post-cd5       pic x.
            15  unpriced-pat-addr-post-cd6       pic 9.
        10  filler                              pic x(2).
*       (FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT
*        HAD 81 BYTES IN IT)
*mf        10  filler                              pic x(40).

    05  unpriced-trailer-rec redefines unpriced-bathdr-rec.

        10  unpriced-trailer-clmhdr1-cnt         pic 9(4).
        10  unpriced-trailer-clmhdr2-cnt         pic 9(4).
        10  unpriced-trailer-itm-cnt             pic 9(5).
        10  unpriced-trailer-pat-addr-cnt        pic 9(4).
        10  filler                              pic x(59).
*       (FILLER ADDED TO ACCOMODATE A 'BAD' INPUT FILE THAT
*        HAD 81 BYTES IN IT)
*mf        10  filler                              pic x(40).

    05  unpriced-cr                              pic x.
fd  priced-claims-file
*   RECORDING MODE IS DATA-SENSITIVE
*     (2001/oct/03 B.E. added new clinic-nbr field)
**    record contains 59  characters
    record contains 61  characters
    data records are diskout-output-rec.

01  diskout-output-rec.
*           (2001/oct/03 B.E. added new clinic-nbr field)
        10  diskout-clmhdr-clinic-nbr           pic x(2).

        10  diskout-clmhdr-claim                pic x(8).
        10  diskout-oma-svc-cd.
            15  diskout-oma-svc-code            pic x(4).
            15  diskout-oma-svc-suff            pic x.
        10  diskout-ohip-amt-billed             pic 9(4)v99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  12
*                      newu701.cbl                                   )

        10  diskout-svc-date.
* (y2k)
*           15  diskout-svc-date-yy             pic 99.
            15  diskout-svc-date-yy             pic 9(4).
            15  diskout-svc-date-mm             pic 99.
            15  diskout-svc-date-dd             pic 99.
        10  diskout-nbr-serv                    pic 99.
        10  diskout-oma-amt-billed              pic 9(4)v99.
        10  diskout-priced-tech                 pic 9(4)v99.
        10  diskout-basic-tech                  pic 9(4)v99.
        10  diskout-basic-prof                  pic 9(4)v99.
        10  diskout-basic-fee                   pic 9(4)v99.
        10  diskout-cr                          pic x.
        10  diskout-lf                          pic x.
copy "f002_suspend_hdr.fd".
* file: f002_suspend_hdr.fd

*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
*  yy/mm/dd  whom  why
*  --------  ----  ---
*
*  90/sep/27 B.E.  - added redefine for clmhdr-claim-source-cd
*  98/dec/01 D.B.  - y2k
*  99/jan/15 B.E.  - correct record length, alignment cosmetics
*  99/jan/25 B.E.  - add 2bytes to reference field to allow 4 digit year
*  00/jan/06 B.A.  - add 1 byte confidential claim flag
*  00/sep/14 B.E.  - add clmhdr-nbr-suspend-desc-recs that counts the
*                    number of description records associated with hdr
*  00/sep/21 B.E.  - add clmhdr-adj-cd-sub-type to indicate "W"eb or
*                    "D"iskette source of claim
*  02/oct/24 M.C.  - there are two "clmhdr-adj-cd-sub-type" defined, substitute
*                    the second one with filler
*  03/oct/20 b.e.  - alpha doctor nbr
*
*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

fd suspend-hdr
*      record   contains 278 characters.
*     record  contains 280 characters.
*!     record  contains 281 characters.
     record  contains 279 characters.

01  suspend-hdr-rec.

    05  clmhdr-claim-id.
*!       10  clmhdr-batch-nbr                    pic 9(9).
       10  clmhdr-batch-nbr                    pic x(8).
       10  clmhdr-batch-nbr-r1 redefines clmhdr-batch-nbr.
           15  clmhdr-clinic-nbr-1-2           pic 99.
*!           15  clmhdr-doc-nbr                  pic 9(4).
           15  clmhdr-doc-nbr                  pic x(3).
           15  clmhdr-week                     pic 99.
           15  clmhdr-day                      pic 9.
       10  clmhdr-claim-nbr                    pic 9(2).
       10  clmhdr-zeroed-oma-suff-adj.
           15  clmhdr-adj-oma-cd               pic x999.
           15  clmhdr-adj-oma-suff             pic x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  13
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
           15  clmhdr-adj-adj-nbr              pic 9.
    05  clmhdr-batch-type                      pic x.
    05  clmhdr-adj-cd-sub-type                 pic x.
    05  clmhdr-claim-source-cd    redefines clmhdr-adj-cd-sub-type
                                               pic x.
    05  clmhdr-doc-nbr-ohip                    pic 9(6).
    05  clmhdr-doc-nbr-ohip-alpha redefines
        clmhdr-doc-nbr-ohip                    pic x(6).
    05  clmhdr-doc-spec-cd                     pic 9(2).
    05  clmhdr-doc-spec-cd-alpha redefines
        clmhdr-doc-spec-cd                     pic x(2).
    05  clmhdr-refer-doc-nbr                   pic 9(6).
    05  clmhdr-refer-doc-nbr-alpha redefines
        clmhdr-refer-doc-nbr                   pic x(6).
    05  clmhdr-diag-cd                         pic 9(3).
    05  clmhdr-diag-cd-alpha redefines
        clmhdr-diag-cd                         pic x(3).
    05  clmhdr-loc                             pic x999.
    05  clmhdr-hosp                            pic x.
    05  clmhdr-agent-cd                        pic x.
    05  clmhdr-adj-cd                          pic x.
    05  clmhdr-tape-submit-ind                 pic x.
    05  clmhdr-i-o-pat-ind                     pic x.
    05  clmhdr-pat-ohip-id-or-chart.
        10  clmhdr-pat-key-type                pic a.
        10  clmhdr-pat-key-data.
            15  clmhdr-pat-key-ohip            pic x(8).
            15  filler                         pic x(7).
    05  clmhdr-pat-acronym.
        10  clmhdr-pat-acronym6                pic x(6).
        10  clmhdr-pat-acronym3                pic x(3).
    05  clmhdr-reference.
        10  clmhdr-ref1                        pic x.
        10  clmhdr-ref2                        pic x.
        10  clmhdr-ref3                        pic x.
        10  clmhdr-ref4                        pic x.
        10  clmhdr-ref5                        pic x.
        10  clmhdr-ref6                        pic x.
        10  clmhdr-ref7                        pic x.
        10  clmhdr-ref8                        pic x.
        10  clmhdr-ref9                        pic x.
        10  clmhdr-ref10                       pic x.
        10  clmhdr-ref11                       pic x.
    05  clmhdr-date-admit.
        10  clmhdr-date-admit-yy               pic x(4).
        10  clmhdr-date-admit-yy-r redefines
            clmhdr-date-admit-yy.
            15 clmhdr-date-admit-yy-12         pic 99.
            15 clmhdr-date-admit-yy-34         pic 99.
        10  clmhdr-date-admit-mm               pic 99.
        10  clmhdr-date-admit-dd               pic 99.
    05  clmhdr-doc-dept                        pic 99.
    05  clmhdr-date-cash-tape-payment          pic x(8).
    05  clmhdr-direct-bills-clm-info  redefines clmhdr-date-cash-tape-payment.
        10  clmhdr-msg-nbr                     pic xx.
        10  clmhdr-reprint-flag                pic x.
        10  clmhdr-sub-nbr                     pic x.
        10  clmhdr-auto-logout                 pic x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  14
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
        10  clmhdr-fee-complex                 pic x.
        10  filler                             pic x(2).
    05  clmhdr-curr-payment                    pic s9(5)v99.
    05  clmhdr-date-period-end.
        10  clmhdr-period-end-yy               pic 9(4).
        10  clmhdr-period-end-mm               pic 99.
        10  clmhdr-period-end-dd               pic 99.
    05  clmhdr-cycle-nbr                       pic 99.
    05  clmhdr-date-sys                        pic x(8).
    05  clmhdr-amt-tech-billed                 pic s9(4)v99.
    05  clmhdr-amt-tech-paid                   pic s9(4)v99.
    05  clmhdr-tot-claim-ar-oma                pic s9(5)v99.
    05  clmhdr-tot-claim-ar-ohip               pic s9(5)v99.
    05  clmhdr-manual-tape-payments            pic s9(5)v99.
    05  clmhdr-status-ohip                     pic xx.
*!  05  clmhdr-orig-batch-id                   pic x(11).
    05  clmhdr-orig-batch-id                   pic x(10).
    05  clmhdr-status                          pic x.

*   ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
*            dyad  extensions to ohip standard format

    05  clmhdr-health-care-nbr                  pic x(12).
    05  clmhdr-health-care-ver                  pic x(02).
    05  clmhdr-health-care-prov                 pic x(02).
    05  clmhdr-relationship                     pic x(01).
*   for new ohip format, relationship is not used, hence manual
*   review is used here.
    05  clmhdr-manual-review redefines clmhdr-relationship   pic x(01).
    05  clmhdr-patient-surname                  pic x(09).
    05  clmhdr-subscr-initials                  pic x(03).
    05  clmhdr-wcb-claim-nbr                    pic x(09).
    05  clmhdr-wcb-accident-date              pic x(08).
    05  clmhdr-wcb-employer-name-addr         pic x(40).
    05  clmhdr-wcb-employer-postal-cd         pic x(06).

*       (00/02/08 B.A.)
    05  clmhdr-confidential-flag              pic x(1).
*       (00/sep/14 B.E.)
    05  clmhdr-nbr-suspend-desc-recs          pic 9(2).
* 2002/10/24 -- MC
*    05  clmhdr-adj-cd-sub-type               pic x(1).
    05  filler                                pic x(1).
* 2002/10/24 - end

    05  suspend-hdr-id.
        10  clmhdr-doc-pract-nbr              pic 9(6).
        10  clmhdr-accounting-nbr             pic x(8).

copy "f002_suspend_dtl.fd".
* file: f002_suspend_dtl.fd

* 98/dec/01 D.B. - y2k
* 00/sep/05 B.E. - added redefine of clmdtl-consecutive-sv-dateS
* 03/oct/20 b.e. - alpha doctor nbr

fd   suspend-dtl
* y2k  record contains 89 characters .
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  15
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
*!       record contains 93 characters .
       record contains 92 characters .

01  suspend-dtl-rec.

    05  clmdtl-id.
*!        10  clmdtl-batch-nbr                    pic 9(9).
        10  clmdtl-batch-nbr                    pic x(8).
        10  clmdtl-claim-nbr                    pic 9(2).
        10  clmdtl-oma-cd                       pic xxxx.
        10  clmdtl-oma-suff                     pic x.
        10  clmdtl-adj-nbr                      pic 9.
    05  clmdtl-det-rec.
        10  clmdtl-rev-group-cd                 pic xxx.
        10  clmdtl-agent-cd                     pic 9.
        10  clmdtl-adj-cd                       pic x.
        10  clmdtl-nbr-serv                     pic 99.
        10  clmdtl-nbr-serv-alpha redefines clmdtl-nbr-serv pic xx.
        10  clmdtl-sv-date.
* y2k         15  clmdtl-sv-yy                    pic 99.
            15  clmdtl-sv-yy                    pic 9999.
            15  clmdtl-sv-mm                    pic 99.
            15  clmdtl-sv-dd                    pic 99.
        10  clmdtl-consec-dates.
            15  clmdtl-consecutive-sv-date  occurs 3 times.
*mf                                              pic 999.
*                                             pic x(3).
*                   (00/sep/05 B.E. added redefine )
                20  clmdtl-sv-nbr               pic 9.
                20  clmdtl-sv-day               pic xx.

        10  clmdtl-amt-tech-billed              pic s9(4)v99.
        10  clmdtl-fee-oma                      pic s9(5)v99.
        10  clmdtl-fee-oma-alpha redefines clmdtl-fee-oma pic x(7).
        10  clmdtl-fee-ohip                     pic s9(5)v99.
        10  clmdtl-fee-ohip-alpha redefines clmdtl-fee-ohip pic x(7).
* Y2k   10  clmdtl-date-period-end              pic x(6).
        10  clmdtl-date-period-end              pic x(8).
        10  clmdtl-cycle-nbr                    pic 999.
        10  clmdtl-diag-cd                      pic 999.
        10  clmdtl-diag-cd-alpha
                redefines clmdtl-diag-cd        pic xxx.
        10  clmdtl-diag-cd-local                pic 999.
        10  clmdtl-diag-cd-local-alpha
                  redefines clmdtl-diag-cd-local  pic xxx.

    05  clmdtl-status                           pic x.
    05  suspend-dtl-id.
        10  clmdtl-doc-pract-nbr                pic 9(6).
        10  clmdtl-accounting-nbr              pic x(8).


copy "f002_suspend_address.fd".
* file: f002_suspend_address.fd

* 98/dec/01 D.B.        - y2k

fd  suspend-address
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  16
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
* y2k record contains 126 characters .
      record contains 128 characters .
*mf      feedback is feedback-suspend-addr.

01  suspend-address-rec.

    05  addr-address-line-1                   pic x(25).
    05  addr-address-line-2                   pic x(25).
    05  addr-address-line-3                   pic x(25).
    05  addr-postal-code                      pic x(6).
    05  addr-surname                          pic x(9).
    05  addr-first-name                       pic x(5).
    05  addr-birth-date.
* y2k
*       10  addr-birth-yy                     pic 99.
        10  addr-birth-yy                     pic 9(4).
        10  addr-birth-mm                     pic 99.
        10  addr-birth-dd                     pic 99.
    05  addr-sex                              pic x.
    05  addr-phone-no                         pic x(10).
    05  suspend-addr-id.
        10  addr-doc-pract-nbr                pic 9(6).
        10  addr-accounting-nbr               pic x(8).


* 2005/05/09 - add description file
*copy "f002_suspend_desc.fd".
* 2005/05/09 - end

* COPY "F020_DOCTOR_MSTR_OHIP.FD".
copy "f020_doctor_mstr.fd".
* sms 137  bml  05-dec-90  increase fields by 2
* sms 139  mc   10-jun-92  add 5 clinic nbr and 2 spec codes in
*                          reserved for nip
*          mc   24-nov-93  include brad's fields of earning subsystem
*          mc   12-feb-94  include doc-ep-pay-code and doc-ep-pay-sub-code
*          db   03-jun-98  Year 2000
*          mc   16-jul-02  add 5 additional batch nbr for each additional
*                          clinic
*          mc   23-sep-02  rename the second occurrence of group-regular-service
*                          to group-over-serviced
*          be   05-nov-03  alpha doctor nbr
*          mc   03-mar-04  reuse filler x(4) for doc-afp-paym-group from filler2

fd  doc-mstr
*       block  contains 680 characters
*       record contains 680 characters.
        block  contains 695 characters
        record contains 695 characters.

01 doc-mstr-rec.
*    05  doc-nbr                                        pic 9(3).
    05  doc-nbr                                 pic x(3).
    05  doc-dept                                pic 99.
    05  doc-ohip-nbr                            pic 9(6).
    05  doc-pract-nbr redefines doc-ohip-nbr    pic 9(6).
    05  doc-sin-nbr.
        10  doc-sin-123                         pic 999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  17
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
        10  doc-sin-456                         pic 999.
        10  doc-sin-789                         pic 999.
    05  doc-clinic-nbr                          pic 99.
    05  doc-spec-cd                             pic 99.
    05  doc-hosp-nbr                            pic x999.
    05  doc-name                                pic x(24).
    05  doc-name-soundex                        pic x(4).

    05  doc-inits.
        10  doc-init1                           pic x.
        10  doc-init2                           pic x.
        10  doc-init3                           pic x.
    05  doc-address-office.
        10  doc-addr-office-1                   pic x(24).
        10  doc-addr-office-2                   pic x(24).
        10  doc-addr-office-3                   pic x(24).
    05  doc-addr-office-r  redefines  doc-address-office.
        10  doc-addr-office  occurs 3 times     pic x(24).
    05  doc-addr-office-pc.
        10  doc-addr-office-pc-123.
            15  doc-addr-office-pc1             pic a.
            15  doc-addr-office-pc2             pic 9.
            15  doc-addr-office-pc3             pic a.
        10  doc-addr-office-pc-456.
            15  doc-addr-office-pc4             pic 9.
            15  doc-addr-office-pc5             pic a.
            15  doc-addr-office-pc6             pic 9.
    05  doc-address-home.
        10  doc-addr-home-1                     pic x(24).
        10  doc-addr-home-2                     pic x(24).
        10  doc-addr-home-3                     pic x(24).
    05  doc-addr-home-r  redefines doc-address-home.
        10  doc-addr-home  occurs 3 times       pic x(24).
    05  doc-addr-home-pc.
        10  doc-addr-home-pc-123.
            15  doc-addr-home-pc1               pic a.
            15  doc-addr-home-pc2               pic 9.
            15  doc-addr-home-pc3               pic a.
        10  doc-addr-home-pc-456.
            15  doc-addr-home-pc4               pic 9.
            15  doc-addr-home-pc5               pic a.
            15  doc-addr-home-pc6               pic 9.
    05  doc-full-part-ind                       pic x.
    05  doc-class-code redefines doc-full-part-ind pic x.
    05  doc-bank-info.
        10  doc-bank-nbr                        pic 9(4).
        10  doc-bank-branch                     pic 9(5).
        10  doc-bank-acct                       pic x(12).
*   05  doc-tax-info.
*       10  doc-billing-percent                 pic 9v99.
*       10  doc-misc-percent                    pic 9v99.
*       10  doc-tax-percent                     pic 9v99.
*       10  doc-billing-percent                 pic 9v9999.
*       10  doc-misc-percent                    pic 9v9999.
*       10  doc-tax-percent                     pic 9v9999.
*       10  doc-pay-code                        pic x.
    05  doc-fac-dates.
        10  doc-date-fac-start.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  18
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
* y2k       15  doc-date-fac-start-yy           pic 99.
            15  doc-date-fac-start-yy           pic 9999.
            15  doc-date-fac-start-mm           pic 99.
            15  doc-date-fac-start-dd           pic 99.
        10  doc-date-fac-term.
* y2k       15  doc-date-fac-term-yy            pic 99.
            15  doc-date-fac-term-yy            pic 9999.
            15  doc-date-fac-term-mm            pic 99.
            15  doc-date-fac-term-dd            pic 99.
    05    doc-fac-dates-r redefines doc-fac-dates.
        10  doc-date-fac occurs 2 times.
* y2k       15  doc-date-fac-yy                 pic 99.
            15  doc-date-fac-yy                 pic 9999.
            15  doc-date-fac-mm                 pic 99.
            15  doc-date-fac-dd                 pic 99.
    05  doc-annual-ceiling-info.
        10  doc-ytdgua                          pic s9(7)v99 comp.
        10  doc-ytdgub                          pic s9(7)v99 comp.
        10  doc-ytdguc                          pic s9(7)v99 comp.
        10  doc-ytdgud                          pic s9(7)v99 comp.
        10  doc-ytdcea                          pic s9(7)v99 comp.
        10  doc-ytdcex                          pic s9(7)v99 comp.
        10  doc-ytdear                          pic s9(7)v99 comp.
        10  doc-ytdinc                          pic s9(7)v99 comp.
        10  doc-ytdeft                          pic s9(7)v99 comp.
        10  doc-totinc-g                        pic s9(7)v99 comp.
* y2k
*       10  doc-ep-date-deposit                 pic 9(4) comp.
        10  doc-ep-date-deposit                 pic 9(8).
        10  doc-totinc                          pic s9(7)v99 comp.
        10  doc-ep-ceiexp                       pic s9(7)v99 comp.
        10  doc-adjcea                          pic s9(7)v99 comp.
        10  doc-adjcex                          pic s9(7)v99 comp.
        10  doc-ceicea                          pic s9(7)v99 comp.
        10  doc-ceicex                          pic s9(7)v99 comp.
        10  ceicea-prt-format                   pic x(13).
        10  ceicex-prt-format                   pic x(13).
        10  ytdcea-prt-format                   pic x(13).
        10  ytdcex-prt-format                   pic x(13).
        10  doc-clinic-nbr-2                    pic 99.
        10  doc-clinic-nbr-3                    pic 99.
        10  doc-clinic-nbr-4                    pic 99.
        10  doc-clinic-nbr-5                    pic 99.
        10  doc-clinic-nbr-6                    pic 99.
        10  doc-spec-cd-2                       pic 99.
        10  doc-spec-cd-3                       pic 99.
        10  doc-ytdinc-g                        pic s9(7)v99 comp.
    05  doc-locations.
        10  doc-loc-1                           pic x999.
        10  doc-loc-2                           pic x999.
        10  doc-loc-3                           pic x999.
        10  doc-loc-4                           pic x999.
        10  doc-loc-5                           pic x999.
        10  doc-loc-6                           pic x999.
        10  doc-loc-7                           pic x999.
        10  doc-loc-8                           pic x999.
        10  doc-loc-9                           pic x999.
        10  doc-loc-10                          pic x999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  19
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
        10  doc-loc-11                          pic x999.
        10  doc-loc-12                          pic x999.
        10  doc-loc-13                          pic x999.
        10  doc-loc-14                          pic x999.
        10  doc-loc-15                          pic x999.
        10  doc-loc-16                          pic x999.
        10  doc-loc-17                          pic x999.
        10  doc-loc-18                          pic x999.
        10  doc-loc-19                          pic x999.
        10  doc-loc-20                          pic x999.
        10  doc-loc-21                          pic x999.
        10  doc-loc-22                          pic x999.
        10  doc-loc-23                          pic x999.
        10  doc-loc-24                          pic x999.
        10  doc-loc-25                          pic x999.
        10  doc-loc-26                          pic x999.
        10  doc-loc-27                          pic x999.
        10  doc-loc-28                          pic x999.
        10  doc-loc-29                          pic x999.
        10  doc-loc-30                          pic x999.
    05  doc-locations-r  redefines  doc-locations.
        10  doc-loc     occurs 30 times         pic x999.
*
    05  doc-rma-expense-percent-misc            pic 9(5)v9(4) comp.
* 2004/03/03 - MC
*   05  filler2                                 pic x(8).
    05  doc-afp-paym-group                      pic x(4).
    05  filler2                                 pic x(4).
* 2004/030/03 - end
    05  doc-ind-pays-gst                        pic x.
    05  doc-nx-avail-batch                      pic 999.
* 2002/07/16 - MC - add 5 more next batch nbr for each clinic
    05  doc-nx-avail-batch-2                    pic 999.
    05  doc-nx-avail-batch-3                    pic 999.
    05  doc-nx-avail-batch-4                    pic 999.
    05  doc-nx-avail-batch-5                    pic 999.
    05  doc-nx-avail-batch-6                    pic 999.
* 2002/07/16 - end
    05  doc-yrly-ceiling-computed               pic 9(7)v99 comp.
    05  doc-yrly-expense-computed               pic 9(7)v99 comp.
    05  doc-rma-expense-percent-reg             pic 9(5)v9(4) comp.
    05  doc-sub-specialty                       pic x(15).
    05  doc-payeft                              pic s9(7)v99 comp.
    05  doc-ytdded                              pic s9(7)v99 comp.
    05  doc-dept-expense-percent-misc           pic 9(5)v9(4) comp.
    05  doc-dept-expense-percent-reg            pic 9(5)v9(4) comp.
    05  doc-ep-ped                              pic s9(9) comp.
    05  doc-ep-pay-code                         pic x.
    05  doc-ep-pay-sub-code                     pic x.
    05  filler3                                 pic x(1).
    05  doc-ind-holdback-active                 pic x(1).
    05  group-regular-service                   pic x(4).
* 2002/09/23 - MC
*    05  group-regular-service                  pic x(4).
    05  group-over-serviced                     pic x(4).
* 2002/09/23 - end
    05  doc-specialties                         pic x(90).

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  20
*                      newu701.cbl                                   )

*2000/03/20 - MC - include locations mstr
copy "f030_locations_mstr.fd".

* 1999/Apr/01 B.E. - added loc-ministry-loc-code and filler, adjusted rec length
* 1999/apr/27 B.E. - added loc-hospital-code field as contingency field in case
*                    it's needed as the current claim rec hospital field is
*                    only 1 character long and is now too small.
* 2001/Jan/26 A.A  - added loc-payroll-flag and decreased the filler to 14 char.
*                    This field used to HSC ONLY
* 2001/may/03 B.E. - redefined card-colour field to indicate it's real purpose
*                    of specifying in/out patient indicator
*                  - added 'active for entry' field

fd  loc-mstr
*       index block contains 512 characters
*       data  block contains 37 characters
*             block contains 37 characters
*       record      contains 37 characters.
              block contains 60 characters
        record      contains 60 characters.

01 loc-mstr-rec.
    05  loc-nbr                         pic x999.
    05  loc-nbr-r     redefines loc-nbr         pic x(4).

    05  loc-clinic-nbr                  pic 9(4).
    05  loc-hospital-nbr                pic 9(4).
    05  loc-hospital-code               pic x(4).

    05  loc-card-colour                 pic x(1).
    05  loc-in-out-ind redefines loc-card-colour
                                        pic x(1).

    05  loc-name                        pic x(24).
    05  loc-ministry-loc-code           pic 9(4).

    05  loc-payroll-flag                pic x(1).
    05  loc-active-for-entry            pic x(1).
    05  filler-reserved-for-nip         pic x(13).

copy "f040_oma_fee_mstr.fd".
* 98/dec/01 D.B.  - y2k
* 99/apr/28 B.E.  - split page (999) into page-alpha (xx) + page-numeric (999)
* 99/nov/30 B.E.  - correction to 'fee-page' definition in redefines
* 00/jul/31 B.E.  - fees changed from 9(5)v99 to 9(4)v999.
* 00/aug/01 B.E.  - added addition length to record for future expansion
*                 - add fee-active-for-entry y/n (1 byte)
*                 - add fee-min, fee-max (current/previous and oma/ohip)
*                                                        2*2*2*7 = 56 bytes)
*                 - add filler for growth -11 flags + 2  nbrs = 11*28 = 39 bytes
* 00/sep/05 B.E.  - add 'fee-global-addon-cd-exclusion-flag'
*
fd  oma-fee-mstr
*       block       contains 247 characters
*       record      contains 247 characters  .
        block       contains 315 characters
        record      contains 315 characters  .
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  21
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
*       feedback is feedback-oma-fee-mstr.

* insert this warning message from "f000_duplicate_fd_warning.fd
*----------------  note  -----------------------
*-- any changes to this fd must also be made  --
*-- to the corresponding "..._d001_..." fd    --
*-- and visa versa                            --
*----------------  note  -----------------------
01 fee-mstr-rec.
    05  fee-oma-cd.
        10  fee-oma-cd-ltr1                     pic x.
        10  filler                              pic 999.
    05  fee-special-m-suffix-ind                pic x.

    05  fee-effective-date.
* y2k   10  fee-date-yy                         pic 99.
        10  fee-date-yy                         pic 9999.
        10  fee-date-mm                         pic 99.
        10  fee-date-dd                         pic 99.
* 00/aug/01 B.E.
    05  fee-active-for-entry                    pic x(1).


    05  fee-desc                                pic x(48).
    05  fee-current-prev-years.
*           (CURRENT rates)
*           (00/aug/01 B.E. - fees changed from 2 to 3 decimals)
        10  fee-curr-a-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-a-fee-2                    pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-fee-2                    pic s9(4)v999
                                        sign is leading .
*           (00/aug/01 B.E.)
        10  fee-curr-a-min              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-min              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-a-max              pic s9(4)v999
                                        sign is leading .
        10  fee-curr-h-max              pic s9(4)v999
                                        sign is leading .

        10  fee-curr-a-anae                     pic 99.
        10  fee-curr-h-anae                     pic 99.
        10  fee-curr-a-asst                     pic 99.
        10  fee-curr-h-asst                     pic 99.

        10  fee-curr-add-on-codes.
            15  fee-curr-add-on-cd              pic x999    occurs 10 times.
        10  fee-curr-oma-ind-card-reqs.
            15  fee-curr-oma-ind-card-required  pic x       occurs  3 times.
* 99/apr/28
*       10  fee-curr-page                       pic 999.
        10  fee-curr-page.
            15 fee-curr-page-alpha              pic x(2).
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  22
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
            15 fee-curr-page-numeric            pic 999.

        10  fee-curr-add-on-perc-flat-ind       pic x.

*           (PREVIOUS rates)
*           (00/aug/01 B.E. - fees changed from 2 to 3 decimals)
        10  fee-prev-a-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-fee-1                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-fee-2                    pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-fee-2                    pic s9(4)v999
                                        sign is leading .
*           (00/aug/01 B.E.)
        10  fee-prev-a-min              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-min              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-max              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-h-max              pic s9(4)v999
                                        sign is leading .
        10  fee-prev-a-anae                     pic 99.
        10  fee-prev-h-anae                     pic 99.
        10  fee-prev-a-asst                     pic 99.
        10  fee-prev-h-asst                     pic 99.

        10  fee-prev-add-on-codes.
            15  fee-prev-add-on-cd              pic x999        occurs 10 times.
        10  fee-prev-oma-ind-card-reqs.
            15  fee-prev-oma-ind-card-required  pic x           occurs  3 times.
*       10  fee-prev-page                       pic 999.
        10  fee-prev-page.
            15 fee-prev-page-alpha              pic x(2).
            15 fee-prev-page-numeric            pic 999.
        10  fee-prev-add-on-perc-flat-ind       pic x.
    05  fee-current-prev-year-r redefines fee-current-prev-years.
* ---------------------- n o t e -------------------------
* ----- set up the following subscripts when using this file
* ----- set subscript  'curr' to 1  and  'prev' 2
        10  fee-years occurs 2 times.
* ----- set subscript  'oma' to 1  and  'ohip' to 2

            15  fee-1           occurs 2 times
*                                                       pic s9(5)v99
                                        pic s9(4)v999
                                        sign is leading.
            15  fee-2           occurs 2 times
*                                                       pic s9(5)v99
                                        pic s9(4)v999
                                        sign is leading.
*               (00/aug/01 B.E.)

*                 - fee-min, fee-max used only if "P" percentage based fee
            15  fee-min         occurs 2 times
                                        pic s9(4)v999
                                        sign is leading.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  23
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
            15  fee-max         occurs 2 times
                                        pic s9(4)v999
                                        sign is leading.

            15  fee-anae        occurs 2 times
                                                pic 99.
            15  fee-asst        occurs 2 times
                                                pic 99.
            15  fee-add-on-codes.
                20  fee-add-on-cd               pic x999        occurs 10 times.
            15  fee-oma-ind-card-requireds.
                20  fee-oma-ind-card-required   pic x           occurs  3 times.
*y2k
*           15  fee-page                        pic 999.
            15  fee-page-alpha-numeric.
                20 fee-page-alpha               pic x(2).
                20 fee-page                     pic 9(3).

            15  fee-add-on-perc-or-flat-ind     pic x.

*       internal computer code (icc) -- used to perform price reductions
    05  fee-icc-code.
        10  fee-icc-sec                         pic xx.
        10  fee-icc-cat                         pic  9.
        10  fee-icc-grp                         pic 99.
        10  fee-icc-reduc-ind                   pic  9.
*       (diag ind = 'y' --> batch claim header diag cd must not = zero)
    05  fee-diag-ind                            pic x.
    05  fee-phy-ind                             pic x.
    05  fee-tech-ind                            pic x.
    05  fee-hosp-nbr-ind                        pic x.
    05  fee-i-o-ind                             pic x.
    05  fee-admit-ind                           pic x.
    05  fee-spec-fr                             pic 99.
    05  fee-spec-to                             pic 99.

*          (00/aug/01 B.E. filler for growth)
*           05  filler                                  pic x(39).
*       (00/sep/05 B.E.)
    05  fee-global-addon-cd-exclusion           pic x(01).
    05  filler                                  pic x(38).


copy "f090_constants_mstr.fd".
* 99/Jan/29     MC      - change iconst-clinic-nbr from numeric to character
* 03/nov/05 b.e. - alpha doctor nbr

fd  iconst-mstr
*       index block contains   2 characters
              block contains 384 characters
        record      contains 384 characters  .
*       feedback is feedback-iconst-mstr.

01 iconst-mstr-rec.
    05  iconst-clinic-nbr-1-2                   pic   99.
*    05  iconst-clinic-nbr                      pic  9(4).
    05  iconst-clinic-nbr                       pic  x(4).
    05  iconst-clinic-name                      pic x(20).
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  24
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
    05  iconst-clinic-cycle-nbr                 pic   99.
    05  iconst-date-period-end.
* y2k   10  iconst-date-period-end-yy           pic   99.
        10  iconst-date-period-end-yy           pic   9999.
        10  iconst-date-period-end-mm           pic   99.
        10  iconst-date-period-end-dd           pic   99.
    05  iconst-clinic-addr.
        10  iconst-clinic-addr-l1               pic  x(25).
        10  iconst-clinic-addr-l2               pic  x(25).
        10  iconst-clinic-addr-l3               pic  x(25).
    05  iconst-clinic-addr-r redefines iconst-clinic-addr.
        10  iconst-clinic-addr                  pic x(25)   occurs  3  times.
    05  iconst-clinic-card-colour               pic    x.
    05  iconst-clinic-over-lim1                 pic 99v99.
    05  iconst-clinic-under-lim2                pic 99v99.
    05  iconst-clinic-under-lim3                pic 99v99.
    05  iconst-clinic-over-lim4                 pic 99v99.

*!    05  iconst-clinic-batch-nbr                 pic 9(6).
    05  iconst-clinic-batch-nbr                 pic x(6).

    05  iconst-reduction-factor                 pic 99v99.
    05  iconst-overpay-factor                   pic 99v99.
    05  filler                                  pic x(242).

copy "f090_const_mstr_rec_2.ws".
* 98/dec/01 D.B.        - y2k

01  constants-mstr-rec-2.
*
*       use subscripts    ss-yr-nbr    (curr = 1;prev = 2)
*                     and ss-rate-type (ohip = 1;oma = 2)
*
    05  const-rec-2-rec-nbr                     pic 99.
    05  const-info.
        10  const-info-curr-prev occurs 2 times.
            15  const-effective-date.
* y2k
*               20  const-yy                    pic 99.
                20  const-yy                    pic 9(4).
                20  const-mm                    pic 99.
                20  const-dd                    pic 99.
            15  const-bilateral                 pic 99v99.
            15  const-ic                        pic 99v99.
            15  const-sr                        pic 99v99.
            15  const-wcb                       pic 999v9(5).
            15  const-ohip-oma-rates occurs 2 times.
                20  const-asst                  pic 99v99.
                20  const-reg                   pic 99v99.
                20  const-cert                  pic 99v99.
    05  const-info-r redefines const-info.
        10  const-info-curr-prev-r.
            15  const-effective-date-curr.
* y2k
*               20  const-yy-curr               pic 99.
                20  const-yy-curr               pic 9999.
                20  const-mm-curr               pic 99.
                20  const-dd-curr               pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  25
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
            15  const-bilateral-curr            pic 99v99.
            15  const-ic-curr                   pic 99v99.
            15  const-sr-curr                   pic 99v99.
            15  const-wcb-curr                  pic 999v9(5).
            15  const-ohip-oma-rates-curr.
                20  const-asst-h-curr           pic 99v99.
                20  const-reg-h-curr            pic 99v99.
                20  const-cert-h-curr           pic 99v99.
                20  const-asst-a-curr           pic 99v99.
                20  const-reg-a-curr            pic 99v99.
                20  const-cert-a-curr           pic 99v99.
            15  const-effective-date-prev.
* y2k           20  const-yy-prev               pic 99.
                20  const-yy-prev               pic 9999.
                20  const-mm-prev               pic 99.
                20  const-dd-prev               pic 99.
            15  const-bilateral-prev            pic 99v99.
            15  const-ic-prev                   pic 99v99.
            15  const-sr-prev                   pic 99v99.
            15  const-wcb-prev                  pic 999v9(5).
            15  const-ohip-oma-rates-prev.
                20  const-asst-h-prev           pic 99v99.
                20  const-reg-h-prev            pic 99v99.
                20  const-cert-h-prev           pic 99v99.
                20  const-asst-a-prev           pic 99v99.
                20  const-reg-a-prev            pic 99v99.
                20  const-cert-a-prev           pic 99v99.
    05  const-max-nbr-rates                     pic 99.
    05  const-groups.
        10  const-group-rates occurs 19 times.
            15  const-section-group.
                20  const-section               pic xx.
                20  const-group                 pic 99.
            15  const-rates-curr-prev occurs 2 times pic 99v99.
    05  const-group-r redefines const-groups.
        10  const-group-rates-r.
            15  const-sect-1                    pic xx.
            15  const-group-1                   pic 99.
            15  const-curr-1                    pic 99v99.
            15  const-prev-1                    pic 99v99.
            15  const-sect-2                    pic xx.
            15  const-group-2                   pic 99.
            15  const-curr-2                    pic 99v99.
            15  const-prev-2                    pic 99v99.
            15  const-sect-3                    pic xx.
            15  const-group-3                   pic 99.
            15  const-curr-3                    pic 99v99.
            15  const-prev-3                    pic 99v99.
            15  const-sect-4                    pic xx.
            15  const-group-4                   pic 99.
            15  const-curr-4                    pic 99v99.
            15  const-prev-4                    pic 99v99.
            15  const-sect-5                    pic xx.
            15  const-group-5                   pic 99.
            15  const-curr-5                    pic 99v99.
            15  const-prev-5                    pic 99v99.
            15  const-sect-6                    pic xx.
            15  const-group-6                   pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  26
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
            15  const-curr-6                    pic 99v99.
            15  const-prev-6                    pic 99v99.
            15  const-sect-7                    pic xx.
            15  const-group-7                   pic 99.
            15  const-curr-7                    pic 99v99.
            15  const-prev-7                    pic 99v99.
            15  const-sect-8                    pic xx.
            15  const-group-8                   pic 99.
            15  const-curr-8                    pic 99v99.
            15  const-prev-8                    pic 99v99.
            15  const-sect-9                    pic xx.
            15  const-group-9                   pic 99.
            15  const-curr-9                    pic 99v99.
            15  const-prev-9                    pic 99v99.
            15  const-sect-10                   pic xx.
            15  const-group-10                  pic 99.
            15  const-curr-10                   pic 99v99.
            15  const-prev-10                   pic 99v99.
            15  const-sect-11                   pic xx.
            15  const-group-11                  pic 99.
            15  const-curr-11                   pic 99v99.
            15  const-prev-11                   pic 99v99.
            15  const-sect-12                   pic xx.
            15  const-group-12                  pic 99.
            15  const-curr-12                   pic 99v99.
            15  const-prev-12                   pic 99v99.
            15  const-sect-13                   pic xx.
            15  const-group-13                  pic 99.
            15  const-curr-13                   pic 99v99.
            15  const-prev-13                   pic 99v99.
            15  const-sect-14                   pic xx.
            15  const-group-14                  pic 99.
            15  const-curr-14                   pic 99v99.
            15  const-prev-14                   pic 99v99.
            15  const-sect-15                   pic xx.
            15  const-group-15                  pic 99.
            15  const-curr-15                   pic 99v99.
            15  const-prev-15                   pic 99v99.
            15  const-sect-16                   pic xx.
            15  const-group-16                  pic 99.
            15  const-curr-16                   pic 99v99.
            15  const-prev-16                   pic 99v99.
            15  const-sect-17                   pic xx.
            15  const-group-17                  pic 99.
            15  const-curr-17                   pic 99v99.
            15  const-prev-17                   pic 99v99.
            15  const-sect-18                   pic xx.
            15  const-group-18                  pic 99.
            15  const-curr-18                   pic 99v99.
            15  const-prev-18                   pic 99v99.
            15  const-sect-19                   pic xx.
            15  const-group-19                  pic 99.
            15  const-curr-19                   pic 99v99.
            15  const-prev-19                   pic 99v99.
* (y2k)
*   05  filler                                  pic x(47).
    05  filler                                  pic x(41).
copy "f091_diagnostic_codes.fd".
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  27
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
fd  diag-mstr
*       index block contains  3  characters
*       data  block contains 123  characters
              block contains 123  characters
        record      contains 123  characters.

01  diag-rec.
    05  diag-cd                         pic xxx.
    05  diag-cd-desc                    pic x(120).


fd  report-file
    record contains 132 characters.

01  rpt-line                    pic x(132).
working-storage section.

************************************************************************
*   (variables below are needed by ya0- pricing copybook logic but
*    are only referenced within d001 so they are dummied up here so that
*    this pgm will compile)
77  password-input                              pic x(3).
77  password-special-privledges                 pic x(3)  value "xxx".
77  confirm                                     pic x   value space.
77  scr-hold-oma-cd                             pic x   value space.
77  scr-hold-oma-suff                           pic x   value space.
77  scr-hold-sv-date-yy-12                      pic x   value space.
77  scr-hold-sv-date-yy-34                      pic x   value space.
77  scr-hold-sv-date-mm                         pic x   value space.
77  scr-hold-sv-date-dd                         pic x   value space.
77  scr-hold-sv-nbr-0                           pic x   value space.
77  scr-hold-fee-oma                            pic x   value space.
77  scr-hold-fee-ohip                           pic x   value space.
77  scr-acpt-det-desc                           pic x   value space.
77  scr-last-claim              pic x   value space.
77  pline                                       pic 9   value zero.
************************************************************************


*mf 77 ws-1-null                                pic x(1) value "<000>".
*mf 77 ws-4-nulls                               pic x(4) value "<000><000><000><
77 ws-1-null                                    pic x(1) value x"00".
77 ws-4-nulls                                   pic x(4) value x"00000000".

77  ws-warning-literal                          pic x(14) value "* Warning * -".
77  ws-error-literal                            pic x(14) value "**ERROR** - ".

01  temp-phone-nbr.
   05 temp-phone-nbr-justified-left.
      10 temp-phone-nbr-1-7                     pic 9(7).
      10 temp-phone-nbr-8-10                    pic 9(3).
   05 temp-phone-nbr-justified-right redefines temp-phone-nbr-justified-left.
      10 temp-phone-nbr-1-3                     pic 9(3).
      10 temp-phone-nbr-4-10                    pic 9(7).

01  batch-rec.
  05  batch-dist-cd                             pic x.
  05  batch-identifier                          pic x(10).
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  28
*                      newu701.cbl                                   )
  05  batch-group-nbr                           pic x(4).
  05  batch-provider-nbr                        pic 9(6).
  05  batch-speciality                          pic 9(2).
  05  batch-pay-type                            pic 9.

* ('dummy' field added to allow compile of common code shared between
*  this pgm and d001)
01 nbr-of-services                              pic 99.

01  header-rec.
  05  hdr-ohip-nbr.
      10  nf-ohip-nbr                           pic x(12).
*2001/02/12 - MC - change the size of the ohip nbr for various provinces
*     10  ab-ns-ohip-nbr redefines nf-ohip-nbr.
*         15  ab-ns-11-digits                   pic x(11).
*         15  ab-ns-last-digits                 pic x.
*     10  bc-ohip-nbr redefines nf-ohip-nbr.
*         15  bc-10-digits                      pic x(10).
*         15  bc-last-digits                    pic xx.
      10  bc-ns-ohip-nbr redefines nf-ohip-nbr.
          15  bc-ns-10-digits                   pic x(10).
          15  bc-ns-last-digits                 pic xx.
*     10  nb-pe-sk-yt-ohip-nbr  redefines nf-ohip-nbr.
*         15  nb-pe-sk-yt-9-digits              pic x(9).
*         15  nb-pe-sk-yt-last-digits           pic xxx.
      10  ab-nb-sk-yt-ohip-nbr  redefines nf-ohip-nbr.
          15  ab-nb-sk-yt-9-digits              pic x(9).
          15  ab-nb-sk-yt-last-digits           pic xxx.
      10  pe-ohip-nbr redefines nf-ohip-nbr.
          15  pe-8-digits                       pic x(8).
          15  pe-last-digits                    pic x(4).
*** end
      10  nt-ohip-nbr redefines nf-ohip-nbr.
          15  nt-first-digit                    pic x.
          15  nt-7-digits                       pic x(7).
          15  nt-last-digits                    pic x(4).
      10  mb-ohip-nbr redefines nf-ohip-nbr.
* 2005/06/23 - MC - Manitoba should have 9 digits
*         15  mb-6-digits                       pic x(6).
*         15  mb-last-digits                    pic x(6).
          15  mb-9-digits                       pic x(9).
          15  mb-last-digits                    pic x(3).
* 2005/06/23 - end

  05  hdr-surname                               pic x(9).
  05  hdr-first-name                            pic x(5).

  05  hdr-birth-date-long.
*  Birth Date split up into yymm and dd
* (y2k)
*   10  hdr-birth-date                          pic 9(4).
    10  hdr-birth-date                          pic 9(6).
    10  hdr-birth-date-dd                       pic 9(2).
  05  hdr-sex                                   pic x.
  05  hdr-accounting-nbr                        pic x(8).
  05  hdr-refer-pract-nbr                       pic 9(6).
  05  hdr-hosp-nbr                              pic x(4).
  05  hdr-i-o-ind                               pic x.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  29
*                      newu701.cbl                                   )
  05  hdr-admit-date.
* (y2k)
*   15  hdr-admit-yy                            pic xx.
    15  hdr-admit-yy                            pic x(4).
    15  hdr-admit-mm                            pic 99.
    15  hdr-admit-dd                            pic 99.
  05  hdr-manual-review                         pic x(1).
  05  hdr-health-care-nbr                       pic x(12).
  05  hdr-health-care-ver                       pic x(02).
  05  hdr-health-care-prov                      pic x(02).
  05  hdr-relationship                          pic x(01).
  05  hdr-patient-surname                       pic x(09).
  05  hdr-subscr-initials                       pic x(03).
  05  hdr-agent-cd                              pic x(01).

* 2003/06/11 - MC
*  05  hdr-loc-code                              pic x(04).
  05  hdr-loc-code.
      10 hdr-loc-alpha                           pic x.
      10 hdr-loc-nbr                             pic x(03).
* 2003/06/11 - end

*     DATA STORED IN WORKING-STORAGE FROM FILES THAT SHARE I-O BUFFER AREAS.

*   (THE FOLLOWING 'DOC' FIELDS WERE CLONED FROM D001 WHEN THE D001 PRICING
*    CODE WAS MERGED INTO U701. THESE VALUES ARE *NOT* USED IN THIS PGM
*    AND THE PRICING CODE HAS BEEN CHANGED WERE APPROPRIATE)
01  ws-doc-mstr-rec-data.
    05  ws-doc-nx-batch-nbr                     pic  999.
    05  ws-doc-dept                             pic   99.
    05  ws-doc-ohip-nbr                         pic 9(6).
    05  ws-doc-spec-cd                          pic   99.
    05  ws-doc-locations.
        10  ws-doc-loc  occurs 30               pic x999.

01    detail-rec.
  05  dtl-oma-cd                                pic x(4).
  05  dtl-oma-suff                              pic x(1).
  05  dtl-fee-billed                            pic 9999v99.
  05  dtl-nbr-of-serv                           pic 99.
  05  dtl-serv-date.
* (y2k)
*       10  dtl-serv-date-yy                    pic 99.
        10  dtl-serv-date-yy                    pic 9(4).
        10  dtl-serv-date-mm                    pic 99.
        10  dtl-serv-date-dd                    pic 99.
  05  dtl-diag-code                             pic x(3).

01  trailer-rec.
  05  trl-h-count                               pic 9(4).
  05  trl-r-count                               pic 9(4).
  05  trl-t-count                               pic 9(4).
  05  trl-a-count                               pic 9(4).
  05  trl-b-count                               pic 9(4).

77  audit-file                                  pic x(9) value "ru701".
77  suspend-dtl-occur                           pic 9(7).
77  ws-carriage-ctrl                            pic 9(02) value 0.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  30
*                      newu701.cbl                                   )
77  ctr-lines-printed                           pic 9(03) value 99.
77  max-lines-per-page                          pic 9(03) value 60.
77  ws-rpt-page-nbr                             pic 9(03) value 0.
77  ws-agent-default-reply                      pic x(01) value spaces.
*!77  ws-doc-nbr                                  pic 9(3)  value 0.
77  ws-doc-nbr                                  pic x(3)  value spaces.
*77  WS-DEFAULT-CLINIC-NBR                       PIC 9(4)  VALUE 0.
77  ws-default-clinic-nbr                       pic 9(2)  value 0.
77  ws-default-batch-location                   pic x(4)  value " ".
77  ws-default-batch-i-o-ind                    pic x(1)  value " ".

*2002/04/24 -  MC
77  ws-default-payroll-flag                     pic x.
*20002/04/24 - end

77  flag-zero-fee                               pic x.
77  feedback-iconst-mstr                        pic x(4).
77  ws-tot-serv                                 pic 999   value 0.
77  ws-special-add-on-cd-entered                pic x.
77  ws-pricing-nbr-serv                         pic 999.
77  ws-highest-grp-tot                          pic s9(5)v99.
77  ws-highest-grp-nbr                          pic 99.
77  flag-new-sec                                pic x.
77  flag-z-highest-grp                          pic x.
*
*  SUBSCRIPTS
*
77  rate-found-ss                               pic 99  comp  value 0.
77  subs                                        pic 99  comp  value 0.
77  ss                                          pic 99  comp  value 0.
77  sub                                         pic 99  comp  value 0.
77  ss1                                         pic 99  comp  value 0.
77  ss2                                         pic 99  comp  value 0.
77  ss-basic-times                              pic 99  comp  value 0.
77  ss-basic-times-desc-rec                     pic 99  comp  value 0.
77  ss-from-plus-one                            pic 99  comp  value 0.
77  ss-const                                    pic 99  comp  value 0.
77  subs-table-addr                             pic 99  comp  value 0.
77  i                                           pic 99  comp  value 0.
77  ss-from                                     pic 99  comp  value 0.
77  ss-to                                       pic 99  comp  value 0.
77  ss-sec                                      pic 99  comp  value 0.
77  ss-grp                                      pic 99  comp  value 0.
77  ss-grp-tot                                  pic 99  comp  value 0.
77  ss-clmhdr                                   pic 99  comp  value 0.
77  ss-tech-prof-suff                           pic 99  comp  value 0.
77  ss-clmdtl-oma                               pic 99  comp  value 0.
77  ss-clmdtl-next-avail-dtl                    pic 99  comp  value 0.
77  ss-clmdtl-new-dtl                           pic 99  comp  value 0.
77  ss-clmdtl-tech-prof-suff                    pic 99  comp  value 0.
77  ss-hold-clmdtl-oma                          pic 99  comp  value 0.
77  ss-price                                    pic 99  comp  value 0.
77  ss-write-dtl                                pic 99  comp  value 0.
77  ss-clmdtl-desc                              pic 99  comp  value 0.
77  ss-conseq-dd                                pic 99  comp  value 0.
77  ss-ind                                      pic 99  comp  value 0.
77  ss-plus-one                                 pic 99  comp  value 0.
77  ss-x                                        pic 99  comp  value 0.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  31
*                      newu701.cbl                                   )
77  ss-suffix                                   pic 99  comp  value 0.
*       (SUBSCRIPTS FOR HOLD-OMA-RECORDS TABLE)
*       (moved to pricing hold.ws copybook)

77  ws-hold-wcb-rate                            pic 999v9(5).
77  ws-reduc-rate98                             pic 99v99.
77  ws-reduc-rate99                             pic 99v99.
77  ws-reduc-rate                               pic 99v99.
77  ws-search-clinic-nbr-1-2                    pic 99  comp  value 0.
*   ('CURR'ENT AND 'PREV'IOUS USED IN SELECTING THE APPROPRIATE OMA YEAR'S FEES
*    'OMA' AND 'OHIP' TO SELECT THE APPROPRIATE FEE TYPE)
77  curr                                        pic 9   comp    value 1.
77  prev                                        pic 9   comp    value 2.
77  oma                                         pic 9   comp    value 1.
77  ohip                                        pic 9   comp    value 2.
77  ss-curr-prev                                pic 99  comp  value 0.

77  space-char                                  pic x(01) value " ".
77  carriage-return                             pic x(01) value x"0D".
77  line-feed                                   pic x(01) value x"0A".
77  ws-hold-temp-1                              pic s9(7)v99.
77  ws-hold-temp-2                              pic 99.
77  ws-hold-temp-3                              pic s9(9).

01  bt-clinic-nbr-1-2                           pic 99  value zero.
01  subs-hosp                                   pic 99  comp  value 0.

01  ws-date-yymmdd.
* (y2k)
*   05 ws-date-yy                               pic 99.
    05 ws-date-yy                               pic 9(4).
    05 ws-date-mm                               pic 99.
    05 ws-date-dd                               pic 99.

01  ws-nbr-10                                   pic x(10).

* 2005/03/03 - MC
01  ws-birth-date                               pic 9(8).
01  ws-sv-date                                  pic 9(8).
* 2005/03/03 - end

*01  hold-suspend-hdr-rec                        pic x(265).
01  hold-suspend-hdr-rec                        pic x(278).

*     DATA STORED IN WORKING-STORAGE FOR CONSTANTS MASTER CLINIC REC SINCE
*     FD AREA IS RE-USED FOR CONSTANTS MASTER PRICING RECS.

01  ws-iconst-mstr-rec-data.
    05  ws-iconst-clinic-nbr-1-2                pic   99.
    05  ws-iconst-clinic-nbr                    pic 9(4).
    05  ws-iconst-clinic-cycle-nbr              pic   99.
* (y2k)
*   05  ws-iconst-date-period-end               pic 9(6).
    05  ws-iconst-date-period-end               pic 9(8).
    05  ws-iconst-clinic-card-colour            pic    x.

01  audit-line.
    05  filler                                  pic x(10) value spaces.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  32
*                      newu701.cbl                                   )
    05  audit-title                             pic x(36).
    05  audit-value                             pic zz,zzz.
    05  filler                                  pic x(05) value spaces.
    05  audit-value-2                           pic zz,zzz.
    05  filler                                  pic x(05) value spaces.
    05  audit-value-3                           pic zz,zzz.
    05  filler                                  pic x(05) value spaces.
    05  audit-value-4                           pic zz,zzz.
    05  filler                                  pic x(05) value spaces.
    05  audit-value-5                           pic zzz,zzz.99 blank when zero.

01  status-values.
  02 status-infos.
    05  status-unpriced-claims                  pic x(11)  value zero.
    05  status-priced-claims-file                  pic x(11)  value zero.
    05  status-iconst-mstr                      pic x(11)  value zero.
    05  status-doc-mstr                         pic x(11)  value zero.
    05  status-oma-mstr                         pic x(11)  value zero.
    05  status-suspend-hdr                      pic x(11)  value zero.
    05  status-suspend-dtl                      pic x(11)  value zero.
    05  status-suspend-addr                     pic x(11)  value zero.
    05  status-diag-mstr                        pic x(11)  value zero.
    05  status-file                             pic x(11).
  02 status-cobol.
    05  status-cobol-unpriced-claims            pic x(02)  value zero.
    05  status-cobol-priced-claims              pic x(02)  value zero.
    05  status-cobol-doc-mstr                   pic x(02)  value zero.
    05  status-cobol-oma-mstr                   pic x(02)  value zero.
    05  status-cobol-iconst-mstr                pic x(02)  value zero.
    05  status-cobol-suspend-hdr                pic x(02)  value zero.
    05  status-cobol-suspend-dtl                pic x(02)  value zero.
    05  status-cobol-suspend-addr               pic x(02)  value zero.
    05  status-cobol-diag-mstr                  pic x(02)  value zero.
    05  status-report                           pic x(02)  value zero.
*2000/03/20 - MC - include loc mstr
    05  status-cobol-loc-mstr                   pic x(02)  value zero.
*2002/04/24 - MC - include error-claims
    05  status-cobol-error-claims               pic x(02)  value zero.

01  feedback-values.
    05  feedback-doc-mstr                       pic x(04)  value zero.
    05  feedback-oma-fee-mstr                   pic x(04)  value zero.
    05  feedback-suspend-hdr                    pic x(04)  value zero.
    05  feedback-suspend-dtl                    pic x(04)  value zero.
    05  feedback-suspend-addr                   pic x(04)  value zero.
    05  feedback-diag-mstr                      pic x(04)  value zero.

01  flag-adjudication-required                  pic x.
    88 adjudication-desc-required               value "Y".

01  ic-flag                                     pic x  value "N".
    88  ic-entered                              value "Y".
    88  ic-not-entered                          value "N".

01  flag                                        pic x.
    88 ok                                       value "Y".
    88 not-ok                                   value "N".

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  33
*                      newu701.cbl                                   )
01  eof-input-file-flag                         pic x   value "N".
    88 eof-input-file                   value "Y".

01  fatal-error-flag                            pic x   value spaces.
    88 fatal-error                      value "Y".

01  flag-lock                                   pic x.
    88 rec-locked                               value "Y".
    88 rec-not-locked                           value "N".

01  flag-ohip-vs-chart                          pic x.
    88  qhip                                    value "O".
    88  chart                                   value "C".
    88  direct                                  value "D".

01  flag-valid-ohip-or-chart                    pic x.
    88  valid-ohip                              value "Y".
    88  valid-chart                             value "Y".
    88  invalid-ohip                            value "N".
    88  invalid-chart                           value "N".

01  flag-ohip-mmyy                              pic x.
    88  valid-mmyy                              value "Y".
    88  invalid-mmyy                            value "N".

01  flag-err-data                               pic x.
    88  err-data                                value "N".
    88  ok-data                                 value "Y".

01  flag-done-clmdtl-recs                       pic x.
    88  done-clmdtl-recs-yes                    value "Y".

01  flag-eoj                                    pic x.
    88  eoj-create-new-patient                  value "C".
    88  eoj                                     value "E".

01  flag-tech-prof-suffix-rule                  pic x.
    88  tech-prof-suff-rule-applied             value "Y".

01  flag-sec-reduction-needed                   pic x.

01  flag-report-desc                            pic x.
    88 report-desc-required                     value "Y".

01  ws-oma-cd.
    05  ws-oma-cd-1                             pic x.
    05  ws-oma-cd-2-4                           pic 999.

*mf 01 skip-processing-this-acct-id-flag            pic x.
01 skip-process-this-acct-id-flag            pic x.
    88 skip-processing-this-acct-id     value "Y".
    88 skip-hdr-addr-but-write-dtl      value "D".

01  record-type-flags                   pic x.
    88 b-record                         value "B".
    88 h-record                         value "H".
    88 r-record                         value "R".
    88 t-record                         value "T".
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  34
*                      newu701.cbl                                   )
    88 a-record                         value "A".
    88 e-record                         value "E".

01 last-record-type-flag                        pic x.
    88 last-record-is-b                 value "B".
    88 last-record-is-h                 value "H".
    88 last-record-is-r                 value "R".
    88 last-record-is-t                 value "T".
    88 last-record-is-a                 value "A".
    88 last-record-is-e                 value "E".

01  counters.
    05  ctr-read-const-mstr                     pic 9(7).
    05  ctr-diskout-writes                      pic 9(7).
    05  ctr-suspend-hdr-writes                  pic 9(7).
    05  ctr-suspend-dtl-writes                  pic 9(7).
    05  ctr-suspend-addr-writes                 pic 9(7).
    05  ctr-recs-read                           pic 9(7).
    05  ctr-b-recs-read-skipped                 pic 9(7).
    05  ctr-h-recs-read-skipped                 pic 9(7).
    05  ctr-r-recs-read-skipped                 pic 9(7).
    05  ctr-t-recs-read-skipped                 pic 9(7).
    05  ctr-a-recs-read-skipped                 pic 9(7).
    05  ctr-e-recs-read-skipped                 pic 9(7).
    05  ctr-b-recs-read                         pic 9(7).
    05  ctr-h-recs-read                         pic 9(7).
    05  ctr-r-recs-read                         pic 9(7).
    05  ctr-t-recs-read                         pic 9(7).
    05  ctr-a-recs-read                         pic 9(7).
    05  ctr-e-recs-read                         pic 9(7).
    05  ctr-h-recs-skipped                      pic 9(7).
    05  ctr-r-recs-skipped                      pic 9(7).
    05  ctr-t-recs-skipped                      pic 9(7).
    05  ctr-a-recs-skipped                      pic 9(7).
    05  ctr-tot-b-recs                          pic 9(7).
    05  ctr-tot-h-recs                          pic 9(7).
    05  ctr-tot-r-recs                          pic 9(7).
    05  ctr-tot-t-recs                          pic 9(7).
    05  ctr-tot-a-recs                          pic 9(7).
    05  ctr-tot-dollars-read                    pic 9(7)v99.

*    05  ctr-tot-dollars-claim                   pic 9(7)v99.
    05  ctr-tot-dollars-oma                     pic 9(7)v99.
    05  ctr-tot-dollars-ohip                    pic 9(7)v99.

    05  ctr-tot-tech-claim                      pic 9(7)v99.
    05  ctr-tot-svcs-read                       pic 9(7).
*** S.B. - start.
    05  ctr-hdr2-rec                            pic 9(02).
    05  ctr-addr-rec                            pic 9(02).
*** S.B. - end.

01  flag-date                                   pic x.
    88 valid-date                                       value "Y".
    88 invalid-date                                     value "N".

01  flag-consec                                 pic x.
    88 valid-consec                                     value "Y".
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  35
*                      newu701.cbl                                   )
    88 invalid-consec                                   value "N".

01  flag-clinic                                 pic x.
    88 clinic-found                                     value "Y".
    88 clinic-not-found                                 value "N".

01  flag-hosp-nbr                               pic x.
    88 valid-hosp-nbr                                   value "Y".
    88 invalid-hosp-nbr                                 value "N".

01  flag-agent-cd                               pic x.
    88 valid-agent-cd                                   value "Y".
    88 invalid-agent-cd                                 value "N".

01  flag-in-out-ind                                     pic x.
    88 valid-in-out-ind                                 value "Y".
    88 invalid-in-out-ind                               value "N".

01  flag-doc                                    pic x.
    88  doc-found                                       value "Y".
    88  doc-not-found                                   value "N".

01  flag-oma                                    pic x.
    88  valid-oma-code                                  value "Y".
    88  invalid-oma-code                                value "N".

01  flag-agent-code                                     pic x.
    88  valid-agent-cd-code                             value "Y".
    88  invalid-agent-cd-code                           value "N".

01  flag-refer-phys                             pic x.
    88  valid-refer-phys                                value "Y".
    88  invalid-refer-phys                              value "N".

01  flag-location                               pic x.
    88  valid-location                                  value "Y".
    88  invalid-location                                value "N".

01  flag-ohip                                   pic x.
    88  valid-ohip                                      value "Y".
    88  invalid-ohip                                    value "N".

01  flag-diag-cd                                pic x.
    88  valid-diag-code                                 value "Y".
    88  invalid-diag-code                               value "N".

01  detail-written-flag                         pic x.
    88  detail-written                          value 'Y'.
    88  detail-not-written                      value 'N'.

01  ws-chk-ind                                  pic x(8).

77  ws-val-total                                pic s9(7).
77  dummy                                       pic 9(3).
77  rem-even                                    pic 9v9(4).
77  max-nbr-digits                              pic 99 value 7.

77  max-doc-locations                           pic 99 value 30.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  36
*                      newu701.cbl                                   )

*   (include the pricing algorith's hold variables)
77  ss-max-nbr-oma-det-rec-allow                pic 99  comp    value  40.
    copy "pricing_variables_hold.ws".
* file: pricing_variables_hold.ws
* purpose: hold all variables used for pricing calcuations by programs
*          d001.cbl and newu701.cbl
*    note: newu701 needs more variables and requires a 50 occurs statment
*          which d001 doesn't need by will work with these larger
*          definitions


* 00/aug/03 B.E. - taken from d001.cbl/newu701.cbl
* 00/aug/30 B.E. - removed ss-max-nbr-oma-det-rec-allow from this copybook
*                  since it must be changed based upon which pgm uses
*                  the copybook.
* 00/aug/10 B.E. - added hold-ss-curr-prev
* 00/aug/31 B.E. - added hold-sv-nbr-serv-incoming
* 00/sep/04 B.E. - rename 'hold-sv-nbr-days-conseq' to 'hold-sv-nbr-days-conseq'
*                  and changed size of 'hold-sv-nbr' from 99 to 9.
* 00/sep/12 B.E. - changed sequence of fields hold-sv-nbr and  hold-sv-day
* 00/sep/25 B.E. - added 'hold-description-tmp' to be used to translate
*                  user entered 'short forms' into longer text
* 00/oct/25 B.E. - changed occurrences from 40 to 50 to handle web claim details
* 01/apr/23 B.E. - changed fees from 3 to 4 decimals to handle the 4 decimal
*                  percentages
* 01/aug/29 B.E. - added flag-desc-rec
* 01/sep/25 B.E. - added flag-update-suspense, flag-create-priced-file
* 02/jan/16 B.E. - added flag-payroll to indicate payroll claims being
*                  paid under

*======================================================================
*       (subscripts for this table in 'ss-oma-subscripts')
01  hold-claim-detail-recs.
    05  hold-oma-recs.

        10  hold-accounting-nbr         pic x(8).

*======================================================================
*========================  W A R N I N G  ! ! !  ======================
* WARNING #1 - length of 'hold-oma-rec'
*      if the length of the 'hold-oma-rec' is changed then the field
*     'hold-sort-oma-rec' must also be changed to reflect the new size.
* WARNING #2  - if the value                    '50' below changes then
*               the corresponding occurs must also be changed to match
*                       hold-grp-tot
*                       hold-grp-nbr
*========================  W A R N I N G  ! ! !  ======================
        10  hold-oma-rec                  occurs  50  times.
            15  hold-oma-cd.
                20  hold-oma-cd-alpha   pic x.
                20  hold-oma-cd-num     pic 999.
            15  hold-oma-suff           pic a.

*               (added incoming svcs 00/aug/31 B.E.)
            15  hold-sv-nbr-serv-incoming pic 99.
            15  hold-sv-nbr-serv          pic 99.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  37
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
            15  hold-admit-date-icc.
                20  hold-sv-date.
*y2k
*                   25  hold-sv-date-yy pic 99.
                    25  hold-sv-date-yy pic 9(4).
                    25  hold-sv-date-yy-r redefines hold-sv-date-yy.
                        30 hold-sv-date-yy-12     pic 99.
                        30 hold-sv-date-yy-34     pic 99.
                    25  hold-sv-date-mm pic 99.
                    25  hold-sv-date-dd pic 99.
                20  hold-icc-cd.
                    25  hold-icc-sec    pic xx.
                    25  hold-icc-grp    pic 99.
*y2k
            15  hold-key-r  redefines  hold-admit-date-icc.
*               20  filler              pic x(4).
                20  filler              pic x(6).
*               (sort key is service-date-dd + icc code)
                20  hold-sort-key-1     pic x(6).
            15  hold-sv-nbr-days-conseq  occurs  3  times.
*                   (00/sep/12 B.E. changed sequence of day/nbr)
                20  hold-sv-nbr         pic 9.
                20  hold-sv-day         pic xx.
                20  hold-sv-day-num redefines hold-sv-day pic 99.
*                       20  hold-sv-nbr         pic 99.

            15  hold-override-price     pic x(1).
            15  hold-bilateral          pic x(1).
            15  hold-fee-incoming       pic s9(5)v99.

            15  hold-fee-oma            pic s9(5)v99.
            15  hold-fee-oma-r redefines hold-fee-oma  pic s9(7).
            15  hold-fee-ohip           pic s9(5)v99.
            15  hold-fee-ohip-r redefines hold-fee-ohip pic s9(7).
            15  hold-priced-tech        pic s9(5)v99.
            15  hold-basic-tech         pic s9(5)v99.
            15  hold-basic-prof         pic s9(5)v99.
            15  hold-basic-fee          pic s9(5)v99.
*               (8 indicators for each detail rec -
*                see definitions below (eg. ss-diag-ind))
            15  hold-oma-rec-ind        pic x           occurs  8  times.
*               (10 possible add on codes for each detail rec)
            15  hold-oma-add-on-cd      pic x999        occurs  10  times.
            15  hold-oma-ind-card-requireds.
                20  hold-oma-ind-card-required pic x    occurs 3 times.

*               (fees are stored as: 1st occur = 'oma'
*                                    2nd occur = 'ohip' )
            15  hold-oma-fees    occurs  2  times.
*                   (oma fees changed from 2 to 3 decimals)
*                      20  hold-oma-fee-1      pic s9(5)v99.
*                      20  hold-oma-fee-2      pic s9(5)v99.
*                   (oma fees changed from 3 to 4 decimals - 2000/apr/23)
*                      20  hold-oma-fee-1      pic s9(4)v999.
*                      20  hold-oma-fee-2      pic s9(4)v999.
                20  hold-oma-fee-1      pic s9(4)v9999.
                20  hold-oma-fee-2      pic s9(4)v9999.
*                   (00/aug/03 B.E. - new min/max fields)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  38
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
                20  hold-fee-min        pic s9(4)v999.
                20  hold-fee-max        pic s9(4)v999.
                20  hold-oma-fee-anae   pic 99.
                20  hold-oma-fee-asst   pic 99.

*               (00/aug/10 B.E.
*                each oma code can have different effective date and therefore
*                lines may vary between current and previous rates)
            15  hold-ss-curr-prev       pic 9 comp.

            15  hold-flag-fee-used      pic x.
            15  hold-flag-sec-group.
                20  hold-flag-sec       pic  9.
                20  hold-flag-grp       pic  9.
            15  hold-diag-cd            pic  999.
            15  hold-line-no            pic 99.

*       (00/apr/23 B.E. from 166 to 168)
*       (00/aug/03 B.E. from 168 to 200 fold hold-fee-min/max fields)
*       (00/aug/04 B.E. from 200 to 220 when copybook created for d001/newu701
*       (00/aug/08 B.E. from 220 to 234 added 2nd dimension for min/max)
*       (00/aug/10 B.E. from 234 to 274 added hold-ss-curr-prev added)
    05  hold-sort-oma-rec               pic x(274).

    05  hold-descriptions.
        10  hold-desc-1                 pic x(22).
        10  hold-desc-2                 pic x(22).
        10  hold-desc-3                 pic x(22).
        10  hold-desc-4                 pic x(22).
        10  hold-desc-5                 pic x(22).

    05  hold-descs-r   redefines   hold-descriptions.
        10  hold-descs  occurs 5 times.
           15  hold-desc               pic x(22).
*            15  orig-desc.
*               20 orig-desc-start      pic x(03).
*               20 orig-desc-end        pic x(19).
    05  hold-desc-tmp.
        10 hold-desc-tmp-start          pic x(03).
        10 hold-desc-tmp-end            pic x(19).

    05  hold-basic-times-desc.
        10  hold-basic-plus-times-desc     occurs  2  times.
            15  hold-basic-units        pic zz9.
            15  hold-basic-b            pic xxx.
            15  hold-times-units        pic zz9.
            15  hold-times-t            pic xxx.

01  hold-grp-totals-tbl.
    05  hold-grp-tot                    pic s9(5)v99 occurs  50  times.
    05  hold-grp-nbr                                 occurs  50 times.
        10  hold-grp-nbr-sec            pic 9.
        10  hold-grp-nbr-grp            pic 9.


*
*       (maximum values or limits that may have to be changed
*               if record layouts are altered)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  39
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*
77  ss-max-nbr-locs-in-doc-rec                  pic 99  comp    value  30.
77  ss-max-nbr-of-desc-rec-allow                pic 99  comp    value  5.

01  flag-desc-rec                               pic xx.
    88 basic-plus-times-entry                   value "BT".
    88 adjudication-desc-entry                  value "A".

01  flag-update-suspense                        pic x.
    88 update-suspense                          value "Y".
    88 dont-update-suspense                     value "N".

01  flag-create-priced-file                     pic x.
    88 create-priced-file                       value "Y".
    88 dont-create-priced-file                  value "N".

01  flag-claim-source                           pic x.
    88 web-claim                                value "W".
    88 online-claim                             value "O".
    88 diskette-claim                           value "D".
    88 price-only-claim                         value "P".

01  flag-payroll                                pic x.

01  flag-retain-prices                          pic x.
    88 retain-incoming-prices                   value "Y".
    88 override-with-rma-prices                 value "N".

*   (subscripts for the 'hold-oma-rec-ind' occurrence above)
77  ss-diag-ind                                 pic 99  comp  value 1.
77  ss-phy-ind                                  pic 99  comp  value 2.
77  ss-hosp-nbr-ind                             pic 99  comp  value 3.
77  ss-i-o-ind                                  pic 99  comp  value 4.
77  ss-admit-ind                                pic 99  comp  value 5.
77  ss-add-on-perc-or-flat-ind                  pic 99  comp  value 6.
77  ss-special-m-suffix-ind                     pic 99  comp  value 7.
77  ss-tech-ind                                 pic 99  comp  value 8.


01  province-flag                              pic x.
    88  province-found                          value "Y".
    88  province-not-found                      value "N".

01  prov-table.

    05  province.
        10  filler                              pic x(2) value "ON".
        10  filler                              pic x(2) value "AB".
* 2005/06/23 - MC - change NF to NL
*       10  filler                              pic x(2) value "NF".
        10  filler                              pic x(2) value "NL".
* 2005/06/23 - end
        10  filler                              pic x(2) value "SK".
        10  filler                              pic x(2) value "MB".
        10  filler                              pic x(2) value "NT".
        10  filler                              pic x(2) value "PE".
*       10  FILLER                              PIC X(2) VALUE "QE".
        10  filler                              pic x(2) value "YT".
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  40
*                      newu701.cbl                                   )
        10  filler                              pic x(2) value "BC".
        10  filler                              pic x(2) value "NB".
        10  filler                              pic x(2) value "NS".
*       10  FILLER                              PIC X(2) VALUE "OT".

    05  province-r               redefines      province.

        10  prov                 occurs 11 times pic x(2).

copy "def_agents.ws".
*
*    -----modification history------
*    date      who          what/why
* filename: def_agents.ws
*
* 90/jul/01  b. e.        - original
* 90/sep/10  b. e.        - added "4" to definition of direct bill
* 91/feb/11  m.c.  - sms 138 - use agent 2 for ohip wcb
* 95/oct/03  yas   - pdr 631 - use agent 5 for moh reduction
* 1999/Jun/18 S.B  - Combined Sick Kids and RMA agents.
* 2001/nov/06 B.E. - added agent 3 for ICU (revenue clinic 85) direct bills

01  def-agent-code                              pic x(01).
    88 def-agent-ohip                   value "0".
    88 def-agent-in-pat-diag-billing    value "1".
    88 def-agent-ohip-wcb               value "2".
*    88 def-agent-3-not-used            value "3".
    88 def-agent-icu-direct-bill        value "3".
    88 def-agent-ohip-not-valid         value "4".
    88 def-agent-moh-reduction          value "5".
    88 def-agent-bill-direct            value "6","4","3".
    88 def-agent-misc-payments          value "7".
    88 def-agent-alternate-funding      value "8".
    88 def-agent-wcb                    value "9".

    88 def-agent-ifhp-direct            value "x".
    88 def-agent-ontario-direct         value "x".
    88 def-agent-foreign-direct         value "x".
    88 def-agent-reciprocal             value "x".
    88 def-agent-quebec-direct          value "x".


copy "default_phone_area_code.ws".
* Filename: default_phone_area_code.ws

*   modification history
* 2000/mar/13 B.E. -original

77 default-area-code                            pic x(3) value "905".
01 swap-phone-nbr.
   10 swap-phone-nbr-1-7                        pic x(7).
   10 filler                                    pic x(3).


copy "sysdatetime.ws".
* 98/dec/01 D.B.        - y2k conversion
* 99/jan/13 B.E.        - changed sys-y1/y2 to y1 thru y4
*                       - added 'default-century-...' and century-date variables
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  41
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/sy)

01 century-year                                 pic 9(4).
01 century-date                                 pic 9(8).
01 default-century-cc                           pic 9(2) value 19.
01 default-century-cccc                         pic 9(4) value 1900.

01  sys-date.
* y2k    05  sys-date-long                              pic x(6).
    05  sys-date-long                           pic x(8).
    05  sys-date-long-r  redefines  sys-date-long.
* y2k   10  sys-yy                              pic 99.
        10  sys-yy                              pic 9999.
        10  sys-yy-alpha  redefines  sys-yy.
* y2k       15  sys-y1                          pic 9.
* y2k       15  sys-y2                          pic 9.
            15  sys-y1                          pic 9.
            15  sys-y2                          pic 9.
            15  sys-y3                          pic 9.
            15  sys-y4                          pic 9.
        10  sys-mm                              pic 99.
        10  sys-dd                              pic 99.
* remove after y2k upgrade of dgux
01  sys-date-numeric redefines sys-date         pic 9(8).
01  sys-date-y2kfix  redefines sys-date.
    05 sys-date-left                            pic x(6).
    05 filler                                   pic x(2).
01  sys-date-y2kfixed redefines sys-date.
    05 sys-date-blank                           pic x(2).
    05 sys-date-right                           pic x(6).
01  sys-date-temp                               pic x(8).

01  run-date.
* y2k    05  run-yy                                     pic 99.
    05  run-yy                                  pic 9999.
    05  filler                                  pic x   value "/".
    05  run-mm                                  pic 99.
    05  filler                                  pic x   value "/".
    05  run-dd                                  pic 99.

01  sys-time.
    05  sys-hrs                                 pic 99.
    05  sys-min                                 pic 99.
    05  sys-sec                                 pic 99.
    05  sys-hdr                                 pic 99.

01  run-time.
    05  run-hrs                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-min                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-sec                                 pic 99.

copy "check_digit.ws".
01  ws-check-digit-nbrs.
    05  ws-temp                                 pic 999.
    05  ws-temp-1                               pic 99.
    05  ws-temp-2                               pic 99.
    05  ws-temp-2-r  redefines ws-temp-2.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  42
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/ch)
        10  ws-temp-2a                          pic 9.
        10  ws-temp-2b                          pic 9.

*       (digit #8 is the check digit using modulus 10)
01  ws-check-nbr.
    05  ws-chk-nbr                              pic 9(8).
    05  ws-chk-nbr-r redefines ws-chk-nbr.
        10  ws-chk-nbr-1                        pic 9.
        10  ws-chk-nbr-2                        pic 9.
        10  ws-chk-nbr-3                        pic 9.
        10  ws-chk-nbr-4                        pic 9.
        10  ws-chk-nbr-5                        pic 9.
        10  ws-chk-nbr-6                        pic 9.
        10  ws-chk-nbr-7                        pic 9.
        10  ws-chk-nbr-8                        pic 9.



copy "check_digit_10.ws".
01  ws-check-digit-nbrs-10.
    05  ws-temp-10                                      pic 999.
    05  ws-temp-1-10                                    pic 99.
    05  ws-temp-2-10                                    pic 99.
    05  ws-temp-2-10-r  redefines ws-temp-2-10.
        10  ws-temp-2a-10                               pic 9.
        10  ws-temp-2b-10                               pic 9.

*       (digit #10 is the check digit using modulus 10)
01  ws-check-nbr-10.
    05  ws-chk-nbr-10                                   pic 9(10).
    05  ws-chk-nbr-10-r redefines ws-chk-nbr-10.
        10  ws-chk-nbr-1-10                             pic 9.
        10  ws-chk-nbr-2-10                             pic 9.
        10  ws-chk-nbr-3-10                             pic 9.
        10  ws-chk-nbr-4-10                             pic 9.
        10  ws-chk-nbr-5-10                             pic 9.
        10  ws-chk-nbr-6-10                             pic 9.
        10  ws-chk-nbr-7-10                             pic 9.
        10  ws-chk-nbr-8-10                             pic 9.
        10  ws-chk-nbr-9-10                             pic 9.
        10  ws-chk-nbr-10-10                            pic 9.



copy "mod_check_digit.ws".
01  ws-nbr-val.

    05  ws-nbr-to-b-val                 pic 9(8).
    05  ws-nbr-to-b-val-r redefines ws-nbr-to-b-val.
        10  ws-nbr-to-b-val-1-8 occurs 8 times
                                        pic 9.
    05  ws-sum-1-2-val.
        10  ws-sum-1-2-val-r occurs 7 times.
            15  ws-sum-1-2-val-r1       pic 99.
            15  ws-sum-1-2-val-r1-r redefines ws-sum-1-2-val-r1.
                20  ws-sum-1            pic 9   occurs 2 times.
    05  ws-sum-1-2-val-r-sep redefines ws-sum-1-2-val.
        10  ws-sum-1-2 occurs 7 times   pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  43
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/mo)

01  ws-hc-nbr-val.

    05  ws-hc-nbr-to-b-val                      pic 9(10).
    05  ws-hc-nbr-to-b-val-r redefines ws-hc-nbr-to-b-val.
        10  ws-hc-nbr-to-b-val-1-10 occurs 10 times
                                        pic 9.
    05  ws-hc-sum-1-2-val.
        10  ws-hc-sum-1-2-val-r occurs 9 times.
            15  ws-hc-sum-1-2-val-r1    pic 99.
            15  ws-hc-sum-1-2-val-r1-r redefines ws-hc-sum-1-2-val-r1.
                20  ws-hc-sum-1                 pic 9   occurs 2 times.
    05  ws-hc-sum-1-2-val-r-sep redefines ws-hc-sum-1-2-val.
        10  ws-hc-sum-1-2 occurs 9 times        pic 99.

copy "mth_desc_max_days.ws".
*
*       (each position contains:
*               - maximum nbr of days in month
*               - non-abreviated spelling of month
*               - nbr of julian days from jan-01 until last day of month
*       note: table does not take into consideration leap year)
*
01  month-descs-and-max-days-mth.
    05  mth-desc-max-days.
        10  filler                      pic x(14) value '31  JANUARY031'.
        10  filler                      pic x(14) value '29 FEBRUARY059'.
        10  filler                      pic x(14) value '31    MARCH090'.
        10  filler                      pic x(14) value '30    APRIL120'.
        10  filler                      pic x(14) value '31      MAY151'.
        10  filler                      pic x(14) value '30     JUNE181'.
        10  filler                      pic x(14) value '31     JULY212'.
        10  filler                      pic x(14) value '31   AUGUST243'.
        10  filler                      pic x(14) value '30SEPTEMBER273'.
        10  filler                      pic x(14) value '31  OCTOBER304'.
        10  filler                      pic x(14) value '30 NOVEMBER334'.
        10  filler                      pic x(14) value '31 DECEMBER365'.
    05  mth-desc-max-days-r   redefines mth-desc-max-days.
        10  mth-desc-max-days-occur     occurs  12  times.
            15  max-nbr-days            pic 99.
            15  mth-desc                pic x(9).
            15  nbr-julian-days-ytd     pic 9(3).


copy "hosp_table.ws".
*  (94/mar/17 b.e. changed 2784 to 3642)
01  hosp-table.

    05  hosp-values.
        10  filler                              pic x(5)        value
                "A1992".
        10  filler                              pic x(5)        value
                "B1160".
        10  filler                              pic x(5)        value
                "C1972".
        10  filler                              pic x(5)        value
                "D1557".
        10  filler                              pic x(5)        value
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  44
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/ho)
                "E1146".
        10  filler                              pic x(5)        value
                "F3361".
        10  filler                              pic x(5)        value
                "G1982".
        10  filler                              pic x(5)        value
                "H1983".
        10  filler                              pic x(5)        value
                "I3309".
        10  filler                              pic x(5)        value
                "J2003".
        10  filler                              pic x(5)        value
                "K1076".
        10  filler                              pic x(5)        value
                "L1538".
        10  filler                              pic x(5)        value
                "M1994".
        10  filler                              pic x(5)        value
                "N1591".
        10  filler                              pic x(5)        value
                "O1172".
        10  filler                              pic x(5)        value
                "P1524".
        10  filler                              pic x(5)        value
                "Q3446".
        10  filler                              pic x(5)        value
                "R1978".
        10  filler                              pic x(5)        value
                "S2006".
        10  filler                              pic x(5)        value
                "T1406".
        10  filler                              pic x(5)        value
                "U1542".
        10  filler                              pic x(5)        value
                "V1149".
        10  filler                              pic x(5)        value
                "W0000".
        10  filler                              pic x(5)        value
                "X1082".
        10  filler                              pic x(5)        value
                "Y1020".
        10  filler                              pic x(5)        value
                "Z1987".
        10  filler                              pic x(5)        value
                "11965".
        10  filler                              pic x(5)        value
                "21969".
        10  filler                              pic x(5)        value
                "33401".
        10  filler                              pic x(5)        value
                "42001".
        10  filler                              pic x(5)        value
                "51966".
        10  filler                              pic x(5)        value
                "61967".
        10  filler                              pic x(5)        value
                "73409".
        10  filler                              pic x(5)        value
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  45
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/ho)
                "83642".
        10  filler                              pic x(5)        value
                "93251".
    05  hosp-values-r redefines hosp-values.
        10  hosp-code-nbr occurs 35 times.
            15  hosp-code                       pic x.
            15  hosp-nbr                        pic x(4).


01 heading-l1.
    05  filler                                  pic x(08)       value
       "RU701".
    05  filler                                  pic x(10)       value
       "RUN DATE:".

* (y2k)
*   05  l1-run-date                             pic x(08).
    05  l1-run-date                             pic x(10).
*   05  filler                                  pic x(08)       value spaces.
    05  filler                                  pic x(06)       value spaces.
    05  filler                                  pic x(66)       value
       "OHIP Diskette Upload into Suspense - ERROR/WARNING/AUDIT Report".
    05  filler                                  pic x(06)       value
        "PAGE:".
    05  rpt-page-nbr                            pic zzz9.

01 heading-l2.
    05  filler                                  pic x(08)       value
        "DOCTOR: ".
*!    05  h-l2-doctor-nbr                         pic 999.
    05  h-l2-doctor-nbr                         pic xxx.
    05  filler                                  pic x(03)       value
        " / ".
    05  h-l2-doctor-initials                    pic x(03).
    05  filler                                  pic x(01)       value
        " ".
    05  h-l2-doctor-name                        pic x(24).
    05  filler                                  pic x(20)       value
        " CLINIC/SPECIALITY: ".
    05  h-l2-clinic                             pic x(4).
    05  filler                                  pic x(03)       value
        " / ".
    05  h-l2-speciality                          pic x(3).

copy "f090_const_mstr_rec_1.ws".
* 2005/jan/04   - extend from 40 clinic to the max clinics allowed (63)

01 constants-mstr-rec-1.
    05  const-rec-1-rec-nbr                     pic 99.
    05  const-max-nbr-clinics                   pic 99.
    05  const-clinic-data.
* 2005/01/04 - MC
*       10  const-clinic-data-r occurs  40  times.
        10  const-clinic-data-r occurs  63  times.
            15  const-clinic-nbr-1-2            pic 99.
            15  const-clinic-nbr                pic x(4).
    05  const-scr-data  redefines  const-clinic-data.
        10  const-clinic-1-2-nbr-1              pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  46
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
        10  const-clinic-nbr-1                  pic x(4).
        10  const-clinic-1-2-nbr-2              pic 99.
        10  const-clinic-nbr-2                  pic x(4).
        10  const-clinic-1-2-nbr-3              pic 99.
        10  const-clinic-nbr-3                  pic x(4).
        10  const-clinic-1-2-nbr-4              pic 99.
        10  const-clinic-nbr-4                  pic x(4).
        10  const-clinic-1-2-nbr-5              pic 99.
        10  const-clinic-nbr-5                  pic x(4).
        10  const-clinic-1-2-nbr-6              pic 99.
        10  const-clinic-nbr-6                  pic x(4).
        10  const-clinic-1-2-nbr-7              pic 99.
        10  const-clinic-nbr-7                  pic x(4).
        10  const-clinic-1-2-nbr-8              pic 99.
        10  const-clinic-nbr-8                  pic x(4).
        10  const-clinic-1-2-nbr-9              pic 99.
        10  const-clinic-nbr-9                  pic x(4).
        10  const-clinic-1-2-nbr-10             pic 99.
        10  const-clinic-nbr-10                 pic x(4).
        10  const-clinic-1-2-nbr-11             pic 99.
        10  const-clinic-nbr-11                 pic x(4).
        10  const-clinic-1-2-nbr-12             pic 99.
        10  const-clinic-nbr-12                 pic x(4).
        10  const-clinic-1-2-nbr-13             pic 99.
        10  const-clinic-nbr-13                 pic x(4).
        10  const-clinic-1-2-nbr-14             pic 99.
        10  const-clinic-nbr-14                 pic x(4).
        10  const-clinic-1-2-nbr-15             pic 99.
        10  const-clinic-nbr-15                 pic x(4).
        10  const-clinic-1-2-nbr-16             pic 99.
        10  const-clinic-nbr-16                 pic x(4).
        10  const-clinic-1-2-nbr-17             pic 99.
        10  const-clinic-nbr-17                 pic x(4).
        10  const-clinic-1-2-nbr-18             pic 99.
        10  const-clinic-nbr-18                 pic x(4).
        10  const-clinic-1-2-nbr-19             pic 99.
        10  const-clinic-nbr-19                 pic x(4).
        10  const-clinic-1-2-nbr-20             pic 99.
        10  const-clinic-nbr-20                 pic x(4).
        10  const-clinic-1-2-nbr-21             pic 99.
        10  const-clinic-nbr-21                 pic x(4).
        10  const-clinic-1-2-nbr-22             pic 99.
        10  const-clinic-nbr-22                 pic x(4).
        10  const-clinic-1-2-nbr-23             pic 99.
        10  const-clinic-nbr-23                 pic x(4).
        10  const-clinic-1-2-nbr-24             pic 99.
        10  const-clinic-nbr-24                 pic x(4).
        10  const-clinic-1-2-nbr-25             pic 99.
        10  const-clinic-nbr-25                 pic x(4).
        10  const-clinic-1-2-nbr-26             pic 99.
        10  const-clinic-nbr-26                 pic x(4).
        10  const-clinic-1-2-nbr-27             pic 99.
        10  const-clinic-nbr-27                 pic x(4).
        10  const-clinic-1-2-nbr-28             pic 99.
        10  const-clinic-nbr-28                 pic x(4).
        10  const-clinic-1-2-nbr-29             pic 99.
        10  const-clinic-nbr-29                 pic x(4).
        10  const-clinic-1-2-nbr-30             pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  47
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
        10  const-clinic-nbr-30                 pic x(4).
        10  const-clinic-1-2-nbr-31             pic 99.
        10  const-clinic-nbr-31                 pic x(4).
        10  const-clinic-1-2-nbr-32             pic 99.
        10  const-clinic-nbr-32                 pic x(4).
        10  const-clinic-1-2-nbr-33             pic 99.
        10  const-clinic-nbr-33                 pic x(4).
        10  const-clinic-1-2-nbr-34             pic 99.
        10  const-clinic-nbr-34                 pic x(4).
        10  const-clinic-1-2-nbr-35             pic 99.
        10  const-clinic-nbr-35                 pic x(4).
        10  const-clinic-1-2-nbr-36             pic 99.
        10  const-clinic-nbr-36                 pic x(4).
        10  const-clinic-1-2-nbr-37             pic 99.
        10  const-clinic-nbr-37                 pic x(4).
        10  const-clinic-1-2-nbr-38             pic 99.
        10  const-clinic-nbr-38                 pic x(4).
        10  const-clinic-1-2-nbr-39             pic 99.
        10  const-clinic-nbr-39                 pic x(4).
        10  const-clinic-1-2-nbr-40             pic 99.
        10  const-clinic-nbr-40                 pic x(4).
* 2005/01/04 - MC - include clinic 41 to 63
*    05  filler                                 pic x(140).
        10  const-clinic-1-2-nbr-41             pic 99.
        10  const-clinic-nbr-41                 pic x(4).
        10  const-clinic-1-2-nbr-42             pic 99.
        10  const-clinic-nbr-42                 pic x(4).
        10  const-clinic-1-2-nbr-43             pic 99.
        10  const-clinic-nbr-43                 pic x(4).
        10  const-clinic-1-2-nbr-44             pic 99.
        10  const-clinic-nbr-44                 pic x(4).
        10  const-clinic-1-2-nbr-45             pic 99.
        10  const-clinic-nbr-45                 pic x(4).
        10  const-clinic-1-2-nbr-46             pic 99.
        10  const-clinic-nbr-46                 pic x(4).
        10  const-clinic-1-2-nbr-47             pic 99.
        10  const-clinic-nbr-47                 pic x(4).
        10  const-clinic-1-2-nbr-48             pic 99.
        10  const-clinic-nbr-48                 pic x(4).
        10  const-clinic-1-2-nbr-49             pic 99.
        10  const-clinic-nbr-49                 pic x(4).
        10  const-clinic-1-2-nbr-50             pic 99.
        10  const-clinic-nbr-50                 pic x(4).
        10  const-clinic-1-2-nbr-51             pic 99.
        10  const-clinic-nbr-51                 pic x(4).
        10  const-clinic-1-2-nbr-52             pic 99.
        10  const-clinic-nbr-52                 pic x(4).
        10  const-clinic-1-2-nbr-53             pic 99.
        10  const-clinic-nbr-53                 pic x(4).
        10  const-clinic-1-2-nbr-54             pic 99.
        10  const-clinic-nbr-54                 pic x(4).
        10  const-clinic-1-2-nbr-55             pic 99.
        10  const-clinic-nbr-55                 pic x(4).
        10  const-clinic-1-2-nbr-56             pic 99.
        10  const-clinic-nbr-56                 pic x(4).
        10  const-clinic-1-2-nbr-57             pic 99.
        10  const-clinic-nbr-57                 pic x(4).
        10  const-clinic-1-2-nbr-58             pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  48
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/f0)
        10  const-clinic-nbr-58                 pic x(4).
        10  const-clinic-1-2-nbr-59             pic 99.
        10  const-clinic-nbr-59                 pic x(4).
        10  const-clinic-1-2-nbr-60             pic 99.
        10  const-clinic-nbr-60                 pic x(4).
        10  const-clinic-1-2-nbr-61             pic 99.
        10  const-clinic-nbr-61                 pic x(4).
        10  const-clinic-1-2-nbr-62             pic 99.
        10  const-clinic-nbr-62                 pic x(4).
        10  const-clinic-1-2-nbr-63             pic 99.
        10  const-clinic-nbr-63                 pic x(4).

    05  filler                                  pic x(2).
* 2005/01/04 - end

01  error-message-vable.

    05  error-messages.
* #1
        10  filler.
            15  err-warn-msg                    pic x(14)  value spaces.
            15  filler                          pic x(08)  value
                "Batch = ".
            15  err-msg-pract-nbr               pic x(06).
            15  filler                          pic x(01)  value "/".
            15  err-msg-account-id              pic x(08).
            15  filler                          pic x(95)  value spaces.
* #2
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(43)  value
                "**ERROR** - NO SUCH DOCTOR FOUND ON FILE - ".
            15  err-msg-doc-nbr                 pic x(03).
            15  filler                          pic x(72)  value spaces.
* #3
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(61)  value
                "INVALID LOCATION CODE FOR DOCTOR: BATCH CONTAINED LOCATION - ".
            15  err-msg-loc-cd                  pic x(04).
            15  filler                          pic x(53)  value spaces.
* #4
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(54)  value
                "INVALID SPECIALITY CODE: BATCH CONTAINED SPECIALITY - ".
            15  err-msg-batch-spec-cd           pic x(04).
            15  filler                          pic x(60)  value spaces.
* #5
        10 filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(53)  value
                "                         DOCTOR'S  SPECIALTIES ARE - ".
            15  err-msg-doc-spec-cd             pic x(04).
            15  filler                          pic x(03) value " / ".
            15  err-msg-doc-spec-cd-2           pic x(04).
            15  filler                          pic x(03) value " / ".
            15  err-msg-doc-spec-cd-3           pic x(04).
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  49
*                      newu701.cbl                                   )
            15  filler                          pic x(47)  value spaces.
* #6
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(56)  value
                "**ERROR** - INVALID CLINIC ID: BATCH CONTAINED CLINIC - ".
            15  err-msg-clinic-id               pic x(10).
            15  filler                          pic x(52)  value spaces.
* #7
        10  filler                              pic x(132) value
                "**ERROR** - FIRST RECORD FOUND IN FILE WAS NOT A 'B'ATCH RECORD
* #8
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(40)  value
                "INVALID OMA CODE - ACCOUNTING NBR = ".
            15  err-accounting-nbr              pic x(10).
            15  filler                          pic x(68).
* #9
        10  filler                              pic x(132) value
                "              DUPLICATE ACCOUNT ID FOUND IN SUSPENSE (HEADER) F
* #10
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(40)  value
                "INVALID WRITE NEW CLAIMS HDR - 'B' KEY=".
            15  bkey-clmhdr-err-msg             pic x(20)  value spaces.
            15  filler                          pic x(58)  value spaces.
* #11
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(40)  value
                "INVALID WRITE NEW CLAIMS HDR -'P' KEY = ".
            15  pkey-clm-err-msg                pic x(20)  value spaces.
            15  filler                          pic x(58)  value spaces.
* #12
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(54)  value
                "INVALID REFERRING PHYSICIAN: BATCH CONTAINED CLINIC - ".
            15  err-refer-phys-nbr              pic x(6).
            15  filler                          pic x(58).
* #13
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(51)  value
                "INVALID PATIENT OHIP NBR: BATCH CONTAINED CLINIC - ".
            15  err-ohip-no                     pic x(08).
            15  filler                          pic x(59).
* #14
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(51)  value
                "INVALID DIAG CODE: ".
            15  err-diag-code                   pic x(03).
            15  filler                          pic x(64).
* #15
        10  filler.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  50
*                      newu701.cbl                                   )
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(51)  value
                "INVALID I-O-INDICATOR: ".
            15  err-i-o-ind                     pic x(01).
            15  filler                          pic x(66).
* #16
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(92)  value
                "NBR OF HEADER1 RECORDS READ IS NOT =  NBR OF HEADER1 RECORDS FR
            15  err-ctr-h-count                 pic 99999.
            15  filler                          pic x(1)  value "/".
            15  err-trl-h-count                 pic 99999.
            15  filler                          pic x(15).
* #17
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(92)  value
                "NBR OF ITEM RECORDS READ IS NOT =  NBR OF ITEM RECORDS FROM TRA
            15  err-ctr-t-count                 pic 99999.
            15  filler                          pic x(1)  value "/".
            15  err-trl-t-count                 pic 99999.
            15  filler                          pic x(15).
* #18
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(92)  value
                "NBR OF ADDRESS RECORDS IS NOT =  NBR OF ADDRESS RECORDS FROM TR
            15  err-ctr-a-count                 pic 99999.
            15  filler                          pic x(1)  value "/".
            15  err-trl-a-count                 pic 99999.
            15  filler                          pic x(15).
* #19
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(92)  value
                "NBR OF BATCH RECORDS READ IS NOT =  NBR OF BATCH RECORDS FROM T
            15  err-ctr-b-count                 pic 99999.
            15  filler                          pic x(1)  value "/".
            15  err-trl-b-count                 pic 99999.
            15  filler                          pic x(15).
* #20
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(51)  value
                "INVALID AGENT CODE:    ".
            15  err-agent-cd                    pic x(01).
            15  filler                          pic x(66).
* #21
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(20)  value
                "DOCTOR SPECIALITY: ".
            15  err-21-value-1                  pic x(02).
            15  filler                          pic x(27)  value
                "  NOT VALID FOR OHIP CODE: ".
            15  err-21-value-2                  pic x(04).
            15  filler                          pic x(33)  value
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  51
*                      newu701.cbl                                   )
                " RANGE: ".
            15  err-21-value-3                  pic x(02).
            15  filler                          pic x(06)  value
                " THRU ".
            15  err-21-value-4                  pic x(02).
            15  filler                          pic x(22).
* #22
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(10) value
                "OMA CODE: ".
            15  err-22-oma-cd                   pic x(04).
            15  filler                          pic x(14) value
                "  REQUIRES -  ".
            15  err-22-msg                      pic x(90).
* #23
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(51)  value
                "INVALID HOSPITAL NBR: ".
            15  err-hosp-nbr                    pic x(04).
            15  filler                          pic x(63).
* #24
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(45)  value
                "SERVICE NOT WITHIN 6 MONTHS OF SYSTEM DATE:".
* (y2k)
*           15  err-24-service-date             pic x(06).
            15  err-24-service-date             pic x(08).
*           15  filler                          pic x(67).
            15  filler                          pic x(65).
* #25
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(118)  value
                "DIRECT BILL CLAIM MISSING - MSG / AUTO LOGOUT / FEE COMPLEXITY
* #26
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(22)  value
                "INVALID -ADMIT- DATE: ".
* (y2k)
*           15  err-admit-date                  pic x(06).
            15  err-admit-date                  pic x(08).
*           15  filler                          pic x(90).
            15  filler                          pic x(88).
* #27
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(32)  value
                "INVALID INITIAL SERVICE DATE:".
* (y2k)
*           15  err-27-service-date             pic x(06).
            15  err-27-service-date             pic x(08).
*           15  filler                          pic x(80).
            15  filler                          pic x(78).
* #28
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  52
*                      newu701.cbl                                   )
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(42)  value
                "INVALID CONSECUTIVE SERVICES DATES/SVC'S:".
            15  err-additional-servs            pic x(09).
            15  filler                          pic x(67).
* #29
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(25)  value
                "INVALID HEALTH CARE NBR:".
            15  err-health-care-nbr             pic x(10).
            15  filler                          pic x(83).
* #30
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(18)  value
                "INVALID PROVINCE:".
            15  err-province                    pic x(02).
            15  filler                          pic x(98).
* #31
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(27)  value
                "INVALID MANUAL REVIEW: ".
            15  err-manual-review               pic x.
            15  filler                          pic x(90).
* #32
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(54)  value
                "INVALID DEPT NO:  BATCH CONTAINED DEPT NO - ".
            15  err-msg-batch-dept-no           pic x(02).
            15  filler                          pic x(62)  value spaces.
* #33
        10 filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(53)  value
                "                  DOCTOR'S DEPT NO          - ".
            15  err-msg-doc-dept-no             pic x(02).
            15  filler                          pic x(63)  value spaces.
* #34
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(92)  value
                "NBR OF HEADER2 RECORDS READ IS NOT =  NBR OF HEADER2 RECORDS FR
            15  err-ctr-r-count                 pic 99999.
            15  filler                          pic x(1)  value "/".
            15  err-trl-r-count                 pic 99999.
            15  filler                          pic x(15).

* #35
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(53)  value
                "INVALID PROVIDER NO:  BATCH CONTAINED PROVIDER NO - ".
            15  err-msg-batch-prov-nbr          pic x(06).
            15  filler                          pic x(59)  value spaces.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  53
*                      newu701.cbl                                   )
* #36
        10 filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(53)  value
                "                  DOCTOR'S PROVIDER NO      - ".
            15  err-msg-doc-prov-nbr            pic x(06).
            15  filler                          pic x(59)  value spaces.
* #37
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(22)  value
                "INVALID BIRTH DATE:".
* (y2k)
*           15  err-birth-date                  pic x(06).
            15  err-birth-date                  pic x(08).
*           15  filler                          pic x(90).
            15  filler                          pic x(88).
* #38
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(28)  value
                "ZERO NUMBER OF SERVICE".
            15  err-nbr-of-serv                 pic x(4).
            15  filler                          pic x(86).
* #39
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(28)  value
                "ZERO AMOUNT BILLED".
*mf         15  err-fee-billed                  pic x(12).
            15  err-fee-billed                  pic 9(12).
            15  filler                          pic x(78).
* #40
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(48)  value
**              "INVALID SIZE OF OHIP NBR".
                "INVALID SIZE OF HEALTH CARE NBR - Province/Nbr: ".
            15  err-prov                        pic x(2).
            15  filler                          pic x(3)   value
                " / ".
            15  err-ohip-nbr                    pic x(12).
            15  filler                          pic x(53).
* #41 @@ USE
        10  filler                              pic x(132)  value
                "CONSTANTS MSTR REC 'LOCKED' -- INFORM OPERATIONS OF PROBLEM".
* #42  @@ USE
        10  filler                              pic x(132)  value
                "SERIOUS ERROR #10 - UNABLE TO READ CONSTANT MSTR REC #2 ".
* #43
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(53)  value
                "INVALID GROUP NBR: BATCH CONTAINED GROUP NBR - ".
            15  err-msg-group-nbr               pic x(06).
            15  filler                          pic x(59)  value spaces.
* #44
        10  filler.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  54
*                      newu701.cbl                                   )
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(15)  value
                "SERVICE DATE: ".
* (y2k)
*           15  err-44-service-date             pic x(06).
            15  err-44-service-date             pic x(08).
            15  filler                          pic x(27)  value
                "IS PRIOR TO ADMIT DATE:".
* (y2k)
*           15  err-44-admit-date               pic x(06).
            15  err-44-admit-date               pic x(08).
*           15  filler                          pic x(64).
            15  filler                          pic x(60).
* #45
        10  filler                              pic x(132)  value
                "SERIOUS ERROR #11 - UNABLE TO READ CONSTANT MSTR REC #1 ".
* #46
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(27)  value
                "INVALID RELATIONSHIP: ".
            15  err-relationship                pic x.
            15  filler                          pic x(90).
*** S.B.- start.
* #47
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(23)  value
                "   REFERRING DOCTOR: - ".
                15  err-msg-referring-doc               pic x(06).
            15  filler                                  pic x(37)  value
                " AND PROVIDER DOCTOR ARE THE SAME: - ".
            15  err-msg-provider-doc            pic x(06).
            15  filler                          pic x(46)  value spaces.

* #48
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(22)  value
                "      SERVICE DATE: - ".
            15  err-msg-svr-date                pic x(08).
              15  filler                        pic x(32)  value
                    " IS GREATER THAN SYSTEM DATE: - ".
                15  err-msg-sys-date            pic x(08).
            15  filler                          pic x(48)  value spaces.
* #49
        10  filler.
            15  filler                          pic x(10)  value spaces.
            15  filler                          pic x(18) value
                "OMA CODE I/O IND: ".
            15  err-49-oma-cd                   pic x(04).
            15  filler                          pic x(38) value
                " DOES NOT MATCH CLMHDR-2 REC I/O IND: ".
            15  err-49-hdr-cd                   pic x(04).
            15  filler                          pic x(58).

* #50
        10  filler.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  55
*                      newu701.cbl                                   )
            15  filler                          pic x(12)  value spaces.
            15  filler                          pic x(36)  value
                " MISSING DETAIL RECORDS FOR CLAIM: ".
            15  err-no-detail-claim             pic x(08).
            15  filler                          pic x(76)  value spaces.
* #51
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(61)  value
                "INVALID LOCATION CODE: BATCH CONTAINED LOCATION - ".
            15  err-51-loc-cd                   pic x(04).
            15  filler                          pic x(53).
* #52
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(35)  value
                "Incoming fee not = RMA priced fee  ".
            15  err-52-incoming-fee             pic zzz9.99.
            15  filler                          pic x(3)  value " / ".
            15  err-52-ohip-fee                 pic zzz9.99.
            15  filler                          pic x(66).

* #53
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(40)  value
                "Incoming I/O ind not = RMA I/O ind ".
            15  err-53-incoming-i-o-ind         pic x.
            15  filler                          pic x(3)  value " / ".
            15  err-53-i-o-ind                  pic x.
            15  filler                          pic x(73).
* 2002/06/12 - MC - add error 54
* #54
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(40)  value
                "Require facility number with premium cd ".
            15  filler                          pic x(3)  value " / ".
            15  err-54-prem-code                pic x(4).
            15  filler                          pic x(71).
* 2002/06/12 - end

* 2002/08/21 - MC - add error 55
* #55
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(40)  value
                "Wrong hospital number with premium cd ".
            15  filler                          pic x(3)  value " / ".
            15  err-55-hosp-code                pic x(4).
            15  filler                          pic x(3)  value " / ".
            15  err-55-prem-code                pic x(4).
            15  filler                          pic x(64).
* 2002/06/12 - end

* 2003/06/11 - MC - add error 56
* #56
        10  filler.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  56
*                      newu701.cbl                                   )
            15  filler                          pic x(14)  value spaces.
* 2004/01/20 - MC
*            15  filler                          pic x(40)  value
*               "Wrong location code - must end with 112".
            15  filler                          pic x(60)  value
* 2004/09/27 - MC
*                "Wrong location code - must end with 112/153/400/250/422".
                "Wrong location code - must end with 112/153/400/250/422/401".
* 2004/09/27 - end

* 2004/01/20 - end
            15  filler                          pic x(3)  value " / ".
            15  err-56-loc-code                 pic x(4).
            15  filler                          pic x(3)  value " / ".
            15  err-56-prem-code                pic x(4).
* 2004/01/20 - MC
*            15  filler                          pic x(64).
            15  filler                          pic x(44).
* 2004/01/20 - end

* 2003/06/11 - end

* 2003/10/22 - MC - add error 57
* #57
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(56)  value
                "**ERROR** - INVALID CLINIC NBR FOR THE DOCTOR -         ".
            15  err-msg-doc-clinic              pic 9(2).
            15  filler                          pic x(60)  value spaces.
* 2003/10/22 - end

* 2004/04/07 - MC - add error 58
* #58
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(15)  value
                "ADMIT DATE: ".
            15  err-58-admit-date               pic x(08).
            15  filler                          pic x(27)  value
                "  IS PRIOR TO BIRTH DATE:".
            15  err-58-birth-date               pic x(08).
            15  filler                          pic x(60).
* 2004/04/07 - end

* 2005/03/03 - MC - add error 59 and 60
* #59
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(17)  value
                "Doc Specialty = ".
            15  err-59-doc-spec                 pic 99.
            15  filler                          pic x(17)  value
                ", Birth date =  ".
            15  err-59-birth-date               pic x(08).
            15  filler                          pic x(27)  value
                "  and age must be >= 60".
            15  filler                          pic x(47).
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  57
*                      newu701.cbl                                   )

* #60
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(17)  value
                "Doc Specialty = ".
            15  err-60-doc-spec                 pic 99.
            15  filler                          pic x(17)  value
                ", Birth date =  ".
            15  err-60-birth-date               pic x(08).
            15  filler                          pic x(27)  value
                "  and age must be >= 75".
            15  filler                          pic x(47).
* 2005/03/03 - end

* 2005/05/04 - MC - add error 61 and 62
* #61
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(17)  value
                "Service Date  = ".
            15  err-61-serv-date                pic x(08).
            15  filler                          pic x(17)  value
                ", Birth date =  ".
            15  err-61-birth-date               pic x(08).
            15  filler                          pic x(68) value
                "  and service date must be > birth date".

* #62
        10  filler.
            15  filler                          pic x(14)  value spaces.
            15  filler                          pic x(17)  value
                "Location code = ".
            15  err-62-loc-code                 pic x(4).
            15  filler                          pic x(17)  value
                ", clinic nbr = ".
            15  err-62-clinic-nbr               pic 99.
            15  filler                          pic x(78)  value
                "  and wrong location for clinic 61 - 65".
* 2005/05/04 - end
    05  error-messages-r redefines error-messages.
        10  err-msg                             pic x(132)
                    occurs 62 times.

01  err-ind                                     pic 99  value zero.
01  err-msg-comment                             pic x(132).
01  save-prt-line                               pic x(132).


01  e1-error-line.

    05  e1-error-word                           pic x(11)   value
                        "*** ERROR- ".
    05  e1-error-msg                            pic x(52).
    05  e1-error-key                            pic x(17).



* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  58
*                      newu701.cbl                                   )
screen section.

01  scr-title.
    05  blank screen.
    05  line 03 col 10 value "Price claims/create Priced File/Upload to Suspense

01 scr-current-system-date.
    05  line 05 col 05 value "Current System Date".
    05  line 05 col 70 pic 99999999 using sys-date.

01 scr-claim-source-default-reply.
    05  line 07 col 05 value "Enter Claim SOURCE - 'W'eb / 'D'iskette / 'P'rice
    05  line 07 col 70 pic x(01) using flag-claim-source auto.

01 scr-update-suspense-reply.
    05  line 11 col 05 value "Do you want to upload claims to Suspense- [Y]/N ?"
    05  line 11 col 70 pic x(01) using flag-update-suspense auto.

01 scr-create-priced-file-reply.
    05  line 12 col 05 value "Do you want to create Priced File         [Y]/N ?"
    05  line 12 col 70 pic x(01) using flag-create-priced-file auto.

01 scr-retain-prices-reply.
    05  line 14 col 05 value "Do you want to RETAIN Incoming prices- [Y]/N ?".
    05  line 14 col 70 pic x(01) using flag-retain-prices auto.

01 scr-agent-default-reply.
    05  line 16 col 05 value "Do you want to default 'BLANK' AGENT Codes to 'OHI
    05  line 16 col 70 pic x(01) using ws-agent-default-reply auto.

01  scr-doc-nbr.
    05  line 15 col 05 value "Enter the DOCTOR NBR or press 'newline' to default
*!    05  line 15 col 66 pic 9(3) using ws-doc-nbr auto.
    05  line 15 col 66 pic x(3) using ws-doc-nbr auto.

01  scr-clinic-nbr.
    05  line 17 col 05 value "Enter the CLINIC NBR or press 'newline' to default
    05  line 17 col 68 pic 9(2) using ws-default-clinic-nbr auto.

* ('dummy' field added to allow compile of common code shared between
*  this pgm and d001)
01  scr-last-claim-lit.
    05                          line 03 col 65 value 'Nbr of Svc'.

01  scr-in-progress-message.
    05  line 19 col 20 value "PROGRAM  NEWU701  NOW IN PROGRESS".

01 file-status-display.
    05  line 24 col 56  "FILE STATUS = ".
    05  line 24 col 70  pic x(11) from status-file      bell blink.
*
01  scr-closing-screen.
    05  blank screen.
    05  line 21 col 01  value "PROGRAM NEWU701 ENDING".
* (y2k - auto fix)
*   05  line 21 col 40  pic 99  from sys-yy.
    05  line 21 col 40  pic 9(4)  from sys-yy.
    05  line 21 col 44  value "/".
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  59
*                      newu701.cbl                                   )
    05  line 21 col 45  pic 99  from sys-mm.
    05  line 21 col 47  value "/".
    05  line 21 col 48  pic 99  from sys-dd.
    05  line 21 col 52  pic 99  from sys-hrs.
    05  line 21 col 54  value ":".
    05  line 21 col 55  pic 99  from sys-min.
    05  line 23 col 10  value "AUDIT REPORT IS IN FILE - RU701".

procedure division.
declaratives.

err-input-diskette-file section.
    use after standard error procedure on unpriced-claims-file.
err-input-diskette.
    stop "ERROR IN ACCESSING: dISKETTE INPUT FILE".
    move status-unpriced-claims         to status-file.
    display file-status-display.
*    stop " ".
    move status-cobol-unpriced-claims   to status-file.
    display file-status-display.
    stop run.

err-suspend-hdr-file section.
    use after standard error procedure on suspend-hdr.
err-suspend-hdr.
*   (IF DUPLICATE KEY ERROR, THEN SET FLAG TO SKIP PROCESSING OF THIS HEADER)
*   (NOTE: 90/01/14 B.E. LOGIC WILL BYPASS WRITING OF HEADER BUT HAS BEEN MODIFI
*          SO THAT THE DETAILS FOR THIS HEADER WILL BE PROCESSED AND THEREFORE
*          WILL BECOME DETAILS FOR THE HEADER ALREADY ON FILE. MESSAGE ON WARNIN
*          REPORT SHOULD ALERT STAFF TO REVIEW CLAIM TO CONFIRM THAT THESE
*          HEADERS ARE FOR SAME PATIENT.  THE ORIGINAL CLAIM HEADER ON FILE WILL
*          HAVE IT'S CLAIM STATUS SET TO "CANCEL (IE.'Y') SO THAT IT WON'T
*          BE PROCESSED UNLESS UNCANCELLED.  IT WILL ALSO APPEAR ON THE CANCELLE
*          SUSPENDED CLAIMS REPORTS)

    if   status-suspend-hdr       = "7013"
      or status-cobol-suspend-hdr = "22"
    then
        go to err-suspend-hdr-50.
*   endif

    stop "ERROR IN ACCESSING: SUSPEND-HEADER"
    move status-suspend-hdr     to status-file
    display file-status-display
*    stop " "
    move status-cobol-suspend-hdr       to status-file
    display file-status-display
    stop run.

err-suspend-hdr-50.
*   (SET FLAG TO INDICATE THAT HEADER IS BEING SKIPPED DUE TO DUPLICATE
*    KEY BUT THAT DETAILS ARE TO BE WRITTEN TO DISK)
*mf    move "D"                            to      skip-processing-this-acct-id-
    move "D"                            to      skip-process-this-acct-id-flag.
    move suspend-hdr-rec                to      hold-suspend-hdr-rec.
*   (READ ORIGINAL HDR REC)
    read suspend-hdr
        invalid key
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  60
*                      newu701.cbl                                   )
          display  "SERIOUS IMPOSSIBLE ERROR #1 SUSPEND HDR FILE - KEY IS = ",su

*   (UPDATE ORIGINAL HEADER'S STATUS TO "CANCELLED"
    move "Y"                            to      clmhdr-status.

*   (REWRITE UPDATED RECORD)
    rewrite suspend-hdr-rec
        invalid key
           display "SERIOUS IMPOSSIBLE ERROR #2 SUSPEND HDR FILE - KEY IS = ",su
           stop run.

*   (RESTORE THE SUSPEND HDR RECORD DATA)
    move hold-suspend-hdr-rec           to      suspend-hdr-rec.

err-suspend-hdr-99-exit.
    exit.



err-suspend-dtl-file section.
    use after standard error procedure on suspend-dtl.
err-suspend-dtl.
    stop "ERROR IN ACCESSING: SUSPEND-DETAIL".
    move status-suspend-dtl             to status-file.
    display file-status-display.
*    stop " ".
    move status-cobol-suspend-dtl       to status-file.
    display file-status-display.
    stop run.

err-suspend-addr-file section.
    use after standard error procedure on suspend-address.
err-suspend-addr.
    stop "ERROR IN ACCESSING: SUSPEND-ADDRESS".
    move status-suspend-addr            to status-file.
    display file-status-display.
*    stop " ".
    move status-cobol-suspend-addr      to status-file.
    display file-status-display.
    stop run.

err-doc-mstr-file section.
    use after standard error procedure on doc-mstr.
err-doc-mstr.
    stop "ERROR IN ACCESSING: DOCTOR MASTER".
    move status-doc-mstr                to status-file.
    display file-status-display.
    stop run.


err-diagnistics-mstr-file section.
    use after standard error procedure on diag-mstr.
err-diagnostics-mstr.
    stop "ERROR IN ACCESSING: DIAGNOSTIC CODES MASTER".
    move status-diag-mstr               to status-file.
    display file-status-display.
    stop run.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  61
*                      newu701.cbl                                   )
err-constants-mstr-file section.
    use after standard error procedure on iconst-mstr.

err-constants-mstr.
*   (IF 'RECORD LOCKED' PRINT WARNING, SET FLAG SO THAT 'READ' WILL LOOP UNTIL R
    if status-iconst-mstr = "7015"
    then
*       (ERROR - WRITE REPORT AND SKIP BATCH)
        move "Y"                        to      fatal-error-flag
        move 2                          to      ws-carriage-ctrl
        move 41                         to      err-ind
        move ws-error-literal           to      err-warn-msg
        move batch-group-nbr            to      err-msg-clinic-id
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
    else
        move status-iconst-mstr         to      status-file
        display  file-status-display
        display "ERROR IN ACCESSING CONSTANTS MASTER"
        stop run.
*   endif.


err-report-file section.
    use after standard error procedure on report-file.
err-report.
    stop "ERROR IN WRITING TO AUDIT REPORT: RU701".
    move status-report                  to status-file.
    display file-status-display.
    stop run.

end declaratives.

mainline section.

    perform aa0-initialization          thru aa0-99-exit.
    perform ab0-processing              thru ab0-99-exit
            until   eof-input-file
                 or fatal-error.
    perform az0-finalization            thru az0-99-exit.
    stop run.

aa0-initialization.

    display scr-title.

    accept sys-date             from date.
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.

*   (when testing the 'master claims batch' allow operator to override
*    system date)
    display scr-current-system-date.
    accept  scr-current-system-date.

    move sys-mm                 to   run-mm.
    move sys-dd                 to   run-dd.
    move sys-yy                 to   run-yy.
    move run-date               to   l1-run-date.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  62
*                      newu701.cbl                                   )
    accept sys-time             from time.
    move sys-hrs                to   run-hrs.
    move sys-min                to   run-min.
    move sys-sec                to   run-sec.

*!    move 0                    to   ws-doc-nbr.
    move spaces                 to   ws-doc-nbr.
*   MOVE 2215                   TO   WS-DEFAULT-CLINIC-NBR.
    move 22                     to   ws-default-clinic-nbr.


*   (predisplay all options on screen)
    display scr-claim-source-default-reply.
    display scr-retain-prices-reply.
    display scr-update-suspense-reply.
    display scr-create-priced-file-reply.
    display scr-agent-default-reply.

aa0-05-default-claim-source.
    display scr-claim-source-default-reply.
    accept  scr-claim-source-default-reply.

    if   web-claim
      or diskette-claim
      or price-only-claim
    then
        next sentence
    else
        go to aa0-05-default-claim-source.
*   endif

aa0-07-retain-prices.
*   (prices are normally overridden, even for diskettes, however some
*    diskettes don't send a "complete" claim under 1 accounting number
*    (eg. PNP allows only 4 details per accounting number) and therefore
*   this program can't reprice the claim. This flag allows the operator
*   to turn on/off the repricing option. Web claim are automatically
*   "repriced")

*   CASE
    if web-claim
    then
        move "N"                        to flag-retain-prices
        go to aa0-09-update-suspense
    else
    if price-only-claim
    then
        move "N"                        to flag-retain-prices
        go to aa0-09-update-suspense.
*   ENDCASE

*   (default for diskettes is to retain prices)
    move "Y"                            to flag-retain-prices.
    accept  scr-retain-prices-reply.
    if    retain-incoming-prices
       or override-with-rma-prices
    then
        next sentence
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  63
*                      newu701.cbl                                   )
    else
        go to aa0-07-retain-prices.
*   endif

aa0-09-update-suspense.
    display scr-retain-prices-reply.

*   CASE
    if web-claim
    then
        move "Y"                        to flag-update-suspense
        go to aa0-10-create-priced-file
    else
    if price-only-claim
    then
        move "N"                        to flag-update-suspense
        go to aa0-10-create-priced-file.
*   ENDCASE

*   (default for diskettes is to retain prices)
    move "Y"                            to flag-update-suspense.
    accept  scr-update-suspense-reply.
    if    update-suspense
       or dont-update-suspense
    then
        next sentence
    else
        go to aa0-09-update-suspense.
*   endif

aa0-10-create-priced-file.
    display scr-update-suspense-reply.

*   CASE
    if web-claim
    then
        move "Y"                        to flag-create-priced-file
        go to aa0-20-default-agent
    else
    if price-only-claim
    then
        move "Y"                        to flag-create-priced-file
        go to aa0-20-default-agent.
*   ENDCASE

*   (default for diskettes is to retain prices)
    move "Y"                            to flag-create-priced-file
    accept  scr-create-priced-file-reply.
    if    create-priced-file
       or dont-create-priced-file
    then
        next sentence
    else
        go to aa0-10-create-priced-file.
*   endif


aa0-20-default-agent.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  64
*                      newu701.cbl                                   )
    display scr-create-priced-file-reply.

*   (00/mar/27 B.E. removed option - no longer required)
    move "Y"                    to  ws-agent-default-reply.
    display scr-agent-default-reply.
*    accept  scr-agent-default-reply.

    if ws-agent-default-reply = "Y" or "N"
    then
        next sentence
    else
        go to aa0-20-default-agent.
*   endif

*   (00/mar/27 B.E. removed option - no longer required)
    display scr-doc-nbr.
*    accept  scr-doc-nbr.

*   (00/mar/27 B.E. removed option - no longer required)
    display scr-clinic-nbr.
*    accept  scr-clinic-nbr.

    display scr-in-progress-message.

    move spaces to suspend-hdr-rec
                   suspend-dtl-rec
                   suspend-address-rec.

    move zero   to suspend-dtl-occur
                   ws-temp
                   counters.

    open input  unpriced-claims-file
* 2000/03/20 - MC - include locations mstr
                loc-mstr
                doc-mstr
                diag-mstr
                oma-fee-mstr
                iconst-mstr.

    open i-o    suspend-hdr
                suspend-dtl
* 2005/05/09 - add description file
*               suspend-desc
* 2005/05/09 - end
                suspend-address.

*    expunge     report-file
*                priced-claims-file.
    open output report-file
                priced-claims-file.

    move spaces                         to      hold-oma-recs.
    perform aa1-init-hold-oma-rec      thru    aa1-99-exit
                varying i
                from    1
                by      1
                until   i  > ss-max-nbr-oma-det-rec-allow
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  65
*                      newu701.cbl                                   )
*               until   i  > 40.

*   (OBTAIN CONSTANT'S MSTR RECORD THAT CONTAINS LIST OF VALID CLINIC NBR)
    move 1                          to      iconst-clinic-nbr-1-2.
    perform uj1-read-isam-const-mstr thru   uj1-99-exit.

*   (CHECK FOR ERRORS - SHUT DOWN)
    if fatal-error
    then
*       (ERROR - WRITE REPORT AND SKIP BATCH)
        move "Y"                        to      fatal-error-flag
        move 2                          to      ws-carriage-ctrl
        move 45                         to      err-ind
        move ws-error-literal           to      err-warn-msg
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
        go to aa0-99-exit
    else
*       (MOVE CONSTANT'S MSTR VALUES INTO HOLD AREA TO BE USED LATER TO VERIFY C
        move constants-mstr-rec-2       to      constants-mstr-rec-1.
*   endif

*   (OBTAIN PRICING CONSTANT'S VALUES FROM REC 2 OF CONSTANTS MASTER)
    move 2                          to      iconst-clinic-nbr-1-2.
    perform uj1-read-isam-const-mstr thru   uj1-99-exit.

*   (CHECK FOR ERRORS - SHUT DOWN)
    if fatal-error
    then
*       (ERROR - WRITE REPORT AND SKIP BATCH)
        move "Y"                        to      fatal-error-flag
        move 2                          to      ws-carriage-ctrl
        move 42                         to      err-ind
        move ws-error-literal           to      err-warn-msg
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
        go to aa0-99-exit.
*   endif

    perform ta0-read-diskette                   thru ta0-99-exit.

*   (FIRST RECORD MUST BE "B"ATCH RECORD)
    if b-record
    then
        add 1                           to      ctr-b-recs-read
*       MOVE DISKETTE-INPUT-REC-DATA    TO      BATCH-REC
        perform ea0-proc-rec-type-batch thru    ea0-99-exit
*       (CHECK FOR ERRORS - SHUT DOWN)
        if fatal-error
        then
           go to aa0-99-exit
        else
*           (READ RECORD AFTER 'B' RECORD)
            perform ta0-read-diskette   thru    ta0-99-exit
*       endif
    else
*       (ERROR - FIRST RECORD NOT "B"ATCH RECORD)
        move "Y"                        to      fatal-error-flag
        move 2                          to      ws-carriage-ctrl
        move 7                          to      err-ind
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  66
*                      newu701.cbl                                   )
        move ws-error-literal           to      err-warn-msg
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       GO TO AA0-99-EXIT.
*   endif
*   (INITIALIZE SUBSCRIPT FOR PRICING HOLD AREA)
    move 0                              to      ss-clmdtl-oma.
*   (00/aug/13 B.E. - reset special add-on code flag)
    move "N"                            to      ws-special-add-on-cd-entered.

    move carriage-return                to      diskout-cr.
    move line-feed                      to      diskout-lf.

aa0-99-exit.
    exit.

aa1-init-hold-oma-rec.

    move zeros          to  hold-sv-nbr-serv(i).
    move zeros          to  hold-sv-date-yy(i).
    move zeros          to  hold-sv-date-mm(i).
    move zeros          to  hold-sv-date-dd(i).
    move zeros          to  hold-icc-grp(i).
    move zeros          to  hold-fee-incoming(i).

*   (00/aug/31 B.E.)
    move zeros          to  hold-sv-nbr-serv-incoming(i).

*   (00/aug/10 B.E.)
    move zeros          to  hold-ss-curr-prev(i).

    move zeros          to  hold-fee-oma(i).
    move zeros          to  hold-fee-ohip(i).
    move zeros          to  hold-priced-tech(i).
    move zeros          to  hold-basic-tech(i).
    move zeros          to  hold-basic-prof(i).
    move zeros          to  hold-basic-fee(i).
    move zeroes         to  hold-flag-sec(i).
    move zeroes         to  hold-flag-grp(i).
    move zeros          to  hold-diag-cd(i).
    move zeros          to  hold-line-no(i).

    perform aa2-init-oma-fees   thru aa2-99-exit
        varying ss1
        from    1
         by     1
        until   ss1 > 2.

    perform aa3-init-sv-nbr  thru aa3-99-exit
        varying ss1
        from    1
         by     1
        until   ss1 > 3.

aa1-99-exit.
    exit.


* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  67
*                      newu701.cbl                                   )
aa2-init-oma-fees.

    move zeroes to  hold-oma-fee-1(i,ss1).
    move zeroes to  hold-oma-fee-2(i,ss1).
    move zeroes to  hold-oma-fee-anae(i,ss1).
    move zeroes to  hold-oma-fee-asst(i,ss1).

aa2-99-exit.
    exit.

aa3-init-sv-nbr.

    move zeroes         to hold-sv-nbr(i,ss1).

aa3-99-exit.
    exit.





ab0-processing.

    if b-record
    then
        add 1                                   to      ctr-b-recs-read
        perform ea0-proc-rec-type-batch         thru    ea0-99-exit
    else
    if h-record
    then
        add 1                                   to      ctr-h-recs-read
        perform fa0-proc-rec-type-header1       thru    fa0-99-exit
    else
    if r-record
    then
        add 1                                   to      ctr-r-recs-read
        move 1                                  to      ctr-hdr2-rec
        perform ga0-proc-rec-type-header2       thru    ga0-99-exit
    else
    if t-record
    then
        add 1                                   to      ctr-t-recs-read
        perform ha0-proc-rec-type-detail        thru    ha0-99-exit
    else
    if a-record
    then
        add 1                                   to      ctr-a-recs-read
        move 1                                  to      ctr-addr-rec
        perform ia0-proc-rec-type-address       thru    ia0-99-exit
    else
    if e-record
    then
        add 1                                   to      ctr-e-recs-read
        perform ka0-proc-rec-type-trailer       thru    ka0-99-exit.
*   endif

*   (IF ERROR FOUND PROCESSING THIS RECORD, SKIP PROCESSING ANY DTL/ADDR RECS TH
*    BELONG TO SAME ACCOUNT ID:
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  68
*                      newu701.cbl                                   )
*    -- SKIP ALL INTERVEENING DETAIL AND ADDRESS RECORDS UNTIL ANOTHER HEADER (H
*    RECORD OR TRAILER (E) RECORD IS FOUND OR END OF INPUT FILE)
    if skip-processing-this-acct-id
    then
        move spaces                             to      unpriced-claims-record
        perform ta0-read-diskette               thru    ta0-99-exit
            until  b-record
*                                           OR "E")
                 or eof-input-file
*       MOVE "N"                                TO      SKIP-PROCESSING-THIS-ACC
*       GO TO AB0-99-EXIT
    else
        if not eof-input-file
             perform ta0-read-diskette               thru    ta0-99-exit.
*       endif
*   endif

ab0-99-exit.
    exit.
az0-finalization.

   close unpriced-claims-file
         priced-claims-file
         suspend-hdr
         suspend-dtl
         suspend-address
* 2005/05/09 - add description file
*        suspend-desc
* 2005/05/09 - end
         doc-mstr
*2000/03/20 - MC - include locations mstr
         loc-mstr
         oma-fee-mstr
         diag-mstr
         iconst-mstr
         report-file.

az0-99-exit.
    exit.

copy "db0_mod10_check_digit.rtn".
db0-mod10-check-digit.

    add  ws-chk-nbr-2
         ws-chk-nbr-4
         ws-chk-nbr-6                   giving ws-temp.

    add  ws-chk-nbr-1
         ws-chk-nbr-1                   giving ws-temp-2.
    add  ws-temp-2a
         ws-temp-2b                     to ws-temp.

    add  ws-chk-nbr-3
         ws-chk-nbr-3                   giving ws-temp-2.
    add  ws-temp-2a
         ws-temp-2b                     to ws-temp.

    add  ws-chk-nbr-5
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  69
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/db)
         ws-chk-nbr-5                   giving ws-temp-2.
    add  ws-temp-2a
         ws-temp-2b                     to ws-temp.

    add  ws-chk-nbr-7
         ws-chk-nbr-7                   giving ws-temp-2.
    add  ws-temp-2a
         ws-temp-2b                     to ws-temp.

    divide   ws-temp    by  10          giving ws-temp-1.

    multiply ws-temp-1  by  10          giving ws-temp-1.

    subtract ws-temp-1                  from ws-temp.

    subtract ws-temp                    from 10
                                        giving ws-temp.

    if        ws-temp      = ws-chk-nbr-8
      or (    ws-temp      = 10
          and ws-chk-nbr-8 =  0 )
    then
        move "y"                        to flag
    else
        move "n"                        to flag.

db0-99-exit.
    exit.


copy "db0a_mod10_check_digit_10.rtn".
db0a-mod10-check-digit-10.

    add  ws-chk-nbr-2-10
         ws-chk-nbr-4-10
         ws-chk-nbr-6-10
         ws-chk-nbr-8-10                giving ws-temp-10.

    add  ws-chk-nbr-1-10
         ws-chk-nbr-1-10                giving ws-temp-2-10.
    add  ws-temp-2a-10
         ws-temp-2b-10                  to ws-temp-10.

    add  ws-chk-nbr-3-10
         ws-chk-nbr-3-10                giving ws-temp-2-10.
    add  ws-temp-2a-10
         ws-temp-2b-10                  to ws-temp-10.

    add  ws-chk-nbr-5-10
         ws-chk-nbr-5-10                giving ws-temp-2-10.
    add  ws-temp-2a-10
         ws-temp-2b-10                  to ws-temp-10.

    add  ws-chk-nbr-7-10
         ws-chk-nbr-7-10                giving ws-temp-2-10.
    add  ws-temp-2a-10
         ws-temp-2b-10                  to ws-temp-10.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  70
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/db)
    add  ws-chk-nbr-9-10
         ws-chk-nbr-9-10                giving ws-temp-2-10.
    add  ws-temp-2a-10
         ws-temp-2b-10                  to ws-temp-10.

    divide   ws-temp-10 by  10          giving ws-temp-1-10.

    multiply ws-temp-1-10 by 10         giving ws-temp-1-10.

    subtract ws-temp-1-10               from ws-temp-10.

    subtract ws-temp-10                 from 10
                                        giving ws-temp-10.

    if        ws-temp-10   = ws-chk-nbr-10-10
      or (    ws-temp-10   = 10
          and ws-chk-nbr-10-10 =  0 )
    then
        move "Y"                        to flag
    else
        move "N"                        to flag.

db0a-99-exit.
    exit.


copy "dc0_mod10_check_digit_alt.rtn".
dc0-mod10-check-digit-for-1-2.
* 00/dec/06 B.E. corrected bug whereby lowercase y/n were used instead of upper
* 01/feb/06 B.E. removed this code - force acceptance of all numbers.

    go to dc0-98-exit.

    move 0                              to ws-temp
                                           ws-temp-1
                                           ws-temp-2.

    add  ws-chk-nbr-2
         ws-chk-nbr-4
         ws-chk-nbr-6                   giving ws-temp.

    add  ws-chk-nbr-1
         ws-chk-nbr-1                   giving ws-temp-2.
    add  ws-temp-2a                     to ws-temp-1.
    add  ws-temp-2b                     to ws-temp.

    add  ws-chk-nbr-3
         ws-chk-nbr-3                   giving ws-temp-2.
    add  ws-temp-2a                     to ws-temp-1.
    add  ws-temp-2b                     to ws-temp.

    add  ws-chk-nbr-5
         ws-chk-nbr-5                   giving ws-temp-2.
    add  ws-temp-2a                     to ws-temp-1.
    add  ws-temp-2b                     to ws-temp.

    add  ws-chk-nbr-7
         ws-chk-nbr-7                   giving ws-temp-2.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  71
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/dc)
    add  ws-temp-2a                     to ws-temp-1.
    add  ws-temp-2b                     to ws-temp.

    move ws-temp                        to ws-temp-2.
    add  ws-temp-2b                     to ws-temp-1.

    subtract ws-temp-1                  from 10
                                        giving ws-temp.

    if        ws-temp      = ws-chk-nbr-8
    then
        move "Y"                        to flag
    else
        move "N"                        to flag.
*   endif

dc0-98-exit.
    move "Y"                            to flag.

dc0-99-exit.
    exit.



ea0-proc-rec-type-batch.

*   (processing a new BATCH. If there were detail records in hold area
*    from the previous claim header rec then area process them - ie. price
*    them and write them out)
    perform xx0-process-hold-dtls       thru xx0-99-exit.

*   (RE-SET TOTALS FOR THIS BATCH - NOTE THAT THIS ZEROING WILL ALSO
*    WIPE OUT THE COUNTER OF THE "B"ATCH RECORD READ THAT IS BEING
*    PROCESSED - THUS SET APPROPRIATE COUNTERS TO 1)
    move zero                           to      counters.
    move 1                              to      ctr-b-recs-read
                                                ctr-recs-read.
*    MOVE DISKETTE-INPUT-REC-DATA       TO      BATCH-REC.
    move unpriced-moh-code               to batch-dist-cd.
    move unpriced-bathdr-batch-nbr       to batch-identifier.
    move unpriced-bathdr-fac-no          to batch-group-nbr.
    move unpriced-bathdr-prov-ohip-no    to batch-provider-nbr.
    move unpriced-bathdr-spec-cd         to batch-speciality.
    move zero                           to batch-pay-type.

*2002/04/24 - MC
*2002/05/03 - MC
*    move unpriced-payroll-flag                 to ws-default-payroll-flag.
     if unpriced-bathdr-clinic-1-2 = 85
     then
        move "B"                        to ws-default-payroll-flag
     else
        move "A"                        to ws-default-payroll-flag.
*   endif
*2002/05/03 - end
*2002/04/24  -  end

    if unpriced-default-batch-loc not = " "
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  72
*                      newu701.cbl                                   )
    then
       move unpriced-default-batch-loc  to ws-default-batch-location
    else
       move spaces                              to ws-default-batch-location.
*   endif

    if unpriced-default-batch-i-o-ind not = " "
    then
       move unpriced-default-batch-i-o-ind      to ws-default-batch-i-o-ind
    else
       move spaces                              to ws-default-batch-i-o-ind.
*   endif

    perform ea10-determine-clinic-nbr   thru    ea10-99-exit.
*   (check if error - shut down)
    if fatal-error
    then
        go to ea0-99-exit.
*   endif

*   (read docter master by doc nbr)
*   MOVE BATCH-PROVIDER-NBR             TO      DOC-PRACT-NBR.
    move unpriced-bathdr-doc-nbr         to      doc-nbr.
    perform tb0-read-doc                thru    tb0-99-exit.
    if doc-found
    then
        perform ea11-check-doctor-speciality    thru    ea11-99-exit
        perform ea12-check-dept-no              thru    ea12-99-exit
        perform ea13-check-provider-nbr         thru    ea13-99-exit
* 2003/10/22 - MC - check doctor's clinic
        perform ea14-check-doctor-clinic        thru    ea14-99-exit
* 2003/10/22 - end
    else
*       (error - write report and skip batch)
        move "Y"                        to      fatal-error-flag
        move 2                          to      ws-carriage-ctrl
        move 2                          to      err-ind
        move ws-error-literal           to      err-warn-msg
        move unpriced-bathdr-doc-nbr     to      err-msg-doc-nbr
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       GO TO EA0-99-EXIT.
*   endif

ea0-99-exit.
    exit.


ea10-determine-clinic-nbr.

    move "N"                            to flag-clinic.

    perform ea10a-search-clinic-tbl     thru ea10a-99-exit
        varying sub
        from   1
        by     1
        until   sub > const-max-nbr-clinics
             or clinic-found.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  73
*                      newu701.cbl                                   )

*   (diskettes from non-web sites don't all have the clinic in
*    the submission file - therefore if the clinic is zero
*    don't give an error but allow the operator to have specified
*    a clinic)
    if    clinic-not-found
* 2003/10/22 - MC - the size has changed from 4 to 2
*      and ws-default-clinic-nbr         = 0000
      and ws-default-clinic-nbr         = 00
* 2003/10/22 - end
    then
*       (error - clinic on diskette is bad and no override
*        default clinic was specified by the operator)
        move "Y"                        to      fatal-error-flag
        move 2                          to      ws-carriage-ctrl
        move 6                          to      err-ind
        move ws-error-literal           to      err-warn-msg
        move batch-group-nbr            to      err-msg-clinic-id
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
    else
        if    clinic-not-found
* 2003/10/22 - MC - the size has changed from 4 to 2
*          and ws-default-clinic-nbr     not = 0000
          and ws-default-clinic-nbr     not = 00
* 2003/10/22 - end
        then
*           (clinic is bad but override default clinic was specified)
            move ws-default-clinic-nbr  to      unpriced-bathdr-clinic-1-2
            move ws-default-clinic-nbr  to      bt-clinic-nbr-1-2
            move ws-default-clinic-nbr  to      batch-group-nbr.
*        endif
*   endif

ea10-99-exit.
    exit.



ea10a-search-clinic-tbl.
*   (97/sep/25 b.e. logic changed for web site file)
*   IF BATCH-GROUP-NBR           = CONST-CLINIC-NBR-1-2 (SUB)
    if unpriced-bathdr-clinic-1-2 = const-clinic-nbr-1-2 (sub)
    then
         move const-clinic-nbr-1-2 (sub) to bt-clinic-nbr-1-2
         move const-clinic-nbr     (sub) to batch-group-nbr
         move 'Y'                        to flag-clinic.
*   endif

ea10a-99-exit.
    exit.


ea11-check-doctor-speciality.

    if    batch-speciality not = doc-spec-cd
      and batch-speciality not = doc-spec-cd-2
      and batch-speciality not = doc-spec-cd-3
      and not price-only-claim
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  74
*                      newu701.cbl                                   )
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 4                          to      err-ind
        move batch-speciality           to      err-msg-batch-spec-cd
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 5                          to      err-ind
        move doc-spec-cd                to      err-msg-doc-spec-cd
        move doc-spec-cd-2              to      err-msg-doc-spec-cd-2
        move doc-spec-cd-3              to      err-msg-doc-spec-cd-3
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.
*   endif


ea11-99-exit.
    exit.


ea12-check-dept-no.

    if    unpriced-bathdr-dept  not = doc-dept
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 32                         to      err-ind
        move unpriced-bathdr-dept        to      err-msg-batch-dept-no
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 33                         to      err-ind
        move doc-dept                   to      err-msg-doc-dept-no
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.
*   endif

ea12-99-exit.
    exit.


ea13-check-provider-nbr.

    if    unpriced-bathdr-prov-ohip-no   not = doc-pract-nbr
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 35                         to      err-ind
        move unpriced-bathdr-prov-ohip-no to     err-msg-batch-prov-nbr
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 36                         to      err-ind
        move doc-pract-nbr              to      err-msg-doc-prov-nbr
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.
*   endif

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  75
*                      newu701.cbl                                   )
ea13-99-exit.
    exit.

* 2003/10/22 - MC - add this new subroutine
ea14-check-doctor-clinic.

    if    bt-clinic-nbr-1-2 not = doc-clinic-nbr
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-2
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-3
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-4
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-5
      and bt-clinic-nbr-1-2 not = doc-clinic-nbr-6
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 57                         to      err-ind
        move bt-clinic-nbr-1-2          to      err-msg-doc-clinic
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.
*   endif

ea14-99-exit.
    exit.

* 2003/10/22 - end


fa0-proc-rec-type-header1.

*   (processing a new HEADER rec. If there were detail records in hold area
*    from the previous claim header rec then area process them - ie. price
*    them and write them out)
    perform xx0-process-hold-dtls       thru xx0-99-exit.

    move "N"                          to   skip-process-this-acct-id-flag.

    perform fb0-build-susp-hdr-rec      thru fb0-99-exit.
*   (if error found processing this record, skip processing dtl/addr part of rec
    if skip-processing-this-acct-id
    then
        go to fa0-99-exit.
*   endif

*mf    perform fd0-build-susp-addr-rec-from-hdr1
    perform fd0-build-susp-addr-rec-hdr1
                                        thru    fd0-99-exit.

*   (moved to just before all details are written out so that total
*    amount of priced claim can be updated into header)
*   perform tc0-write-hdr-rec           thru    tc0-99-exit.

    move 0                              to      ctr-hdr2-rec
                                                ctr-addr-rec.
fa0-99-exit.
    exit.


* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  76
*                      newu701.cbl                                   )

fb0-build-susp-hdr-rec.

*  (if 'RMB' claim output header/address records)
    if   last-record-is-h
      or detail-written
    then
        move 'N'                        to   detail-written-flag
*       (header written out with details in xx0)
*         perform tc0-write-hdr-rec       thru tc0-99-exit
        perform tf0-write-addr-rec      thru tf0-99-exit.
*   endif

*   move diskette-input-rec-data        to      header-rec.
*   98/04/06 mc - initialize header-rec
    move spaces                         to      header-rec.
    move zeroes                         to      hdr-birth-date
                                                hdr-birth-date-dd
                                                hdr-refer-pract-nbr
                                                hdr-admit-yy
                                                hdr-admit-mm
                                                hdr-admit-dd.

*   (incoming claim/accounting nbr moved to hold area so it can
*    be written back out to the unpriced(diskette-out) files

    move spaces                         to      suspend-hdr-rec.

    move zeroes                         to      clmhdr-batch-nbr.
    move unpriced-clmhdr-claim           to      hold-accounting-nbr.
    move unpriced-clmhdr-claim           to      hdr-accounting-nbr.
    move doc-nbr                        to      clmhdr-doc-nbr.

    move unpriced-clmhdr-health-nbr      to      hdr-health-care-nbr.
    if unpriced-clmhdr-birth-date = spaces
    then
        move zeroes                     to      hdr-birth-date-long
    else
        move unpriced-clmhdr-birth-date  to      hdr-birth-date-long.
*   endif

    inspect unpriced-clmhdr-ref-doc-nbr replacing all space-char by zeros.
    if unpriced-clmhdr-ref-doc-nbr = spaces
    then
        move zeroes                     to      hdr-refer-pract-nbr
    else
        move unpriced-clmhdr-ref-doc-nbr to      hdr-refer-pract-nbr.
    move unpriced-clmhdr-hosp-nbr        to      hdr-hosp-nbr.
    move unpriced-clmhdr-man-review      to      hdr-manual-review.
    if unpriced-clmhdr-admit-date = spaces
    then
        move zeroes                     to      hdr-admit-date
    else
        move unpriced-clmhdr-admit-date  to      hdr-admit-date.
*   endif
    move unpriced-clmhdr-version-cd      to      hdr-health-care-ver.

    move zeros                          to      clmhdr-zeroed-oma-suff-adj.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  77
*                      newu701.cbl                                   )
    move "C"                            to      clmhdr-batch-type.

*   (00/sep/21 B.E. distinguish between "D"iskette and "W"eb claims")
    move flag-claim-source              to      clmhdr-claim-source-cd.

    move bt-clinic-nbr-1-2              to      clmhdr-clinic-nbr-1-2.

*   IF BATCH-PROVIDER-NBR NOT = DOC-PRACT-NBR
*   THEN
*       MOVE '??????'                   TO      CLMHDR-DOC-NBR-OHIP-ALPHA
*   ELSE
        move batch-provider-nbr         to      clmhdr-doc-nbr-ohip.
*   endif

*   IF BATCH-SPECIALITY NOT = DOC-SPEC-CD
*   THEN
*       MOVE '??'                       TO      CLMHDR-DOC-SPEC-CD-ALPHA
*   ELSE
        move batch-speciality           to      clmhdr-doc-spec-cd.
*   endif

*   (REFERRING PHY. SPECIFIED - ENSURE THAT NBR IS VALID)

    if hdr-refer-pract-nbr not = spaces and not = zeros
    then
        perform fb02-verify-referring-phys-nbr
                                        thru    fb02-99-exit
*       IF INVALID-REFER-PHYS
*       THEN
*           MOVE "??????"               TO      CLMHDR-REFER-DOC-NBR-ALPHA
*       ELSE
            move hdr-refer-pract-nbr    to      clmhdr-refer-doc-nbr.
*       endif
*   endif

*2000/11/27 - MC - if referring doc nbr is blank for clinic 60's, set
*                  referring doc-nbr to be the same as original doc-nbr

    if     hdr-refer-pract-nbr = 0
      and (    bt-clinic-nbr-1-2 >= 61
           and bt-clinic-nbr-1-2 <= 65
          )
        then
            move batch-provider-nbr     to clmhdr-refer-doc-nbr.
*           endif


*   (determine if hospital nbr is required, and if so that the code is valid -
*    - if valid, replace 4 digit hospital number with 1 character code)
*       (hospital nbr specified - ensure that nbr is valid and translate to hosp


*2000/03/20 - MC - comment out the following if condition
*    if    hdr-hosp-nbr not = spaces and not = zeros
*      and not price-only-claim
*    then
*       perform fb05-verify-hospital    thru    fb05-99-exit
*       if clmhdr-hosp = "?"
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  78
*                      newu701.cbl                                   )
*       then
*           perform xb0-print-warning-line
*                                       thru    xb0-99-exit
*           move 1                      to      ws-carriage-ctrl
*           move 23                     to      err-ind
*           move hdr-hosp-nbr           to      err-hosp-nbr, clmhdr-hosp
*           perform zb0-build-write-err-rpt-line
*                                       thru    zb0-99-exit.
*       endif
*   endif

*   (if requested by operator, set all blank agent codes to 'OHIP')
*   98/03/31 mc - also set clmhdr-tape-submit-ind to 'Y' and
*                 clmhdr-agent-cd = '0'
    if ws-agent-default-reply = "Y"
    then
        move "Y"                        to      clmhdr-tape-submit-ind
        move "0"                        to      clmhdr-agent-cd
        move "0"                        to      hdr-agent-cd.
*   endif

*   MOVE ZEROS                          TO      CLMHDR-ADJ-CD.
    move spaces                         to      clmhdr-adj-cd.


    move zero                           to      clmhdr-status-ohip.

    move spaces                         to      clmhdr-reference.

*   (non-rma-enhanced submissions don't have a location in the header
*    records.  check the 'HEB' batch header record to see if rma has
*    input a default value to use for all claims in the batch and
*    override if required)


    if    (   hdr-loc-code = ws-4-nulls
           or hdr-loc-code = spaces)
      and ws-default-batch-location not = spaces
    then
        move ws-default-batch-location  to clmhdr-loc.
*   endif

*   (non-rma-enhanced submissions don't have a patient i/o indicator in the
*    hdr records.  check the 'HEB' batch header record to see if rma has
*    input a default value to use for all claims in the batch and
*    override if required)

    if    (   hdr-i-o-ind = ws-1-null
           or hdr-i-o-ind = spaces)
      and ws-default-batch-i-o-ind not = spaces
    then
        move ws-default-batch-i-o-ind   to clmhdr-i-o-pat-ind.
*   endif


    if hdr-admit-date not = spaces and not = zeros
    then
*       (ADMIT DATE SPECIFIED - ENSURE THAT DATE IS VALID)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  79
*                      newu701.cbl                                   )
        move hdr-admit-yy               to      ws-date-yy
        move hdr-admit-mm               to      ws-date-mm
        move hdr-admit-dd               to      ws-date-dd
        perform xd0-verify-date thru    xd0-99-exit
        if     invalid-date
           and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 26                     to      err-ind
            move hdr-admit-date         to      err-admit-date
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*           MOVE "??????"               TO      CLMHDR-DATE-ADMIT
*       ELSE
            move hdr-admit-yy           to      clmhdr-date-admit-yy
            move hdr-admit-mm           to      clmhdr-date-admit-mm
            move hdr-admit-dd           to      clmhdr-date-admit-dd.
*       endif
*   endif


* 2004/04/07 - MC
    if hdr-admit-date not = spaces and not = zeros
    then
*       (ADMIT DATE SPECIFIED - ENSURE THAT DATE IS greater than birth date)
        if     hdr-admit-date < hdr-birth-date-long
           and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 58                     to      err-ind
            move hdr-admit-date         to      err-58-admit-date
            move hdr-birth-date-long    to      err-58-birth-date
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
            move "????????"             to      clmhdr-date-admit.
*       endif
*   endif
* 2004/04/07 - end


    move sys-date                       to      clmhdr-date-sys.
    move doc-dept                       to      clmhdr-doc-dept.
    move zero                           to      clmhdr-curr-payment
*mf                                             clmhdr-manual-and-tape-paymnts
                                                clmhdr-amt-tech-billed
                                                clmhdr-amt-tech-paid.

    if hdr-health-care-nbr not = spaces and not = zeros
    then
        move hdr-health-care-nbr        to      clmhdr-health-care-nbr
*       (THE FOLLOWING TWO MOVE STMT ADDED ON 91/04/23 BY M.C. - MOVED TO
*        NEW LINES NUMBER BY B.L. 91/SEP/05)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  80
*                      newu701.cbl                                   )
        move hdr-health-care-nbr        to      clmhdr-pat-key-data
        move "O"                        to      clmhdr-pat-key-type.
*   endif

    move hdr-health-care-ver            to      clmhdr-health-care-ver.

*   (CHECK THE RELATIONSHIP FIELD)
*   IF HDR-RELATIONSHIP =  SPACES
*                        OR 'Y'
*                        OR 'N'
*    THEN
*        MOVE HDR-RELATIONSHIP           TO      CLMHDR-RELATIONSHIP
*    ELSE
*        PERFORM XB0-PRINT-WARNING-LINE
*                                       THRU    XB0-99-EXIT
*        MOVE 1                          TO      WS-CARRIAGE-CTRL
*        MOVE 46                         TO      ERR-IND
*        MOVE HDR-RELATIONSHIP           TO      ERR-RELATIONSHIP
*        PERFORM ZB0-BUILD-WRITE-ERR-RPT-LINE
*                                        THRU    ZB0-99-EXIT
*        MOVE HDR-RELATIONSHIP           TO      CLMHDR-RELATIONSHIP.
**       MOVE "?"                        TO      CLMHDR-RELATIONSHIP.
**   endif

*   (CHECK THE MANUAL REVIEW INDICATOR)
    if  hdr-manual-review =  spaces
                          or 'Y'
                          or 'N'
    then
        move hdr-manual-review              to      clmhdr-manual-review
    else
        if not price-only-claim
        then
            move ws-warning-literal         to      err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit
            move 1                          to      ws-carriage-ctrl
            move 31                         to      err-ind
            move hdr-manual-review          to      err-manual-review
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
            move hdr-manual-review          to      clmhdr-manual-review.
*       endif
*   endif

*   (00/sep/14 B.E.)
*   (number of description records set to zero here and updated by
*    program that processes the description record upload file)
*    move 0                             to clmhdr-nbr-suspend-desc-recs.

    move doc-pract-nbr                  to      clmhdr-doc-pract-nbr.
    move hdr-accounting-nbr             to      clmhdr-accounting-nbr.

fb0-99-exit.
    exit.

fb0a-search-province.

    if hdr-health-care-prov = prov(sub)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  81
*                      newu701.cbl                                   )
    then
        move "Y"                        to province-flag.
*   endif

fb0a-99-exit.
    exit.


fb02-verify-referring-phys-nbr.

*   MOVE HDR-REFER-PRACT-NBR            TO      WS-CHK-IND.
*   MOVE "Y"                            TO      FLAG-REFER-PHYS.

    move hdr-refer-pract-nbr            to      ws-chk-nbr.
*   IF      WS-CHK-NBR     = ZEROES
        if  ws-chk-nbr-8   = 1
        or  ws-chk-nbr-8   = 2
    then
        perform dc0-mod10-check-digit-for-1-2 thru dc0-99-exit
    else perform db0-mod10-check-digit  thru    db0-99-exit.
*   endif

    move flag                           to      flag-refer-phys.

    if    invalid-refer-phys
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 12                         to      err-ind
        move hdr-refer-pract-nbr        to      err-refer-phys-nbr
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.
*   endif

    if    hdr-refer-pract-nbr = batch-provider-nbr
      and (   bt-clinic-nbr-1-2 < 60
           or bt-clinic-nbr-1-2 > 65
          )
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 47                         to      err-ind
*2000/03/20 - MC
*       move unpriced-clmhdr-ref-doc-nbr to      err-msg-referring-doc
*       move unpriced-bathdr-prov-ohip-no to     err-msg-provider-doc
*
        move hdr-refer-pract-nbr        to      err-msg-referring-doc
        move batch-provider-nbr          to     err-msg-provider-doc
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.

*** S.B. - end.

fb02-99-exit.
    exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  82
*                      newu701.cbl                                   )
fb03-verify-diag-code.

    move "Y"                            to      flag-diag-cd.
*mf    read diag-mstr      suppress data record
       read diag-mstr
        invalid key
            if not price-only-claim
            then
                move ws-error-literal           to      err-warn-msg
                perform xb0-print-warning-line  thru    xb0-99-exit
                move 1                          to      ws-carriage-ctrl
                move 14                         to      err-ind
                move diag-cd                    to      err-diag-code
                perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
                move            'N'             to      flag-diag-cd.
*           endif

fb03-99-exit.
    exit.


fb04-verify-doc-location.

*   (NON-RMA-ENHANCED SUBMISSIONS DON'T HAVE A LOCATION IN THE HEADER
*    RECORDS.  CHECK THE 'HEB' BATCH HEADER RECORD TO SEE IF RMA HAS
*    INPUT A DEFAULT VALUE TO USE FOR ALL CLAIMS IN THE BATCH AND
*    OVERRIDE IF REQUIRED)

    if    Hdr-loc-code = spaces
      and ws-default-batch-location not = spaces
      and not price-only-claim
    then
        move ws-default-batch-location  to hdr-loc-code.
*   endif

    move 'N'                            to      flag-location.
    if hdr-loc-code not = spaces
    then
        perform fb04a-search-doc-location       thru    fb04a-99-exit
            varying sub
            from 1
            by   1
            until   sub > max-doc-locations
                 or valid-location.
*   endif

    if    invalid-location
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 3                          to      err-ind
        move hdr-loc-code               to      err-msg-loc-cd
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.
*   endif

fb04-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  83
*                      newu701.cbl                                   )
    exit.


fb04a-search-doc-location.

    if hdr-loc-code = doc-loc(sub)
    then
        move 'Y'                        to flag-location.
*   endif

fb04a-99-exit.
    exit.

*2000/03/20 - MC  add the new subroutine fb04b-read-loc-mstr
fb04b-read-loc-mstr.

    move hdr-loc-code                   to loc-nbr.

    read loc-mstr
      invalid key
        if not price-only-claim
        then
            move zeroes                     to  loc-hospital-nbr
            move spaces                     to  loc-card-colour
            move ws-error-literal           to  err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit
            move 1                          to      ws-carriage-ctrl
            move 51                         to      err-ind
            move hdr-loc-code               to      err-51-loc-cd
            perform zb0-build-write-err-rpt-line
                                            thru    zb0-99-exit.
*       endif

fb04b-99-exit.
    exit.



copy "hospital.dc".
*        valid hospital codes are:
*        code      nbr        name
*        a        1992        macassa lodge
*        b        1160        joseph brant
*        c        1972        chedoke general
*        d        1557        hotel dieu
*        e        1146        haldimand war memorial hospital
*        f        3361        manitoulin health centre
*        g        1982        hamilton general
*        h        1983        henderson general
*        i        3309        shaver hospital
*        j        2003        st. joseph's
*        k        1076        hotel dieu-windsor
*        l        1538        west lincoln memorial
*        m        1994        mcmaster university medical centre
*        n        1591        norfolk general
*        o        1172        oakville trafalgar, active treatment
*        p        1524        muskoka hospital
*        q        3446        pine villa nursing home
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  84
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/ho)
*        r        1978        dr. rygiels home
*        s        2006        st. peter's
*        t        1406        toronto sick kids
*        u        1542        greater niagara
*        v        1149        west haldimand general hospital (hagersville)
*        w        0000        "weird" ie. used as miscellaneous hosp -- keyers
*                             will enter "report" when using this hospital,
*                             a card will be produced and manually changed to
*                             the correct hospital number
*        x        1082        salvation army/grace windsor
*        y        1020        willett hospital, paris
*        z        1987        hamilton psychiatric
*        1        1965        blackadar nursing home
*        2        1969        beacon hill lodge
*        3        3401        the brownstone nursing home
*        4        2001        st. elizabeth
*        5        1966        st. joseph's villa
*        6        1967        wentworth lodge
*        7        3409        grace villa
*        8        3642        wellington place
*        9        3251        parkview nursing centre


copy "hosp_nbr_code_to_nbr.rtn"
     replacing  ==ca11-move-hosp==      by ==fb05-verify-hospital==
                ==ca11-10-hosp-loop==   by ==fb05-10-hosp-loop==
                ==ca11-99-exit==        by ==fb05-99-exit==
                ==clmhdr-hosp==         by ==hdr-hosp-nbr==
                ==hosp-nbr==            by ==hosp-code==
                ==hosp-code==           by ==hosp-nbr==
                ==spaces==              by =="?"==
                ==l1-hosp==             by ==clmhdr-hosp==.


fb05-verify-hospital.
*       (TRANSLATE HOSPITAL CODE INTO THE CORRESPONDING HOSPITAL NUMBER)

    MOVE ZERO                   TO      SUBS-HOSP.
fb05-10-hosp-loop.

    ADD 1                       TO      SUBS-HOSP.

    IF hdr-hosp-nbr = hosp-nbr  (SUBS-HOSP)
    THEN
        MOVE hosp-code (SUBS-HOSP)
                                TO      clmhdr-hosp
        GO TO fb05-99-exit.
*   (ELSE)
*   ENDIF

    IF SUBS-HOSP < 35
    THEN
        GO TO fb05-10-hosp-loop
    ELSE
*mf     MOVE SPACES             TO      L1-HOSP.
        MOVE ZERO               TO      clmhdr-hosp.
*   ENDIF

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  85
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/ho)
fb05-99-exit.
    EXIT.
copy "verify_agent_code.rtn"
     replacing  ==xx00-verify-agent==   by ==fb06-verify-agent==
                ==xx00-99-exit==        by ==fb06-99-exit==
                ==agent-2b-tested==     by ==hdr-agent-cd==.
fb06-verify-agent.

    MOVE hdr-agent-cd                   TO      DEF-AGENT-CODE.

    IF   DEF-AGENT-OHIP
      OR DEF-AGENT-OHIP-WCB
      OR DEF-AGENT-IN-PAT-DIAG-BILLING
      OR DEF-AGENT-OHIP-NOT-VALID
      OR DEF-AGENT-MOH-REDUCTION
      OR DEF-AGENT-BILL-DIRECT
      OR DEF-AGENT-MISC-PAYMENTS
      OR DEF-AGENT-ALTERNATE-FUNDING
      OR DEF-AGENT-WCB
    THEN
        MOVE "Y"                        TO      FLAG-AGENT-CD
    ELSE
        MOVE "N"                        TO      FLAG-AGENT-CD.
*   ENDIF

fb06-99-exit.
    EXIT.
fb07-verify-in-out-ind.

*   (NON-RMA-ENHANCED SUBMISSIONS DON'T HAVE A PATIENT I/O INDICATOR IN THE
*    HDR RECORDS.  CHECK THE 'HEB' BATCH HEADER RECORD TO SEE IF RMA HAS
*    INPUT A DEFAULT VALUE TO USE FOR ALL CLAIMS IN THE BATCH AND
*    OVERRIDE IF REQUIRED)

    if    hdr-i-o-ind = spaces
      and ws-default-batch-i-o-ind not = spaces
    then
        move ws-default-batch-i-o-ind   to hdr-i-o-ind.
*   endif

*   IF HDR-I-O-IND = "1" OR "2" OR SPACES
    if hdr-i-o-ind = "1" or "2" or "I" or "O" or spaces
    then
        move "Y"                        to      flag-in-out-ind
    else
        move "N"                        to      flag-in-out-ind.
*   endif

fb07-99-exit.
    exit.
*mf fd0-build-susp-addr-rec-from-hdr1.
fd0-build-susp-addr-rec-hdr1.

    move spaces                 to suspend-address-rec.

*   VALIDATE THE BIRTH DATE

    move hdr-birth-date-long    to addr-birth-date.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  86
*                      newu701.cbl                                   )

    if    hdr-birth-date-long = spaces or zeros
      and not price-only-claim
    then
        move ws-warning-literal to err-warn-msg
        perform xb0-print-warning-line thru xb0-99-exit
        move 1                  to ws-carriage-ctrl
        move 37                 to err-ind
        move hdr-birth-date-long to err-birth-date
        perform zb0-build-write-err-rpt-line thru zb0-99-exit
*       MOVE '??????'           TO ADDR-BIRTH-DATE
    else
        move addr-birth-yy      to ws-date-yy
        move addr-birth-mm      to ws-date-mm
        move addr-birth-dd      to ws-date-dd
        perform xd0-verify-date thru xd0-99-exit
        if    invalid-date
          and not price-only-claim
        then
            move ws-error-literal       to err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit
            move 1                      to ws-carriage-ctrl
            move 37                     to err-ind
            move hdr-birth-date-long    to err-birth-date
            perform zb0-build-write-err-rpt-line thru zb0-99-exit.
*           MOVE '??????'               TO ADDR-BIRTH-DATE.
*       endif
*   endif

    move clmhdr-doc-pract-nbr   to addr-doc-pract-nbr.
    move clmhdr-accounting-nbr  to addr-accounting-nbr.

fd0-99-exit.
    exit.


ga0-proc-rec-type-header2.

    if unpriced-clmhdr-claim = 00523321
    then
        next sentence.
*   endif

    move unpriced-clmhdr-pat-surname     to clmhdr-pat-acronym6
                                           clmhdr-patient-surname.

    move unpriced-clmhdr-given-name      to clmhdr-pat-acronym3
                                           clmhdr-subscr-initials.

* 2000/jun/09 -BA/BE begin
*  (if either 'confidentiality' or 'manual review' flags have been
*   set then update 'manual review' to  "Y"es in the suspend header rec)
*    move unpriced-confidentiality-flag to    clmhdr-confidential-flag.
    if   unpriced-confidentiality-flag = "Y"
      or hdr-manual-review            = "Y"
    then
        move "Y"                          to    hdr-manual-review
    else
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  87
*                      newu701.cbl                                   )
        move ' '                          to    hdr-manual-review.
*   endif
    if   unpriced-confidentiality-flag = "Y"
    then
        move "Y"                          to    clmhdr-confidential-flag
    else
        move ' '                          to    clmhdr-confidential-flag.
* 2000/jun/09 -BA end

    move unpriced-clmhdr-loc-code        to hdr-loc-code.
*   (DETERMINE IF VALID LOCATION FOR DOCTOR)
    perform fb04-verify-doc-location    thru    fb04-99-exit.
*   IF INVALID-LOCATION
*   THEN
*       MOVE "????"                     TO      CLMHDR-LOC
*   ELSE
        move hdr-loc-code               to      clmhdr-loc.
*   endif


* 2005/05/05 - MC - check certain location code if clinic 61 - 65
    if  bt-clinic-nbr-1-2 >= 61 and bt-clinic-nbr-1-2  <= 65
        and  not price-only-claim
    then
        if    hdr-loc-code not = 'M233'
          and hdr-loc-code not = 'M521'
          and hdr-loc-code not = 'M525'
          and hdr-loc-code not = 'M526'
          and hdr-loc-code not = 'M527'
          and hdr-loc-code not = 'M540'
          and hdr-loc-code not = 'M541'
          and hdr-loc-code not = 'M542'
          and hdr-loc-code not = 'M544'
          and hdr-loc-code not = 'M545'
          and hdr-loc-code not = 'M546'
          and hdr-loc-code not = 'M547'
          and hdr-loc-code not = 'M555'
          and hdr-loc-code not = 'M556'
        then
            move ws-warning-literal         to      err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit
            move 1                          to      ws-carriage-ctrl
            move 62                         to      err-ind
            move bt-clinic-nbr-1-2          to      err-62-clinic-nbr
            move hdr-loc-code               to      err-62-loc-code
            move "????"                     to      clmhdr-loc
            perform zb0-build-write-err-rpt-line
                                                thru    zb0-99-exit.
*       endif
*   endif

* 2005/05/05 - end

*2000/03/20 - MC -get the hosp nbr and i/o ind from f030-locations-mstr
*                 by loc-code
    perform fb04b-read-loc-mstr         thru    fb04b-99-exit.
    move loc-hospital-nbr               to      clmhdr-hosp.
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  88
*                      newu701.cbl                                   )

*2002/04/24 - substitute hosp with payroll-flag
    move ws-default-payroll-flag        to      clmhdr-hosp.
*2002/04/24  - end

    move unpriced-clmhdr-agent-cd        to      hdr-agent-cd.
*   (DETERMINE IF VALID AGENT)
    perform fb06-verify-agent           thru    fb06-99-exit.
    if    invalid-agent-cd
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 20                         to      err-ind
        move hdr-agent-cd               to      err-agent-cd
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       MOVE "?"                        TO      CLMHDR-AGENT-CD
*   ELSE
        move hdr-agent-cd               to      clmhdr-agent-cd.
*   endif

    if     def-agent-ohip
        or def-agent-ohip-wcb
    then
        move zero                       to      clmhdr-date-cash-tape-payment
    else
        if not price-only-claim
        then
*           (PRINT WARNING THAT DIRECT BILL AGENT ENTERED AND ALL DIRECT
*            BILL INFO IS MISSING)
            move ws-warning-literal         to      err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit
            move 1                          to      ws-carriage-ctrl
            move 25                         to      err-ind
            perform zb0-build-write-err-rpt-line
                                            thru    zb0-99-exit
            move "??"                       to      clmhdr-msg-nbr
            move "?"                        to      clmhdr-reprint-flag
            move "?"                        to      clmhdr-sub-nbr
            move "?"                        to      clmhdr-auto-logout
            move "?"                        to      clmhdr-fee-complex.
*       endif
*   endif

*   (SET INDICATOR TO ASSUME THAT CLAIM CAN BE SUBMITTED ON TAPE - WHEN
*    ACTUAL CLAIM IS BUILT THE DETAILS WERE BE CHECKED TO ENSURE THAT
*    THIS INDICATOR IS SET CORRECLTY)
    if clmhdr-agent-cd = 0 or 2
    then
        move "Y"                        to      clmhdr-tape-submit-ind
    else
        move "N"                        to      clmhdr-tape-submit-ind.
*   endif

*2001/02/28 - MC- if agent = 6 or 9, set clmhdr-status = 'I'gnore
    if clmhdr-agent-cd = 6 or 9
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  89
*                      newu701.cbl                                   )
    then
        move "I"                        to      clmhdr-status.
*   endif


*2000/03/20 - MC - use loc-card-colour instead
*   move unpriced-clmhdr-i-o-ind         to      hdr-i-o-ind.
    move loc-card-colour                to      hdr-i-o-ind.
*
*2000/03/29 - MC - check the incoming i-o ind with loc-card-colour
    if    unpriced-clmhdr-i-o-ind  not =   hdr-i-o-ind
      and not price-only-claim
    then
        move ws-warning-literal         to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 53                         to      err-ind
        move unpriced-clmhdr-i-o-ind     to      err-53-incoming-i-o-ind
        move hdr-i-o-ind                to      err-53-i-o-ind
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit .
*   endif
*


    perform fb07-verify-in-out-ind      thru    fb07-99-exit.
    if    invalid-in-out-ind
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 15                         to      err-ind
        move hdr-i-o-ind                to      err-i-o-ind
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
*       MOVE "?"                        TO      CLMHDR-I-O-PAT-IND
        move hdr-i-o-ind                to      clmhdr-i-o-pat-ind
    else
*       IF HDR-I-O-IND = 1 - 96/07/30
        if hdr-i-o-ind = "1" or "I"
        then
            move "I"                    to      clmhdr-i-o-pat-ind
        else
*           IF HDR-I-O-IND = 2 - 96/07/30
            if hdr-i-o-ind = "2" or "O"
            then
                move "O"                to      clmhdr-i-o-pat-ind
            else
*               (IF INDICATOR IS BLANK - CONSIDER AS 'OUT' PATIENT)
                move "O"                to      clmhdr-i-o-pat-ind.
*           endif
*       endif
*   endif


    if unpriced-clmhdr-prov-cd = spaces
    then
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  90
*                      newu701.cbl                                   )
        move 'ON'                       to      hdr-health-care-prov
    else
        move unpriced-clmhdr-prov-cd     to      hdr-health-care-prov.
*   endif

    move 'N'                            to      province-flag.
    perform fb0a-search-province        thru    fb0a-99-exit
            varying sub from 1 by 1
            until (province-found or sub > 11).


    if    province-not-found
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line
                                        thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 30                         to      err-ind
        move hdr-health-care-prov       to      err-province
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       MOVE "??"                       TO      CLMHDR-HEALTH-CARE-PROV
*   ELSE
        move hdr-health-care-prov       to      clmhdr-health-care-prov.
*   endif


******************

* 2001/02/07 - MC - save RMB registration nbr
    if hdr-health-care-prov not = 'ON'  and
       unpriced-clmhdr-pat-ohip-nbr not = spaces and
       unpriced-clmhdr-pat-ohip-nbr not = zeroes
    then
        move unpriced-clmhdr-pat-ohip-nbr       to hdr-ohip-nbr.
*   endif

******************
    if hdr-health-care-prov = 'ON'
    then
        if    hdr-health-care-nbr = spaces
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 29                     to      err-ind
            move hdr-health-care-nbr
                                        to      err-health-care-nbr
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
            move "??????????"           to      clmhdr-health-care-nbr
        else
            move hdr-health-care-nbr    to      ws-nbr-10
            if   (   ws-nbr-10 not numeric
                  or ws-nbr-10 = zero
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  91
*                      newu701.cbl                                   )
                 )
              and not price-only-claim
            then
                move ws-error-literal   to      err-warn-msg
                perform xb0-print-warning-line
                                        thru    xb0-99-exit
                move 1                  to      ws-carriage-ctrl
                move 29                 to      err-ind
                move hdr-health-care-nbr
                                        to      err-health-care-nbr
                perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
                move "??????????"       to      clmhdr-health-care-nbr
            else
                move hdr-health-care-nbr
                                        to      ws-check-nbr-10
                perform db0a-mod10-check-digit-10 thru  db0a-99-exit
                if    flag = 'N'
                  and not price-only-claim
                then
                    move ws-error-literal       to      err-warn-msg
                    perform xb0-print-warning-line
                                        thru    xb0-99-exit
                    move 1              to      ws-carriage-ctrl
                    move 29             to      err-ind
                    move hdr-health-care-nbr to err-health-care-nbr
                    perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
                    move "??????????"   to      clmhdr-health-care-nbr
                else
*               (DATA IS OK - HAS ALREADY BEEN MOVED INTO CLMHDR FIELDS
                    next sentence.
*               endif
*           endif
*       endif
*   endif

*   (DETERMINE IF VALID SIZE OF OHIP NBR FOR OUT OF PROVINCE PATIENT)

* 2005/06/23 - MC - change from NF to NL
* if hdr-health-care-prov = 'NF'
    if hdr-health-care-prov = 'NL'
* 2005/06/23 - end
    then
        if   (    nf-ohip-nbr is not numeric
              or (nf-ohip-nbr = spaces or zeros)
             )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit
            move 1                      to ws-carriage-ctrl
            move 40                     to err-ind
            move hdr-health-care-prov   to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr
            perform zb0-build-write-err-rpt-line thru zb0-99-exit
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  92
*                      newu701.cbl                                   )
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
        else
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
                                                clmhdr-health-care-nbr
***
*       endif
    else
* 2001/02/12 - MC - ohip nbr size has changed
*   if hdr-health-care-prov = 'AB' or 'NS'
    if hdr-health-care-prov = 'BC' or 'NS'
    then
*       if      (ab-ns-11-digits is not numeric)
*           or  (ab-ns-11-digits =  spaces or zeros)
*           or  (ab-ns-last-digits not = spaces)
        if   (    (bc-ns-10-digits is not numeric)
              or  (bc-ns-10-digits =  spaces or zeros)
              or  (bc-ns-last-digits not = spaces)
             )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit
            move 1                      to ws-carriage-ctrl
            move 40                     to err-ind
            move hdr-health-care-prov   to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr
            perform zb0-build-write-err-rpt-line thru zb0-99-exit
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
        else
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
                                                clmhdr-health-care-nbr
*       endif
    else
*   if hdr-health-care-prov = 'BC'
    if hdr-health-care-prov = 'PE'
    then
*       if      (bc-10-digits is not numeric)
*           or  (bc-10-digits =  spaces or zeros)
*           or  (bc-last-digits not = spaces)
        if   (    (pe-8-digits is not numeric)
              or  (pe-8-digits =  spaces or zeros)
              or  (pe-last-digits not = spaces)
             )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit
            move 1                      to ws-carriage-ctrl
            move 40                     to err-ind
            move hdr-health-care-prov   to err-prov
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  93
*                      newu701.cbl                                   )
            move hdr-ohip-nbr           to err-ohip-nbr
            perform zb0-build-write-err-rpt-line thru zb0-99-exit
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
        else
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
                                                clmhdr-health-care-nbr
*       endif
    else
*   if hdr-health-care-prov = 'NB' or 'PE' or 'SK' or 'YT'
    if hdr-health-care-prov = 'AB' or 'NB' or 'SK' or 'YT'
    then
*       if      (nb-pe-sk-yt-9-digits is not numeric)
*           or  (nb-pe-sk-yt-9-digits =  spaces or zeros)
*           or  (nb-pe-sk-yt-last-digits not = spaces)
        if   (    (ab-nb-sk-yt-9-digits is not numeric)
              or  (ab-nb-sk-yt-9-digits =  spaces or zeros)
              or  (ab-nb-sk-yt-last-digits not = spaces)
             )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit
            move 1                      to ws-carriage-ctrl
            move 40                     to err-ind
            move hdr-health-care-prov   to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr
            perform zb0-build-write-err-rpt-line thru zb0-99-exit
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
        else
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
                                                clmhdr-health-care-nbr
*       endif
    else
    if hdr-health-care-prov = 'NT'
    then
        if   (    (nt-first-digit is not alphabetic)
              or  (nt-first-digit =  spaces)
              or  (nt-7-digits is not numeric)
              or  (nt-7-digits =  spaces or zeros)
              or  (nt-last-digits not = spaces)
             )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit
            move 1                      to ws-carriage-ctrl
            move 40                     to err-ind
            move hdr-health-care-prov   to err-prov
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  94
*                      newu701.cbl                                   )
            move hdr-ohip-nbr           to err-ohip-nbr
            perform zb0-build-write-err-rpt-line thru zb0-99-exit
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
        else
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
                                                clmhdr-health-care-nbr
*       endif
    else
    if hdr-health-care-prov = 'MB'
    then
* 2005/06/23 - MC - Manitoba should be 9 digits
*        if   (    (mb-6-digits is not numeric)
*             or  (mb-6-digits =  spaces or zeros)
        if   (    (mb-9-digits is not numeric)
              or  (mb-9-digits =  spaces or zeros)
* 2005/06/23 - end
              or  (mb-last-digits not = spaces)
             )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line thru xb0-99-exit
            move 1                      to ws-carriage-ctrl
            move 40                     to err-ind
            move hdr-health-care-prov   to err-prov
            move hdr-ohip-nbr           to err-ohip-nbr
            perform zb0-build-write-err-rpt-line thru zb0-99-exit
*           MOVE "?"                    TO      CLMHDR-PAT-KEY-TYPE
*           MOVE "????????"             TO      CLMHDR-PAT-KEY-DATA
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
        else
            move "O"                    to      clmhdr-pat-key-type
            move hdr-ohip-nbr           to      clmhdr-pat-key-data
* 2001/02/07 - MC - move hdr-ohip-nbr to clmhdr-health-care-nbr
                                                clmhdr-health-care-nbr.
*       endif
*   endif


    perform ga1-build-addr-rec-from-hdr2    thru ga1-99-exit.

ga0-99-exit.
   exit.


ga1-build-addr-rec-from-hdr2.

    move unpriced-clmhdr-pat-surname     to      addr-surname.
    move unpriced-clmhdr-given-name      to      addr-first-name.
    if   unpriced-clmhdr-sex = "1"
    then
         move "M"                       to      addr-sex
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  95
*                      newu701.cbl                                   )
    else
    if   unpriced-clmhdr-sex = "2"
    then
         move "F"                       to      addr-sex
    else
         move unpriced-clmhdr-sex        to      addr-sex.
*   endif

*   (if phone nbr is only 7 digits long then default to local area code)
    move unpriced-clmhdr-phone-no       to      temp-phone-nbr.
    if    (    temp-phone-nbr-1-3  =  0
           and temp-phone-nbr-4-10 <> 0
          )
       or (    temp-phone-nbr-1-7  <> 0
           and temp-phone-nbr-8-10 =  0
          )
    then
*       (default area-code)
        move default-area-code           to     unpriced-clmhdr-phone-no-1-3
        if temp-phone-nbr-8-10 = 0
        then
            move temp-phone-nbr-1-7      to     unpriced-clmhdr-phone-no-4-10
        else
            move temp-phone-nbr-4-10     to     unpriced-clmhdr-phone-no-4-10.
*       endif
*   endif

    move unpriced-clmhdr-phone-no         to      addr-phone-no.


ga1-99-exit.
    exit.

gb1-verify-dtl-diag-cd.

    if hold-diag-cd(ss-write-dtl) =   spaces
                                   or zeros
    then
*       (CHECK IF CODE REQUIRES A DIAGNOSIS CODE)
        if    hold-oma-rec-ind (ss-write-dtl, ss-diag-ind) = "Y"
          and hold-oma-suff    (ss-write-dtl)              = "A" or "M"
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                          thru    xb0-99-exit
            move 1                        to      ws-carriage-ctrl
            move 22                       to      err-ind
            move hold-oma-cd(ss-write-dtl) to     err-22-oma-cd
            move "DIAGNOSTIC CODE"        to      err-22-msg
            perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit
*           MOVE "???"                    TO      CLMDTL-DIAG-CD-ALPHA
            move zero                     to      clmdtl-diag-cd
        else
*           (NO DIAG. CODE SPECIFIED BUT NONE WAS REQUIRED)
            move zero                     to      clmdtl-diag-cd
*       endif
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  96
*                      newu701.cbl                                   )
    else
*       (DIAG. CODE SPECIFIED - ENSURE THAT CODE IS VALID)
        move hold-diag-cd(ss-write-dtl) to      diag-cd
*##     CHCE3DCK ROUTINE TO SEE IF USING HOLD
        perform fb03-verify-diag-code     thru    fb03-99-exit
*       IF INVALID-DIAG-CODE
*       THEN
*           MOVE "???"                    TO      CLMDTL-DIAG-CD-ALPHA
*       ELSE
            move hold-diag-cd(ss-write-dtl)
                                          to      clmdtl-diag-cd
*           (### ENSURE THAT CLMHDR STILL AVAILLE AND NOT NEW REC)
*mf            if clmhdr-diag-cd = spaces or zeros
            if clmhdr-diag-cd-alpha = spaces or zeros
            then
                move hold-diag-cd(ss-write-dtl)
                                          to      clmhdr-diag-cd.
*           endif
*       endif
*   endif

gb1-99-exit.
    exit.

*2000/04/28 - B.A. begin
copy "d001_d003_newu701_confidentiality_check.rtn".
*  file: d001_d003_newu701_confidentiality_check.rtn

* 2000/may/26 B.E. - original

ga11-check-for-confidentially.

*   (skip checking if already flagged by user as confidential)
    if clmhdr-confidential-flag =    "Y"
                                  or "R"
    then
        go to ga11-99-exit.
*   endif

    perform ga11a-check-conf-ministry           thru ga11a-99-exit.
    if clmhdr-confidential-flag     <> "Y"
                                and <> "R"
    then
        perform ga11b-check-conf-rma            thru ga11b-99-exit.
*   endif


ga11-99-exit.
    exit.

copy "confidentially_check_ministry_codes.rtn".
* file: confidentially_check_ministry_codes.rtn
*       (These edits ensure no verification letter is sent to a patient.
*       The codes checked match codes that the ministry automatically
*       recognizes as confidential and won't send letters for, but must
*       be flagged for internal RMA processing to ensure that RMA doesn't
*       send letters either)
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  97
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/co)
* 2000/may 26 B.E. - original

ga11a-check-conf-ministry.

*   (Don't override the "Y"es to be sent to the ministry with an "R"MA flag)
    if clmhdr-confidential-flag = "Y"
    then
        go to ga11a-99-exit.
*   endif

*   (ministry will 'no verify' these codes but RMA processing must also ignore)
    if hold-diag-cd (ss-clmdtl-oma) =
                                           099
                                        or 290
                                        or 291
                                        or 292
                                        or 295
                                        or 296
                                        or 297
                                        or 298
                                        or 299
                                        or 634
                                        or 635
                                        or 640
                                        or 895

    then
        move 'R'                to clmhdr-confidential-flag
    else
*       (ministry doesn't automatically 'no verify' these codes so set flag)
        if hold-oma-cd (ss-clmdtl-oma) =
                                           'A777'
                                        or 'A902'

                                        or 'C777'

                                        or 'E108'
                                        or 'E753'

                                        or 'K015'
                                        or 'K018'
                                        or 'K021'
                                        or 'K051' or 'K052' or 'K053'
                                        or 'K061'
                                        or 'K620'
                                        or 'K623' or 'K624'
                                        or 'K629'

                                        or 'G100'

                                        or 'R200'
                                        or 'R872'

                                        or 'S274'
                                        or 'S436'
                                        or 'S626'
                                        or 'S738'
                                        or 'S741'
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  98
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/co)
                                        or 'S752'
                                        or 'S756'
                                        or 'S768'
                                        or 'S783'
                                        or 'S785'

                                        or 'W777'
        then
            move 'R'            to clmhdr-confidential-flag.
*           endif
*       endif
*   endif

ga11a-99-exit.
    exit.
copy "confidentially_check_rma_codes.rtn".
* file: confidentially_check_rma_codes.rtn
*       (edits in addition to the ministry codes, that ensure no verification
*       letter is sent to a patient.  These are addition codes that the ministry
*       DOESN'T automatically supress letters for, but for which RMA
*       wants to suppress any contact with patient.)
*
* 00/may 26 B.E. - original
* 00/sep/15 B.E. - removed all but 1 diag code and 1 oma code as per Thekla
* 00/sep/26 B.E. - as per Dr Hucker request added 302

ga11b-check-conf-rma.

*   (check DIAGNOSIS Code)
    if hold-diag-cd (ss-clmdtl-oma) =
                                           632
                                        or 302


*                                          042
*                                       or 043
*                                       or 044
*                                       or 097
*                                       or 098
*                                       or 300
*                                       or 301
*                                       or 311
*                                       or 319


    then
        move 'R'                to clmhdr-confidential-flag
    else
*       (check BILLING Code)
        if hold-oma-cd (ss-clmdtl-oma) =
                                           'G362'



*                                          'A193' or 'A194'
*                                       or 'A195' or 'A196' or 'A197' or 'A198'
*                                       or 'A395'
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page  99
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/co)
*                                       or 'C192' or 'C193'
*                                       or 'C195' or 'C196' or 'C197'
*                                       or 'C198' or 'C199'
*                                       or 'C395'
*
*                                       or 'K004' or 'K005'
*                                       or 'K007' or 'K008'
*                                       or 'K010'
*                                       or 'K012'
*                                       or 'K024' or 'K025'
*                                       or 'K190' or 'K191' or 'K192'
*                                       or 'K193' or 'K194' or 'K195'
*                                       or 'K196' or 'K197' or 'K198'
*                                       or 'K199'
*                                       or 'K200' or 'K201' or 'K202'
*                                       or 'K203' or 'K204' or 'K205'
*                                       or 'K206' or 'K207'
*
*                                       or 'W195' or 'W196'
*                                       or 'W395'
        then
            move 'R'            to clmhdr-confidential-flag.
*           endif
*       endif
*   endif

ga11b-99-exit.
    exit.


ha0-proc-rec-type-detail.

*   (move the 2 service details from the 'unpriced' rec to pricing hold area)
    add 1                               to                   ss-clmdtl-oma.

    move unpriced-itm1-oma-svc-code      to hold-oma-cd      (ss-clmdtl-oma).

*   (00/aug/31 B.E. set flag is special addin code found)
*   (set flag if special add on oma codes of e409 or e400
*    or e401 or e410 entered)
    if hold-oma-cd(ss-clmdtl-oma) =   "E400"
                                   or "E409"
                                   or "E401"
                                   or "E410"
    then
        move "Y"                                to ws-special-add-on-cd-entered.
*   endif

    move unpriced-itm1-oma-svc-suff      to hold-oma-suff    (ss-clmdtl-oma).
*   MOVE TAPEOUT-ITM1-OMA-AMT-BILLED    TO HOLD-FEE-BILLED  (SS-CLMDTL-OMA).

*   (save incoming $ and #-svcs so that if RMA pricing alters these
*    values they can be recovered if needed)
    move unpriced-itm1-oma-amt-billed    to hold-fee-incoming(ss-clmdtl-oma).
    move unpriced-itm1-nbr-serv         to hold-sv-nbr-serv-incoming
                                                            (ss-clmdtl-oma).
*
    move unpriced-itm1-override-price    to hold-override-price
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 100
*                      newu701.cbl                                   )
                                                            (ss-clmdtl-oma).
    move unpriced-itm1-bilateral         to hold-bilateral   (ss-clmdtl-oma).
*   (IF PRICE OVERRIDE IS REQUESTED THEN MOVE THE ENTERED FEE INTO FEE-OMA/OHIP)
*  (NOTE: PRICE OVERRIDE FLAG ASSUMED TO BE SET IF THE INCOMING RECORD
*         HAS PRICES. THIS HANDLES PC BASED BILLING PACKAGES THAT PRICE
*         CLAIMS BUT DON'T SET THE PRICE OVERRIDE FLAG.
*         THIS CODE SHOULD EVENTUALLY BE CHANGED TO USE THE INCOMING
*         PRICE BUT REPORT IF THE RMA PRICING SOFTWARE CALCULATES
*         A DIFFERENT PRICE)

    inspect unpriced-itm1-oma-amt-billed replacing all space-char by zeros.

*    if unpriced-itm1-oma-amt-billed not = 0
*    then
*        move "Y"               to      unpriced-itm1-override-price.
**   endif

*    if   unpriced-itm1-override-price = "Y"

    if unpriced-itm1-oma-amt-billed not = 0
    then
        move unpriced-itm1-oma-amt-billed to hold-fee-incoming(ss-clmdtl-oma)
    else
        move 0                            to hold-fee-oma     (ss-clmdtl-oma)
                                             hold-basic-prof  (ss-clmdtl-oma)
                                             hold-fee-ohip    (ss-clmdtl-oma).
*   endif

    move unpriced-itm1-nbr-serv          to hold-sv-nbr-serv (ss-clmdtl-oma).
*   (REPEATING SERVICES NOT ALLOWED IN OHIP SUBMITTAL TAPE SPECIFICATION)
    move 0                              to hold-sv-nbr      (ss-clmdtl-oma,1)
                                           hold-sv-nbr      (Ss-clmdtl-oma,2)
                                           hold-sv-nbr      (ss-clmdtl-oma,3)
                                           hold-sv-day-num  (ss-clmdtl-oma,1)
                                           hold-sv-day-num  (ss-clmdtl-oma,2)
                                           hold-sv-day-num  (ss-clmdtl-oma,3).
*  (if Override Price or Bilateral flags set, then default the first
*   repetitive day field as per the way D001 works)

    if unpriced-itm1-override-price = "Y"
    then
        move "OP"                       to hold-sv-day      (ss-clmdtl-oma,1)
    else
    if unpriced-itm1-bilateral = "Y"
    then
        move "BI"                       to hold-sv-day      (ss-clmdtl-oma,1).
*   ENDCASE

    move unpriced-itm1-svc-date          to hold-sv-date     (ss-clmdtl-oma).
    move unpriced-itm1-diag-cd           to hold-diag-cd     (ss-clmdtl-oma).
    move hold-oma-cd (ss-clmdtl-oma)    to fee-oma-cd.
    perform xc0-check-oma-code          thru xc0-99-exit.
*   (00/04/28 - B.A. begin)
*   (The check for oma and diag code is to set the confidentiality flag
*    at the detail level)
    perform ga11-check-for-confidentially thru ga11-99-exit.
*   (00/04/28 end)

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 101
*                      newu701.cbl                                   )
    perform ha1-move-pricing-to-hold    thru ha1-99-exit.

* ## BELOW FLAG MOVED - WHAT IMPACT ON RESET OF PGM)
*   MOVE 'Y'                            TO DETAIL-WRITTEN-FLAG.

    if unpriced-itm2-oma-svc-code = spaces
    then
*       (MOVE DETAIL REC TO PRICING HOLD AREA)
        go to ha0-90-after-2nd-detail.
*   endif

    add 1                               to                   ss-clmdtl-oma.

    move unpriced-itm2-oma-svc-code      to hold-oma-cd      (ss-clmdtl-oma).
*   (00/aug/31 B.E. set flag is special addin code found)
*   (set flag if special add on oma codes of e409 or e400
*    or e401 or e410 entered)
    if hold-oma-cd(ss-clmdtl-oma) =   "E400"
                                   or "E409"
                                   or "E401"
                                   or "E410"
    then
        move "Y"                                to ws-special-add-on-cd-entered.
*   endif

    move unpriced-itm2-oma-svc-suff      to hold-oma-suff    (ss-clmdtl-oma).
*   MOVE TAPEOUT-ITM2-OMA-AMT-BILLED    TO HOLD-FEE-BILLED  (SS-CLMDTL-OMA).

*   (save incoming $ and #-svcs so that if RMA pricing alters these
*    values they can be recovered if needed)
    move unpriced-itm2-oma-amt-billed    to hold-fee-incoming(ss-clmdtl-oma).
    move unpriced-itm2-nbr-serv         to hold-sv-nbr-serv-incoming
                                                            (ss-clmdtl-oma).

    move unpriced-itm2-override-price    to hold-override-price
                                                            (ss-clmdtl-oma).
    move unpriced-itm2-bilateral         to hold-bilateral   (ss-clmdtl-oma).

*    if unpriced-itm2-oma-amt-billed not = 0
*    then
*        move "Y"               to      unpriced-itm2-override-price.
**   endif

*    if unpriced-itm2-override-price = "Y"

    if unpriced-itm2-oma-amt-billed not = 0
    then
        move unpriced-itm2-oma-amt-billed to hold-fee-incoming(ss-clmdtl-oma)
    else
        move 0                            to hold-fee-oma     (ss-clmdtl-oma)
                                             hold-basic-prof  (ss-clmdtl-oma)
                                             hold-fee-ohip    (ss-clmdtl-oma).
*   endif

    move unpriced-itm2-nbr-serv          to hold-sv-nbr-serv (ss-clmdtl-oma).
    move 0                              to hold-sv-nbr      (ss-clmdtl-oma,1)
                                           hold-sv-nbr      (ss-clmdtl-oma,2)
                                           hold-sv-nbr      (ss-clmdtl-oma,3)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 102
*                      newu701.cbl                                   )
                                           hold-sv-day-num  (ss-clmdtl-oma,1)
                                           hold-sv-day-num  (ss-clmdtl-oma,2)
                                           hold-sv-day-num  (ss-clmdtl-oma,3).
    move unpriced-itm2-svc-date          to hold-sv-date   (ss-clmdtl-oma).
    move unpriced-itm2-diag-cd           to hold-diag-cd   (ss-clmdtl-oma).
*  (if Override Price or Bilateral flags set, then default the first
*   repetitive day field as per the way D001 works)

    if unpriced-itm2-override-price = "Y"
    then
        move "OP"                       to hold-sv-day      (ss-clmdtl-oma,1)
    else
    if unpriced-itm2-bilateral = "Y"
    then
        move "BI"                       to hold-sv-day      (ss-clmdtl-oma,1).
*   ENDCASE

*   (CALL TO THESE 2 ROUTINES MOVED TO OUTPUT OF SUSPENSE RECORDS)
*    EXCEPT FOR READ OF OMA-FEE-MSTR SINCE VALUES NEEDED NOW TO
*    PUT INTO HOLD AREA FOR LATER PRICING CACULATIONS)
*    PERFORM HB0-BUILD-SUSP-DTL-REC-FROM-DTL THRU HB0-99-EXIT
*    PERFORM YD0-WRITE-DTL-REC THRU YD0-99-EXIT.

    move hold-oma-cd(ss-clmdtl-oma)     to   fee-oma-cd.
    perform xc0-check-oma-code          thru xc0-99-exit.
    perform ha1-move-pricing-to-hold    thru ha1-99-exit.

ha0-90-after-2nd-detail.

ha0-99-exit.
    exit.



ha1-move-pricing-to-hold.
*WC0-MOVE-OMA-DATA-TO-HOLD. (TAKEN FROM D001.CB)

*   (save the nbr of the incoming detail record so that if the pricing
*    module re-sorts the claim details within the hold area, the program
*    can use the hold-line-no field to re-sort the records back into
*    the original sequence)
    move  ss-clmdtl-oma      to hold-line-no         (ss-clmdtl-oma).

*        (MOVE OMA REC'S DATA TO THE DETAIL ENTRY'S HOLD AREA)

    move fee-tech-ind        to hold-oma-rec-ind(ss-clmdtl-oma,ss-tech-ind).
    move fee-diag-ind        to hold-oma-rec-ind(ss-clmdtl-oma,ss-diag-ind).
    move fee-phy-ind         to hold-oma-rec-ind(ss-clmdtl-oma,ss-phy-ind).
    move fee-hosp-nbr-ind    to hold-oma-rec-ind(ss-clmdtl-oma,ss-hosp-nbr-ind).
    move fee-i-o-ind         to hold-oma-rec-ind(ss-clmdtl-oma,ss-i-o-ind).
    move fee-admit-ind       to hold-oma-rec-ind(ss-clmdtl-oma,ss-admit-ind).
    move fee-special-m-suffix-ind
                             to hold-oma-rec-ind(ss-clmdtl-oma,ss-special-m-suff

    move fee-icc-sec         to hold-icc-sec    (ss-clmdtl-oma).
    move fee-icc-grp         to hold-icc-grp    (ss-clmdtl-oma).

*   (move oma rec's fees according to whether service is current or
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 103
*                      newu701.cbl                                   )
*    previous fees
*    -- if service date is < constants mstr "CURRENT PRICES EFFECT DATE"
*       then use previous rates)
*   (change to use f040 oma fee code's effective date rather than
*    constants master's date)
*     if hold-sv-date (ss-clmdtl-oma) < const-effective-date (curr)
    if hold-sv-date (ss-clmdtl-oma) < fee-effective-date
    then
        move prev                       to hold-ss-curr-prev(ss-clmdtl-oma)
    else
        move curr                       to hold-ss-curr-prev(ss-clmdtl-oma).
*   endif

    move hold-ss-curr-prev(ss-clmdtl-oma)
                                        to ss-curr-prev.
    move fee-1    (ss-curr-prev, oma)  to hold-oma-fee-1   (ss-clmdtl-oma, oma).
    move fee-2    (ss-curr-prev, oma)  to hold-oma-fee-2   (ss-clmdtl-oma, oma).
    move fee-anae (ss-curr-prev, oma)  to hold-oma-fee-anae(ss-clmdtl-oma, oma).
    move fee-asst (ss-curr-prev, oma)  to hold-oma-fee-asst(ss-clmdtl-oma, oma).
    move fee-1    (ss-curr-prev,ohip)  to hold-oma-fee-1   (ss-clmdtl-oma,ohip).
    move fee-2    (ss-curr-prev,ohip)  to hold-oma-fee-2   (ss-clmdtl-oma,ohip).
    move fee-anae (ss-curr-prev,ohip)  to hold-oma-fee-anae(ss-clmdtl-oma,ohip).
    move fee-asst (ss-curr-prev,ohip)  to hold-oma-fee-asst(ss-clmdtl-oma,ohip).
    move fee-min  (ss-curr-prev,ohip)  to hold-fee-min     (ss-clmdtl-oma,ohip).
    move fee-max  (ss-curr-prev,ohip)  to hold-fee-max     (ss-clmdtl-oma,ohip).
    move fee-add-on-cd(ss-curr-prev,1) to hold-oma-add-on-cd(ss-clmdtl-oma, 1).
    move fee-add-on-cd(ss-curr-prev,2) to hold-oma-add-on-cd(ss-clmdtl-oma, 2).
    move fee-add-on-cd(ss-curr-prev,3) to hold-oma-add-on-cd(ss-clmdtl-oma, 3).
    move fee-add-on-cd(ss-curr-prev,4) to hold-oma-add-on-cd(ss-clmdtl-oma, 4).
    move fee-add-on-cd(ss-curr-prev,5) to hold-oma-add-on-cd(ss-clmdtl-oma, 5).
    move fee-add-on-cd(ss-curr-prev,6) to hold-oma-add-on-cd(ss-clmdtl-oma, 6).
    move fee-add-on-cd(ss-curr-prev,7) to hold-oma-add-on-cd(ss-clmdtl-oma, 7).
    move fee-add-on-cd(ss-curr-prev,8) to hold-oma-add-on-cd(ss-clmdtl-oma, 8).
    move fee-add-on-cd(ss-curr-prev,9) to hold-oma-add-on-cd(ss-clmdtl-oma, 9).
    move fee-add-on-cd(ss-curr-prev,10) to hold-oma-add-on-cd(ss-clmdtl-oma,10).
    move fee-oma-ind-card-requireds(ss-curr-prev)
                                to hold-oma-ind-card-requireds(ss-clmdtl-oma).

*   (oma fee mstr records for sp add-ons should have data duplicated
*    in fee-1 and fee-2 for 'f'lat or 'p'erc rates. Some do not and
*    therefore require this logic patch)
*   (00/aug/08 B.E.
*    recognize 'add on' codes by "P"ercent/"F"lat designation rather
*    than having to have a specific ICC code)
*   if hold-icc-cd (ss-clmdtl-oma) = 'SP98'
*                                 or 'SP99'
    if fee-add-on-perc-or-flat-ind(ss-curr-prev) =   "P"
                                                  or "F"
    then
        perform ha1a-addon-fee-fix      thru ha1a-99-exit.
*   endif

    if fee-add-on-perc-or-flat-ind(ss-curr-prev) =   "P"
                                                  or "F"
    then
        move fee-add-on-perc-or-flat-ind(ss-curr-prev)
                 to hold-oma-rec-ind (ss-clmdtl-oma,ss-add-on-perc-or-flat-ind)
    else
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 104
*                      newu701.cbl                                   )
        move " " to hold-oma-rec-ind (ss-clmdtl-oma,ss-add-on-perc-or-flat-ind).
*   endif

*   (if indicator for flat vs percent not set then use fee > 1.00 as flat
*                                                      and < 1.01 as percent
*   (00/aug/08 B.E. - removed below code - the "F"lat or "P"ercentage
*                     MUST be set in order to identify code as an 'add on',
*                     so no defaulting of flag can now be performed.)
*    else
*        if hold-oma-fee-1 (ss-clmdtl-oma,  oma) > 1.00
*        then
*            move "F"    to hold-oma-rec-ind     (ss-clmdtl-oma, ss-add-on-perc-
*        else
*            move "P"    to hold-oma-rec-ind     (ss-clmdtl-oma, ss-add-on-perc-
**       endif
**   endif

ha1-99-exit.
    exit.

ha1a-addon-fee-fix.

*   (format of f040 file fees is: 99.999 allowing only 3 decimals. 2001/apr/23
*    requirement was for 4 decimal positions only for PERCENTAGE based addons.
*    Percentages were originally stored using only the numbers after the
*    decimal place. Conversion run to multiply by 100 and now percentages
*    that were stored as .605 were stored as 60.500 . This means that
*    when pricing claims the Percentage rates must be divided by 100 before
*    moving into pricing hold variables.
    if fee-add-on-perc-or-flat-ind(ss-curr-prev) =   "P"
    then
        compute hold-oma-fee-1 (ss-clmdtl-oma,  oma) =
                hold-oma-fee-1 (ss-clmdtl-oma,  oma) / 100
        compute hold-oma-fee-2 (ss-clmdtl-oma,  oma) =
                hold-oma-fee-2 (ss-clmdtl-oma,  oma) / 100
        compute hold-oma-fee-1 (ss-clmdtl-oma, ohip) =
                hold-oma-fee-1 (ss-clmdtl-oma, ohip) / 100
        compute hold-oma-fee-2 (ss-clmdtl-oma, ohip) =
                hold-oma-fee-2 (ss-clmdtl-oma, ohip) / 100.
*   endif

*       (IF 'OMA' FEE-1  RATE IS ZERO, THEN USE FEE-2 AND VISA VERSA)
    if        hold-oma-fee-1 (ss-clmdtl-oma,  oma) = 0
    then
       move  hold-oma-fee-2 (ss-clmdtl-oma,  oma)       to hold-oma-fee-1(ss-clm
    else
        if        hold-oma-fee-2 (ss-clmdtl-oma,  oma) = 0
        then
            move  hold-oma-fee-1 (ss-clmdtl-oma,  oma)  to hold-oma-fee-2(ss-clm
        else
            next sentence.
*       endif
*   endif

*       (IF 'OHIP' FEE-1  RATE IS ZERO, THEN USE FEE-2 AND VISA VERSA)
    if        hold-oma-fee-1 (ss-clmdtl-oma, ohip) = 0
    then
        move  hold-oma-fee-2 (ss-clmdtl-oma, ohip)      to hold-oma-fee-1(ss-clm
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 105
*                      newu701.cbl                                   )
    else
        if        hold-oma-fee-2 (ss-clmdtl-oma, ohip) = 0
        then
            move  hold-oma-fee-1 (ss-clmdtl-oma, ohip)  to hold-oma-fee-2(ss-clm
        else
            next sentence.
*       endif
*   endif
*

ha1a-99-exit.
    exit.


hb0-build-susp-dtl-rec-dtl.

*   (THIS ROUTINE CALLED PASSING SS-WRITE-DTL AS SUBSCRIPT OF PRICED HOLD AREA)

    move spaces                         to   suspend-dtl-rec.

*   (keep BI and OP flags by moving them into consecutives services area)
    move hold-sv-day(ss-write-dtl,1)    to clmdtl-sv-day(1).
    move hold-sv-day(ss-write-dtl,2)    to clmdtl-sv-day(2).
    move hold-sv-day(ss-write-dtl,3)    to clmdtl-sv-day(3).
*   (00/sep/12 B.E. repetitive services were not initialized)
    move 0                              to clmdtl-sv-nbr(1)
                                           clmdtl-sv-nbr(2)
                                           clmdtl-sv-nbr(3).

*   ## CHECK IF CLMHDR-STILL AVAILABLE - MIGHT HAVE BEEN READ INTO BY
*   ## NEW HAEADER???
    move clmhdr-batch-nbr               to   clmdtl-batch-nbr.

    move hold-oma-cd(ss-write-dtl)      to   clmdtl-oma-cd
                                             fee-oma-cd.
    move hold-oma-suff(ss-write-dtl)    to   clmdtl-oma-suff.
    move 0                              to   clmdtl-adj-nbr.
    move 0                              to   clmdtl-rev-group-cd.
    move clmhdr-agent-cd                to   clmdtl-agent-cd.
    move clmhdr-adj-cd                  to   clmdtl-adj-cd.

*2001/02/28 - MC - default clmhdr-status into clmdtl-status
*2001/03/30 - BE - if not 'I'gnore status, then if claim details have been
*                  altered due to tech/prof/suffix rule processing,
*                  then update detail/header status to "U"pdated
    if     tech-prof-suff-rule-applied
       and clmhdr-status <> "I"
    then
        move "U"                        to   clmdtl-status
                                             clmhdr-status
    else
        move clmhdr-status              to   clmdtl-status.
*   endif

    perform gb1-verify-dtl-diag-cd thru gb1-99-exit.

    if    hold-sv-nbr-serv(ss-write-dtl) = 0
      and not price-only-claim
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 106
*                      newu701.cbl                                   )
    then
        move ws-error-literal           to   err-warn-msg
        perform xb0-print-warning-line thru xb0-99-exit
        move 1                          to   ws-carriage-ctrl
        move 38                         to   err-ind
        move hold-sv-nbr-serv(ss-write-dtl)
                                        to   err-nbr-of-serv
        perform zb0-build-write-err-rpt-line thru zb0-99-exit
*       MOVE '??'                       TO   CLMDTL-NBR-SERV-ALPHA
    else
*       (91/MAR/13 B.E.)
*       (SUM NBR SERVICES FOR AUDIT TOTALS)
*       ADD  DTL-NBR-OF-SERV            TO   CTR-TOT-SVCS-READ
        add  hold-sv-nbr-serv(ss-write-dtl)
                                        to   ctr-tot-svcs-read
*       MOVE DTL-NBR-OF-SERV            TO   CLMDTL-NBR-SERV
        move hold-sv-nbr-serv(ss-write-dtl)
                                        to   clmdtl-nbr-serv.
*   endif

    if    hold-fee-ohip     (ss-write-dtl)  = 0
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line thru xb0-99-exit
        move 1                          to   ws-carriage-ctrl
        move 39                         to   err-ind
*       MOVE DTL-FEE-BILLED             TO   ERR-FEE-BILLED
        move hold-fee-ohip (ss-write-dtl)
                                        to   err-fee-billed
        perform zb0-build-write-err-rpt-line thru zb0-99-exit.


*    (2000/03/20 - MC - check the two prices)
*    if  hold-fee-incoming(ss-write-dtl) not = 0  and
*       hold-fee-incoming(ss-write-dtl) not = hold-fee-ohip(ss-write-dtl)
*    then
*       move ws-warning-literal         to      err-warn-msg
*        perform xb0-print-warning-line  thru    xb0-99-exit
*        move 1                          to      ws-carriage-ctrl
*        move 52                         to      err-ind
*        move hold-fee-incoming(ss-write-dtl) to err-52-incoming-fee
*        move hold-fee-ohip    (ss-write-dtl) to err-52-ohip-fee
*        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit.
*   endif


*   (ya0- pricing logic has determined correction price to use and therefore
*         this routine can use the hold-fee-ohip)
*           if  hold-fee-incoming(ss-write-dtl) not = 0
*           then
*               move hold-fee-incoming(ss-write-dtl)to clmdtl-fee-oma
*                                                      clmdtl-fee-ohip
*           else

*   (00/sep/08 B.E. - don't automatically use ohip fees for both)
*            move hold-fee-ohip(ss-write-dtl)      to clmdtl-fee-oma
*                                                     clmdtl-fee-ohip.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 107
*                      newu701.cbl                                   )
     move hold-fee-oma (ss-write-dtl)    to clmdtl-fee-oma.
     move hold-fee-ohip(ss-write-dtl)    to clmdtl-fee-ohip.

*   (2000/jun/05 B.E. correct pricing of tech portion of fee)
    move hold-priced-tech(ss-write-dtl)       to clmdtl-amt-tech-billed

*   (Perform a second read to oma-fee-mstr for each detail
*    before any edit checks.)
    perform xc0-check-oma-code          thru xc0-99-exit.

*   (verify speciality against ohip code in header rec)
    if    (   fee-spec-fr < batch-speciality
           or fee-spec-fr = batch-speciality)
      and (   fee-spec-to = batch-speciality
           or fee-spec-to > batch-speciality)
    then
        move batch-speciality           to      clmhdr-doc-spec-cd
    else
        if not price-only-claim
        then
            move ws-error-literal           to  err-warn-msg
            perform xb0-print-warning-line  thru    xb0-99-exit
            move 1                          to      ws-carriage-ctrl
            move 21                         to      err-ind
            move batch-speciality           to      err-21-value-1
            move hold-oma-cd(ss-write-dtl)  to      err-21-value-2
            move fee-spec-fr                to      err-21-value-3
            move fee-spec-to                to      err-21-value-4
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
            move batch-speciality           to      clmhdr-doc-spec-cd.
*   endif

*   (DETERMINE IF REFERRING PHY. NBR REQUIRED, AND IF SO THAT THE NBR IS VALID)
    if hdr-refer-pract-nbr =   spaces
                            or zeros
    then
        if    fee-phy-ind = "Y"
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 22                     to      err-ind
            move hold-oma-cd(ss-write-dtl)
                                        to      err-22-oma-cd
            move "REFERRING PHYSICIAN"  to      err-22-msg
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       endif

*   (DETERMINE IF DIAGNOSTIC CODE IS REQUIRED, AND IF SO THAT THE CODE IS VALID)
    if hold-diag-cd(ss-write-dtl) =   spaces
                                     or zeros
    then
        if    fee-diag-ind = "Y"
          and hold-oma-suff (ss-write-dtl)  = "A" or "M"
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 108
*                      newu701.cbl                                   )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 22                     to      err-ind
            move hold-oma-cd(ss-write-dtl)
                                        to      err-22-oma-cd
            move "DIAGNOSTIC CODE"      to      err-22-msg
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       endif
*   endif

*    (00/sep/14 B.E. - this edit no longer required)
*    if hdr-hosp-nbr =   spaces
*                     or zeros
*    then
*        if fee-hosp-nbr-ind = "Y"
*         and not price-only-claim
*        then
*           move ws-error-literal       to      err-warn-msg
*            perform xb0-print-warning-line
*                                        thru    xb0-99-exit
*            move 1                      to      ws-carriage-ctrl
*            move 22                     to      err-ind
*            move hold-oma-cd(ss-write-dtl)
*                                        to      err-22-oma-cd
*            move "HOSPITAL NUMBER"      to      err-22-msg
*            perform zb0-build-write-err-rpt-line
*                                        thru    zb0-99-exit.
**           MOVE "?"                    TO      CLMHDR-HOSP.
**       endif
**   endif

*   (DETERMINE IF IN/OUT INDICATOR IS REQUIRED, AND IF SO THAT IT IS VALID)
    if hdr-i-o-ind =   spaces
                    or zeros
    then
        if   (   fee-i-o-ind = "I"
              or fee-i-o-ind = "O"
              or fee-i-o-ind = "B"
             )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 22                     to      err-ind
            move hold-oma-cd(ss-write-dtl)
                                        to      err-22-oma-cd
            move "IN/OUT PATIENT INDICATOR"
                                        to      err-22-msg
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
        else next sentence
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 109
*                      newu701.cbl                                   )
    else
        if   (   (     hdr-i-o-ind = "I"
                   and fee-i-o-ind <> "I"
                   and fee-i-o-ind <> "B"
                 )
              or (    hdr-i-o-ind = "O"
                  and fee-i-o-ind <> "O"
                  and fee-i-o-ind <> "B"
                 )
             )
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 49                     to      err-ind
            move fee-i-o-ind            to      err-49-oma-cd
            move hdr-i-o-ind            to      err-49-hdr-cd
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       endif
*   endif

* 2002/06/12 - MC

    if (hdr-hosp-nbr = spaces or zero) and
* 2002/08/12 - MC
*      (hold-oma-cd(ss-write-dtl) >= 'K994' and hold-oma-cd(ss-write-dtl) <= 'K9
      (hold-oma-cd(ss-write-dtl) >= 'K990' and hold-oma-cd(ss-write-dtl) <= 'K99
* 2002/08/12 - end
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 54                     to      err-ind
            move hold-oma-cd(ss-write-dtl)
                                        to      err-54-prem-code
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*    endif

* 2002/06/12 - end

* 2002/08/21 - MC

    if (hdr-hosp-nbr = 'G000' or 'M200' or 'H000' or 'J000') and
      (hold-oma-cd(ss-write-dtl) >= 'K990' and hold-oma-cd(ss-write-dtl) <= 'K99
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 55                     to      err-ind
            move hdr-hosp-nbr           to      err-55-hosp-code
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 110
*                      newu701.cbl                                   )
            move hold-oma-cd(ss-write-dtl)
                                        to      err-55-prem-code
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*    endif

* 2002/08/21 - end

* 2003/06/11 - MC

    if (hdr-loc-nbr not = '112' ) and
* 2004/01/20 - MC
       (hdr-loc-nbr not = '153' ) and
       (hdr-loc-nbr not = '400' ) and
       (hdr-loc-nbr not = '250' ) and
       (hdr-loc-nbr not = '422' ) and
* 2004/01/20 - end
* 2004/09/27 - MC
       (hdr-loc-nbr not = '401' ) and
* 2004/09/27 - end
      (hold-oma-cd(ss-write-dtl) >= 'K990' and hold-oma-cd(ss-write-dtl) <= 'K99
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 56                     to      err-ind
            move hdr-loc-code           to      err-56-loc-code
            move hold-oma-cd(ss-write-dtl)
                                        to      err-56-prem-code
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*    endif

* 2003/06/11 - end


*
*   (CHECK IF ADMIT DATE IS REQUIRED, AND IF SO VERIFY THAT DATE IS VALID)
    if hdr-admit-date =   spaces
                       or zeros
    then
        if    fee-admit-ind = "Y"
          and not price-only-claim
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 22                     to      err-ind
            move hold-oma-cd(ss-write-dtl)
                                        to      err-22-oma-cd
            move "ADMIT DATE"           to      err-22-msg
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       endif
*   endif
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 111
*                      newu701.cbl                                   )

*   (VERIFY SERVICE DATE IS VALID)
    move hold-sv-date-dd(ss-write-dtl) to   ws-date-dd.
    move hold-sv-date-mm(ss-write-dtl) to   ws-date-mm.
    move hold-sv-date-yy(ss-write-dtl) to   ws-date-yy.
    perform xd0-verify-date              thru xd0-99-exit.
    if    invalid-date
      and not price-only-claim
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 27                         to      err-ind
        move hold-sv-date(ss-write-dtl)
                                        to      err-27-service-date
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
    else
*       (service is a real date - ensure that it is not greater than the
*        run date.)
        if    hold-sv-date(ss-write-dtl) > sys-date
          and not price-only-claim
        then
          move ws-error-literal           to      err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 48                         to      err-ind
          move hold-sv-date(ss-write-dtl)
                                          to      err-msg-svr-date
          move sys-date                   to      err-msg-sys-date
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit
          move "????????"                 to      clmdtl-sv-date
        else
*         (service is valid - ensure it is not stale-dated ie. not
*          within 6 months of current system date)
         if   (   (hold-sv-date-yy(ss-write-dtl) * 365)
                + (hold-sv-date-mm(ss-write-dtl) *  30)
*                 (+ 6 MONTHS TIMES 30 DAYS = 180)
                + 190
                + hold-sv-date-dd(ss-write-dtl)
                   < (sys-yy * 365) + (SYS-MM * 30) + SYS-DD
              )
          and not price-only-claim
* 2002/08/21 - MC - Yas requests to bypass the edit check on stale date for clin
          and   bt-clinic-nbr-1-2 not = 80
          and   bt-clinic-nbr-1-2 not = 95
* 2002/08/21 - end
* 2002/05/03 - MC - temporary edit check (ie error if svc date < 20010901)
*         and hold-sv-date(ss-write-dtl) < 20010901
* 2002/05/03 - end
        then
            move ws-error-literal       to      err-warn-msg
            perform xb0-print-warning-line
                                        thru    xb0-99-exit
            move 1                      to      ws-carriage-ctrl
            move 24                     to      err-ind
            move hold-sv-date(ss-write-dtl)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 112
*                      newu701.cbl                                   )
                                        to      err-24-service-date
            perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
            move "????????"             to      clmdtl-sv-date
        else
*           (VERIFY SERVICE DATE IS NOT BEFORE ADMIT DATE IF SPECIFIED)
            if    hdr-admit-date  not = spaces
              and hold-sv-date(ss-write-dtl) < hdr-admit-date
              and not price-only-claim
            then
                move ws-error-literal   to      err-warn-msg
                perform xb0-print-warning-line
                                        thru    xb0-99-exit
                move 1                  to      ws-carriage-ctrl
                move 44                 to      err-ind
                move hold-sv-date(ss-write-dtl)
                                        to      err-44-service-date
                move hdr-admit-date     to     err-44-admit-date
                perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
*2001/03/08 - MC
*               move "????????"         to      clmdtl-sv-date
                move "????????"         to      clmhdr-date-admit
                move hold-sv-date-dd(ss-write-dtl) to      clmdtl-sv-dd
                move hold-sv-date-mm(ss-write-dtl) to      clmdtl-sv-mm
                move hold-sv-date-yy(ss-write-dtl) to      clmdtl-sv-yy
***
            else
*              (INITIAL SERVICE DATE IS VALID AND WITHIN 6 MONTHS OF CURRENT DAT
                move hold-sv-date-dd(ss-write-dtl) to      clmdtl-sv-dd
                move hold-sv-date-mm(ss-write-dtl) to      clmdtl-sv-mm
                move hold-sv-date-yy(ss-write-dtl) to      clmdtl-sv-yy.
*           endif
*       endif
*   endif

* 2005/03/03 - MC -add two more edit check
    if    clmhdr-doc-spec-cd = 7
*           (check the patient's age )
    then
        move    hold-sv-date(ss-write-dtl)      to ws-sv-date
        move    hdr-birth-date-long             to ws-birth-date
        compute dummy = (ws-sv-date - ws-birth-date) / 10000
        if       (hold-oma-cd(ss-write-dtl) = 'A775' or 'W775' or 'C775')
              and dummy < 75
              and not price-only-claim
            then
                move ws-error-literal   to      err-warn-msg
                perform xb0-print-warning-line
                                        thru    xb0-99-exit
                move 1                  to      ws-carriage-ctrl
                move 60                 to      err-ind
                move clmhdr-doc-spec-cd to      err-60-doc-spec
                move hdr-birth-date-long to      err-60-birth-date
                perform zb0-build-write-err-rpt-line
        else
        if      dummy < 60
              and not price-only-claim
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 113
*                      newu701.cbl                                   )
            then
                move ws-error-literal   to      err-warn-msg
                perform xb0-print-warning-line
                                        thru    xb0-99-exit
                move 1                  to      ws-carriage-ctrl
                move 59                 to      err-ind
                move clmhdr-doc-spec-cd to      err-59-doc-spec
                move hdr-birth-date-long to     err-59-birth-date
                perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*       endif
*   endif

*2005/03/03 - end

* 2005/05/05 - MC
*    service date - ensure that it is greater than the
*    birth  date.)
     if    hold-sv-date(ss-write-dtl) < hdr-birth-date-long
       and not price-only-claim
     then
          move ws-error-literal           to      err-warn-msg
          perform xb0-print-warning-line  thru    xb0-99-exit
          move 1                          to      ws-carriage-ctrl
          move 61                         to      err-ind
          move hold-sv-date(ss-write-dtl)
                                          to      err-61-serv-date
          move hdr-birth-date-long        to      err-61-birth-date
          perform zb0-build-write-err-rpt-line
                                          thru    zb0-99-exit
          move "????????"                 to      clmdtl-sv-date.
*   endif
* 2005/05/05 - end

    move clmhdr-doc-pract-nbr to clmdtl-doc-pract-nbr.
    move clmhdr-accounting-nbr to clmdtl-accounting-nbr.

hb0-99-exit.
    exit.

ia0-proc-rec-type-address.

    move unpriced-pat-addr-1             to addr-address-line-1.
    move unpriced-pat-addr-2             to addr-address-line-2.
    move unpriced-pat-addr-3             to addr-address-line-3.
    move unpriced-pat-addr-post-cd       to addr-postal-code.


*   PERFORM YE0-WRITE-ADDR-REC  THRU    YE0-99-EXIT.


ia0-99-exit.
    exit.

ka0-proc-rec-type-trailer.

*   (processing a TRAILER rec)
*   (ensure that all numeric fields are zero filled in trailer rec)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 114
*                      newu701.cbl                                   )
    inspect unpriced-trailer-clmhdr1-cnt  replacing all space-char by zeros.
    inspect unpriced-trailer-clmhdr2-cnt  replacing all space-char by zeros.
    inspect unpriced-trailer-itm-cnt      replacing all space-char by zeros.
    inspect unpriced-trailer-pat-addr-cnt replacing all space-char by zeros.

*    (if there were detail records in hold area from the previous claim
*      header rec then area process them - ie. price them and write them out)
    perform xx0-process-hold-dtls       thru xx0-99-exit.

    if (last-record-is-h) or (detail-written)
    then
        move 'N'                   to   detail-written-flag
*       (HEADER WRITTEN OUT IN XX0 ROUTINE)
*       PERFORM TC0-WRITE-HDR-REC  THRU TC0-99-EXIT
        perform tf0-write-addr-rec thru tf0-99-exit.
*   endif

*       CHECK IF AUDIT TOTALS MATCH TRAILER REC TOTAL - WARNING MESSAGE
    move unpriced-trailer-clmhdr1-cnt    to trl-h-count.
    move unpriced-trailer-clmhdr2-cnt    to trl-r-count.
    move unpriced-trailer-itm-cnt        to trl-t-count.
    move unpriced-trailer-pat-addr-cnt   to trl-a-count.

    add ctr-h-recs-read
        ctr-h-recs-skipped      giving ctr-tot-h-recs.

    add ctr-r-recs-read
        ctr-r-recs-skipped      giving ctr-tot-r-recs.

    add ctr-t-recs-read
        ctr-t-recs-read-skipped giving ctr-tot-t-recs.

    add ctr-a-recs-read
        ctr-a-recs-read-skipped giving ctr-tot-a-recs.

    if trl-h-count not = ctr-tot-h-recs
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 16                         to      err-ind
        move ctr-tot-h-recs             to      err-ctr-h-count
        move trl-h-count                to      err-trl-h-count
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*   endif
    if trl-r-count not = ctr-tot-r-recs
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 34                         to      err-ind
        move ctr-tot-r-recs             to      err-ctr-r-count
        move trl-r-count                to      err-trl-r-count
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*   endif
    if trl-t-count not = ctr-tot-t-recs
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 115
*                      newu701.cbl                                   )
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 17                         to      err-ind
        move ctr-tot-t-recs             to      err-ctr-t-count
        move trl-t-count                to      err-trl-t-count
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*   endif
    if trl-a-count not = ctr-tot-a-recs
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 18                         to      err-ind
        move ctr-tot-a-recs             to      err-ctr-a-count
        move trl-a-count                to      err-trl-a-count
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*   endif
    if    trl-b-count not = zero
      and trl-b-count not = ctr-b-recs-read
    then
        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 19                         to      err-ind
        move ctr-b-recs-read            to      err-ctr-b-count
        move trl-b-count                to      err-trl-b-count
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit.
*   endif

    perform ka1-print-batch-audit-tots  thru    ka1-99-exit.

*** S.B. - start.
*** Added the following to prevent a missing detail error
*** from appearing on the first batch record after a previous
*** batch that had any detail records in it.
    move 0                              to      ctr-hdr2-rec
                                                ctr-addr-rec.
*** S.B. - end.

ka0-99-exit.
    exit.



ka1-print-batch-audit-tots.

*  (PRINT BATCH AUDIT COUNTERS ON NEW PAGE)
    move 99                                     to ctr-lines-printed.
    move 2                                      to ws-carriage-ctrl.

    move "********** AUDIT COUNTERS **********" to audit-title.
    move zero                                   to audit-value
                                                   audit-value-2
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 116
*                      newu701.cbl                                   )
                                                   audit-value-3.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move 3                                      to ws-carriage-ctrl.
    move "TOTAL NBR INPUT RECORDS READ= "       to audit-title.
    move ctr-recs-read                          to audit-value
                                                   audit-value-2.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move 2                                      to ws-carriage-ctrl.
    move "NBR OF BATCH   RECORDS READ = "       to audit-title.
    move ctr-b-recs-read                        to audit-value
                                                   audit-value-2.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "NBR OF TRAILER RECORDS READ = "       to audit-title.
    move ctr-e-recs-read                        to audit-value
                                                   audit-value-2.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "NBR OF HEADER1 RECORDS READ = "       to audit-title.
    move ctr-h-recs-read                        to audit-value
                                                   audit-value-3
                                                   audit-value-4.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "NBR OF HEADER2 RECORDS READ = "       to audit-title.
    move ctr-r-recs-read                        to audit-value
                                                   audit-value-3
                                                   audit-value-4.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "NBR OF DETAIL  RECORDS READ = "       to audit-title.
    move ctr-t-recs-read                        to audit-value
                                                   audit-value-3.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "NBR OF DETAIL  RECS SKIPPED = "       to audit-title.
    move ctr-t-recs-read-skipped                to audit-value
                                                   audit-value-2.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 117
*                      newu701.cbl                                   )
    move "NBR OF ADDRESS RECORDS READ = "       to audit-title.
    move ctr-a-recs-read                        to audit-value
                                                   audit-value-4.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "TOTAL SVCS HDRS/DETAILS READ= "       to audit-title.
    move ctr-tot-svcs-read                      to audit-value-5.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "TOTAL $$$  HDRS/DETAILS READ= "       to audit-title.
    move ctr-tot-dollars-read                   to audit-value-5.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "NBR OF ADDRESS RECS SKIPPED = "       to audit-title.
    move ctr-a-recs-read-skipped                to audit-value
                                                   audit-value-2.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move 3                                      to ws-carriage-ctrl.
    move "NBR OF HEADER  RECORDS WRITTEN = "    to audit-title.
    move ctr-suspend-hdr-writes                 to audit-value-2
                                                   audit-value-4.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move 2                                      to ws-carriage-ctrl.
    move "NBR OF HEADER1 RECORDS SKIPPED = "    to audit-title.
    move ctr-h-recs-skipped                     to audit-value-2.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move 2                                      to ws-carriage-ctrl.
    move "NBR OF HEADER2 RECORDS SKIPPED = "    to audit-title.
    move ctr-r-recs-skipped                     to audit-value-2.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "NBR OF DETAIL  RECORDS WRITTEN = "    to audit-title.
    move ctr-suspend-dtl-writes                 to audit-value-2
                                                   audit-value-3.
    move audit-line                             to rpt-line.
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

    move "NBR OF ADDRESS RECORDS WRITTEN = "    to audit-title.
    move ctr-suspend-addr-writes                to audit-value-4.
    move audit-line                             to rpt-line.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 118
*                      newu701.cbl                                   )
    move spaces                                 to audit-line.
    perform zz0-write-err-rpt-line              thru zz0-99-exit.

*  (FORCE NEW PAGE AFTER TOTALS)
    move 99                                     to ctr-lines-printed.

ka1-99-exit.
    exit.
xb0-print-warning-line.

    move 2                      to      ws-carriage-ctrl.
    move 1                      to      err-ind.
    move batch-provider-nbr     to      err-msg-pract-nbr.
    move hdr-accounting-nbr     to      err-msg-account-id.
    perform zb0-build-write-err-rpt-line
                                thru    zb0-99-exit.

xb0-99-exit.
    exit.

xd0-verify-date.

    move "Y"                            to flag-date.

    if   ws-date-mm < 1
      or ws-date-mm > 12
    then
        move "N"                        to flag-date
    else
        if   ws-date-dd < 1
          or ws-date-dd > max-nbr-days (ws-date-mm)
        then
            move "N"                    to flag-date.
*       endif
*   endif

xd0-99-exit.
    exit.
ta0-read-diskette.

    move unpriced-input-rec-type         to      last-record-type-flag.

    move low-values                     to      unpriced-Claims-record.

    read unpriced-claims-file
        at end
            move "Y" to eof-input-file-flag
            go to ta0-99-exit.

*  (REPLACE ANY NULLS IN RECORD WITH BLANKS)
    inspect unpriced-claims-record replacing all low-values by spaces.

*  (REPLACE ANY CARRIAGE-RETURNS IN RECORD WITH BLANKS)
    inspect unpriced-claims-record replacing all carriage-return by spaces.

*   (SET FLAG TO TEST RECORD TYPE)
    move unpriced-input-rec-type to      record-type-flags.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 119
*                      newu701.cbl                                   )
*   (CHECK WHETHER THIS RECORD WILL BE PROCESSED OR SKIPPED)
    if    skip-processing-this-acct-id
      and t-record
    then
        add 1                   to      ctr-t-recs-read-skipped
    else
        if   (skip-processing-this-acct-id or skip-hdr-addr-but-write-dtl)
          and a-record
        then
            add 1               to      ctr-a-recs-read-skipped
        else
            next sentence.
*       endif
*   endif

    add 1                       to      ctr-recs-read.

ta0-99-exit.
    exit.




tb0-read-doc.

    move "Y"                    to flag-doc.
    read doc-mstr
        invalid key move "N"    to flag-doc
                    go to tb0-99-exit.

*   IF WS-DOC-NBR NOT EQUAL TO 0 AND
*      WS-DOC-NBR NOT EQUAL TO DOC-NBR
*   THEN
*       PERFORM YB1-READ-NEXT-DOC   THRU YB1-99-EXIT
*   ELSE
*       IF DOC-DATE-FAC-TERM GREATER THAN '000000'
*       THEN
*           PERFORM YB1-READ-NEXT-DOC   THRU YB1-99-EXIT.
*       endif
*   endif


tb0-99-exit.
    exit.



tc0-write-hdr-rec.

*   (00/oct/02 B.E. - oma/ohip prices summed separately)
*      move ctr-tot-dollars-claim  to clmhdr-tot-claim-ar-oma
    move ctr-tot-dollars-oma    to clmhdr-tot-claim-ar-oma.
    move ctr-tot-dollars-ohip   to clmhdr-tot-claim-ar-ohip.

*   (00/jun/05 B.E. added summation into header amt for tech fee)
    move ctr-tot-tech-claim     to clmhdr-amt-tech-billed.

    if update-suspense
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 120
*                      newu701.cbl                                   )
    then
        add 1                           to      ctr-suspend-hdr-writes
        write suspend-hdr-rec.
*   endif

*   (CHECK FOR ERROR FLAG SET BY DECLARATIVES ON PREVIOUS WRITE STMNT)
    if skip-processing-this-acct-id or skip-hdr-addr-but-write-dtl
    then
*     (NOTE: 90/01/14 B.E. LOGIC WILL ALLOW WRITING OF HEADER TO FAIL BUT FLAG H
*      SET SO THAT THE DETAIL RECS  FOR THIS HEADER WILL BE PROCESSED AND THEREF
*      WILL BECOME DETAILS FOR THE HEADER ALREADY ON FILE. MESSAGE ON WARNING
*      REPORT SHOULD ALERT STAFF TO REVIEW CLAIM TO CONFIRM THAT THESE
*      HEADERS ARE FOR SAME PATIENT)

        move ws-error-literal           to      err-warn-msg
        perform xb0-print-warning-line  thru    xb0-99-exit
        move 1                          to      ws-carriage-ctrl
        move 9                          to      err-ind
        perform zb0-build-write-err-rpt-line
                                        thru    zb0-99-exit
        add 1                           to      ctr-h-recs-skipped
        go to tc0-99-exit.
*   endif

    move zero                           to      ctr-tot-dollars-oma
                                                ctr-tot-dollars-ohip
                                                ctr-tot-tech-claim.

tc0-99-exit.
    exit.



td0-write-susp-dtl.

    if update-suspense
    then
        add 1                       to ctr-suspend-dtl-writes
        write suspend-dtl-rec.
*    endif

td0-99-exit.
    exit.



te0-write-disk-out.

    if create-priced-file
    then
        add 1                       to ctr-diskout-writes
        write diskout-output-rec.
*   endif

te0-99-exit.
    exit.


* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 121
*                      newu701.cbl                                   )

tf0-write-addr-rec.

    if update-suspense
    then
        add 1                      to ctr-suspend-addr-writes
        write suspend-address-rec
        invalid key
               move "D"            to skip-process-this-acct-id-flag
               go to tf0-99-exit.

tf0-99-exit.
    exit.


tg0-read-oma-fee-mstr.

    move "Y"                    to flag-oma.
    read oma-fee-mstr
        invalid key move "N"    to flag-oma.

tg0-99-exit.
    exit.
uj1-read-isam-const-mstr.

    move 'N'                            to flag-lock.

    read    iconst-mstr
        invalid key
            move "Y"                    to      fatal-error-flag
            go to uj1-99-exit.

    move "N"                            to      fatal-error-flag

    add  1                              to ctr-read-const-mstr.

uj1-99-exit.
    exit.


xc0-check-oma-code.

    perform tg0-read-oma-fee-mstr        thru tg0-99-exit.

    if     not valid-oma-code
       and not price-only-claim
    then
        move 2                          to      ws-carriage-ctrl
        move 8                          to      err-ind
        move clmhdr-accounting-nbr      to      err-accounting-nbr
        perform zb0-build-write-err-rpt-line    thru    zb0-99-exit
*       (BLANK OUT OMA FEE RECORD SINCE IT WAS INVALID)
        move spaces                     to      fee-mstr-rec.
*   endif

xc0-99-exit.
    exit.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 122
*                      newu701.cbl                                   )

xx0-process-hold-dtls.

*   (process the detail records in the hold area  - ie. price
*    them, write them out, and reset counters/subscripts)
    if batch-provider-nbr = "264978"
    then
        if hold-accounting-nbr = "00000004"
        then
            next sentence
        else
            next sentence
    else
        next sentence.
*   endif

    if ss-clmdtl-oma > 0
    then
*       (initialize next available dtl subscript)
        move ss-clmdtl-oma                     to     ss-clmdtl-next-avail-dtl
        move "N"                               to     flag-tech-prof-suffix-rule
        perform zz3-apply-tech-prof-suff-rules thru   zz3-99-exit
                varying ss-tech-prof-suff
                from    1
                by      1
                until ss-tech-prof-suff > ss-clmdtl-oma
*       (if new details added, then increase max dtl subscript)
        perform xx1-test-for-new-dtls   thru    xx1-99-exit
        move 1                          to      ss-basic-times-desc-rec
        move 0                          to      ss-basic-times
        perform ya0-price-claim         thru    ya0-99-exit

        perform xx2-write-susp-diskout-dtl      thru    xx2-99-exit
                varying ss-write-dtl
                from    1
                by      1
                until ss-write-dtl > ss-clmdtl-oma
        move 'Y'                        to   detail-written-flag
*       (reset subscripts for detail recs)
        move 0                          to   ss-clmdtl-oma
                                             ss-price
                                             ss-write-dtl
*       (00/aug/13 B.E. - reset special add-on code flag)
        move "N"                        to   ws-special-add-on-cd-entered
*       (b.e. - 2000/jun/28 zero out hold area)
        perform aa1-init-hold-oma-rec      thru    aa1-99-exit
                varying i
                from    1
                by      1
                until   i  > 40
*       (WRITE OUT HEADER NOW THAT PRICES ARE KNOWN)
        perform tc0-write-hdr-rec       thru tc0-99-exit
   else
**      (This is to ensure that each claim has a detail record.  If not,
**       then an error is generated)
        if     ss-clmdtl-oma = 0
           and ctr-hdr2-rec = 1
           and ctr-addr-rec = 1
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 123
*                      newu701.cbl                                   )
           and not price-only-claim
        then
           move ws-error-literal                to      err-warn-msg
           perform xb0-print-warning-line thru xb0-99-exit
           move 1                          to   ws-carriage-ctrl
           move 50                         to   err-ind
           move clmhdr-accounting-nbr      to   err-no-detail-claim
           perform zb0-build-write-err-rpt-line thru zb0-99-exit.
*       endif
*   endif

xx0-99-exit.
    exit.


xx1-test-for-new-dtls.

*   (if next available detail record number is greater than original
*    max number of details, then new records were created so update
*    new maximum)

    if ss-clmdtl-next-avail-dtl > ss-clmdtl-oma
    then
        move ss-clmdtl-next-avail-dtl   to      ss-clmdtl-oma.
*   endif

xx1-99-exit.
    exit.

xx2-write-susp-diskout-dtl.
*   (write detail rec from data in the priced hold area to the suspend file)

*   (sum total priced detail into audit total of run
*    using whichever price is to be used)

*   (pricing algorith may have overriden prices but for total
*    dollars 'read' use the incoming amounts
    add hold-fee-incoming(ss-write-dtl) to   ctr-tot-dollars-read.

    add hold-fee-ohip(ss-write-dtl)     to   ctr-tot-dollars-ohip
    add hold-fee-oma (ss-write-dtl)     to   ctr-tot-dollars-oma

*   (2000/jun/05 B.E. - keep running counter of tech fee to sum into hdr rec)
    add  hold-priced-tech(ss-write-dtl) to   ctr-tot-tech-claim.

    perform hb0-build-susp-dtl-rec-dtl  thru hb0-99-exit.

    perform td0-write-susp-dtl           thru td0-99-exit.

*   (BUILD DISKOUT DISKETTE RECORD)
    perform xx2a-build-diskout-rec       thru xx2a-99-exit.
    perform te0-write-disk-out           thru te0-99-exit.

xx2-99-exit.
    exit.


xx2a-build-diskout-rec.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 124
*                      newu701.cbl                                   )

    move hold-accounting-nbr                to  diskout-clmhdr-claim.

*   (2001/oct/03 B.E. added new clinic-nbr to output file)
    move bt-clinic-nbr-1-2                  to  diskout-clmhdr-clinic-nbr.

    move hold-oma-cd        (ss-write-dtl)  to  diskout-oma-svc-code.
    move hold-oma-suff      (ss-write-dtl)  to  diskout-oma-svc-suff.
    move hold-sv-nbr-serv   (ss-write-dtl)  to  diskout-nbr-serv.
    move hold-sv-date       (ss-write-dtl)  to  diskout-svc-date.
    move hold-fee-oma       (ss-write-dtl)  to  diskout-oma-amt-billed.
    move hold-fee-ohip      (ss-write-dtl)  to  diskout-ohip-amt-billed.
    move hold-priced-tech   (ss-write-dtl)  to  diskout-priced-tech.
    move hold-basic-tech    (ss-write-dtl)  to  diskout-basic-tech.
    move hold-basic-prof    (ss-write-dtl)  to  diskout-basic-prof.
    move hold-basic-fee     (ss-write-dtl)  to  diskout-basic-fee.
    move carriage-return                    to  diskout-cr.

xx2a-99-exit.
    exit.



copy "pricing_logic.rtn".
* file: pricing_logic.rtn
* 00/aug/31 B.E. - original
* 00/sep/07 B.E. - the sequence of incoming claim details is stored in
*                   hold-incoming-line-nbr so that if the pricing
*                   module re-sorts the claim details within the hold area,
*                   the program can use the hold-line-no field to re-sort
*                   the records back into the original sequence)
*  00/sep/07 B.E. - added additional display fields in ya11-
*  00/sep/12 B.E. - yz0-reset-verify-prices logic moved from newu701 into
*                   this common pricing logic so that the resetting to
*                   'incoming' prices can be done before the technical/
*                   professional fee calculations is performed.
* 00/sep/25 B.E. - added display/confirm logic after each stage of pricing
* 00/oct/02 B.E. - ajust pricing for newu701 so that:
*                (OP claims from the web/diskette retain their incoming $ while
*                 online claims use the amount the user entered into the OMA fee
*                 as the basis for basic pricing)
* 00/dec/22 B.E. - "special"reduction (see MaryAnne) based upon oma code and
*                  location for in patients (currently G259/G420)
* 01/aug/29 B.E. - changed warnings so that now only if the OHIP amount
*                 is zero does the system stop the user and the value in the
*                 oma amount is ignored
* 01/sep/02 B.E. - changed logic of how ADJUDICATION description was being
*                  created so that clmhdr manual-review-flag would be
*                  set automatically
* 01/sep/27 B.E. - uncommented line on .85 reduction pricing that was
*                  accidentally commented out


ya0-price-claim.

*   (turn off the zero fee flag until the end of pricing so that the
*    warning is not produced each pass)
    move 'N'                                            to flag-zero-fee.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 125
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)

*    (note:  all pricing constant values are found in record 2 of constants
*            master file which was read in 'mainline')

*   (if the agent code is 'wcb' the constants master wcb rate is held
*    or else the variable is set to 1 for no affect in the
*    multiplication.)
    if def-agent-wcb
    then
*       (wcb pricing/reductions not required at RMA currently, therefore
*        just use the 1st line's curr-prev value to set rate)
        move hold-ss-curr-prev(1)               to ss-curr-prev
        move const-wcb(ss-curr-prev)            to ws-hold-wcb-rate
    else
        move 1                                  to ws-hold-wcb-rate.
*   endif

*   (if incoming diskette file was priced, then "B" and "C" suffix'd lines
*    have the number of services combined using the 'basic + times' logic
*    and this routine will strip out the basic units so that the regular
*    pricing algorith will work)
    if   (    diskette-claim
          and override-with-rma-prices
         )
    then
        perform ya5-reset-nbr-services-value    thru ya5-99-exit
            varying ss
            from 1 by 1
            until   ss > ss-clmdtl-oma.
*   endif

*   (find the 'SP99' and 'SP98' add-on group reduction rates)
*   (00/aug/08 changed to allow all ICC codes to be possible add on's)
    move 1                                      to ws-reduc-rate.

    perform ya2-find-add-on-reduc-rate          thru ya2-99-exit
        varying subs
        from 1 by 1
        until   subs > const-max-nbr-rates.


    perform yb0-calc-basic-fee                  thru yb0-99-exit
        varying ss
        from 1 by 1
        until   ss > ss-clmdtl-oma.


*       (if only 1 detail entry then no further reductions necessary)
    if ss-clmdtl-oma = 1
    then
        go to ya0-98-display-fees.
*   (else)
*   endif

    perform ya1-display-fees                    thru ya1-99-exit.
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 126
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
        move 90                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==

    move 1                                      to ss
                                                   ss2.
    perform yc0-sort-by-icc-and-fee             thru yc0-99-exit
                until ss2 not < ss-clmdtl-oma.

    move "N"                                    to flag-sec-reduction-needed.

    move zero                                   to ss-grp-tot
                                                   hold-grp-totals-tbl.
    move 1                                      to ss-sec
                                                   ss-grp
                                                   hold-flag-sec ( 1 )
                                                   hold-flag-grp ( 1 ).
    perform yd0-set-icc-sort-flags              thru yd0-99-exit
        varying ss
        from 2 by 1
        until   ss > ss-clmdtl-oma.

    move ss-clmdtl-oma                          to ss-hold-clmdtl-oma.

    perform xa0-display-details                 thru xa0-99-exit
                 varying ss-clmdtl-oma
                 from 1
                 by 1
                 until   ss-clmdtl-oma > ss-hold-clmdtl-oma
                      or ss-clmdtl-oma > ss-max-nbr-oma-det-rec-allow.

    move ss-hold-clmdtl-oma                     to ss-clmdtl-oma.

*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 91                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==

    perform ye0-group-reductions                thru ye0-99-exit
        varying ss
        from 1 by 1
        until   ss > ss-clmdtl-oma
*  (00/jul/27 B.E. removed hard coding of 7 and replace with calculation)
*            or ss > 7.
             or ss > (ss-max-nbr-oma-det-rec-allow - 1) .

    perform ya1-display-fees                    thru ya1-99-exit.
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 92                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 127
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==

    perform yf0-add-on-increases                thru yf0-99-exit
        varying ss
        from 1 by 1
        until   ss > ss-clmdtl-oma.

    perform ya1-display-fees                    thru ya1-99-exit.
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 93                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==


*       (at this time, only 'sp' oma codes require 'sectional' reduction)
    if flag-sec-reduction-needed = "N"
    then
        go to ya0-98-display-fees.
*   (else)
*   endif

    move 1                                      to ss-from.
    move 0                                      to ss-to.

ya0-calc-sectional-reductions.

    if hold-icc-sec (ss-from) not = "SP"
    then
        move ss-from                    to      ss-to
        go to ya0-increment-ss-from.
*   (else)
*   endif

    perform yh0-find-high-grp-within-sec        thru yh0-99-exit.

    if online-claim
    then
        display scr-acpt-det-desc.
*   endif

*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 94                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==

    perform yi0-sec-reduct-within-sec           thru yi0-99-exit
                varying ss
                from ss-from by 1
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 128
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
                until   ss > ss-to.

ya0-increment-ss-from.

    if ss-to < ss-clmdtl-oma
    then
        add  1, ss-to                           giving  ss-from
        move 0                                  to      ss-to
        perform ya1-display-fees                thru    ya1-99-exit
*       ==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
        if password-input = password-special-privledges
        then
            move 95                                 to err-ind
            perform za0-common-error                thru za0-99-exit
*       ==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
            go to ya0-calc-sectional-reductions
        else
            go to ya0-calc-sectional-reductions.
*       endif
*   (else)
*   endif

    perform yf1-special-add-on-incr             thru yf1-99-exit
        varying ss
        from 1 by 1
        until   ss > ss-clmdtl-oma.

    perform ya1-display-fees                    thru ya1-99-exit.
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 96                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==


ya0-98-display-fees.
*   (display fees before min-max testing so that if warning message is displayed
*    that fees being in/decreased then the Operator can see the fees on the
*    screen)
    perform ya1-display-fees                    thru ya1-99-exit.
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 97                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==

*   (test min/max price to ensure that calculated basic prices are within
*    acceptable range)
    perform test-min-max-limits                 thru test-min-max-limits-99-exit
        varying ss
        from 1 by 1
        until   ss > ss-clmdtl-oma.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 129
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)

*  (display the fees again in case they min-max testing has changed the
*   fee)
*  (turn on flag to print warning message if a zero fee is found)
    move 'Y'                                    to flag-zero-fee.
    perform ya1-display-fees                    thru ya1-99-exit.
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 98                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==



*   (00/sep/12 B.E. - reset prices, if necessary, before calculating
*                     technical/professional breakdown)
*   (this routine has priced claims according to RMA pricing. If
*    incoming file was "D"iskette, then reset prices to the 'incoming'
*    values rather than RMA priced amounts. If the file was from the "W"eb,
*    then reset any OP or MR line to 'incoming' prices)
    if not online-claim
    then
        perform yz0-reset-verify-prices      thru yz0-99-exit.
*   endif

    perform ya3-calc-priced-tech                thru ya3-99-exit
        varying ss
        from 1
        by   1
        until   ss > ss-clmdtl-oma.

    perform ya1-display-fees                    thru ya1-99-exit.
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 99                                 to err-ind
        perform za0-common-error                thru za0-99-exit.
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==


*   (00/sep/07 B.E. - if necessary, sort the details back into their
*                     original sequence)
    move 1                                      to ss
                                                   ss2.
    perform yj0-sort-by-orig-line-no            thru yj0-99-exit
                until ss2 not < ss-clmdtl-oma.
*   (redisplay records in original sequence)
    perform ya1-display-fees                    thru ya1-99-exit.
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==
    if password-input = password-special-privledges
    then
        move 100                                to err-ind
        perform za0-common-error                thru za0-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 130
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*   (else)
*   endif
*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==*==


ya0-99-exit.
    exit.


ya1-display-fees.

    move ss-clmdtl-oma                          to ss-hold-clmdtl-oma.

    perform ya11-disp-oma-fees                  thru ya11-99-exit
                varying ss-clmdtl-oma
                from 1
                by   1
                until   ss-clmdtl-oma > ss-hold-clmdtl-oma
                     or ss-clmdtl-oma > ss-max-nbr-oma-det-rec-allow.

    move ss-hold-clmdtl-oma                     to ss-clmdtl-oma.

ya1-99-exit.
    exit.


ya11-disp-oma-fees.

*   (display fields on screen, only if pricing is for "online" d001 pgm)
*    and skip if 'web' or 'diskette' type batch pricing)
    if online-claim
    then
        next sentence
    else
        go to ya11-99-exit.
*   endif

    add ss-clmdtl-oma
*       (sms 126 allow for 8 claim details instead of 6)
*       14                              giving pline.
        13                              giving pline.

*   (00/sep/07 B.E. - added additional display fields)
    display scr-hold-oma-cd.
    display scr-hold-oma-suff.
    display scr-hold-sv-date-yy-12.
    display scr-hold-sv-date-yy-34.
    display scr-hold-sv-date-mm.
    display scr-hold-sv-date-dd.

    display scr-hold-sv-nbr-0
    display scr-hold-fee-oma.
    display scr-hold-fee-ohip.
*   (2001/aug/29 B.E. changed warning so that now only if the OHIP amount
*                     is zero does the system stop the user)
*      if      ( hold-fee-oma(ss-clmdtl-oma)  = 0
*            or  hold-fee-ohip(ss-clmdtl-oma) = 0 )

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 131
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
    if    hold-fee-ohip(ss-clmdtl-oma) = 0
      and flag-zero-fee = 'Y'
    then
        move '* Warning - '             to e1-error-word
        move 59                         to err-ind
        perform za0-common-error        thru za0-99-exit
        move '* Error - '               to e1-error-word.
*   (else)
*   endif

ya11-99-exit.
    exit.



ya2-find-add-on-reduc-rate.

*   (find the 'SP99' and 'SP98' add-on group reduction rates)

*  ****  BUG BUG BUG BUG BUG BUG  - using first line's curr-prev subscript  ***
*  ****  which may/maynot be SP98/SP99 item) **********************************
    move hold-ss-curr-prev(1)               to ss-curr-prev.

    if const-section-group (subs) = 'SP98'
    then
            move const-rates-curr-prev ( subs, ss-curr-prev) to ws-reduc-rate98
    else
        if const-section-group (subs) = 'SP99'
        then
            move const-rates-curr-prev ( subs, ss-curr-prev) to ws-reduc-rate99
        else
*           (00/aug/08 - no rate needed for non-SP add ons)
            move 1                                           to ws-reduc-rate98
                                                                ws-reduc-rate99.
*       endif
*   endif

ya2-99-exit.
    exit.


ya3-calc-priced-tech.

*   (sms #113 - treat agent 4 as direct bill)
    if         def-agent-wcb
      and not hold-fee-ohip-r(ss) = 0
      and not hold-fee-oma-r (ss) = 0
    then
        perform ya4-round-wcb                   thru ya4-99-exit.
*   endif

    if    hold-basic-tech(ss) = 0
       or hold-basic-fee (ss) = 0
       or hold-fee-ohip  (ss) = 0
    then
       move 0 to hold-priced-tech(ss)
    else
       compute hold-priced-tech(ss) rounded =
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 132
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
                (hold-basic-tech(ss) * hold-fee-ohip(ss)) / hold-basic-fee(ss).
*   endif

ya3-99-exit.
    exit.

ya4-round-wcb.

    divide hold-fee-ohip-r(ss)  by 5
        giving ws-hold-temp-3 remainder ws-hold-temp-2.

    if ws-hold-temp-2 < 3
    then
        subtract ws-hold-temp-2 from hold-fee-ohip-r(ss)
    else
        subtract ws-hold-temp-2 from 5 giving ws-hold-temp-2
        add      ws-hold-temp-2 to   hold-fee-ohip-r(ss).
*   endif

    divide hold-fee-oma-r(ss)   by 5
        giving ws-hold-temp-3 remainder ws-hold-temp-2.

    if ws-hold-temp-2 < 3
    then
        subtract ws-hold-temp-2 from hold-fee-oma-r(ss)
    else
        subtract ws-hold-temp-2 from 5 giving ws-hold-temp-2
        add      ws-hold-temp-2 to   hold-fee-oma-r(ss).
*   endif

ya4-99-exit.
    exit.


ya5-reset-nbr-services-value.

*  (incoming anaesthetis/assitance reocrds (B and C suffixed claims) have
*   the number of services bumped up by the act of pricing the claim. so that
*   the RMA pricing algorithm will work, extract out the basic units from
*   the number of services from incoming claims)


*      hold-sv-nbr-serv-incoming(ss)
    if hold-sv-nbr-serv(ss) not = 0
    then
*       CASE
        if hold-oma-suff(ss) = "B"
        then
            if hold-oma-cd(ss) = "E400" or "E401"
            then
                move 0                  to     hold-sv-nbr-serv(ss)
            else
                subtract hold-oma-fee-asst (ss,ohip)
                                        from   hold-sv-nbr-serv(ss)
                                        giving hold-sv-nbr-serv(ss)
        else
        if hold-oma-suff(ss) = "C"
        then
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 133
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
            if hold-oma-cd(ss) = "E400" or "E401"
            then
                move 0                  to     hold-sv-nbr-serv(ss)
            else
                subtract hold-oma-fee-anae (ss,ohip)
                                        from   hold-sv-nbr-serv(ss)
                                        giving hold-sv-nbr-serv(ss).
*       ENDCASE
*   endif

ya5-99-exit.
    exit.

yb0-calc-basic-fee.

*       (all entries except 'BI','OP' and 'add on codes' are priced according to
*        the calculated basic-fee using the following formula :
*               fee = basic-fee * (#-of-services)
*
*       'bi'lateral entries are priced according to:
*               fee = basic-fee * (constants-master-bilateral-percentage-rate)

*       'OP' override priced uses the fee entered by the
*         operator for the oma-amt
*         and multiply this fee by a constants-mstr-indep-consider-rate
*         to obtain the ohip-amt unless batch-agent-code is 'direct' or 'wcb'
*         in which case the amt-entered is used for both oma and ohip fees.

*        NOTE: as documented in line below, 'add on' codes were identified by
*              having ICC code of SP98/99. Changed to look for
*              "F"lat/"P"ercentage designation
*              in field fee-add-on-perc-or-flat-ind
*         'add on' codes which have an icc-code of "SP98" or "SP99"
*          are set to zero at this time --
*           -- routine 'yf0' will later price these add on codes)


*       agent code = 'wcb' ("9") is priced according to --
*            'basic-rate' * constants master 'wcb-rate'
*       wcb uses ohip-rate not oma-rate for basic-fee
*                ----          ---

*       agent code = 'direct bill' ("6") uses oma not ohip-rate for basic-fee
*                                             ---     ----

*=============  put the table used in calculating prices here =================

*       (this flag will indicate if fee-1 ('1'),
*                                   fee-2 ('2')
*                                or "fee-1 + fee-2" ('3')
*        is used in calculating final amount)
    if hold-oma-cd(ss) = "E409"
    then
        next sentence.
*    endif

    move "0"                                    to hold-flag-fee-used (ss).

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 134
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*   (OP claims from the web/diskette retain their incoming $ while
*    online claims use the amount the user entered into the OMA fee
*    as the basis for basic pricing)
    if hold-sv-day ( ss ,1) = "MR" or "OP"
    then
*   (sms #113 - treat agent 4 as direct bill)
        if   def-agent-ohip
          or def-agent-ohip-wcb
          or def-agent-alternate-funding
        then
            move hold-ss-curr-prev(ss)              to ss-curr-prev
            if online-claim
            then
                compute hold-fee-ohip (ss) rounded
                      = hold-fee-oma  (ss) * const-ic (ss-curr-prev)
                go to yb0-98-technical
            else
                compute hold-fee-ohip      (ss) rounded
                      = hold-fee-incoming  (ss) * const-ic (ss-curr-prev)
                move    hold-fee-ohip      (ss) to hold-fee-oma (ss)
                go to yb0-98-technical

        else
*               (agent 'non-ohip' ie. 'wcb' and 'direct')
            move  hold-fee-oma  (ss) to hold-fee-ohip (ss)
            go to yb0-98-technical.
*       endif
*   (else)
*   endif

*   (00/aug/08 B.E.
*    recognize 'add on' codes by "P"ercent/"F"lat designation rather
*    than having to have a specific ICC code)
*           if hold-icc-cd (ss) =    "SP99"
*                                 or "SP98"

    if hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) = "P"
                                                       or "F"
    then
        move 0                                  to hold-fee-oma  (ss)
        move 0                                  to hold-fee-ohip (ss)
        go to yb0-98-technical.
*   else
*       if hold-sv-day ( ss ,1) = "OP"
*       then
*           if   def-agent-ohip
*             or def-agent-alternate-funding
*           then
*               move hold-ss-curr-prev(ss)          to ss-curr-prev
*               compute hold-fee-ohip (ss) rounded
*                     = hold-fee-oma  (ss) * const-ic (ss-curr-prev)
*               go to yb0-98-technical
*           else
*                       (agent 'non-ohip' ie. 'wcb' and 'direct')
*               move    hold-fee-oma  (ss)
*                            to hold-fee-ohip (ss)
*               go to yb0-98-technical.
*           endif
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 135
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*       (else)
*       endif
*   endif


*   (basic fee calculation)

*   (setup currrent/previous rate subscript for this detail line)
    move hold-ss-curr-prev(ss)  to ss-curr-prev.

    if   (hold-icc-sec (ss) = "CV")
      or (     (   hold-icc-sec (ss) =   "NM"
           or      hold-icc-sec (ss) =   "DR"
           or      hold-icc-sec (ss) =   "PF"
           or      hold-icc-sec (ss) =   "DU")
           and hold-oma-suff (ss) = "B"        )

      or (      hold-icc-sec (ss) = "SP"
           and (hold-oma-suff (ss) = "A" or "M")   )

      or (      hold-icc-sec (ss) = "CP"
           and (hold-oma-suff (ss) = "A" or "M") )

      or (      hold-icc-sec (ss) = "DT"
           and (hold-oma-suff (ss) = "A" or "M")   )

    then
        move hold-oma-fee-1 (ss,oma)    to hold-fee-oma       (ss)
        move hold-oma-fee-1 (ss,ohip)   to hold-fee-ohip      (ss)
        move 1                          to hold-flag-fee-used (ss)

    else
        if   (    (   hold-icc-sec (ss) =   "NM"
               or     hold-icc-sec (ss) =   "DR"
               or     hold-icc-sec (ss) =   "DU"
               or     hold-icc-sec (ss) =   "PF")
              and hold-oma-suff (ss) = "C"          )
        then
            move hold-oma-fee-2 (ss,oma ) to hold-fee-oma       (ss)
            move hold-oma-fee-2 (ss,ohip) to hold-fee-ohip      (ss)
            move 2                        to hold-flag-fee-used (ss)

        else
            if   (    (   hold-icc-sec (ss) =   "NM"
                   or     hold-icc-sec (ss) =   "DU"
                   or     hold-icc-sec (ss) =   "PF"
                   or     hold-icc-sec (ss) =   "DR")
                  and (hold-oma-suff (ss) = "A" or "M") )
            then
                add hold-oma-fee-1 (ss,oma)
                    hold-oma-fee-2 (ss, oma)
                                        giving hold-fee-oma   (ss)
                add hold-oma-fee-1 (ss,ohip)
                    hold-oma-fee-2 (ss,ohip)
                                        giving hold-fee-ohip  (ss)
                move "3"                to hold-flag-fee-used (ss)
            else
                if   (     (   hold-icc-sec (ss) = "CP"
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 136
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
                            or hold-icc-sec (ss) = "DT"
                            or hold-icc-sec (ss) = "SP")
                      and  hold-oma-suff (ss) = "C"        )
                then
                    if ws-doc-spec-cd = 0
                    then
                        move const-reg (ss-curr-prev, 2)
                                        to hold-fee-oma (ss)
                        move const-reg (ss-curr-prev, 1)
                                        to hold-fee-ohip (ss)
                    else
                        move const-cert (ss-curr-prev, 2)
                                        to hold-fee-oma (ss)
                        move const-cert (ss-curr-prev, 1)
                                        to hold-fee-ohip (ss)
*                   endif
                else
                    if    hold-icc-sec  (ss) = "SP"
                      and hold-oma-suff (ss) = "B"
                    then
                        move const-asst (ss-curr-prev, 2)
                                        to hold-fee-oma (ss)
                        move const-asst (ss-curr-prev, 1)
                                        to hold-fee-ohip (ss)
                    else
                        next sentence.
*                   endif
*               endif
*           endif
*       endif
*   endif


*       (apply 'bi'lateral reduction unless i.o.p. code)

    if     hold-sv-day ( ss, 1)         = "BI"
       and hold-oma-cd-alpha ( ss ) not = "Z"
    then
        compute hold-fee-oma  (ss) rounded
                = hold-fee-oma  (ss) * const-bilateral( ss-curr-prev)
        compute hold-fee-ohip (ss) rounded
                = hold-fee-ohip (ss) * const-bilateral( ss-curr-prev)
        go to yb0-50
    else
        next sentence.
*   endif


*       (calculate total # of services)
    compute ws-tot-serv = hold-sv-nbr-serv (ss)
                        + hold-sv-nbr      (ss, 1)
                        + hold-sv-nbr      (ss, 2)
                        + hold-sv-nbr      (ss, 3).

*   (if anae or asst then create a 'basic + times' description rec)
    if         (hold-oma-suff (ss) =  "B" or "C")
       and not (hold-icc-sec(ss)   = "NM" or "PF" or "DU")
    then
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 137
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*       (set flag indicating a new 'B+T' type description record)
        move "BT"                               to flag-desc-rec
        perform ym0-create-desc-record          thru ym0-99-exit
    else
        next sentence.
*   endif

*   (if anaesthetist ('C') then  fee =
*    =      basic fee (which takes into consideration regular vs certified rate)
*     times (# services + oma code's anaesthetist 'basic' units)
    if     hold-oma-suff (ss) = "C"
      and (hold-icc-sec (ss)  = "CP" or "DT" or "SP")
    then
        compute hold-fee-oma  (ss) rounded
           = hold-fee-oma  (ss) * ( ws-tot-serv + hold-oma-fee-anae (ss,  oma) )
        compute hold-fee-ohip (ss) rounded
           = hold-fee-ohip (ss) * ( ws-tot-serv + hold-oma-fee-anae (ss, ohip) )
        add hold-oma-fee-anae ( ss, ohip)               to hold-sv-nbr-serv (ss)
*       (since system adds the 'basic' units to the 'nbr of svcs' then
*        automatically increase the audit totals with these 'hidden' svcs)
        add hold-oma-fee-anae ( ss, ohip)               to nbr-of-services
        if online-claim
        then
            display scr-last-claim
            go to yb0-50
        else
            go to yb0-50
    else
        next sentence.
*   endif


*   (if assistant ('B') then  fee =
*             =       basic fee
*               times (# services + oma code's 'basic' assistant units)
    if    hold-oma-suff (ss) = "B"
      and hold-icc-sec (ss) = "SP"
    then
        compute hold-fee-oma  (ss) rounded
           = hold-fee-oma  (ss) * ( ws-tot-serv + hold-oma-fee-asst (ss,  oma) )
        compute hold-fee-ohip (ss) rounded
           = hold-fee-ohip (ss) * ( ws-tot-serv + hold-oma-fee-asst (ss, ohip) )
        add hold-oma-fee-asst ( ss, ohip)               to hold-sv-nbr-serv (ss)
*       (since system adds the 'basic' units to the 'nbr of svcs' then
*        automatically increase the audit totals with these 'hidden' svcs)
        add hold-oma-fee-asst ( ss, ohip)               to nbr-of-services
        display scr-last-claim
        go to yb0-50
    else
        next sentence.
*   endif


    compute hold-fee-oma  (ss) rounded = hold-fee-oma  (ss) * ws-tot-serv.
    compute hold-fee-ohip (ss) rounded = hold-fee-ohip (ss) * ws-tot-serv.


yb0-50.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 138
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)

*       (agent is wcb - calculate at 'basic-rate' (ohip-rate not oma-rate) * 'wc
*                                                  ----          ---

*   (sms #113 - treat agent 4 as direct bill)
    if def-agent-wcb
    then
        compute hold-fee-ohip (ss) rounded = hold-fee-ohip (ss) * const-wcb( ss-
        move    hold-fee-ohip (ss)        to hold-fee-oma  (ss)
    else
*       (agent is direct bill - use oma-rate not ohip-rate)
*                                   ---          ----

*   (sms #113 - treat agent 4 as direct bill)
        if def-agent-bill-direct
           or def-agent-foreign-direct
           or def-agent-ifhp-direct
           or def-agent-ontario-direct
           or def-agent-quebec-direct
        then
            move hold-fee-oma (ss)      to hold-fee-ohip (ss)
        else
           next sentence.
*       endif
*   endif

yb0-98-technical.

*   ("special" reduction of fees based upon OMA/LOCATION, note that an
*    appropriate description record must also be created and the manual review
*    flag set to that OHIP is informed of the special pricing)

    if    hold-oma-cd(ss)    = "G259"
      and hold-oma-suff(ss)  = "A"
      and clmhdr-loc         = "G420"
      and clmhdr-i-o-pat-ind = "I"
    then
        compute hold-fee-ohip(ss) = hold-fee-ohip(ss) * .85

*       (set flag indicating an 'A'djudication type description record
*        is to be created)
         move "A"                               to flag-desc-rec
         perform ym0-create-desc-record        thru ym0-99-exit
    else
        next sentence.
*   endif

*   save basic fee and basic technical portion for later
*   calculation of the priced technical portion

    move hold-fee-ohip (ss)                     to hold-basic-fee(ss).

    if    hold-oma-rec-ind (ss,ss-tech-ind) = "Y"
       or hold-oma-suff    (ss) = 'B'
    then
        move hold-basic-fee(ss)                 to hold-basic-tech(ss)
    else
        if hold-oma-suff(ss) = 'C'
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 139
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
        then
            move zero                           to hold-basic-tech(ss)
        else
            if hold-icc-sec(ss) = 'NM' or 'DR' or 'DU' or 'PF'
            then
                move hold-oma-fee-1(ss,ohip)    to hold-basic-tech(ss)
                move hold-oma-fee-2(ss,ohip)    to hold-basic-prof(ss)
                perform yb1-compute-basic-tech  thru yb1-99-exit
            else
                move zero                       to hold-basic-tech(ss).
*   endif

yb0-99-exit.
    exit.


yb1-compute-basic-tech.

    add hold-basic-tech(ss), hold-basic-prof(ss) giving ws-hold-temp-1.

    if ws-hold-temp-1 = zero
    then
        move zero                               to hold-basic-tech(ss)
    else
        compute hold-basic-tech(ss) rounded =
                hold-basic-tech(ss) *
                (hold-basic-fee(ss) / ws-hold-temp-1).

yb1-99-exit.

    exit.

yc0-sort-by-icc-and-fee.

    if hold-sort-key-1 (ss) > hold-sort-key-1 (ss + 1)
    then
        move hold-oma-rec (ss)          to hold-sort-oma-rec
        move hold-oma-rec (ss + 1)      to hold-oma-rec (ss)
        move hold-sort-oma-rec          to hold-oma-rec (ss + 1)
        if ss > 1
        then
            subtract 1 from ss
            go to yc0-sort-by-icc-and-fee
        else
            next sentence
*       endif
    else
        if hold-sort-key-1 (ss) = hold-sort-key-1 (ss + 1)
        then
            if hold-fee-ohip (ss) < hold-fee-ohip (ss + 1)
            then
                move hold-oma-rec (ss)          to hold-sort-oma-rec
                move hold-oma-rec (ss + 1)      to hold-oma-rec (ss)
                move hold-sort-oma-rec          to hold-oma-rec (ss + 1)
                if ss > 1
                then
                    subtract 1 from ss
                    go to yc0-sort-by-icc-and-fee.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 140
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*               (else)
*               endif
*           (else)
*           endif
*       (else)
*       endif
*   endif

    add 1,  ss2                                 giving ss2
                                                       ss.

yc0-99-exit.
    exit.

yj0-sort-by-orig-line-no.

    if hold-line-no (ss) > hold-line-no (ss + 1)
    then
        move hold-oma-rec (ss)          to hold-sort-oma-rec
        move hold-oma-rec (ss + 1)      to hold-oma-rec (ss)
        move hold-sort-oma-rec          to hold-oma-rec (ss + 1)
        if ss > 1
        then
            subtract 1 from ss
            go to yj0-sort-by-orig-line-no
        else
            next sentence.
*       endif
*   endif

    add 1,  ss2                                 giving ss2
                                                       ss.

yj0-99-exit.
    exit.

yd0-set-icc-sort-flags.

    if hold-icc-sec (ss) = "SP"
    then
        move "Y"                        to flag-sec-reduction-needed.
*   (else)
*   endif

*   (if same day, check for add on code)
*   (00/aug/08 B.E.
*    recognize 'add on' codes by "P"ercent/"F"lat designation rather
*    than having to have a specific ICC code)
*             ('sp98' and 'sp99' are checks for 'add-on' codes)

    if     hold-sv-date    (ss) = hold-sv-date (ss - 1)
       and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "P"
       and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "F"
*             and  (hold-icc-cd (ss) not = "SP98")
*             and  (hold-icc-cd (ss) not = "SP99")
    then
        if    hold-icc-sec (ss) = hold-icc-sec (ss - 1)
           or hold-icc-sec (ss) = "SP"
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 141
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
        then
            if     hold-icc-grp       (ss) = hold-icc-grp (ss - 1)
              and  (    (hold-icc-cd  (ss) not = "SP00")
                     or (hold-icc-grp (ss) not = "00"  ) )
            then
                move hold-flag-sec (ss - 1) to hold-flag-sec (ss)
                move hold-flag-grp (ss - 1) to hold-flag-grp (ss)
                go to yd0-99-exit
            else
                move hold-flag-sec (ss - 1)     to     hold-flag-sec (ss)
                add  1, ss-grp          giving ss-grp
                                                       hold-flag-grp (ss)
                go to yd0-99-exit.
*           endif
*       (else)
*       endif
*   (else)
*   endif

    add 1, ss-sec                               giving ss-sec
                                                       hold-flag-sec (ss).
    move 1                                      to     ss-grp
                                                       hold-flag-grp (ss).

yd0-99-exit.
    exit.



ye0-group-reductions.

*       (do not do group reduction if the 'icc' group code = "00" --
*       -- also bilateral and independent considerations are not 'group reduced"
*       note - sort has put highest valued entry in group in lower subscripted
*              position of hold-array. therefore we reduce entires (ss+1)
*            - if the icc code of entry to be reduced is not found in constant
*              master record's table of rate then no reduction is done

    add ss, 1                           giving ss-plus-one.

    if      hold-flag-sec-group (ss)  = hold-flag-sec-group (ss-plus-one)
       and (hold-icc-grp (ss)     not = "00")
       and (hold-sv-day ( ss, 1)  not = "BI")
       and (hold-sv-day ( ss, 1)  not = "MR")
       and (hold-sv-day ( ss, 1)  not = "OP")
    then
        move 0                          to rate-found-ss
        perform ye1-find-group-rate     thru ye1-99-exit
                varying ss-x
                from 1 by 1
                until    rate-found-ss not = 0
                      or ss-x > const-max-nbr-rates

*       (setup currrent/previous rate subscript for this detail line)
        move hold-ss-curr-prev(ss)  to ss-curr-prev
        if rate-found-ss not = 0
        then
            compute hold-fee-ohip (ss-plus-one)  rounded =
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 142
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
                    hold-fee-ohip (ss-plus-one) * const-rates-curr-prev ( rate-f
            compute hold-fee-oma  (ss-plus-one)  rounded =
                    hold-fee-oma  (ss-plus-one) * const-rates-curr-prev ( rate-f
*       (else)
*       endif
*   (else)
*   endif

*  (may need 'pricing_test_min_max_limits.ws' logic here!!)

ye0-99-exit.
    exit.

ye1-find-group-rate.

    if const-section-group (ss-x) = hold-icc-cd (ss-plus-one)
    then
        move ss-x                       to rate-found-ss.
*   (else)
*   endif

ye1-99-exit.
    exit.


yf0-add-on-increases.

*       (this rtn is called varying 'ss' across # of detail lines ('ss-clmdtl-om
*       - if add on codes e409 or e400 have been entered then flag
*         will force search for these codes -- search must be made since
*         these codes are considered as add on's for all oma codes
*         but are not found in any code's 'hold-oma-add-on-cd (x)' fields)


*        skip search if code being checked (ie. oma-cd (ss) )
*          is an add-on code itself since add on's for add on's is not allowed)

    if     hold-oma-cd (ss) =   "E400"
                             or "E409"
                             or "E410"
                             or "E401"
       or hold-sv-day(ss,1) = "MR" or "OP"
*================   you can add on  to an add on  ==========================
****      or (hold-icc-cd (ss) =   "SP98"
****                            or "SP99")
*      or hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind )=   "P"
*                                                           or "F"

    then
        go to yf0-99-exit.
*   (else)
*   endif
*============================================================================


    if     ws-special-add-on-cd-entered = "N"
      and (hold-oma-add-on-cd (ss, 1) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 2) = spaces  or  zeroes)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 143
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
      and (hold-oma-add-on-cd (ss, 3) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 4) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 5) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 6) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 7) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 8) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 9) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss,10) = spaces  or  zeroes)
    then
        next sentence
    else
        perform yf2-search-oma-recs-4-addon-cd  thru yf2-99-exit
            varying ss2
            from 1 by 1
            until   ss2 > ss-clmdtl-oma.
*   endif

yf0-99-exit.
    exit.

yf2-search-oma-recs-4-addon-cd.

*       (note: add on codes "E409" and "E400" are considerated as add on
*        codes for all oma codes and need not be found in add-on-code slots
*                  ===


*       (add on codes allowed only if performed on same service date)
    if hold-sv-date (ss2) not = hold-sv-date (ss)
    then
        go to yf2-99-exit.
*   (else)
*   endif
*   (00/agu/08 B.E.
*    SP98 and SP99 add on codes have to be reduced by their 'group reduction'
*    factor, however all other add ons have no reduction rate)
    if hold-icc-cd (ss2) = 'SP98'
    then
        move ws-reduc-rate98                    to ws-reduc-rate
    else
        if hold-icc-cd (ss2) = 'SP99'
        then
            move ws-reduc-rate99                to ws-reduc-rate
        else
            move 1                              to ws-reduc-rate.
*       endif
*   endif

    if hold-oma-cd (ss2) =    hold-oma-add-on-cd (ss, 1)
                           or hold-oma-add-on-cd (ss, 2)
                           or hold-oma-add-on-cd (ss, 3)
                           or hold-oma-add-on-cd (ss, 4)
                           or hold-oma-add-on-cd (ss, 5)
                           or hold-oma-add-on-cd (ss, 6)
                           or hold-oma-add-on-cd (ss, 7)
                           or hold-oma-add-on-cd (ss, 8)
                           or hold-oma-add-on-cd (ss, 9)
                           or hold-oma-add-on-cd (ss,10)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 144
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*============================================================================
*                                 or "E409"
*============================================================================
                           or "E400"
                           or "E401"
    then
        next sentence
    else
        go to yf2-99-exit.
*   endif

    if hold-oma-suff(ss2) not = hold-oma-suff(ss)
    then
        go to yf2-99-exit.
*   (else)
*   endif

*       (note - fee-1 contains percent of add on code (ss2) --
*        - also the percentage type add-on is not multiplied by
*          wcb-rate since the value of oma code from which add on's percentage
*          is calculated, has already been multiplied by the wcb-rate --
*          however flat rate is calculated as flat-rate * wcb-rate)

    if hold-oma-rec-ind (ss2 , ss-add-on-perc-or-flat-ind) <> "P"
    then
        go to yf2-30.
*   endif

*   (============  percentage add-on code calculation ==========)
*   (calculate Percentage price unless operator has Overridden Price)
*   (00/aug/31 B.E. changed subscript line below from ss-clmdtl-oma to ss2)
*       if hold-sv-day ( ss-clmdtl-oma, 1) not = "OP"

    if hold-sv-day ( ss2, 1) not = "OP"
    then
        compute hold-fee-oma  (ss2) rounded =
                hold-fee-oma  (ss2)     + (   hold-fee-oma   (ss)
                                            * hold-oma-fee-1 (ss2 , oma)
                                            * ws-reduc-rate    )
        compute hold-fee-ohip  (ss2) rounded =
                hold-fee-ohip  (ss2)    + (   hold-fee-ohip   (ss)
                                            * hold-oma-fee-1 (ss2 , ohip)
                                            * ws-reduc-rate    )
*       (if special add-on code then update addon with # of services from 'main'
        if hold-oma-cd (ss2) =    "E400"
                               or "E401"
        then
            compute hold-sv-nbr-serv (ss2)      =  hold-sv-nbr-serv ( ss2)
                                                 + hold-sv-nbr-serv ( ss)
                                                 + hold-sv-nbr      ( ss, 1)
                                                 + hold-sv-nbr      ( ss, 2)
                                                 + hold-sv-nbr      ( ss, 3)
*           (since system adds the 'basic' units to the 'nbr of svcs' then
*            increase the audit totals with these 'additional' svcs)
            compute nbr-of-services             =  nbr-of-services
                                                 + hold-sv-nbr-serv ( ss)
                                                 + hold-sv-nbr      ( ss, 1)
                                                 + hold-sv-nbr      ( ss, 2)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 145
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
                                                 + hold-sv-nbr      ( ss, 3)
            display scr-last-claim
            go to yf2-50
        else
            go to yf2-50
*           endif
*       endif
    else
        next sentence.
*   endif


yf2-30.
*   ( ===========  FLAT add-on code calculation ========== )
*   (the # of services doesn't effect pricing for the two special add-on codes)
*   if hold-oma-cd ( ss2 ) = "E409"
*   then
*       move 1                                  to ws-pricing-nbr-serv
*   else
        compute ws-pricing-nbr-serv =             hold-sv-nbr-serv ( ss2)
                                                + hold-sv-nbr      ( ss2, 1)
                                                + hold-sv-nbr      ( ss2, 2)
                                                + hold-sv-nbr      ( ss2, 3).
*   endif

*    note - fee-2 contains flat rate value of add on code (ss2)
*   (calculate Flag price unless operator has Overridden Price)
*   (00/aug/31 B.E. changed subscript line below from ss-clmdtl-oma to ss2)
*       if hold-sv-day ( ss-clmdtl-oma, 1) not = "OP"

    if hold-sv-day ( ss2, 1) not = "OP"
    then
        compute hold-fee-oma   (ss2) rounded =
                hold-fee-oma   (ss2)        +   (   hold-oma-fee-2 (ss2 ,  oma)
                                                  * ws-hold-wcb-rate
                                                  * ws-pricing-nbr-serv
                                                  * ws-reduc-rate       )
        compute hold-fee-ohip  (ss2) rounded =
                hold-fee-ohip  (ss2)        +  (   hold-oma-fee-2 (ss2 , ohip)
                                                 * ws-hold-wcb-rate
                                                 * ws-pricing-nbr-serv
                                                 * ws-reduc-rate       ).
*   endif

yf2-50.

*    (e409 has special processing - it is calculated as a percent but then
*     the result is compared against the 'flat' rate -- the greater amount is us

*   if hold-oma-cd (ss2) = "E409"
*   then
*       (if percent calculated amt < 'flat' rate)
*       if  hold-fee-oma (ss2)     < hold-oma-fee-2 (ss2, oma)
*       then
*           move hold-oma-fee-2 (ss2, oma)      to hold-fee-oma  (ss2)
*           move hold-oma-fee-2 (ss2,ohip)      to hold-fee-ohip (ss2)
*       else
*           next sentence.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 146
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*       endif
*   endif

*       (agent is wcb - calculate at 'basic-rate' (ohip-rate not oma-rate) * 'wc
*                                                  ----          ---

*   (sms #113 - treat agent 4 as direct bill)
*   if def-agent-wcb
*   then
**      (setup currrent/previous rate subscript for this detail line)
*       move hold-ss-curr-prev(ss)  to ss-curr-prev
*       compute hold-fee-ohip (ss) rounded = hold-fee-ohip (ss) * const-wcb( ss-
*       move    hold-fee-ohip (ss)        to hold-fee-oma  (ss)
*   else
*       (agent is direct bill - use oma-rate not ohip-rate)
*                                   ---          ----

*   (sms #113 - treat agent 4 as direct bill)
        if def-agent-bill-direct
           or def-agent-foreign-direct
           or def-agent-ifhp-direct
           or def-agent-ontario-direct
           or def-agent-quebec-direct
        then
            move hold-fee-oma (ss)      to hold-fee-ohip (ss)
        else
            next sentence.
*       endif
*   endif

yf2-99-exit.
    exit.


yf1-special-add-on-incr.

*       (this rtn is called varying 'ss' across # of detail lines ('ss-clmdtl-om
*       - if add on codes e409 or e400 have been entered then flag
*         will force search for these codes -- search must be made since
*         these codes are considered as add on's for all oma codes
*         but are not found in any code's 'hold-oma-add-on-cd (x)' fields)


*        skip search if code being checked (ie. oma-cd (ss) )
*          is an add-on code itself since add on's for add on's is not allowed)

    if     hold-oma-cd (ss) =   "E400"
                             or "E409"
                             or "E401"
                             or "E410"
*==*==   you can add on  to an add on  *==*==**
***      or (hold-icc-cd (ss) =   "SP98"
***                            or "SP99")
*    if hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind )=   "P"
*                                                         or "F"

    then
        go to yf1-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 147
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*   (else)
*   endif


    if     ws-special-add-on-cd-entered = "N"
      and (hold-oma-add-on-cd (ss, 1) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 2) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 3) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 4) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 5) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 6) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 7) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 8) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss, 9) = spaces  or  zeroes)
      and (hold-oma-add-on-cd (ss,10) = spaces  or  zeroes)
    then
        next sentence
    else
        perform yf3-search-oma-recs-4-addon-cd  thru yf3-99-exit
            varying ss2
            from 1 by 1
            until   ss2 > ss-clmdtl-oma.
*   endif

yf1-99-exit.
    exit.

yf3-search-oma-recs-4-addon-cd.

*       (note: add on codes "E409" and "E400" are considerated as add on
*        codes for all oma codes and need not be found in add-on-code slots
*                  ===

*       (add on codes allowed only if performed on same service date)
    if hold-sv-date (ss2) not = hold-sv-date (ss)
    then
        go to yf3-99-exit.
*   (else)
*   endif
*   (00/aug/08 B.E.
*    if not SP add on, no group reduction factor needed, default to 1)

    if hold-icc-cd (ss2) = 'SP98'
    then
        move ws-reduc-rate98                    to ws-reduc-rate
    else
        if hold-icc-cd (ss2) = 'SP99'
        then
            move ws-reduc-rate99                to ws-reduc-rate
        else
            move 1                              to ws-reduc-rate.
*       endif
*   endif

*   if hold-oma-cd (ss2) =    hold-oma-add-on-cd (ss, 1)
*                          or hold-oma-add-on-cd (ss, 2)
*                          or hold-oma-add-on-cd (ss, 3)
*                          or hold-oma-add-on-cd (ss, 4)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 148
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*                          or hold-oma-add-on-cd (ss, 5)
*                          or hold-oma-add-on-cd (ss, 6)
*                          or hold-oma-add-on-cd (ss, 7)
*                          or hold-oma-add-on-cd (ss, 8)
*                          or hold-oma-add-on-cd (ss, 9)
*                          or hold-oma-add-on-cd (ss,10)
     if hold-oma-cd (ss2) =   "E409"
                           or "E410"
*                          or "E400"
    then
        next sentence
    else
        go to yf3-99-exit.
*   endif

    if hold-oma-suff(ss2) not = hold-oma-suff(ss)
    then
        go to yf3-99-exit.
*   (else)
*   endif

*       (note - fee-1 contains percent of add on code (ss2) --
*        - also the percentage type add-on is not multiplied by
*          wcb-rate since the value of oma code from which add on's percentage
*          is calculated, has already been multiplied by the wcb-rate --
*          however flat rate is calculated as flat-rate * wcb-rate)

    if hold-oma-rec-ind (ss2 , ss-add-on-perc-or-flat-ind) <> "P"
    then
        go to yf3-30.
*   endif

*   (============  percentage add-on code calculation ==========)
*   (calculate PERCENTAGE price unless operator has Overridden Price)
*   (00/aug/31 B.E. changed subscript line below from ss-clmdtl-oma to ss2)
*       if hold-sv-day ( ss-clmdtl-oma, 1) not = "OP"

    if hold-sv-day ( ss2, 1) not = "OP"
    then
*       ( ===========  percentage add-on code calculation ========== )
        compute hold-fee-oma  (ss2) rounded =
                hold-fee-oma  (ss2)     + (   hold-fee-oma   (ss)
                                            * hold-oma-fee-1 (ss2 , oma)
                                            * ws-reduc-rate    )
        compute hold-fee-ohip  (ss2) rounded =
                hold-fee-ohip  (ss2)    + (   hold-fee-ohip   (ss)
                                            * hold-oma-fee-1 (ss2 , ohip)
                                            * ws-reduc-rate    )
            if hold-oma-cd(ss2) =    "E409"
                                  or "E410"
            then
                move 1                          to hold-sv-nbr-serv(ss2)
                go to yf3-50
            else
                go to yf3-50
*           endif
*       endif
    else
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 149
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
        next sentence.
*   endif


yf3-30.
*   ( ===========  flat add-on code calculation ========== )

*   (the # of services doesn't effect pricing for the two special add-on codes)
    if hold-oma-cd ( ss2 ) =    "E409"
                             or "E410"
    then
        move 1                                  to ws-pricing-nbr-serv.
*   else
*       compute ws-pricing-nbr-serv =             hold-sv-nbr-serv ( ss2)
*                                               + hold-sv-nbr      ( ss2, 1)
*                                               + hold-sv-nbr      ( ss2, 2)
*                                               + hold-sv-nbr      ( ss2, 3).
*   endif

*    note - fee-2 contains flat rate value of add on code (ss2)
*   (calculate FLAT price unless operator has Overridden Price)
*   (00/aug/31 B.E. changed subscript line below from ss-clmdtl-oma to ss2)
*       if hold-sv-day ( ss-clmdtl-oma, 1) not = "OP"

    if hold-sv-day ( ss2, 1) not = "OP"
    then
        compute hold-fee-oma   (ss2) rounded =
                hold-fee-oma   (ss2)        +   (   hold-oma-fee-2 (ss2 ,  oma)
                                                  * ws-hold-wcb-rate
                                                  * ws-pricing-nbr-serv
                                                  * ws-reduc-rate       )
        compute hold-fee-ohip  (ss2) rounded =
                hold-fee-ohip  (ss2)        +  (   hold-oma-fee-2 (ss2 , ohip)
                                                 * ws-hold-wcb-rate
                                                 * ws-pricing-nbr-serv
                                                 * ws-reduc-rate       ).
*   endif


yf3-50.

*    (E409 has special processing - it is calculated as a percent but then
*     the result is compared against the 'flat' rate -- the greater amount is us

*   (00/aug/31 B.E. changed subscript line below from ss-clmdtl-oma to ss2)
    if     (hold-oma-cd (ss2) =    "E409"
                                or "E410")
*                and hold-sv-day ( ss-clmdtl-oma, 1) not = "OP"
       and hold-sv-day ( ss2, 1) not = "OP"
    then
*       (if percent calculated amt < 'flat' rate)
        if  hold-fee-oma (ss2)     < hold-oma-fee-2 (ss2, oma)
        then
            move hold-oma-fee-2 (ss2, oma)      to hold-fee-oma  (ss2)
            move hold-oma-fee-2 (ss2,ohip)      to hold-fee-ohip (ss2)
        else
            next sentence.
*       endif
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 150
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
*   endif

*       (agent is wcb - calculate at 'basic-rate' (ohip-rate not oma-rate) * 'wc
*                                                  ----          ---

*   (sms #113 - treat agent 4 as direct bill)
*    if def-agent-bill-direct
*   then
*       (setup currrent/previous rate subscript for this detail line)
*       move hold-ss-curr-prev(ss)  to ss-curr-prev.
*       compute hold-fee-ohip (ss) rounded = hold-fee-ohip (ss) * const-wcb( ss-
*       move    hold-fee-ohip (ss)        to hold-fee-oma  (ss)
*   else
*       (agent is direct bill - use oma-rate not ohip-rate)
*                                   ---          ----

*   (sms #113 - treat agent 4 as direct bill)
        if def-agent-bill-direct
           or def-agent-foreign-direct
           or def-agent-ifhp-direct
           or def-agent-ontario-direct
           or def-agent-quebec-direct
        then
            move hold-fee-oma (ss)      to hold-fee-ohip (ss)
        else
            next sentence.
*       endif
*   endif

yf3-99-exit.
    exit.



yh0-find-high-grp-within-sec.
*       (calculate each group's value -- ignore all anaesthetist ('c') and assis

*       (since 'yh1' varies 'ss' from ss-from+1 up, check ss-from position of ho
    move zeros                                  to hold-grp-totals-tbl
                                                 ss-grp-tot
                                                ws-highest-grp-tot
                                                ws-highest-grp-nbr.
    move "N"                                    to flag-new-sec.

yh0-100-find-sp-suffix-a.

    if hold-oma-suff (ss-from) = "A"
    then
        add 1                           to      ss-grp-tot
        move ss-from                    to      ss
        perform yh11-add-singular-value thru    yh11-99-exit
    else
        add 1                           to      ss-from
        if ss-from > ss-clmdtl-oma
        then
            move ss-clmdtl-oma          to      ss-to
            move "Y"                    to      flag-new-sec
        else
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 151
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
            go to yh0-100-find-sp-suffix-a.
*       endif
*   endif

*       (if the icc section code indicates that 'sectional reduction' will be
*        necessary ((at this time only 'sp' for suffix codes "A" qualify)) -- th
*        the group total.  these group totals will later be used to determine
*         which group is highest valued and therefore not to be sectionally redu

    add 1, ss-from                              giving ss-from-plus-one.

    perform yh1-calc-group-values               thru yh1-99-exit
                varying ss
                from ss-from-plus-one by 1
                until   flag-new-sec = "Y".


*       (determine which group in hold-grp-tot array has highest value)

    move 'N'                                    to flag-z-highest-grp

    perform yh2-find-highest-value              thru yh2-99-exit
                varying ss
                from 1 by 1
                until ss > ss-grp-tot.

yh0-99-exit.
    exit.


yh1-calc-group-values.

*       (process only 'ss-clmdtl-oma' nbr of entries)

    if ss > ss-clmdtl-oma
    then
        move ss-clmdtl-oma                      to ss-to
        move "Y"                                to flag-new-sec
        go to yh1-99-exit.
*   (else)
*   endif

*       (if anesthetist or assistant ignore entry)
    if hold-oma-suff (ss) = "B" or "C"
    then
        go to yh1-99-exit.
*   (else)
*   endif


    if hold-icc-sec  (ss) not = "SP"
    then
        next sentence
    else
        if  hold-flag-sec-group (ss) = hold-flag-sec-group (ss - 1)
        then
            perform yh11-add-singular-value     thru    yh11-99-exit
            go to yh1-99-exit
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 152
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
        else
            if hold-flag-sec (ss) = hold-flag-sec (ss - 1)
            then
                add 1                           to ss-grp-tot
                perform yh11-add-singular-value thru    yh11-99-exit
                go to yh1-99-exit.
*           (else)
*           endif
*       endif
*    endif

*       (new section found - set flag to stop perform)

    subtract 1 from ss                          giving ss-to.
    move "Y"                                    to flag-new-sec.

yh1-99-exit.
    exit.



yh11-add-singular-value.

*       (store sec/group flag and add up group's "SINGULAR UNIT" values

*        -- determine if 'fee-1'/'fee-2'/'fee-1+fee-2' was used to calculate
*       'singular unit value'.
*       if fee used is not known (ie. flag=0) then use calculated
*       'fee-oma')


    move hold-flag-sec-group (ss)               to hold-grp-nbr (ss-grp-tot).


    if hold-flag-fee-used (ss) = "0"
    then
        add hold-fee-oma (ss)                   to hold-grp-tot (ss-grp-tot)
    else
        if hold-flag-fee-used (ss) = "1"
        then
            add hold-oma-fee-1 (ss, ohip)       to hold-grp-tot (ss-grp-tot)
        else
            if hold-flag-fee-used (ss) = "2"
            then
                add hold-oma-fee-2 (ss, ohip)   to hold-grp-tot (ss-grp-tot)
            else
                if hold-flag-fee-used (ss) = "3"
                then
                    add hold-oma-fee-1 (ss, ohip)
                        hold-oma-fee-2 (ss, ohip)
                        hold-grp-tot (ss-grp-tot) giving hold-grp-tot (ss-grp-to
*               (else)
*               endif
*           endif
*       endif
*   endif

yh11-99-exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 153
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
    exit.



yh2-find-highest-value.

    if hold-grp-tot ( ss ) > ws-highest-grp-tot
    then
        move hold-grp-tot ( ss )                to ws-highest-grp-tot
        move hold-grp-nbr ( ss )                to ws-highest-grp-nbr
        if hold-oma-cd-alpha(ss) = 'Z'
        then
            move 'Y'                            to flag-z-highest-grp.
*       (else)
*       endif
*   (else)
*   endif

yh2-99-exit.
    exit.



yi0-sec-reduct-within-sec.

*      (sectional reduction entails reducing all groups except the
*       highest priced one by the sectional reduction rate.
*       THE FOLLOWING ARE not SECTIONALLY REDUCED:
*               - 'add on' codes ("P"ercentage/"F"lat designation)
*               - 'I.O.P' codes (starting with 'Z') ,
*               - Manual Review (MR) and
*               - Entries for anesthetists (suffix = 'C')
*                          or assistants   (suffix = 'B')

*   (setup currrent/previous rate subscript for this detail line)
    move hold-ss-curr-prev(ss)  to ss-curr-prev.

*   if       hold-icc-sec (ss)  = "SP"

    if     hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "P"
       and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "F"
       and hold-sv-day     (ss, 1)  <> "MR"
       and hold-sv-day     (ss, 1)  <> "OP"
       and hold-oma-suff   (ss)     <> "B"
       and hold-oma-suff   (ss)     <> "C"
    then
*       (reduce this group if its not the highest valued group)
        if    hold-flag-sec-group (ss) = ws-highest-grp-nbr
          or  flag-z-highest-grp = 'Y'
        then
            next sentence
        else
            if    hold-oma-cd-alpha (ss) <> "Z"
              and hold-oma-rec-ind  (ss, ss-add-on-perc-or-flat-ind) <> "P"
              and hold-oma-rec-ind  (ss, ss-add-on-perc-or-flat-ind) <> "F"
*                      and (hold-icc-cd (ss) not = "SP98")
*                      and (hold-icc-cd (ss) not = "SP99")
            then
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 154
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
                compute hold-fee-oma  (ss) rounded =
                        hold-fee-oma  (ss) * const-sr (ss-curr-prev)
                compute hold-fee-ohip (ss) rounded =
                        hold-fee-ohip (ss) * const-sr (ss-curr-prev).
*           (else)
*           endif
*       endif
*   (else)
*   endif

yi0-99-exit.
    exit.


*ym0-create-basic-times-desc.
ym0-create-desc-record.

* (2001/aug/29 B.E. changed routine's name and overloaded it to produce
*  basic+times description records and regular 'text' message description
*  records)

*   (CURRENTLY newu701 doesn't create these records in the suspense files -
*    so code is skipped)
    if not online-claim
    then
        go to ym0-99-exit.
*   endif

    if adjudication-desc-entry
    then
*       (set flag to force creation of description rec later in processing)
        move "Y"                          to flag-adjudication-required

*       move "REFER TO ADJUDICATION"      to hold-desc (ss-basic-times-desc-rec)
**      (force subscript to indicate description record is 'full' so that code
**       won't try to slip a B+T description into this desc rec)
*        move 2                            to ss-basic-times

        go to ym0-90-display.
*   endif


    add 1                               to ss-basic-times.

*   ('basic+times' description records are created with 2 'B+T' entries
*    per description record so skip to next description record if current
*    one is already full and creating another B+T record or skip to new
*    rec if creating a text message record and a B+T already in current
*    record)
*    if    (    adjudication-desc-required
*           and ss-basic-times > 1
*         )
*       or (    basic-plus-times-entry
     if   (    basic-plus-times-entry
           and ss-basic-times > 2
          )
    then
        move 1                          to ss-basic-times
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 155
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
        add 1, ss-basic-times-desc-rec  giving ss-basic-times-desc-rec.
*   (else)
*   endif

    if basic-plus-times-entry
    then
        move "B +"                        to hold-basic-b (ss-basic-times)
        move "T /"                        to hold-times-t (ss-basic-times)
        move ws-tot-serv                  to hold-times-units (ss-basic-times)
        if hold-oma-suff (ss) = "B"
        then
            move hold-oma-fee-asst (ss, ohip)
                                          to hold-basic-units (ss-basic-times)
            move hold-basic-times-desc    to hold-desc (ss-basic-times-desc-rec)
            go to ym0-90-display
        else
            move hold-oma-fee-anae (ss, ohip)
                                          to hold-basic-units (ss-basic-times)
            move hold-basic-times-desc    to hold-desc (ss-basic-times-desc-rec)
            go to ym0-90-display.
*       endif
*   endif


ym0-90-display.
    display scr-acpt-det-desc.

ym0-99-exit.
    exit.




yz0-reset-verify-prices.

    perform yz1-check-price             thru yz1-99-exit
        varying ss
        from 1 by 1
        until   ss > ss-clmdtl-oma.

yz0-99-exit.
    exit.


yz1-check-price.

*  (routine 'ya0' has priced claims according to RMA pricing. if
*   incoming file was "D"iskette AND the operator requested that the
*   incoming prices NOT be retain, then reset prices to
*   the 'incoming' values rather than RMA priced amounts.
*   If the file was from the "W"eb, then reset any OP or MR line
*   to 'incoming' prices)
*   NOTE: updating OHIP price only - OMA has RMA calculated prices!!!!!

    if   (    diskette-claim
          and retain-incoming-prices
         )
      or     web-claim
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 156
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
         and (    retain-incoming-prices
               or hold-sv-day (ss,1) = "MR" or "OP"
             )
    then
        move hold-fee-incoming (ss)     to hold-fee-ohip    (ss).
*   endif

*  (routine 'ya0-' also may have altered the nbr services on the claim
*   as it priced "B/C" suffix claims for basic+times calculations.
*   Reset these to original incoming values if incoming file was a
*   diskette claim)
    if   diskette-claim
    then
        move hold-sv-nbr-serv-incoming(ss)
                                        to hold-sv-nbr-serv (ss).
*   endif

yz1-99-exit.
    exit.


xa0-display-details .
*   (this is dummy routine called from pricing copybook logic that
*    is used by d001 to display priced claims on screen.
*
*    IF EVER WE NEED TO DUMP PRICED CLAIMS INTO REPORT OR DO OTHER CHECKING
*    THEN HERE IS THE IDEAL AREA TO PLACE THIS CODE
*

xa0-99-exit.
    exit.
za0-common-error.
*   (this is dummy routine called from pricing copybook logic that
*    is used by d001 to display errors
za0-99-exit.
    exit.


zb0-build-write-err-rpt-line.

    move err-msg (err-ind)              to      rpt-line.
    perform zz0-write-err-rpt-line      thru    zz0-99-exit.

zb0-99-exit.
    exit.


zz0-write-err-rpt-line.

     add ws-carriage-ctrl               to      ctr-lines-printed.
     if ctr-lines-printed > max-lines-per-page
     then
        perform zz1-print-headings      thru    zz1-99-exit
        move 1                          to      ws-carriage-ctrl.
*    endif

    write rpt-line      after advancing ws-carriage-ctrl lines.

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 157
*                      newu701.cbl                                   )
zz0-99-exit.
    exit.



zz1-print-headings.

*   (SAVE LINE THAT WAS TO BE PRINTED, RESTORE AFTER HEADINGS PRINTED)
    move rpt-line                  to   save-prt-line.

    add 1                          to   ws-rpt-page-nbr.
    move ws-rpt-page-nbr           to   rpt-page-nbr.
    write rpt-line from heading-l1 after advancing page.

*   (97/09/25 B.E. - ADD DOCTOR INFO INTO AUDIT REPORT)
    move doc-nbr                   to h-l2-doctor-nbr.
    move doc-inits                 to h-l2-doctor-initials.
    move doc-name                  to h-l2-doctor-name.
    move batch-group-nbr           to h-l2-clinic.
    move batch-speciality          to h-l2-speciality.
    write rpt-line from heading-l2 after advancing 1 line.

    move spaces                    to   rpt-line
    write rpt-line                 after advancing 2 lines.
    move 2                         to   ctr-lines-printed.

    move save-prt-line             to   rpt-line.

zz1-99-exit.
    exit.


zz3-apply-tech-prof-suff-rules.

copy "tech_prof_suff_split_part1.rtn"
     replacing  ==ss-clmdtl-oma== by ==ss-tech-prof-suff==.
* file: tech_prof_suff_split_part1.rtn
* purpose: certain ICC codes must be submitted appropriate suffix depending
*          upon tech/prof components. Note that diskette uploaded claims
*          are NOT changed
* 2001/apr/01 B.E. - original
* 2001/oct/01 B.E. documentation wrong - corrected!


*   (note only RMA repsonsible claims with sufix "A" are tested)
    if    ( hold-icc-sec (ss-tech-prof-suff) = "PF" or "DU" or "DR" or "NM" )
      and ( hold-oma-suff(ss-tech-prof-suff) = "A" )
      and ( not diskette-claim)
    then
*       CASE
*       (if "TECH" only and "A" suffix - change to "B")
        if    hold-oma-fee-1(ss-tech-prof-suff , ohip)<> 0
          and hold-oma-fee-2(ss-tech-prof-suff , ohip) = 0
        then
            move "Y"                        to   flag-tech-prof-suffix-rule
            move "B" to hold-oma-suff(ss-tech-prof-suff)
            perform xa0-display-details     thru xa0-99-exit
        else
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 158
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/te)

*       (if "PROF" only and "A" suffix - change to "C")
        if    hold-oma-fee-1(ss-tech-prof-suff , ohip) = 0
          and hold-oma-fee-2(ss-tech-prof-suff , ohip)<> 0
        then
            move "Y"                            to flag-tech-prof-suffix-rule
            move "C"                            to hold-oma-suff(ss-tech-prof-su
            perform xa0-display-details         thru xa0-99-exit
        else

*       (if both "PROF+TECH" "A" suffix - change to "B" and add 2nd line
*                                        with "C" code if not 8th line of input)
        if    hold-oma-fee-1(ss-tech-prof-suff , ohip)<> 0
          and hold-oma-fee-2(ss-tech-prof-suff , ohip)<> 0
        then
            perform zz6-calc-ss-for-next-dtl    thru   zz6-99-exit
            if    online-claim
            then
*               (error if new line would exceed max allowed number of detail lin
                if ss-clmdtl-new-dtl > ss-max-nbr-oma-det-rec-allow
                then
                    move 101                    to err-ind
                    perform za0-common-error    thru za0-99-exit
*                   (blank line entered since it can't be expanded)
                    move spaces         to hold-oma-rec     (ss-tech-prof-suff)
                    move zero           to hold-sv-nbr-serv (ss-tech-prof-suff)
                    move zero           to hold-sv-date     (ss-tech-prof-suff)
                    move zero           to hold-sv-nbr-days-conseq
                                                            (ss-clmdtl-oma,1)
                    move zero           to hold-sv-nbr-days-conseq
                                                            (ss-clmdtl-oma,2)
                    move zero           to hold-sv-nbr-days-conseq
                                                            (ss-clmdtl-oma,3)
                    move zero           to hold-fee-incoming(ss-tech-prof-suff)
                    move zero           to hold-fee-oma     (ss-tech-prof-suff)
                    move zero           to hold-fee-ohip    (ss-tech-prof-suff)
                    move zero           to hold-priced-tech (ss-tech-prof-suff)
                    move zero           to hold-basic-tech  (ss-tech-prof-suff)
                    move zero           to hold-basic-prof  (ss-tech-prof-suff)
                    move zero           to hold-basic-fee   (ss-tech-prof-suff)
                    move zero           to hold-oma-fees    (ss-clmdtl-oma,1)
                    move zero           to hold-oma-fees    (ss-clmdtl-oma,2)
                    move zero           to hold-fee-min     (ss-clmdtl-oma,1)
                    move zero           to hold-fee-min     (ss-clmdtl-oma,2)
                    move zero           to hold-fee-max     (ss-clmdtl-oma,1)
                    move zero           to hold-fee-max     (ss-clmdtl-oma,2)
                    move zero           to hold-oma-fee-anae(ss-clmdtl-oma,1)
                    move zero           to hold-oma-fee-anae(ss-clmdtl-oma,2)
                    move zero           to hold-oma-fee-asst(ss-clmdtl-oma,1)
                    move zero           to hold-oma-fee-asst(ss-clmdtl-oma,2)
                    move zero           to hold-ss-curr-prev(ss-tech-prof-suff)
                    move zero           to hold-flag-sec-group(ss-tech-prof-suff
                    move zero           to hold-diag-cd     (ss-tech-prof-suff)
                    move zero           to hold-line-no     (ss-tech-prof-suff)
                    subtract 1          from                 ss-tech-prof-suff
                else
                    perform zz7-split-a-into-b-and-c thru zz7-99-exit
*                   (split line's svc need to be added to claim audit counter)
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 159
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/te)
                    add hold-sv-nbr-serv (ss-tech-prof-suff)
                                                     to  nbr-of-services
                    display scr-last-claim-lit
                    perform xa0-display-details      thru xa0-99-exit
*                   (bump up line number so that operator skips the system
*                    built line from above code)
                    add 1                            to   ss-tech-prof-suff
                    perform xa0-display-details      thru xa0-99-exit
*               endif
            else
                perform zz7-split-a-into-b-and-c     thru zz7-99-exit
                add 1                                to ss-clmdtl-next-avail-dtl
*           endif
*       endif
*       ENDCASE



zz3-99-exit.
    exit.


copy "tech_prof_suff_split_part2.rtn"
     replacing  ==ss-clmdtl-oma== by ==ss-tech-prof-suff==.
* file: tech_prof_suff_split_part2.rtn
* purpose: - certain ICC codes must be submitted appropriate suffix depending
*            upon tech/prof components
*          - this routine calculates the next avail subscript for a new dtl rec


zz6-calc-ss-for-next-dtl.

    if    online-claim
    then
        add 1                           to     ss-tech-prof-suff
                                        giving ss-clmdtl-new-dtl
    else
        add 1                           to     ss-clmdtl-next-avail-dtl
                                        giving ss-clmdtl-new-dtl.
*   endif

zz6-99-exit.
    exit.



zz7-split-a-into-b-and-c.
*   (set flag that change has been made)

    move "Y"                        to   flag-tech-prof-suffix-rule.

*   (change "A" suffix to "B" and create new detail with "C" suffix)
    move "B"                        to hold-oma-suff(ss-tech-prof-suff)
*   (default next line as same oma code with "C" suffix
    move hold-oma-rec(ss-tech-prof-suff)to hold-oma-rec(ss-clmdtl-new-dtl).
    move "C"                        to hold-oma-suff(ss-clmdtl-new-dtl).
    move ss-clmdtl-new-dtl          to hold-line-no (ss-clmdtl-new-dtl).

* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 160
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/te)
zz7-99-exit.
    exit.


copy "y2k_default_sysdate_century.rtn".
y2k-default-sysdate.

    move sys-date-left                  to sys-date-temp.
    move sys-date-temp                  to sys-date-right.
    move zeros                          to sys-date-blank.
* 1999/dec/30 B.E.
*   add 19000000                        to sys-date-numeric.
    add 20000000                        to sys-date-numeric.

y2k-default-sysdate-exit.
    exit.

copy "pricing_test_min_max_limits.rtn".
* file: pricing_test_min_max_limits.rtn
* 00/aug/14 B.E. original
* 01/aug/29 B.E. - remove error messages when reducing or increase amounts
* 01/sep/01 B.E. - changed min/max fee checkings so that it takes place only
*                  on "A" suffix claim details

test-min-max-limits.

*   (test min/max price to ensure that calculated basic prices are within
*    acceptable range for "A" suffix claims only - doesn't apply to
*    assistant(B) and anesthetist(C) details)

*   (non add-on, non OP'd fees must be > minimum if specified)

    if    hold-fee-min    (ss, oma) <> 0
      and hold-fee-oma    (ss)      <  hold-fee-min(ss, oma)
*        and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "P"
*        and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "F"
      and hold-sv-day     (ss,1) <> "OP"
      and hold-oma-suff   (ss)   = "A"
    then
        move hold-fee-min (ss, oma)             to hold-fee-oma (ss).
*          move 86                                 to      err-ind
*          perform za0-common-error                thru    za0-99-exit.
*   endif

    if    hold-fee-min    (ss,ohip) <> 0
      and hold-fee-ohip   (ss)      <  hold-fee-min(ss,ohip)
*        and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "P"
*        and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "F"
      and hold-sv-day     (ss,1) <> "OP"
      and hold-oma-suff   (ss)   = "A"
    then
        move hold-fee-min (ss,ohip)             to hold-fee-ohip(ss).
*          move 87                                 to      err-ind
*          perform za0-common-error                thru    za0-99-exit.
*   endif

*   (non add-on, non OP'd fees must be < maximum if specified)
    if    hold-fee-max    (ss, oma) <> 0
* Micro Focus COBOL for UNIX         V4.0 revision 005 23-Jun-05 15:26 Page 161
*                      newu701.cbl (/alpha/rmabill/rmabill101c/use/pr)
      and hold-fee-oma    (ss)       > hold-fee-max(ss, oma)
*         and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "P"
*         and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "F"
      and hold-sv-day     (ss,1) <> "OP"
      and hold-oma-suff   (ss)   = "A"
    then
        move hold-fee-max (ss, oma)             to hold-fee-oma (ss).
*          move 88                                 to      err-ind
*          perform za0-common-error                thru    za0-99-exit.
*   endif

    if    hold-fee-max    (ss,ohip) <> 0
      and hold-fee-ohip   (ss)       > hold-fee-max(ss,ohip)
*         and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "P"
*         and hold-oma-rec-ind(ss, ss-add-on-perc-or-flat-ind) <> "F"
      and hold-sv-day     (ss,1) <> "OP"
      and hold-oma-suff   (ss)   = "A"
    then
        move hold-fee-max (ss,ohip)             to hold-fee-ohip(ss).
*          move 89                                 to      err-ind
*          perform za0-common-error                thru    za0-99-exit.
*   endif

test-min-max-limits-99-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 Compiler
* Copyright (C) 1984-1995 Micro Focus Ltd.     URN 2XUPG/GB0/00000F
*                                              REF GNB-030056000AA
*
* Total Messages:     0
* Data:       29268     Code:       34679
