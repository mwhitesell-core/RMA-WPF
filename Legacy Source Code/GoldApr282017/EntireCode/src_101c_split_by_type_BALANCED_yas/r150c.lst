* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   1
*                      r150c.cbl
* Directives File: /usr/opt/mfcobol4.0/cobol.dir
* Accepted - SHOW-DIR
* Accepted - SOURCEFORMAT"FREE"
* Accepted - SPZERO
* Accepted - TIME
* Accepted - TRUNC
* Accepted - RESEQ
* Accepted - SEQCHK
* End Of Directives File: /usr/opt/mfcobol4.0/cobol.dir
identification    division.
program-id.       r150c.
author.           dyad computer systems inc.
installation.     rma.
date-written.     80/10/28.
date-compiled. 18-May-06 15:41.
security.
*
*       files   : r150_srt_work_file   - sorted doctor work file
*               : f020            - doc mstr
*               : r150ca          - t4'S
*               : r150cb          - t4 audit report
*
*      program purpose : this program is the third in a series of 3 programs.
*                        it uses the sorted work file produced by r150b
*                        to print the t4'S AND T4 AUDIT REPORT.
*
*
*      revision history:
*
*         may/82 (d.m.& i.w.)   - changed to access new doc master
*                               - program renamed (was r022b)
*
*         feb 20/86 (m.s.)      - pdr 300
*                               - three changes have to be made, and
*                                 they are as follows:
*                                 1. change "MCMASTER UNIVERSITY" to
*                                           "REGIONAL MEDICAL ASSOCIATES"
*                                 2. do not print income tax deducted
*                                 3. fix the s.i.n. because it prints
*                                    the same s.i.n. for each doctor
*
*         may 27/87 (s.b.)      - coversion from aos to aos/vs.
*                                 change field size for
*                                 status clause to 2 and
*                                 feedback clause to 4.
*
*         feb 13/89 (s.f.)      - t4 forms have changed since 1987
*                                 made necessary changes to fit new
*                                 1988 forms
*
*   revised march/89 : - sms 115 s.f.
*                      - make sure file status is pic xx ,feedback is
*                        pic x(4) and infos status is pic x(11).
*
*    april 26/89  s. fader      - sms 116
*                               - print the dept code and/or name
*
*
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   2
*                      r150c.cbl
*         feb 12/91 (m.c.)      - pdr 479
*                               - change print format on t4a slips
*
*
*         feb 11/92 (m.c.)      - pdr 547
*                               - change print format on t4a slips
*
*
*         feb 14/94 (m.c.)      - change print format on t4a slips
*                               - linda norek requested the changes
*
*         feb 09/95 (b.e.)      - change print format on t4a slips
*
*         jan 15/96 (m.c.)      - allow negative value in earnings &
*                                 tax for each doctor level
*
*         feb 2/98  (j.c.)      - s149 unix conversion
*         jan 15/99 (b.e.)      - new layout of t4a
*
environment division.
input-output section.
file-control.


    copy "f020_doctor_mstr.slr".
    select doc-mstr
*mf     assign index to "f020_doctor_mstr"
*mf     assign data  to "f020_doctor_mstr"
        assign to disk "$pb_data/f020_doctor_mstr"
        organization is indexed
        access mode  is dynamic
*mf added lock mode so that files aren't open exclusively
        lock mode is manual

        record key   is doc-nbr of doc-mstr-rec

*mf added two  alternative keys below
        alternate key is doc-name-soundex
         with duplicates
        alternate key is doc-ohip-nbr of doc-mstr
         with duplicates
              status  is status-cobol-doc-mstr.
*       infos status  is status-doc-mstr.
*       eof-flag     is eof-doc-mstr
*


    select doc-work-mstr
         assign to  work-file-name
          organization sequential
          status is status-work-mstr.
*mf          infos status is status-work-mstr.



    select print-file
          assign to printer print-file-name
          file status is status-prt-file.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   3
*                      r150c.cbl                                     )

    select  print-audit
          assign to printer print-audit-name
          file status is status-audit-file.
data division.
file section.

    copy "f020_doctor_mstr.fd".
* sms 137  bml  05-dec-90  increase fields by 2
* sms 139  mc   10-jun-92  add 5 clinic nbr and 2 spec codes in
*                          reserved for nip
*          mc   24-nov-93  include brad's fields of earning subsystem
*          mc   12-feb-94  include doc-ep-pay-code and doc-ep-pay-sub-code
*          db   03-jun-98  Year 2000
*          mc   16-jul-02  add 5 additional batch nbr for each additional
*                          clinic
*          mc   23-sep-02  rename the second occurrence of group-regular-service
*                          to group-over-serviced
*          be   05-nov-03  alpha doctor nbr
*          mc   03-mar-04  reuse filler x(4) for doc-afp-paym-group from filler2
*          be   06-apr-17  - increase to 800 when $1M payroll figures changed th

fd  doc-mstr
*       block  contains 680 characters
*       record contains 680 characters.
*       block  contains 695 characters
*       record contains 695 characters.
        block  contains 800 characters
        record contains 800 characters.

01 doc-mstr-rec.
*    05  doc-nbr                                        pic 9(3).
    05  doc-nbr                                 pic x(3).
    05  doc-dept                                pic 99.
    05  doc-ohip-nbr                            pic 9(6).
    05  doc-pract-nbr redefines doc-ohip-nbr    pic 9(6).
    05  doc-sin-nbr.
        10  doc-sin-123                         pic 999.
        10  doc-sin-456                         pic 999.
        10  doc-sin-789                         pic 999.
    05  doc-clinic-nbr                          pic 99.
    05  doc-spec-cd                             pic 99.
    05  doc-hosp-nbr                            pic x999.
    05  doc-name                                pic x(24).
    05  doc-name-soundex                        pic x(4).

    05  doc-inits.
        10  doc-init1                           pic x.
        10  doc-init2                           pic x.
        10  doc-init3                           pic x.
    05  doc-address-office.
        10  doc-addr-office-1                   pic x(24).
        10  doc-addr-office-2                   pic x(24).
        10  doc-addr-office-3                   pic x(24).
    05  doc-addr-office-r  redefines  doc-address-office.
        10  doc-addr-office  occurs 3 times     pic x(24).
    05  doc-addr-office-pc.
        10  doc-addr-office-pc-123.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   4
*                      r150c.cbl (/alpha/rmabill/rmabill101c/use/f020)
            15  doc-addr-office-pc1             pic a.
            15  doc-addr-office-pc2             pic 9.
            15  doc-addr-office-pc3             pic a.
        10  doc-addr-office-pc-456.
            15  doc-addr-office-pc4             pic 9.
            15  doc-addr-office-pc5             pic a.
            15  doc-addr-office-pc6             pic 9.
    05  doc-address-home.
        10  doc-addr-home-1                     pic x(24).
        10  doc-addr-home-2                     pic x(24).
        10  doc-addr-home-3                     pic x(24).
    05  doc-addr-home-r  redefines doc-address-home.
        10  doc-addr-home  occurs 3 times       pic x(24).
    05  doc-addr-home-pc.
        10  doc-addr-home-pc-123.
            15  doc-addr-home-pc1               pic a.
            15  doc-addr-home-pc2               pic 9.
            15  doc-addr-home-pc3               pic a.
        10  doc-addr-home-pc-456.
            15  doc-addr-home-pc4               pic 9.
            15  doc-addr-home-pc5               pic a.
            15  doc-addr-home-pc6               pic 9.
    05  doc-full-part-ind                       pic x.
    05  doc-class-code redefines doc-full-part-ind pic x.
    05  doc-bank-info.
        10  doc-bank-nbr                        pic 9(4).
        10  doc-bank-branch                     pic 9(5).
        10  doc-bank-acct                       pic x(12).
*   05  doc-tax-info.
*       10  doc-billing-percent                 pic 9v99.
*       10  doc-misc-percent                    pic 9v99.
*       10  doc-tax-percent                     pic 9v99.
*       10  doc-billing-percent                 pic 9v9999.
*       10  doc-misc-percent                    pic 9v9999.
*       10  doc-tax-percent                     pic 9v9999.
*       10  doc-pay-code                        pic x.
    05  doc-fac-dates.
        10  doc-date-fac-start.
* y2k       15  doc-date-fac-start-yy           pic 99.
            15  doc-date-fac-start-yy           pic 9999.
            15  doc-date-fac-start-mm           pic 99.
            15  doc-date-fac-start-dd           pic 99.
        10  doc-date-fac-term.
* y2k       15  doc-date-fac-term-yy            pic 99.
            15  doc-date-fac-term-yy            pic 9999.
            15  doc-date-fac-term-mm            pic 99.
            15  doc-date-fac-term-dd            pic 99.
    05    doc-fac-dates-r redefines doc-fac-dates.
        10  doc-date-fac occurs 2 times.
* y2k       15  doc-date-fac-yy                 pic 99.
            15  doc-date-fac-yy                 pic 9999.
            15  doc-date-fac-mm                 pic 99.
            15  doc-date-fac-dd                 pic 99.
    05  doc-annual-ceiling-info.
*        10  doc-ytdgua                          pic s9(7)v99 comp.
        10  doc-ytdgua                          pic s9(7)v99.
*        10  doc-ytdgub                          pic s9(7)v99 comp.
        10  doc-ytdgub                          pic s9(7)v99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   5
*                      r150c.cbl (/alpha/rmabill/rmabill101c/use/f020)
*        10  doc-ytdguc                          pic s9(7)v99 comp.
        10  doc-ytdguc                          pic s9(7)v99.
*        10  doc-ytdgud                          pic s9(7)v99 comp.
        10  doc-ytdgud                          pic s9(7)v99.
*        10  doc-ytdcea                          pic s9(7)v99 comp.
        10  doc-ytdcea                          pic s9(7)v99.
*        10  doc-ytdcex                          pic s9(7)v99 comp.
        10  doc-ytdcex                          pic s9(7)v99.
*        10  doc-ytdear                          pic s9(7)v99 comp.
        10  doc-ytdear                          pic s9(7)v99.
*        10  doc-ytdinc                          pic s9(7)v99 comp.
        10  doc-ytdinc                          pic s9(7)v99.
*        10  doc-ytdeft                          pic s9(7)v99 comp.
        10  doc-ytdeft                          pic s9(7)v99.
*        10  doc-totinc-g                        pic s9(7)v99 comp.
        10  doc-totinc-g                        pic s9(7)v99.
* y2k
*       10  doc-ep-date-deposit                 pic 9(4) comp.
        10  doc-ep-date-deposit                 pic 9(8).
*        10  doc-totinc                          pic s9(7)v99 comp.
        10  doc-totinc                          pic s9(7)v99.
*        10  doc-ep-ceiexp                       pic s9(7)v99 comp.
        10  doc-ep-ceiexp                       pic s9(7)v99.
*        10  doc-adjcea                          pic s9(7)v99 comp.
        10  doc-adjcea                          pic s9(7)v99.
*        10  doc-adjcex                          pic s9(7)v99 comp.
        10  doc-adjcex                          pic s9(7)v99.
*        10  doc-ceicea                          pic s9(7)v99 comp.
        10  doc-ceicea                          pic s9(7)v99.
*        10  doc-ceicex                          pic s9(7)v99 comp.
        10  doc-ceicex                          pic s9(7)v99.
        10  ceicea-prt-format                   pic x(13).
        10  ceicex-prt-format                   pic x(13).
        10  ytdcea-prt-format                   pic x(13).
        10  ytdcex-prt-format                   pic x(13).
        10  doc-clinic-nbr-2                    pic 99.
        10  doc-clinic-nbr-3                    pic 99.
        10  doc-clinic-nbr-4                    pic 99.
        10  doc-clinic-nbr-5                    pic 99.
        10  doc-clinic-nbr-6                    pic 99.
        10  doc-spec-cd-2                       pic 99.
        10  doc-spec-cd-3                       pic 99.
*        10  doc-ytdinc-g                        pic s9(7)v99 comp.
        10  doc-ytdinc-g                        pic s9(7)v99.
    05  doc-locations.
        10  doc-loc-1                           pic x999.
        10  doc-loc-2                           pic x999.
        10  doc-loc-3                           pic x999.
        10  doc-loc-4                           pic x999.
        10  doc-loc-5                           pic x999.
        10  doc-loc-6                           pic x999.
        10  doc-loc-7                           pic x999.
        10  doc-loc-8                           pic x999.
        10  doc-loc-9                           pic x999.
        10  doc-loc-10                          pic x999.
        10  doc-loc-11                          pic x999.
        10  doc-loc-12                          pic x999.
        10  doc-loc-13                          pic x999.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   6
*                      r150c.cbl (/alpha/rmabill/rmabill101c/use/f020)
        10  doc-loc-14                          pic x999.
        10  doc-loc-15                          pic x999.
        10  doc-loc-16                          pic x999.
        10  doc-loc-17                          pic x999.
        10  doc-loc-18                          pic x999.
        10  doc-loc-19                          pic x999.
        10  doc-loc-20                          pic x999.
        10  doc-loc-21                          pic x999.
        10  doc-loc-22                          pic x999.
        10  doc-loc-23                          pic x999.
        10  doc-loc-24                          pic x999.
        10  doc-loc-25                          pic x999.
        10  doc-loc-26                          pic x999.
        10  doc-loc-27                          pic x999.
        10  doc-loc-28                          pic x999.
        10  doc-loc-29                          pic x999.
        10  doc-loc-30                          pic x999.
    05  doc-locations-r  redefines  doc-locations.
        10  doc-loc     occurs 30 times         pic x999.
*
    05  doc-rma-expense-percent-misc            pic 9(5)v9(4) comp.
* 2004/03/03 - MC
*   05  filler2                                 pic x(8).
    05  doc-afp-paym-group                      pic x(4).
    05  filler2                                 pic x(4).
* 2004/030/03 - end
    05  doc-ind-pays-gst                        pic x.
    05  doc-nx-avail-batch                      pic 999.
* 2002/07/16 - MC - add 5 more next batch nbr for each clinic
    05  doc-nx-avail-batch-2                    pic 999.
    05  doc-nx-avail-batch-3                    pic 999.
    05  doc-nx-avail-batch-4                    pic 999.
    05  doc-nx-avail-batch-5                    pic 999.
    05  doc-nx-avail-batch-6                    pic 999.
** 2002/07/16 - end
*    05  doc-yrly-ceiling-computed               pic 9(7)v99 comp.
    05  doc-yrly-ceiling-computed               pic 9(7)v99.
*    05  doc-yrly-expense-computed               pic 9(7)v99 comp.
    05  doc-yrly-expense-computed               pic 9(7)v99.
    05  doc-rma-expense-percent-reg             pic 9(5)v9(4) comp.
    05  doc-sub-specialty                       pic x(15).
*    05  doc-payeft                              pic s9(7)v99 comp.
    05  doc-payeft                              pic s9(7)v99.
*    05  doc-ytdded                              pic s9(7)v99 comp.
    05  doc-ytdded                              pic s9(7)v99.
    05  doc-dept-expense-percent-misc           pic 9(5)v9(4) comp.
    05  doc-dept-expense-percent-reg            pic 9(5)v9(4) comp.
    05  doc-ep-ped                              pic s9(9) comp.
    05  doc-ep-pay-code                         pic x.
    05  doc-ep-pay-sub-code                     pic x.
    05  filler3                                 pic x(1).
    05  doc-ind-holdback-active                 pic x(1).
    05  group-regular-service                   pic x(4).
* 2002/09/23 - MC
*    05  group-regular-service                  pic x(4).
    05  group-over-serviced                     pic x(4).
* 2002/09/23 - end
    05  doc-specialties                         pic x(90).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   7
*                      r150c.cbl (/alpha/rmabill/rmabill101c/use/f020)

*
    copy "r150_chq_doc_mstr.fd".
fd  doc-work-mstr
    block contains 56 characters
    record contains 56 characters.


01  doc-work-rec.
    05  wk-doc-clinic-nbr               pic 99.
*!    05  wk-doc-nbr                    pic 9(3).
    05  wk-doc-nbr                      pic x(3).
    05  wk-doc-name                     pic x(24).
    05  wk-doc-inits.
        10  wk-doc-inits-1              pic x.
        10  wk-doc-inits-2              pic x.
        10  wk-doc-inits-3              pic x.
    05  wk-doc-tax-ded                  pic s9(5)v99.
    05  wk-doc-earnings                 pic s9(6)v99.
    05  wk-sin.
        10  wk-sin-123                  pic 999.
        10  wk-sin-456                  pic 999.
        10  wk-sin-789                  pic 999.
*

fd  print-file
    record contains 132 characters.
01  prt-line                            pic x(132).

fd  print-audit
    record contains 132  characters.
01  prt-audit                           pic x(132).

working-storage section.

*   status file indicators
*mf 77  status-work-mstr                        pic x(11) value zero.
*mf 77  common-status-file                      pic x(11) value zero.
*mf 77  status-doc-mstr                         pic x(11) value zero.
77  status-audit-file                           pic xx    value zero.
77  status-prt-file                             pic xx    value zero.

77  common-status-file                         pic x(2) value zero.
77  status-cobol-doc-mstr                      pic x(2) value zero.
77  status-work-mstr                           pic x(2) value zero.

*   flag indicators
77  err-ind                                     pic 99  value zero.

01  flag-pcode-write                            pic x    value "N".
    88  write-pcode                             value  "Y".
    88  not-write-pcode                         value  "N".

01  flag-work-file                              pic x   value "N".
    88  not-eof-wk-file                         value "N".
    88  end-wk-file                             value "Y".

01  flag-address                                pic x   value  "Y".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   8
*                      r150c.cbl                                     )
    88  not-found-addr                          value  "N".
    88  found-addr                              value  "Y".

01  flag-doc-file                               pic x   value "Y".
    88  found-doc-nbr                           value "Y".
    88  not-found-doc-nbr                       value "N".

*  variables
77  flag-audit-reach-100                        pic x      value "N".
77  ws-init-name                                pic x(30).
77  ws-reply                                    pic x.
77  max-nbr-lines                               pic 99     value 55.
77  flag-audit-max-writes                       pic 999    value 100.


01  ws-initials.
    05  ws-1st-init.
        10  ws-init1                            pic x.
        10  ws-dot1                             pic x.
    05  ws-2cd-init.
        10  ws-init2                            pic x.
        10  ws-dot2                             pic x.
    05  ws-3rd-init.
        10  ws-init3                            pic x.
        10  ws-dot3                             pic x.

01  counters.
    05  ctr-page                                pic 9999.
    05  ctr-line                                pic 99.
    05  ctr-doc-mstr-reads                      pic 9(7).
    05  ctr-wk-file-reads                       pic 9(7).
    05  ctr-audit-writes                        pic 9(7).
    05  ctr-t4-writes                           pic 9(7).
    05  ctr-flag-audit-writes                   pic 9(7).

* totals
01  totals.
    05  total-tax                               pic s9(6)v99.
    05  total-earnings                          pic s9(8)v99.
    05  grand-total-tax                         pic s9(8)v99.
    05  grand-total-earnings                    pic s9(9)v99.


* hold area.
01  hold-area.
    05  hold-doc-nbr                            pic 9(3).
    05  hold-doc-name                           pic x(24).
    05  hold-inits.
        10  hold-inits-1                        pic x.
        10  hold-inits-2                        pic x.
        10  hold-inits-3                        pic x.
    05  hold-earnings                           pic s9(6)v99.
    05  hold-tax                                pic s9(5)v99.
    05  hold-sin-nbr.
        10  hold-sin-123                        pic 999.
        10  hold-sin-456                        pic 999.
        10  hold-sin-789                        pic 999.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page   9
*                      r150c.cbl                                     )

01  print-file-name.
    05  printer-file-name                       pic x(6)     value "r150ca".



01  print-audit-name.
    05  printer-audit-name                      pic x(6)     value "r150cb".



01  work-file-name.
    05  filler                                  pic x(18)    value "r150_srt_wor

01  blank-line                                  pic x(132)   value spaces.

copy "sysdatetime.ws".
* 98/dec/01 D.B.        - y2k conversion
* 99/jan/13 B.E.        - changed sys-y1/y2 to y1 thru y4
*                       - added 'default-century-...' and century-date variables

01 century-year                                 pic 9(4).
01 century-date                                 pic 9(8).
01 default-century-cc                           pic 9(2) value 19.
01 default-century-cccc                         pic 9(4) value 1900.

01  sys-date.
* y2k    05  sys-date-long                              pic x(6).
    05  sys-date-long                           pic x(8).
    05  sys-date-long-r  redefines  sys-date-long.
* y2k   10  sys-yy                              pic 99.
        10  sys-yy                              pic 9999.
        10  sys-yy-alpha  redefines  sys-yy.
* y2k       15  sys-y1                          pic 9.
* y2k       15  sys-y2                          pic 9.
            15  sys-y1                          pic 9.
            15  sys-y2                          pic 9.
            15  sys-y3                          pic 9.
            15  sys-y4                          pic 9.
        10  sys-mm                              pic 99.
        10  sys-dd                              pic 99.
* remove after y2k upgrade of dgux
01  sys-date-numeric redefines sys-date         pic 9(8).
01  sys-date-y2kfix  redefines sys-date.
    05 sys-date-left                            pic x(6).
    05 filler                                   pic x(2).
01  sys-date-y2kfixed redefines sys-date.
    05 sys-date-blank                           pic x(2).
    05 sys-date-right                           pic x(6).
01  sys-date-temp                               pic x(8).

01  run-date.
* y2k    05  run-yy                                     pic 99.
    05  run-yy                                  pic 9999.
    05  filler                                  pic x   value "/".
    05  run-mm                                  pic 99.
    05  filler                                  pic x   value "/".
    05  run-dd                                  pic 99.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  10
*                      r150c.cbl (/alpha/rmabill/rmabill101c/use/sysd)

01  sys-time.
    05  sys-hrs                                 pic 99.
    05  sys-min                                 pic 99.
    05  sys-sec                                 pic 99.
    05  sys-hdr                                 pic 99.

01  run-time.
    05  run-hrs                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-min                                 pic 99.
    05  filler                                  pic x   value ":".
    05  run-sec                                 pic 99.

01  head-audit-1.
    05  filler                                  pic x(7)        value "R150CB/".
    05  head-aud-clinic-nbr                     pic 99.
    05  filler                                  pic x(35)       value spaces.
    05  filler                                  pic x(52)       value "T4  AUDIT
    05  filler                                  pic x(12)       value "RUN  DATE
* (y2k)
    05  head-aud-date.
* (y2k)
        10  head-aud-yy                         pic 99.
        10  filler                              pic x           value "/".
        10  head-aud-mm                         pic 99.
        10  filler                              pic x           value "/".
        10  head-aud-dd                         pic 99bbbbb.
    05  filler                                  pic x(5)        value "PAGE ".
    05  aud-head-page                           pic zzz9.


01  head-audit-2.
    05  filler                                  pic x(23)       value spaces.
    05  filler                                  pic x(13)       value "DEPARTMEN
    05  filler                                  pic x(24)       value "DOCTOR".
    05  filler                                  pic x(25)       value "DOCTOR".
    05  filler                                  pic x(14)       value "TOTAL".
    05  filler                                  pic x(33)       value "INCOME TA


01  head-audit-3.
    05  filler                                  pic x(27)       value spaces.
    05  filler                                  pic x(11)       value "#".
    05  filler                                  pic x(23)       value "#".
    05  filler                                  pic x(23)       value "NAME".
    05  filler                                  pic x(16)       value "EARNINGS"
    05  filler                                  pic x(32)       value "DEDUCTED"

*01  detail-account-nbr.
*    05  filler                                  pic x(57)       value spaces.
*    05  filler                                  pic x(10)       value "ZZF55423

01  detail-doc-name.
    05  filler                                  pic x(5)        value spaces.
    05  d2-doc-name                             pic x(15).
    05  filler                                  pic x(2)        value spaces.
    05  d2-doc-lit                              pic x(4).
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  11
*                      r150c.cbl                                     )
    05  d2-init.
        10  d2-init-1                           pic x.
        10  d2-init-1-per                       pic x.
        10  d2-init-2                           pic x.
        10  d2-init-2-per                       pic x.
        10  d2-init-3                           pic x.
        10  d2-init-3-per                       pic x.
    05  filler                                  pic x           value spaces.
    05  d2-doc-nbr                              pic 999.
    05  filler                                  pic x(8)        value spaces.
*   (1999/jan)
*   05  filler                                  pic x(30)       value "REGIONAL

01  detail-addr-1.
    05  filler                                  pic x(5)        value spaces.
    05  d1-addr-1                               pic x(24).
    05  filler                                  pic x(103)    value spaces.


01  detail-addr-2.
    05  filler                                  pic x(5)        value spaces.
    05  d2-addr-2                               pic x(24).
*   05  filler                                  pic x(14)       value spaces.
    05  filler                                  pic x(103)      value spaces.
*   05  filler                                  pic x(89)       value "ZZF554234


01  detail-addr-3.
    05  filler                                  pic x(5)        value spaces.
    05  d3-addr-3                               pic x(24).
    05  d3-pcode  redefines d3-addr-3.
        10  d3-pcode-1                          pic x.
        10  d3-pcode-2                          pic x.
        10  d3-pcode-3                          pic x.
        10  d3-split                            pic x.
        10  d3-pcode-4                          pic x.
        10  d3-pcode-5                          pic x.
        10  d3-pcode-6                          pic x(18).
    05  filler                                  pic x(103)      value spaces.


01  detail-addr-4.
    05  filler                                  pic x(5)        value spaces.
*   (1999/jan)
*   05  d4-pcode.
*       10  d4-pcode-1                          pic x.
*       10  d4-pcode-2                          pic x.
*       10  d4-pcode-3                          pic x.
*       10  d4-split                            pic x.
*       10  d4-pcode-4                          pic x.
*       10  d4-pcode-5                          pic x.
*       10  d4-pcode-6                          pic x.
*   05  filler                                  pic x(120)      value spaces.
    05  filler                                  pic x(39)       value spaces.
    05  filler                                  pic x(90)       value "REGIONAL

01  detail-amt-6.
*       (1998/jan)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  12
*                      r150c.cbl                                     )
*   05  filler                                  pic x(62)       value spaces.
    05  d6-earnings                             pic zzz,zz9.99-.
*   05  filler                                  pic x(60)       value spaces.
    05  filler                                  pic x(122)      value spaces.

01  detail-soc-nbr.
*   05  filler                                          pic x(42)       value sp
*       (1999/jan)
*   05  filler                                          pic x(53)       value sp
    05  filler                                  pic x(11)       value spaces.
    05  det-sin.
        10  det-sin-123                         pic 999.
        10  filler                              pic x           value spaces.
        10  det-sin-456                         pic 999.
        10  filler                              pic x           value spaces.
        10  det-sin-789                         pic 999.
*   05  filler                                          pic x(80)       value sp
*       (1999/jan)
*   05  filler                                          pic x(68)       value sp
    05  filler                                  pic x(38)       value spaces.
    05  filler                                  pic x(10)       value "ZZF554234

** this is added on feb  12/91 for pdr 479
*01  detail-acct-no.
*    05  filler                                  pic x(44)       value spaces.
*    05  filler                                  pic x(88)       value "ZZF55423


01  detail-aud-1.

    05  filler                                  pic x(26)       value spaces.
    05  d1-aud-doc-dept                         pic 99.
    05  filler                                  pic x(9)        value spaces.
*   05  d1-aud-doc-nbr                          pic zz9.
    05  d1-aud-doc-nbr                          pic 999.
    05  filler                                  pic x(13)       value spaces.
    05  d1-aud-doc-init                         pic x(6).
    05  filler                                  pic x           value spaces.
    05  d1-aud-doc-name                         pic x(16).
    05  filler                                  pic x(7)        value spaces.
    05  d1-aud-earn                             pic zzz,zz9.99-.
    05  filler                                  pic x(6)        value spaces.
    05  d1-aud-tax                              pic zz,zz9.99-.
    05  filler                                  pic x(24)       value spaces.


01  tot-audit.

    05  filler                                  pic x(64)       value spaces.
    05  tot-message                             pic x(12).
    05  filler                                  pic x(3)        value spaces.
    05  tot-aud-earn                            pic zzz,zzz,zz9.99bb.
    05  tot-aud-tax                             pic  zz,zzz,zz9.99b.
    05  tot-stars                               pic x(23).

01  error-message-table.

    05  error-messages.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  13
*                      r150c.cbl                                     )
        10  filler                              pic x(60)       value
                "ERROR NO WORK FILE SUPPLIED".
        10  filler                              pic x(60)       value
                "DOCTOR # NOT FOUND IN DOC-MSTR".
        10  filler                              pic x(60)       value
                "ERR MESS #3 GOES HERE".

    05  error-messages-r redefines error-messages.
        10  err-msg                             pic x(60)
                        occurs 3 times.

01  err-msg-comment                             pic x(60).

01  e1-error-line.

    05  e1-error-word                           pic x(13)      value
                "***  ERROR - ".
    05  e1-error-msg                            pic x(119).
screen section.

01  program-in-progress.
    05  blank screen.
    05  line 01 col 01  value is "R150C".
    05  line 01 col 25  value is "T4 AND AUDIT STATEMENTS REPORT".
* (y2k - auto fix)
*   05  line 01 col 70  pic 99 from sys-yy.
    05  line 01 col 70  pic 9(4) from sys-yy.
    05  line 01 col 72  value is "/".
    05  line 01 col 73  pic 99 from sys-mm.
    05  line 01 col 75  value is "/".
    05  line 01 col 76  pic 99 from sys-dd.
    05  line 10 col 25  value is "PART 3 - PRINT T4 AND AUDIT STATEMENTS".
    05  line 13 col 30 value "PROGRAM R150C IN PROGRESS".

01  confirm.
    05  line 23 col 01  value " ".

01  blank-screen.
    05  blank screen.

01  file-status-display.
    05  line 24 col 56 value "FILE STATUS = ".
*mf    05  line 24 col 70 pic x(11) from common-status-file  bell blink.
    05  line 24 col 70 pic x(2) from common-status-file  bell blink.

01  err-msg-line.
    05  line 24 col 01 value " ERROR - "  bell blink.
    05  line 24 col 11 pic x(60) from err-msg-comment.

01  blank-line-24.
    05  line 24 col 1 blank line.

01  blank-screen.
    05  blank screen.

01  scr-closing-screen.
    05  blank screen.
    05  line 6 col 20  value "NUMBER OF CHQ-DOC WORK READS    = ".
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  14
*                      r150c.cbl                                     )
    05  line 6 col 60  pic z(6)9 using ctr-wk-file-reads.
    05  line 7 col 20  value "NUMBER OF DOC-MSTR READS        = ".
    05  line 7 col 60  pic z(6)9 using ctr-doc-mstr-reads.
    05  line 8 col 20  value "NUMBER OF T4 REPORT WRITES      = ".
    05  line 8 col 60  pic z(6)9 using ctr-t4-writes.
    05  line 9 col 20  value "NUMBER OF AUDIT REPORT WRITES   = ".
    05  line 9 col 60  pic z(6)9 using ctr-audit-writes.
    05  line 21 col 20  value "PROGRAM R150C ENDING".
* (y2k - auto fix)
*   05  line 21 col 42  pic 99 using sys-yy.
    05  line 21 col 42  pic 9(4) using sys-yy.
    05  line 21 col 44  value "/".
    05  line 21 col 45  pic 99  using sys-mm.
    05  line 21 col 47  value "/".
    05  line 21 col 48  pic 99  using sys-dd.
    05  line 21 col 50  pic z9  using sys-hrs.
    05  line 21 col 52  value ":".
    05  line 21 col 53  pic 99  using sys-min.
    05  line 22 col 20  value "REPORTS ARE FOUND IN".
    05  line 22 col 42  pic x(6) using print-file-name .
    05  line 23 col 42  pic x(6) using print-audit-name .
procedure division.
declaratives.

err-doc-mstr-file section.
    use after standard error procedure on doc-mstr.
err-doc-mstr.
    stop "ERROR IN ACCESSING DOCTOR MASTER ".
*mf    move status-doc-mstr                        to common-status-file.
    move status-cobol-doc-mstr                     to common-status-file.
    display file-status-display.
    stop run.

err-doc-work-mstr-file section.
    use after standard error procedure on  doc-work-mstr.
err-doc-work-mstr.
    stop "ERROR IN ACCESSING DOCTOR WORK MASTER".
    move status-work-mstr                       to common-status-file.
    display file-status-display.
    stop run.

end declaratives.


mainline section.

    perform aa0-initialization                  thru aa0-99-exit.
    perform  ab0-mainline                       thru ab0-99-exit
                                                until end-wk-file.
    perform az0-end-of-job                      thru az0-99-exit.
    stop run.
aa0-initialization.

* (y2k)
    accept  sys-date                    from    date.
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.
* (y2k)
    move    sys-yy                      to      run-yy
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  15
*                      r150c.cbl                                     )
* (y2k)
                                                head-aud-yy.
    move    sys-mm                      to      run-mm
                                                head-aud-mm.
    move    sys-dd                      to      run-dd
                                                head-aud-dd.

    accept  sys-time                    from    time.
    move    sys-hrs                     to      run-hrs.
    move    sys-min                     to      run-min.
    move    sys-sec                     to      run-sec.

*    expunge   print-audit
*mf              print-file.

    open     input  doc-mstr
                    doc-work-mstr.
    open    output  print-file
                    print-audit.
    display program-in-progress.


    move spaces                         to      prt-line
                                                prt-audit
                                                blank-line
                                                hold-doc-name
                                                hold-inits.

    move zero                           to      counters
                                                totals
                                                hold-doc-nbr
                                                hold-tax
                                                hold-earnings.

    move 90                             to      ctr-line.

    read doc-work-mstr
             at end
                move  1                 to      err-ind
                move "Y"                to      flag-work-file
                perform za0-common-error
                                        thru    za0-99-exit
                go to az0-10-continue.

    add 1                               to      ctr-wk-file-reads.


    if not-eof-wk-file
    then
        move wk-doc-clinic-nbr          to      head-aud-clinic-nbr
        move wk-doc-inits               to      hold-inits
        move wk-doc-name                to      hold-doc-name
        move wk-doc-nbr                 to      hold-doc-nbr
        move wk-doc-earnings            to      hold-earnings
        move wk-doc-tax-ded             to      hold-tax
        move wk-sin                     to      hold-sin-nbr
        perform xa0-read-wk-file        thru    xa0-99-exit.
*   (else)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  16
*                      r150c.cbl                                     )
*   endif

aa0-99-exit.
  exit.
ab0-mainline.

    if wk-doc-nbr = hold-doc-nbr
    then
        add wk-doc-earnings             to      hold-earnings
        add wk-doc-tax-ded              to      hold-tax
    else
        perform bb0-print-reports       thru    bb0-99-exit
        perform cb0-clear-hold-area     thru    cb0-99-exit
        perform cb1-move-rec-to-hold    thru    cb1-99-exit.
*   endif

ab0-10-continue.
    perform xa0-read-wk-file            thru    xa0-99-exit.

ab0-99-exit.
   exit.

bb0-print-reports.

    move "Y"                            to      flag-doc-file.
    move hold-doc-nbr                   to      doc-nbr.

    perform  xb0-read-doc-mstr          thru    xb0-99-exit.

    perform bc0-print-t4                thru    bc0-99-exit.
    perform bd0-print-audit             thru    bd0-99-exit.

bb0-99-exit.
    exit.
bc0-print-t4.

    move "N"                            to      flag-pcode-write.

    write  prt-line  from  blank-line  after page.

    add hold-earnings, hold-tax         giving  d6-earnings.

*   (1999/jan/15)
*   write prt-line from detail-amt-6    after  1  lines.
    write prt-line from detail-amt-6    after  5  lines.


*   (the following 2 lines are commented on 86/02/20 by m.s.,
*    do not print income tax deducted on t4a slips.)
*   move hold-tax                       to      d7-tax.
*   write prt-line  from detail-amt-7 after 3 lines.

    move hold-sin-123                   to      det-sin-123.
    move hold-sin-456                   to      det-sin-456.
    move hold-sin-789                   to      det-sin-789.

    write  prt-line  from  detail-soc-nbr   after  3  lines.

* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  17
*                      r150c.cbl                                     )
*   (1999/jan)
    write prt-line from detail-addr-4 after 2 line.
*    write prt-line from detail-account-nbr  after  3  lines.

    move "DR. "                         to      d2-doc-lit.
    move hold-doc-nbr                   to      d2-doc-nbr.

    move spaces                         to      ws-init-name
                                                ws-initials.

    if hold-inits-1  not = spaces
    then
        move doc-init1                  to      ws-init1
        move "."                        to      ws-dot1.
*   (else)
*   endif

    if hold-inits-2 not = spaces
    then
        move doc-init2                  to      ws-init2
        move "."                        to      ws-dot2.
*   (else)
*   endif

    if hold-inits-3 not = spaces
    then
        move doc-init3                  to      ws-init3
        move "."                        to      ws-dot3.
*   (else)
*   endif
    string      ws-1st-init delimited by spaces,
                ws-2cd-init delimited by spaces,
                ws-3rd-init delimited by spaces,
                        into ws-init-name.
    move ws-init-name                   to      d2-init.
    move hold-doc-name                  to      d2-doc-name.

    write prt-line  from  detail-doc-name  after 1 lines.

    move doc-addr-home-1                to      d1-addr-1.
    write prt-line from detail-addr-1   after   1 line.


    move doc-addr-home-2                to      d2-addr-2.

    write prt-line from detail-addr-2 after 1 line.


    if doc-addr-home-3  not = spaces
    then
        move doc-addr-home-3            to      d3-addr-3
    else
        if    doc-addr-home-pc  not = spaces
          and doc-addr-home-pc  not = " 0 0 0"
        then
            move spaces                 to      d3-split
            move doc-addr-home-pc1      to      d3-pcode-1
            move doc-addr-home-pc2      to      d3-pcode-2
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  18
*                      r150c.cbl                                     )
            move doc-addr-home-pc3      to      d3-pcode-3
            move doc-addr-home-pc4      to      d3-pcode-4
            move doc-addr-home-pc5      to      d3-pcode-5
            move doc-addr-home-pc6      to      d3-pcode-6
            move "Y"                    to      flag-pcode-write
        else
            move spaces                 to      d3-addr-3
            move "Y"                    to      flag-pcode-write.
*       endif
*   endif
    write prt-line  from detail-addr-3 after 1 line.


*   (1999/jan)
*   if write-pcode
*   then
*       move spaces                     to      d4-pcode
*   else
*       if    doc-addr-home-pc not = spaces
*         and  doc-addr-home-pc not = " 0 0 0"
*       then
*           move spaces                 to      d4-split
*           move doc-addr-home-pc1      to      d4-pcode-1
*           move doc-addr-home-pc2      to      d4-pcode-2
*           move doc-addr-home-pc3      to      d4-pcode-3
*           move doc-addr-home-pc4      to      d4-pcode-4
*           move doc-addr-home-pc5      to      d4-pcode-5
*           move doc-addr-home-pc6      to      d4-pcode-6
*       else
*           move spaces                 to      d4-pcode.
*       endif
**  endif
*   write prt-line from detail-addr-4 after 1 line.

bc0-10-continue.

*   write prt-line from detail-addr-5 after 1 line.


    add 1                               to      ctr-t4-writes.

bc0-99-exit.
  exit.

bd0-print-audit.

    perform be0-move-write-audit        thru    be0-99-exit.

    if  ctr-flag-audit-writes = flag-audit-max-writes
     or ctr-flag-audit-writes > flag-audit-max-writes
     or end-wk-file
    then
        perform bf0-sub-totals          thru    bf0-99-exit.
*   (else)
*   endif

bd0-99-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  19
*                      r150c.cbl                                     )

be0-move-write-audit.

    if ctr-line > max-nbr-lines
    then
        perform xc0-headings            thru    xc0-99-exit.
*   (else)
*   endif

    if not-found-doc-nbr
    then
        move "******"                   to      d1-aud-doc-init
        move "UNKNOWN DOCTOR  "         to      d1-aud-doc-name
*mf        move "*"                        to      d1-aud-doc-dept
        move zero                       to      d1-aud-doc-dept
    else
        move hold-doc-name              to      d1-aud-doc-name
        perform be1-inits               thru    be1-99-exit
        move doc-dept                   to      d1-aud-doc-dept.
*   endif

    move hold-doc-nbr                   to      d1-aud-doc-nbr.
    move hold-tax                       to      d1-aud-tax.

*    (for the purposes of the report earnings are added to tax
*     to obtain gross earnings.)

    add hold-earnings, hold-tax         giving  d1-aud-earn.

    write prt-audit from detail-aud-1 after 1 line.

    add hold-tax                        to      total-earnings.
    add hold-earnings                   to      total-earnings.
    add hold-tax                        to      total-tax.
    add 1                               to      ctr-audit-writes
                                                ctr-line
                                                ctr-flag-audit-writes.
be0-99-exit.
  exit.



be1-inits.

    move spaces                         to      ws-initials.

    if hold-inits-1 not = spaces
    then
        move hold-inits-1               to      ws-init1
        move "."                        to      ws-dot1.
*   (else)
*   endif

    if hold-inits-2 not = spaces
    then
        move hold-inits-2               to      ws-init2
        move "."                        to      ws-dot2.
*   (else)
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  20
*                      r150c.cbl                                     )
*   endif

    if hold-inits-3 not = spaces
    then
        move hold-inits-3               to      ws-init3
        move "."                        to      ws-dot3.
*   (else)
*   endif

    string      ws-1st-init delimited by spaces,
                ws-2cd-init delimited by spaces,
                ws-3rd-init delimited by spaces,
                        into ws-init-name.

    move ws-init-name                   to      d1-aud-doc-init.

be1-99-exit.
    exit.


bf0-sub-totals.
    add total-earnings                  to      grand-total-earnings.
    add total-tax                       to      grand-total-tax.
    move "  SUB  TOTAL"                 to      tot-message.
    move total-earnings                 to      tot-aud-earn.
    move total-tax                      to      tot-aud-tax.
    move "*"                            to      tot-stars.
    move zero                           to      total-earnings
                                                total-tax
                                                ctr-flag-audit-writes.

    write prt-audit from tot-audit after 2 lines.
    move 90                             to      ctr-line.
bf0-99-exit.
   exit.
cb0-clear-hold-area.

    move zero                           to      hold-earnings
                                                hold-tax
                                                hold-sin-nbr
                                                hold-doc-nbr.

    move spaces                         to      hold-inits
                                                hold-doc-name.

cb0-99-exit.
  exit.


cb1-move-rec-to-hold.

    move wk-doc-nbr                     to      hold-doc-nbr.
    move wk-doc-inits                   to      hold-inits.
    move wk-doc-name                    to      hold-doc-name.
    move wk-doc-earnings                to      hold-earnings.
    move wk-doc-tax-ded                 to      hold-tax.

*   (the following statement is added on 86/02/20 by m.s.,
* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  21
*                      r150c.cbl                                     )
*    this will print different sin for each doctor.)

    move wk-sin                         to      hold-sin-nbr.

cb1-99-exit.
   exit.
xa0-read-wk-file.

    read doc-work-mstr next
         at end
            move "Y"                    to      flag-work-file
            go to az0-end-of-job.
    add 1                               to      ctr-wk-file-reads.

xa0-99-exit.
   exit.


xb0-read-doc-mstr.

    read doc-mstr
        invalid key
                move 2                  to      err-ind
                move "N"                to      flag-doc-file
                perform za0-common-error
                                        thru    za0-99-exit
                move 0                  to      err-ind
                move spaces             to      doc-mstr-rec
                go to xb0-99-exit.
    add 1                               to      ctr-doc-mstr-reads.

xb0-99-exit.
   exit.


xc0-headings.

    add 1                                       to      ctr-page.
    move ctr-page                               to      aud-head-page.
    write prt-audit  from head-audit-1 after advancing page.
    write prt-audit  from head-audit-2 after 2 lines.
    write prt-audit  from head-audit-3 after 1 line.
    write prt-audit  from blank-line   after 1 line.
    move 5                                      to      ctr-line.

xc0-99-exit.
   exit.
za0-common-error.

    move err-msg (err-ind)                      to      err-msg-comment.
    display confirm.
    display err-msg-line.
    stop " ".

za0-99-exit.
   exit.


* Micro Focus COBOL for UNIX         V4.0 revision 005 18-May-06 15:41 Page  22
*                      r150c.cbl                                     )
az0-end-of-job.

    perform bb0-print-reports                   thru    bb0-99-exit.


    move "FINAL  TOTAL"                         to      tot-message.
    move grand-total-earnings                   to      tot-aud-earn.
    move grand-total-tax                        to      tot-aud-tax.
    move "**"                                   to      tot-stars.
    write prt-audit from tot-audit after 2 lines.

az0-10-continue.

    close   print-file
            print-audit
            doc-mstr
            doc-work-mstr.

*    expunge doc-work-mstr.
* (y2k)
    accept  sys-date                            from    date.
    perform y2k-default-sysdate         thru y2k-default-sysdate-exit.
    accept  sys-time                            from    time.
    display scr-closing-screen.
    display confirm.
    stop run.

az0-99-exit.
  exit.


    copy "y2k_default_sysdate_century.rtn".
y2k-default-sysdate.

    move sys-date-left                  to sys-date-temp.
    move sys-date-temp                  to sys-date-right.
    move zeros                          to sys-date-blank.
* 1999/dec/30 B.E.
*   add 19000000                        to sys-date-numeric.
    add 20000000                        to sys-date-numeric.

y2k-default-sysdate-exit.
    exit.
* Micro Focus COBOL for UNIX         V4.0 revision 005 Compiler
* Copyright (C) 1984-1995 Micro Focus Ltd.     URN 2XUPG/GB0/00000F
*                                              REF GNB-030056000AA
*
* Total Messages:     0
* Data:        5912     Code:        4108
